/////////////////
//LOCAL STORAGE (USEFUL)//
/////////////////
//PROID
//OTP
//PHN
//USERINFO
//CONTACTS
//RELATIONPROFILEID //pro id of friend
//SINGLECHATID
//CELID  //any
//CID   //my
//MYCELEBPROFILEINFO
//LASTCONTACTID
//GRPSTATUS
//GRPIDLIST //raw various groups basic data
//Profile Diversions setGeneratorId("id") ::: setGroupId("id")  ::: setCelebId("id")
//
//Comment Screen Diversion   :::  setPostId("id") setCelebPostId("id") setGroupPostId("id")
//
//Camera Non crashable
var appState = {
    takingPicture: true,
    imageUri: ""
};
var APP_STORAGE_KEY = "exampleAppState";
var cameraExport = {};
var pageLocation = window.location.pathname.split('/').reverse()[0];
var smsList = [];
var interceptEnabled = false;
var server = "http://www.mymsgapp.com/services/";
//important global variable 

var checkBox = false;
var interval = "";
var proPicUpdated = false;
var coverPicUpdated = false;
var progressStatus = "";
// This state represents the state of our application and will be saved and
// restored by onResume() and onPause()
var cameraAppStatus = true;
var fileURL = "";
var checkURL = "";
var checkURLC = "";

var pendingAudio = false;
var backpressCounter = 0;
var notify = 0;
var push = "";
var pushwp = "";

var timerIndex = "";
var firstCall = false;
var currentPage = 0; //0 = Home 1= Group

var megaLoad1 = false;
var megaLoad2 = false;
var megaLoad3 = false;
var megaLoad4 = false;
var megaLoad5 = false;
var megaLoad6 = false;

$(document).ready(function() {
    if (pageLocation == 'index.html') {
        //EMOJI POPULATE
        var tabs = [];
        var counter = [];
        counter[0] = 0;
        counter[1] = 0;
        counter[2] = 0;
        counter[3] = 0;
        counter[4] = 0;
        counter[5] = 0;
        counter[6] = 0;
        counter[7] = 0;
        counter[8] = 0;
        counter[9] = 0;
        tabs[0] = '<div class="row">';
        tabs[1] = '<div class="row">';
        tabs[2] = '<div class="row">';
        tabs[3] = '<div class="row">';
        tabs[4] = '<div class="row">';
        tabs[5] = '<div class="row">';
        tabs[6] = '<div class="row">';
        tabs[7] = '<div class="row">';
        tabs[8] = '<div class="row">';
        tabs[9] = '<div class="row">';
        for (var key in emojiList) {
            if (emojiList[key].unicode.indexOf('-') > -1 && emojiList[key].unicode.indexOf('-1f1') == -1) continue;
            switch (emojiList[key].category) {
                case emojiCategory[0]:
                    tabs[0] += '<div class="col-10" onclick="setInput(this)" data-emoji-name="' + emojiList[key].shortname + '" ><a><img src="emoji/' + emojiList[key].unicode + '.svg" style="width: 75%;" /></a></div>';
                    counter[0]++;
                    //console.log(counter[0]);
                    if (counter[0] == 10) {
                        counter[0] = 0;
                        tabs[0] += '</div> <div class="row">';
                    }
                    break;
                case emojiCategory[1]:
                    //document.write('<img width="50px" height="50px" src="emoji/'+emojiList[key].unicode+'.svg"> : '+emojiList[key].unicode+'<br>');
                    counter[1]++;
                    tabs[1] += '<div class="col-10" onclick="setInput(this)" data-emoji-name="' + emojiList[key].shortname + '" ><a><img src="emoji/' + emojiList[key].unicode + '.svg" style="width: 75%;" /></a></div>';
                    if (counter[1] == 10) {
                        counter[1] = 0;
                        tabs[1] += '</div> <div class="row">';
                    }
                    break;
                case emojiCategory[2]:
                    tabs[2] += '<div class="col-10" onclick="setInput(this)" data-emoji-name="' + emojiList[key].shortname + '" ><a><img src="emoji/' + emojiList[key].unicode + '.svg" style="width: 75%;" /></a></div>';
                    counter[2]++;
                    if (counter[2] == 10) {
                        counter[2] = 0;
                        tabs[2] += '</div> <div class="row">';
                    }
                    break;
                case emojiCategory[3]:
                    tabs[3] += '<div class="col-10" onclick="setInput(this)" data-emoji-name="' + emojiList[key].shortname + '" ><a><img src="emoji/' + emojiList[key].unicode + '.svg" style="width: 75%;" /></a></div>';
                    counter[3]++;
                    if (counter[3] == 10) {
                        counter[3] = 0;
                        tabs[3] += '</div> <div class="row">';
                    }
                    break;
                case emojiCategory[4]:
                    tabs[4] += '<div class="col-10" onclick="setInput(this)" data-emoji-name="' + emojiList[key].shortname + '" ><a><img src="emoji/' + emojiList[key].unicode + '.svg" style="width: 75%;" /></a></div>';
                    counter[4]++;
                    if (counter[4] == 10) {
                        counter[4] = 0;
                        tabs[4] += '</div> <div class="row">';
                    }
                    break;
                case emojiCategory[5]:
                    tabs[5] += '<div class="col-10" onclick="setInput(this)" data-emoji-name="' + emojiList[key].shortname + '" ><a><img src="emoji/' + emojiList[key].unicode + '.svg" style="width: 75%;" /></a></div>';
                    counter[5]++;
                    if (counter[5] == 10) {
                        counter[5] = 0;
                        tabs[5] += '</div> <div class="row">';
                    }
                    break;

                case emojiCategory[6]:

                    tabs[6] += '<div class="col-10" onclick="setInput(this)" data-emoji-name="' + emojiList[key].shortname + '" ><a><img src="emoji/' + emojiList[key].unicode + '.svg" style="width: 75%;" /></a></div>';
                    counter[6]++;
                    if (counter[6] == 10) {
                        counter[6] = 0;
                        tabs[6] += '</div> <div class="row">';
                    }
                    break;

                case emojiCategory[7]:

                    tabs[7] += '<div class="col-10" onclick="setInput(this)" data-emoji-name="' + emojiList[key].shortname + '" ><a><img src="emoji/' + emojiList[key].unicode + '.svg" style="width: 75%;" /></a></div>';
                    counter[7]++;
                    if (counter[7] == 10) {
                        counter[7] = 0;
                        tabs[7] += '</div> <div class="row">';
                    }
                    break;

                case emojiCategory[8]:

                    tabs[8] += '<div class="col-10" onclick="setInput(this)" data-emoji-name="' + emojiList[key].shortname + '" ><a><img src="emoji/' + emojiList[key].unicode + '.svg" style="width: 75%;" /></a></div>';
                    counter[8]++;
                    if (counter[8] == 10) {
                        counter[8] = 0;
                        tabs[8] += '</div> <div class="row">';
                    }
                    break;

                case emojiCategory[9]:
                    tabs[9] += '<div class="col-10" onclick="setInput(this)" data-emoji-name="' + emojiList[key].shortname + '" ><a><img src="emoji/' + emojiList[key].unicode + '.svg" style="width: 75%;" /></a></div>';
                    counter[9]++;
                    if (counter[9] == 10) {
                        counter[9] = 0;
                        tabs[9] += '</div> <div class="row">';
                    }
                    break;

            }
        }
        var emoji = "";
        // for (var i = 0; i < tabs.length; i++) {
        //     emoji += tabs[i] + '</div>';
        // }
        localStorage.setItem("EMOJI1", tabs[0] + "</div>");
        localStorage.setItem("EMOJI2", tabs[1] + "</div>");
        localStorage.setItem("EMOJI3", tabs[2] + "</div>");
        localStorage.setItem("EMOJI4", tabs[3] + "</div>");
        localStorage.setItem("EMOJI5", tabs[4] + "</div>");
        localStorage.setItem("EMOJI6", tabs[5] + "</div>");
        localStorage.setItem("EMOJI7", tabs[6] + "</div>");
        localStorage.setItem("EMOJI8", tabs[7] + "</div>");
        localStorage.setItem("EMOJI9", tabs[8] + "</div>");
        localStorage.setItem("EMOJI10", tabs[9] + "</div>");
        megaLoad1 = true;
        console.log("1-megaUpload:" + megaLoad1);
    }

    if (pageLocation == 'profile.html') {
        fetchProfile();
    }
    if (pageLocation == 'user_profile_edit.html') {
        extractProfile();
    }
    if (pageLocation == 'friend_profile.html') {
        fetchFriendProfile();
    }
    if (pageLocation == 'singlechat.html') {

        fetchSingleChat();
        //checkPostShare(); /// for demonstrational purposes
        setInterval(function() {
            fetchSingleChat();
        }, 1000);
        // populateEmoji(1);

    }

    if (pageLocation == 'chat.html') {
        if (localStorage.getItem("USERINFO") === null || localStorage.getItem("USERINFO") === "") {
            fetchPreProfile();
        } else {
            var data1 = JSON.parse(localStorage.getItem("USERINFO"));
            document.getElementById('profilePicture').style.backgroundImage = "url(" + server + getThumb(data1[0].imageURL) + ")";
            document.getElementById("profileQuote").innerHTML = '"' + data1[0].quote + '"';
        }
        if (localStorage.getItem("CELEBAPPLIED") == 1) {
            document.getElementById("celebStatus").style.display = 'block';
            if (localStorage.getItem("CELEBSTATUS") == 1) {
                document.getElementById("celebStatus").setAttribute("onclick", "location.href = 'celeb_posts.html'");
            } else {
                document.getElementById("celebStatus").setAttribute("onclick", "location.href = 'celeb_pending.html'");
            }
        } else {
            document.getElementById("celebStatus").style.display = 'none';
        }

        fetchActiveChatList();
        if (localStorage.getItem("COUNT") === null || localStorage.getItem("COUNT") === "") {
            notificationCounter();
        } else {
            document.getElementById('notificationCount').innerHTML = localStorage.getItem("COUNT");
        }
        notificationCounter();
        setInterval(function() {
            notificationCounter();
            messageCounter();
        }, 10000);
    }

    if (pageLocation == 'comment_screen.html') {
        fetchComments();
        setInterval(function() {
            fetchComments();
        }, 6000);
    }
    if (pageLocation == 'celebrity_comment_screen.html') {
        fetchCelebrityComments();
        setInterval(function() {
            fetchCelebrityComments();
        }, 6000);
    }
    if (pageLocation == 'group_comment_screen.html') {
        fetchGroupComments();
        setInterval(function() {
            fetchGroupComments();
        }, 6000);
    }

    if (pageLocation == 'addgroup.html') {
        populateContacts();
    }
    if (pageLocation == 'groups.html') {
        if (localStorage.getItem("USERINFO") === null && localStorage.getItem("USERINFO") === "") {
            fetchPreProfile();
        }
        fetchActiveGroupList();
    }
    if (pageLocation == 'groupchat.html') {
        fetchGroupChat();
        setInterval(function() {
            fetchGroupChat();
        }, 2000);
        //populateEmoji(1);
    }
    if (pageLocation == 'group_info.html') {
        fetchGroupInfo();
    }
    if (pageLocation == 'groupedit.html') {
        extractGroupInfo();
    }
    if (pageLocation == 'social.html') {
        //console.log(localStorage.getItem("USERINFO"));
        if (localStorage.getItem("USERINFO") === null || localStorage.getItem("USERINFO") === "") {
            fetchPreProfile();
        } else {
            var data2 = JSON.parse(localStorage.getItem("USERINFO"));
            document.getElementById('profilePicture').style.backgroundImage = "url(" + server + getThumb(data2[0].imageURL) + ")";
            document.getElementById("profileQuote").innerHTML = '"' + data2[0].quote + '"';
        }

        if (localStorage.getItem("CID") === null || localStorage.getItem("CID") === "") {
            checkCelebrityStatus();
        } else {
            fetchCelebrityList();
        }
        if (localStorage.getItem("COUNT") === null || localStorage.getItem("COUNT") === "") {
            notificationCounter();
        } else {
            document.getElementById('notificationCount').innerHTML = localStorage.getItem("COUNT");
        }
        notificationCounter();
        setInterval(function() {
            notificationCounter();
        }, 10000);
    }

    if (pageLocation == 'celeb_profile.html') {
        fetchCelebrityDetail();
    }
    if (pageLocation == 'celeb_posts.html') {


        if (localStorage.getItem("CID") === null || localStorage.getItem("CID") === "") {

        } else {
            //document.getElementById("requestPending").style.display = 'none';
            fetchMyCelebrityPost();
        }

    }
    if (pageLocation == 'my_celeb_profile.html') {
        fetchMyCelebrityProfile();
    }
    if (pageLocation == 'edit_celeb_profile.html') {
        proPicUpdated = false;
        coverPicUpdated = false;
        extractMyCelebrityProfile();
    }
    if (pageLocation == "group_posts.html") {
        fetchGroupPost();
    }
    if (pageLocation == "notifications.html") {
        fetchNotification();
    }
    if (pageLocation == 'wallet.html') {
        fetchWallet();
    }
});

var app = {
    // Application Constructor
    initialize: function() {
        this.bindEvents();
    },
    // Bind Event Listeners
    //
    // Bind any events that are required on startup. Common events are:
    // 'load', 'deviceready', 'offline', and 'online'.
    bindEvents: function() {
        document.addEventListener('deviceready', this.onDeviceReady, false);
        document.addEventListener('pause', this.onPause, false);
        document.addEventListener('resume', this.onResume, false);
        document.addEventListener('backbutton', this.backkeypress, false);
        //////////////////
        // add an event //
        //////////////////
        //document.addEventListener('deviceready', , false);
    },
    // deviceready Event Handler
    //
    // The scope of 'this' is the event. In order to call the 'receivedEvent'
    // function, we must explicitly call 'app.receivedEvent(...);'
    onDeviceReady: function() {

        checkConnection(0);

        /////////////////////////
        // LOCAL NOTIFICATIONS //
        /////////////////////////
        // cordova.plugins.notification.local.hasPermission(function(granted) {
        //     if (granted) {
        //         console.log("APPROVED");
        //         schedule(notify++, "Active", "Notifications Are Now Active", new Date(), "111");
        //     } else {
        //         cordova.plugins.notification.local.registerPermission(function(grant) {
        //             if (grant) {
        //                 console.log("APPROVED");
        //             } else {
        //                 console.log("NO");
        //             }
        //         });
        //     }
        // });
        // cordova.plugins.notification.local.on("click", function(notification) {
        //     alert(notification.data.redirectId);
        // });

        if (pageLocation == 'index.html') {
            if (localStorage.getItem("PROID") === null || localStorage.getItem("PROID") === "") {
                console.log("PROID NOT SET");
                megaLoad2 = true;
                megaLoad3 = true;
                megaLoad4 = true;
                megaLoad5 = true;
                megaLoad6 = true;
                console.log("YYY");
                window.location = "login.html";
            } else {
                console.log("PROID SET");
                contactFetch(); //megaLoad2
                //fetchRelation(); //megaLoad3
                //dataFeedRefresh(); //megaLoad4 //then dataFeedPopulate 
                fetchGroupList(); //megaLoad5
                fetchPreProfile(); //megaLoad6
                timerIndex = setTimeout(function() {
                    console.log("XXX");
                    // if (megaLoad1 && megaLoad2 && megaLoad3 && megaLoad4 && megaLoad5 && megaLoad6) {
                    if (window.localStorage.getItem("VALIDATED") == "PROFILE") {
                        window.location = "user_profile.html";
                    } else if (window.localStorage.getItem("VALIDATED") == "HOME") {
                        window.location = "home.html";
                    } else {
                        window.location = "login.html";
                    }
                    //}
                }, 4000);
            }
            checkConnection(0);
        }

        // window.plugin.CanvasCamera is now available
        if (pageLocation == 'otp.html') {
            initApp();
        }
        if (pageLocation == 'login.html') {
            navigator.globalization.getPreferredLanguage(successCallback, errorCallback);
        }
        if (pageLocation == 'home.html') {

            ////////////////////////
            //PUSH NOTIFICATIONS  //
            ////////////////////////
            if (localStorage.getItem("NOTIFICATIONID") === "" || localStorage.getItem("NOTIFICATIONID") === null) {
                if (device.platform == 'android' || device.platform == 'Android' || device.platform == "ios") {
                    //alert('in android/ios');
                    push = PushNotification.init({
                        'android': {
                            'senderID': "440801567822",
                            sound: "true",
                            vibration: "true",
                            icon: "icon"
                                // iconColor: "#3dcae3"
                        },
                        "GCM": {
                            title: "Large Icon",
                            message: "Loaded from drawables folder",
                            image: "icon"
                        },
                        browser: {
                            pushServiceURL: 'http://push.api.phonegap.com/v1/push'
                        },
                        ios: {
                            alert: "true",
                            badge: "true",
                            sound: "true"
                        },
                        windows: {}
                    });
                    main();
                } else if (device.platform == 'Win32NT') {
                    //alert('in win');
                    pushwp = window.plugins.pushNotification;
                    //alert("PushWP value:" + pushwp);
                    mainwp();
                }
            }
            if (localStorage.getItem("DATAFEED") === null || localStorage.getItem("DATAFEED") === "") {
                firstCall = true;
                dataFeedRefresh();
            } else {
                if (localStorage.getItem("LATESTFOLLOWCELEB") === "" || localStorage.getItem("LATESTFOLLOWCELEB") === null) {
                    dataFeedRefreshPopulate();
                } else {
                    firstCall = true;
                    dataFeedRefresh();
                    localStorage.setItem("LATESTFOLLOWCELEB", "");
                }

            }
            if (localStorage.getItem("HOMEGROUPLIST") === null || localStorage.getItem("HOMEGROUPLIST") === "") {
                fetchGroupList();
            } else {
                setTimeout(function() {
                    fetchGroupList("R");
                }, 5000);
                fetchGroupListPopulate();
            }
            if (localStorage.getItem("CONTACTS") === null || localStorage.getItem("CONTACTS") === "") {
                contactFetch();
            } else {

            }
            if (localStorage.getItem("USERINFO") == null || localStorage.getItem("USERINFO") == "") {
                fetchPreProfile();
            } else {
                var data = JSON.parse(localStorage.getItem("USERINFO"));
                document.getElementById('profilePicture').style.backgroundImage = "url(" + server + getThumb(data[0].imageURL) + ")";
                document.getElementById("profileQuote").innerHTML = '"' + data[0].quote + '"';
            }
            if (localStorage.getItem("CELEBAPPLIED") == 1) {
                document.getElementById("celebStatus").style.display = 'block';
                if (localStorage.getItem("CELEBSTATUS") == 1) {
                    document.getElementById("celebStatus").setAttribute("onclick", "location.href = 'celeb_posts.html'");
                } else {
                    document.getElementById("celebStatus").setAttribute("onclick", "location.href = 'celeb_pending.html'");
                }
            } else {
                document.getElementById("celebStatus").style.display = 'none';
            }
            if (localStorage.getItem("COUNT") === null || localStorage.getItem("COUNT") === "") {
                notificationCounter();
            } else {
                document.getElementById('notificationCount').innerHTML = localStorage.getItem("COUNT");
            }
            notificationCounter();
            setInterval(function() {
                notificationCounter();
            }, 10000);
            //fetchInfo(); //instead used fetch preprofile
            //checkUserStatus(); // this or contactFech();
            //contactFetch(); //done in index.html
            // setInterval(function() {
            //     fetchRelation();
            // }, 300000);

        }

        if (pageLocation == 'contacts.html') {
            if (localStorage.getItem("CONTACTS") === null || localStorage.getItem("CONTACTS") === "") {
                contactFetch('CON');
            } else {
                fetchContacts();
                fetchContactRelation();
            }

            // setInterval(function() {
            //     fetchContactRelation();
            // }, 6000);
        }
        // MEDIA FETCH
        if (localStorage.getItem("PAGELOC") == 'user_profile.html') {
            if (localStorage.getItem("PAGERED") == "TAKE") {
                takePhotoSuccess(localStorage.getItem("PAGEINTAKE"));
            } else if (localStorage.getItem("PAGERED") == "GET") {
                getPhotoSuccess(localStorage.getItem("PAGEINTAKE"));
            }
            localStorage.setItem("PAGELOC", "");
        }
        if (localStorage.getItem("PAGELOC") == 'home.html') {
            if (localStorage.getItem("PAGERED") == "TAKE") {
                postTakePhotoSuccess(localStorage.getItem("PAGEINTAKE"));
            } else if (localStorage.getItem("PAGERED") == "GET") {
                postGetPhotoSuccess(localStorage.getItem("PAGEINTAKE"));
            }
            localStorage.setItem("PAGELOC", "");
        }
        if (localStorage.getItem("PAGELOC") == 'singlechat.html') {
            if (localStorage.getItem("PAGERED") == "TAKE") {
                chatTakePhotoSuccess(localStorage.getItem("PAGEINTAKE"));
            } else if (localStorage.getItem("PAGERED") == "GET") {
                chatGetPhotoSuccess(localStorage.getItem("PAGEINTAKE"));
            }
            localStorage.setItem("PAGELOC", "");
        }
        if (localStorage.getItem("PAGELOC") == 'addgroup.html') {
            if (localStorage.getItem("PAGERED") == "TAKE") {
                takeGroupDisplayPhotoSuccess(localStorage.getItem("PAGEINTAKE"));
            } else if (localStorage.getItem("PAGERED") == "GET") {
                getGroupDisplayPhotoSuccess(localStorage.getItem("PAGEINTAKE"));
            }
            localStorage.setItem("PAGELOC", "");
        }
        if (localStorage.getItem("PAGELOC") == 'create_celeb_profile.html') {
            if (localStorage.getItem("CELEBPICTYPE") == "COVER") {
                if (localStorage.getItem("PAGERED") == "TAKE") {
                    takePictureCSuccess(localStorage.getItem("PAGEINTAKE"));
                } else if (localStorage.getItem("PAGERED") == "GET") {
                    getPictureCSuccess(localStorage.getItem("PAGEINTAKE"));
                }
            }
            if (localStorage.getItem("CELEBPICTYPE") == "DP") {
                if (localStorage.getItem("PAGERED") == "TAKE") {
                    takePictureSuccess(localStorage.getItem("PAGEINTAKE"));
                } else if (localStorage.getItem("PAGERED") == "GET") {
                    getPictureSuccess(localStorage.getItem("PAGEINTAKE"));
                }
            }
            localStorage.setItem("PAGELOC", "");
        }
        if (localStorage.getItem("PAGELOC") == 'celeb_posts.html') {
            if (localStorage.getItem("PAGERED") == "TAKE") {
                postCelebTakePhotoSuccess(localStorage.getItem("PAGEINTAKE"));
            } else if (localStorage.getItem("PAGERED") == "GET") {
                postCelebGetPhotoSuccess(localStorage.getItem("PAGEINTAKE"));
            }
            localStorage.setItem("PAGELOC", "");
        }
        if (localStorage.getItem("PAGELOC") == 'group_posts.html') {
            if (localStorage.getItem("PAGERED") == "TAKE") {
                postGroupTakePhotoSuccess(localStorage.getItem("PAGEINTAKE"));
            } else if (localStorage.getItem("PAGERED") == "GET") {
                postGroupGetPhotoSuccess(localStorage.getItem("PAGEINTAKE"));
            }
            localStorage.setItem("PAGELOC", "");
        }
        app.receivedEvent('deviceready');

    },
    onPause: function() {
        makeOffline();
        console.log("PAUSED");
        if (appState.takingPicture || appState.imageUri) {
            window.localStorage.setItem(APP_STORAGE_KEY, JSON.stringify(appState));
        }
    },
    onResume: function(event) {
        makeOnline();
        console.log("RESUME");
        var storedState = window.localStorage.getItem(APP_STORAGE_KEY);

        if (storedState) {
            appState = JSON.parse(storedState);
        }
        if (!appState.takingPicture && appState.imageUri) {
            console.log("PRE:" + appState.imageUri);
        } else if (appState.takingPicture && event.pendingResult) {
            if (event.pendingResult.pluginStatus === "OK") {
                localStorage.setItem("PAGEINTAKE", event.pendingResult.result);
                location.href = localStorage.getItem("PAGELOC");
            } else {
                console.log(event.pendingResult.result);
            }
        }
    },
    // Update DOM on a Received Event
    receivedEvent: function(id) {
        console.log('Received Event: ' + id);
    },
    backkeypress: function() {
        if (pageLocation == 'login.html' || pageLocation == 'otp.html') {
            navigator.app.exitApp();
        } else if (pageLocation == 'home.html') {
            console.log("PA:" + pendingAudio);
            if (pendingAudio) {
                backpressCounter++;
                if (backpressCounter == 2) {
                    closePopup();
                }
            } else {
                if ($('.cd-popup').hasClass('is-visible')) {
                    closePopup();
                } else {
                    makeOffline();
                    navigator.app.exitApp();
                }

            }

        } else if (pageLocation == 'singlechat.html') {
            console.log("PA:" + pendingAudio);
            if (pendingAudio) {
                backpressCounter++;
                if (backpressCounter == 2) {
                    closeChatPopup();
                }
            } else {
                if ($('.send-attach-outer').hasClass('send-attach-outer-visible')) {
                    closeChatPopup();
                } else {
                    window.history.back();
                }
            }

        } else if (pageLocation == 'groupchat.html') {

            if ($('.send-attach-outer').hasClass('send-attach-outer-visible')) {
                closeChatPopup();
            } else {
                window.history.back();
            }

        } else if (pageLocation == 'celeb_posts.html') {
            console.log("PA:" + pendingAudio);
            if (pendingAudio) {
                backpressCounter++;
                if (backpressCounter == 2) {
                    closePopup();
                }
            } else {
                if ($('.cd-popup').hasClass('is-visible')) {
                    closePopup();
                } else {
                    makeOffline();
                    navigator.app.exitApp();
                }

            }

        } else if (pageLocation == 'group_posts.html') {
            console.log("PA:" + pendingAudio);
            if (pendingAudio) {
                backpressCounter++;
                if (backpressCounter == 2) {
                    closePopup();
                }
            } else {
                if ($('.cd-popup').hasClass('is-visible')) {
                    closePopup();
                } else {
                    makeOffline();
                    navigator.app.exitApp();
                }

            }

        } else if (pageLocation == 'user_profile.html') {
            alert("Processing underway...");
        } else {
            window.history.back();
        }
    }
};

app.initialize();



/////////////// //
//login.html // //
/////////////// //
function sendOtp(argument) {
    if (checkBox) {
        $("#tncNotify").html("Please Accept T&C To Proceed.");
    } else {
        var phoneReg = /^(\+\d{1,3}[- ]?)?\d{10}$/;
        var phoneNo = document.getElementById("phoneNo").value;
        if (phoneNo.match(phoneReg)) {
            var xhttp = new XMLHttpRequest();
            document.getElementById('sendOtpButton').innerHTML = "Processing";
            document.getElementById('sendOtpButton').setAttribute('onclick', '');
            xhttp.onreadystatechange = function() {
                if (xhttp.readyState == 4 && xhttp.status == 200) {
                    //console.log(xhttp.responseText.trim());
                    if (xhttp.responseText.indexOf("error") == -1) {
                        // console.log();
                        if (xhttp.responseText.trim().split("%").length == 3) {
                            localStorage.setItem("LOGIN", "1");
                        }
                        localStorage.setItem("PHN", document.getElementById("countryCode").placeholder + phoneNo);
                        localStorage.setItem("OTP", xhttp.responseText.trim().split("%")[0]);
                        localStorage.setItem("PROID", xhttp.responseText.trim().split("%")[1].trim());

                        location.href = "otp.html";
                        // $(".pre-otp").fadeOut("fast");
                        //  $(".post-otp").fadeIn("fast");
                    } else {
                        $(".err-input").addClass("err");
                        $("#phoneNoNotify").html("Mobile Number Already Registed.");
                        document.getElementById('sendOtpButton').innerHTML = "Next";
                        document.getElementById('sendOtpButton').setAttribute('onclick', 'sendOtp();');
                    }
                }
            };
            xhttp.open("POST", server + "entry.php", true);
            var parameters = "phNo=" + encodeURIComponent(document.getElementById("countryCode").placeholder + phoneNo);
            xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhttp.send(parameters);
        } else {
            $(".err-input").addClass("err");
            $("#phoneNoNotify").html("Please Enter Correct Mobile Number.");
        }
    }
}

function checkCountry(th) {
    localStorage.setItem("COUNTRY", $(th).find(".country-name").text());
    localStorage.setItem("CODE", $(th).find(".item-note-right").text());
    localStorage.setItem("SELECTEDCC", "1");
    location.href = "login.html";
}

//locale finder
function successCallback(obj) {
    var locale = obj.value.split("-")[1];
    if (localStorage.getItem("SELECTEDCC") == "1") {
        document.getElementById("country").setAttribute("placeholder", localStorage.getItem("COUNTRY"));
        document.getElementById("countryCode").setAttribute("placeholder", localStorage.getItem("CODE"));
    } else {
        if (ccGenerator(locale)) {
            document.getElementById("country").setAttribute("placeholder", localStorage.getItem("COUNTRY"));
            document.getElementById("countryCode").setAttribute("placeholder", localStorage.getItem("CODE"));
        }
    }

}

function errorCallback(obj) {
    document.getElementById("country").setAttribute("placeholder", "India");
    document.getElementById("countryCode").setAttribute("placeholder", "+91");
}


///////////// //
//otp.html // //
///////////// //
function startTimer(duration, display) {
    var timer = duration,
        minutes, seconds;
    interval = setInterval(function() {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.text(minutes + ":" + seconds);

        if (--timer < 0) {
            timer = duration;
        }
    }, 1000);
}

function reSendOtp(argument) {
    popupOpenbtn1();
    var fiveMinutes = 60 * 5,
        display = $('#time');
    startTimer(fiveMinutes, display);
    document.getElementById("phoneNoVerify").value = "";
    var phoneNo = localStorage.getItem("PHN");
    var id = localStorage.getItem("PROID");
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            if (xhttp.responseText.trim() !== " ") {
                console.log(xhttp.responseText.trim());
                localStorage.setItem("OTP", xhttp.responseText.trim());
                clearInterval(interval);
                listSMS();
                startWatch();
            }
        }
    };
    xhttp.open("POST", server + "reEntry.php", true);
    var parameters = "phNo=" + encodeURIComponent(phoneNo) + "&id=" + id;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function initApp() {
    console.log("InitApp");
    if (!SMS) {
        console.log('SMS plugin not ready');
        return;
    }
    listSMS();
    startWatch();
    document.addEventListener('onSMSArrive', function(e) {
        var data = e.data;
        console.log("PostInitApp " + data);
        smsList.push(data);

        updateStatus('SMS arrived, count: ' + smsList.length);
        if (data.body.indexOf("MSG") != -1) {
            var con = parseInt(data.body);
            console.log(con);
            verify(con);
        }

    });
}

function update(id, str) {
    console.log("UPDATE " + id + ":::" + str);
}

function updateStatus(str) {
    console.log("UPDATESTATUS " + str);
}

function updateData(str) {
    console.log("UPDATEDATA " + str);
}

function listSMS() {

    updateData('');

    if (SMS) SMS.listSMS({}, function(data) {
        updateStatus('sms listed as json array');
        //updateData( JSON.stringify(data) );

        var html = "";
        if (Array.isArray(data)) {
            for (var i in data) {
                var sms = data[i];
                smsList.push(sms);
                html += sms.address + ": " + sms.body + "<br/>";
            }
        }
        updateData(html);

    }, function(err) {
        updateStatus('error list sms: ' + err);
    });
}

function startWatch() {

    if (SMS) SMS.startWatch(function() {
        update('watching', 'watching started');
    }, function() {
        updateStatus('failed to start watching');
    });
}

function stopWatch() {
    if (SMS) SMS.stopWatch(function() {
        update('watching', 'watching stopped');
    }, function() {
        updateStatus('failed to stop watching');
    });
}

/////////////
//Not USED //
/////////////
function sendSMS() {
    // var sendto = $('input#sendto').val().trim();
    // var textmsg = $('textarea#textmsg').val();
    // if (sendto.indexOf(";") >= 0) {
    //     sendto = sendto.split(";");
    //     for (i in sendto) {
    //         sendto[i] = sendto[i].trim();
    //     }
    // }
    // if (SMS) SMS.sendSMS(sendto, textmsg, function() {}, function(str) { console.log(str); });
}

function deleteLastSMS() {
    // updateData('');
    // if (smsList.length === 0) {
    //     updateStatus('no sms id to delete');
    //     return;
    // }

    // var sms = smsList.pop();

    // if (SMS) SMS.deleteSMS({
    //     _id: sms["_id"]
    // }, function(n) {
    //     updateStatus(n + ' sms messages deleted');
    // }, function(err) {
    //     updateStatus('error delete sms: ' + err);
    // });
}

function restoreAllSMS() {
    updateData('');

    if (SMS) SMS.restoreSMS(smsList, function(n) {
        // clear the list if restore successfully
        smsList.length = 0;
        updateStatus(n + ' sms messages restored');

    }, function(err) {
        updateStatus('error restore sms: ' + err);
    });
}

function toggleIntercept() {
    interceptEnabled = !interceptEnabled;

    if (interceptEnabled) { // clear the list before we start intercept
        smsList.length = 0;
    }

    if (SMS) SMS.enableIntercept(interceptEnabled, function() {}, function() {});

    console.log('intercept ' + (interceptEnabled ? 'ON' : 'OFF'));
    console.log(interceptEnabled ? 'Disable' : 'Enable');
}
//Auto Verificaton
function verify(arg) {
    console.log("AUTO Veri" + arg);
    if (arg == localStorage.getItem("OTP")) {
        if (localStorage.getItem("LOGIN") == "1") {
            loadingOn();
            setTimeout(function() {
                window.localStorage.setItem("VALIDATED", "HOME");
                window.location.href = "home.html";
            }, 500);
        } else {
            setVerified();
        }

    }
}

//Manual Verification
function verifyOtp(argument) {
    var sixReg = /^[0-9]{6,6}$/;
    var sixNo = document.getElementById("phoneNoVerify").value;
    if (sixNo.match(sixReg)) {
        if (sixNo == localStorage.getItem("OTP")) {
            if (localStorage.getItem("LOGIN") == "1") {
                loadingOn();
                setTimeout(function() {
                    window.localStorage.setItem("VALIDATED", "HOME");
                    window.location.href = "home.html";
                }, 500);

            } else {
                setVerified();
            }
        } else {
            $('.err-input').addClass('err');
            $(".err-notify").html("Invalid O.T.P");
        }
    } else {
        $('.err-input').addClass('err');
        $(".err-notify").html("6 digits required.");
    }
}

function removeErr(argument) {
    $('.err-input').removeClass('err');
    $(".err-notify").html("");
}

function setVerified(argument) {
    loadingOn();
    var proId = localStorage.getItem("PROID");
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                window.location.href = "user_profile.html";
            }

        }
    };
    xhttp.open("POST", server + "setVerified.php", true);
    var parameters = "proId=" + proId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

/////////////////
//profile.html //
/////////////////

function removeErrPro(argument) {
    $("#proName").css("border-bottom", "1px solid #bdbdbd");
    $("#proEmail").css("border-bottom", "1px solid #bdbdbd");
    $("#proGender").css("border-bottom", "1px solid #bdbdbd");
    $("#proStatus").css("border-bottom", "1px solid #63b5f6");
    $("#proPic").css("border", "1px solid #fff");
    $("#proCategory").css("border-bottom", "1px solid #bdbdbd");
    $(".err-notify").html("");
}
//plugin function to retrive photo from PHOTOLIBRARY
function getPhoto() {

    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "GET");
    navigator.camera.getPicture(getPhotoSuccess, getPhotoFail, {
        quality: 60,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI,
        sourceType: Camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
}
//success handler
function getPhotoSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    document.getElementById('proPic').style.backgroundImage = "url(" + imageURL + ")";
    fileURL = imageURL;
    checkURL = imageURL;
    localStorage.setItem("PAGELOC", "");
    proPicUpdated = true;
}
//erroor handler
function getPhotoFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}

//plugin function to retrive photo from CAMERA
function takePhoto() {

    localStorage.setItem("PAGELOC", pageLocation);
    localStorage.setItem("PAGERED", "TAKE");
    appState.takingPicture = true; //1
    navigator.camera.getPicture(takePhotoSuccess, takePhotoFail, {
        quality: 60,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI,
        sourceType: Camera.PictureSourceType.CAMERA
            // targetWidth: 200,
            // targetHeight: 200
    });

}
//success handler
function takePhotoSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    document.getElementById('proPic').style.backgroundImage = "url(" + imageURL + ")";
    fileURL = imageURL;
    checkURL = imageURL;
    proPicUpdated = true;
    localStorage.setItem("PAGELOC", "");
    proPicUpdated = true;
}
//erroor handler
function takePhotoFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}

//special function for iOS to clear temporary files
function cleanup() {
    navigator.camera.cleanup(onSuccess, onFail);

    function onSuccess() {
        console.log("Camera cleanup success.");
    }

    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}

function updateProfile(argument) {
    //console.log(localStorage.getItem("PROID"));
    if (checkBox) {
        $("#privacyErr").html("Please Agree To Proceed.");
    } else {
        var nameReg = /^[a-z ,.'-]+$/i;
        var emailReg = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        var proName = document.getElementById("proName").value;
        var proFName = proName.split(" ")[0];
        var proLName = (proName.split(" ").length > 1) ? proName.split(" ")[1] : '';
        var proEmail = document.getElementById("proEmail").value;
        var proGender = document.getElementById("proGender").value;
        var proStatus = document.getElementById("proStatus").value;
        //console.log(proStatus=="");
        if (proPicUpdated) {
            if (proName.match(nameReg)) {
                if (proEmail.match(emailReg)) {
                    if (proGender !== "0") {
                        if (proStatus != " " && proStatus !== "") {
                            var xhttp = new XMLHttpRequest();
                            xhttp.onreadystatechange = function() {
                                loadingOn();
                                if (xhttp.readyState == 4 && xhttp.status == 200) {
                                    console.log(xhttp.responseText.trim());
                                    if (xhttp.responseText.trim()) {

                                        displayImageUpload();

                                    }
                                }
                            };
                            xhttp.open("POST", server + "profileDataUpdate.php", true);
                            var parameters = "proFName=" + proFName + "&proLName=" + proLName + "&proEmail=" + proEmail + "&proGender=" + proGender + "&proStatus=" + proStatus + "&proId=" + localStorage.getItem("PROID");
                            xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                            console.log(parameters);
                            xhttp.send(parameters);
                        } else {
                            $("#proStatus").css("border-bottom", "2px solid #000");
                            $("#statusErr").html("Invalid Status");
                        }
                    } else {
                        $("#proGender").css("border-bottom", "2px solid #000");
                        $("#genderErr").html("Please Select Your Gender");
                    }
                } else {
                    $("#proEmail").css("border-bottom", "2px solid #000");
                    $("#emailErr").html("Invalid Email");
                }
            } else {
                $("#proName").css("border-bottom", "2px solid #000");
                $("#nameErr").html("Invalid Name");
            }
        } else {
            $("#proPic").css("border", "2px solid #000");
            $("#picErr").html("Select a display picture.");
        }
    }
}



//plugin function to upload the file on the server
function displayImageUpload() {
    console.log("in upload file:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "displayImageUpload.php");
    //console.log(uri);
    var options = new FileUploadOptions();

    options.fileKey = "fileUploadKey";
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "image/jpeg";
    options.httpMethod = 'POST';
    var params = {};
    params.id = localStorage.getItem("PROID");
    //params.value2 = "param";
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.onprogress = function(progressEvent) {
        $(".myBar").css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $(".myBar").css("width", perc + "%");
            $("#proPerc").html(perc);
        } else {
            if (progressStatus.innerHTML === "") {
                $(".myBar").css("width", "0%");
            } else {
                $(".myBar").css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        loadingOff();
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
        loadingOff();
    }
}

function loadingOn() {
    var myClassName = " cd-popup";
    var trigger = document.getElementById('loading');
    trigger.className = trigger.className.replace(myClassName, "");
    trigger.className = trigger.className + ' is-visible';
}

function loadingOff() {
    var trigger = document.getElementById('loading');
    var myClassName = trigger.className;
    trigger.className = trigger.className.replace(myClassName, 'cd-popup');
}

function loadingOnC() {
    document.getElementById("proLoader").style.display = 'table';
}

function loadingOffC() {
    document.getElementById("proLoader").style.display = 'none';
}

///////////////////////////////
//Home.html ///////////////////
///////////////////////////////

function checkOffline(chatterId) {
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log("Offline:" + xhttp.responseText.trim());
            if (xhttp.responseText != "" && xhttp.responseText != null) {
                data = JSON.parse(xhttp.responseText.trim());
                if (data.online == "1") {
                    document.getElementById("onlineStatus").innerHTML = "<p>Online</p>";
                } else {
                    document.getElementById("onlineStatus").innerHTML = "<p>Last Seen " + formatAMPM(new Date(data.last_seen)) + "</p>";
                }
            }
        }
    };
    xhttp.open("POST", server + "checkOffline.php", true);
    var parameters = "singleChatId=" + chatterId;
    console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function makeOffline() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
        }
    };
    xhttp.open("POST", server + "makeOffline.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function makeOnline() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
        }
    };
    xhttp.open("POST", server + "makeOnline.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

var monArr = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

function formatAMPM(date) {
    var today = new Date();
    var exDate = "";
    if (date.getDate() == today.getDate() && date.getMonth() == today.getMonth() && date.getFullYear() == today.getFullYear()) {
        exDate = "";
    } else {
        exDate = date.getDate() + " " + monArr[date.getMonth()];
    }

    var hours = date.getHours();
    var minutes = date.getMinutes();
    var ampm = hours >= 12 ? 'pm' : 'am';
    hours = hours % 12;
    hours = hours ? hours : 12; // the hour '0' should be '12'
    minutes = minutes < 10 ? '0' + minutes : minutes;
    var strTime = hours + ':' + minutes + '' + ampm + ' ' + exDate;

    //console.log(strTime);

    return strTime;
}

Date.prototype.yyyymmdd = function() {
    var mm = this.getMonth() + 1; // getMonth() is zero-based
    var dd = this.getDate();

    return [this.getFullYear(),
        (mm > 9 ? '' : '0') + mm,
        (dd > 9 ? '' : '0') + dd
    ].join('');
};

var date = new Date();


function sqlToJsDate(arg) {
    var t = arg.split(/[- :]/);
    var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    var d = new Date(Date.UTC(t[0], t[1] - 1, t[2], t[3], t[4], t[5]));
    return (d.getDate() + " " + monthNames[d.getMonth()] + " " + d.getFullYear());
}
////////////////
//CONNECTION  //
////////////////

var connErr = '<div class="celebrity-loader internet-connection-loader" id="connErr">' +
    '        <div class="celebrity-loader-inner">' +
    '            <img src="img/alerts/internet_down.jpg" />' +
    '            <p>Whoops</p>' +
    '            <p class="internet-connect-details">No Internet connection found.</p>' +
    '            <img class="internet-retry push-m" src="img/icons/retry.svg"  onclick="checkConnection(1)" />' +
    '            <p class="internet-connect-details">Retry</p>' +
    '        </div>' +
    '    </div>';


function checkConnection(arg) {
    var networkState = navigator.connection.type;
    console.log('Connection type: ' + networkState);
    if (networkState == 'none' || networkState == 'NONE') {
        if (arg == 0) {
            $('body').append(connErr);
        }
        if (pageLocation == 'index.html') {
            clearTimeout(timerIndex);
        }
    } else {
        if (arg == 1) {
            location.reload();
        }
    }
    // var states = {};
    // states[Connection.UNKNOWN]  = 'Unknown connection';
    // states[Connection.ETHERNET] = 'Ethernet connection';
    // states[Connection.WIFI]     = 'WiFi connection';
    // states[Connection.CELL_2G]  = 'Cell 2G connection';
    // states[Connection.CELL_3G]  = 'Cell 3G connection';
    // states[Connection.CELL_4G]  = 'Cell 4G connection';
    // states[Connection.CELL]     = 'Cell generic connection';
    // states[Connection.NONE]     = 'No network connection';
    // console.log('Connection type: ' + states[networkState]);
}


/////////////////
//LOCAL NOTICICATION //
/////////////////
function notiGen() {
    // schedule(notify++, "Notification", "Generating Notificactions", new Date(), "777");
    scheduleMultiple();
}

function schedule(id, title, message, at, redirect) {
    console.log("in schedule::" + id + "::" + title + "::" + message + "::" + at + "::" + redirect);
    var sound = device.platform == 'Android' ? 'file://sound/close.mp3' : 'file://beep.caf';
    var date = new Date();

    cordova.plugins.notification.local.schedule({
        id: id,
        title: title,
        text: message,
        at: at,
        sound: sound,
        icon: "img/icon.png",
        data: { "redirectId": redirect }
    });

    var data = "";
    if (localStorage.getItem("NOTIFICATION") === "" || localStorage.getItem("NOTIFICATION") === null) {
        var arr = [];
        data = {
            id: id,
            title: title,
            text: message,
            at: at,
            sound: sound,
            icon: "img/icon.png",
            data: { "redirectId": redirect }
        };
        arr.push(data);
        localStorage.setItem("NOTIFICATION", JSON.stringify(arr));
    } else {
        var mat = JSON.parse(localStorage.getItem("NOTIFICATION"));
        data = {
            id: id,
            title: title,
            text: message,
            at: at,
            sound: sound,
            icon: "img/icon.png",
            data: { "redirectId": redirect }
        };
        mat.push(data);
        localStorage.setItem("NOTIFICATION", JSON.stringify(mat));
    }
}

function scheduleMultiple(argument) {
    var date = new Date();
    //cordova.plugins.notification.local.schedule(localStorage.getItem("NOTIFICATION"));
    cordova.plugins.notification.local.schedule([{
        id: 99,
        title: "First",
        text: "UNO Message",
        at: date,
        sound: 'file://sound/close.mp3',
        icon: "img/icon.png",
    }, {
        id: 100,
        title: "Second",
        text: "DUO Message",
        at: date,
        sound: 'file://sound/close.mp3',
        icon: "img/icon.png",
    }]);
}
////////////////////////
// PUSH NOTIFICATIONS //
//                    //
////////////          //
//WINDOWS //          //
////////////          //
////////////////////////
function mainwp() {
    pushwp.register(
        channelHandler,
        errorHandler, {
            "channelName": "PheonixPush",
            "ecb": onNotificationWP8,
            "uccb": channelHandler,
            "errcb": jsonErrorHandler
        });
    //success handler
    function channelHandler(data) {
        //alert('DATA:' + data.uri);
        sendDetails(data.uri);
    }
    //message
    //handle MPNS notifications for WP8
    function onNotificationWP8(e) {
        if (e.type == "toast" && e.jsonContent) {
            pushNotification.showToastNotification(successHandler, errorHandler, {
                "Title": e.jsonContent["wp:Text1"],
                "Subtitle": e.jsonContent["wp:Text2"],
                "NavigationUri": e.jsonContent["wp:Param"]
            });
        }

        if (e.type == "raw" && e.jsonContent) {
            alert(e.jsonContent.Body);
        }
    }
    //error handler json
    function jsonErrorHandler(error) {
        alert('Json ERROR:' + error);
    }
    //error handler 
    function errorHandler(error) {
        alert('ERROR handler:' + error);
    }
}
////////////////
//ANDROID IOS //
////////////////
function main(argument) {

    PushNotification.hasPermission(function(data) {
        if (data.isEnabled) {
            console.log('isEnabled');
        }
    });
    //Success Handler
    push.on('registration', function(data) {
        console.log(data.registrationId);
        sendDetails(data.registrationId);
    });

    //Error Handler
    push.on('error', function(e) {
        console.log(e.message);
    });

    //Message
    push.on('notification', function(data) {
        alert("Message");
        console.log(data.message);
        console.log(data.title);
        console.log(data.count);
        console.log(data.sound);
        console.log(data.image);
        console.log(data.additionalData);
    });

    /*push.setApplicationIconBadgeNumber(function() {
        console.log('success');
    }, function() {
        console.log('error');
    }, 2);

    push.finish(function() {
        console.log('success');
    }, function() {
        console.log('error');
    }, 'push-1');*/
}

//************************************  OUTSIDE DEVICE READY
// handle APNS notifications for iOS
function onNotificationAPN(e) {
    // storage the e.id value  (the extra value sent in push notification)
    window.localStorage.setItem("push_que", e.id);
    var push_que = e.id;
    // if the push notification is coming inline
    if (e.foreground == "1") {
        // storage the e.numero value  (the extra value sent in push notification)
        window.localStorage.setItem("push_que", e.id);
        var push_que1 = e.id;
        /// some code here to open a message  if a new push is recieved inline
    }
    if (event.alert) {
        navigator.notification.alert(event.alert);
    }
    if (event.sound) {
        var snd = new Media(event.sound);
        snd.play();
    }
    if (event.badge) {
        pushNotification.setApplicationIconBadgeNumber(successHandler, errorHandler, event.badge);
    }
}

// handle GCM notifications for Android
function onNotificationGCM(e) {
    alert(e.event);
    if (e.foreground) {
        //  if the push is recieved inline
        //  storage the value of  playoad.id,  the extra value sent by push
        window.localStorage.setItem("push_que", e.payload.id);
        var push_que = e.payload.id;

    } else {
        // otherwise we were launched because the user touched a notification in the notification tray

        if (e.coldstart) {
            //  storage the value of  playoad.numero, the extra value sent by push
            window.localStorage.setItem("push_que", e.payload.id);

        } else {
            //  storage the value of  playoad.numero, the extra value sent by push
            window.localStorage.setItem("push_que", e.payload.id);

        }
    }



}


//********************************** END OUTSIDE DEVICE READY

function sendDetails(regId) {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText);
            if (xhttp.responseText.trim() !== false || xhttp.responseText.trim() !== "") {
                localStorage.setItem("NOTIFICATIONID", regId);
            } else {
                console.log("NOT REGISTERED");
            }
        }
    };
    //alert('type::' + type);
    xhttp.open("GET", server + "setNotificationId.php?id=" + encodeURIComponent(regId) + "&type=" + device.platform + "&proId=" + localStorage.getItem("PROID"), true);
    xhttp.send();
}


//////////
//SHARE //
//////////
function reShare(event, jsonData) {
    event.stopPropagation();
    var innerJson = jsonData.replace(/~/g, '"');
    var data = JSON.parse(innerJson);
    share(event, data.from, data.id, data.type, data.genId, data.imageURL, data.userName, data.time, data.desc, data.title, data.count, data.posterId, data.posterName);
}

function share(event, from, id, type, genId, imageURL, userName, time, desc, title, count, posterId, posterName) {
    event.stopPropagation();

    // document.removeEventListener('touchmove', function(e) { eventSet=false; }, false);    



    // function setPostId(id, type, genId, imageURL, userName, time, desc, title, count) {
    //     //console.log(id+":"+type+":"+genId+":"+imageURL+":"+userName+":"+time+":"+desc+":"+title+":"+count);
    //     var data = '{"id":"' + id + '",' + '"type":"' + type + '",' + '"genId":"' + genId + '",' + '"imageURL":"' + imageURL + '",' + '"userName":"' + userName + '",' + '"time":"' + time + '",' + '"desc":"' + desc + '",' + '"title":"' + title + '",' + '"count":"' + count + '"}';
    //     ///console.log(data);
    //     localStorage.setItem("HOMEPOSTDETAIL", data);
    //     // localStorage.setItem("HOMEPOSTID",pId);
    //     window.location.href = "comment_screen.html";
    // }

    // function setCelebPostId(id, type, genId, imageURL, userName, time, desc, title, count) {
    //     //console.log(id+":"+type+":"+genId+":"+imageURL+":"+userName+":"+time+":"+desc+":"+title+":"+count);
    //     var data = '{"id":"' + id + '",' + '"type":"' + type + '",' + '"genId":"' + genId + '",' + '"imageURL":"' + imageURL + '",' + '"userName":"' + userName + '",' + '"time":"' + time + '",' + '"desc":"' + desc + '",' + '"title":"' + title + '",' + '"count":"' + count + '"}';
    //     ///console.log(data);
    //     localStorage.setItem("CELEBPOSTDETAIL", data);
    //     // localStorage.setItem("HOMEPOSTID",pId);
    //     window.location.href = "celebrity_comment_screen.html";
    // }

    // function setGroupPostId(id, type, genId, imageURL, userName, time, desc, title, count, posterId, posterName) {
    //     //console.log(id+":"+type+":"+genId+":"+imageURL+":"+userName+":"+time+":"+desc+":"+title+":"+count);
    //     var data = '{"id":"' + id + '",' + '"type":"' + type + '",' + '"genId":"' + genId + '",' + '"imageURL":"' + imageURL + '",' + '"userName":"' + userName + '",' + '"time":"' + time + '",' + '"desc":"' + desc + '",' + '"title":"' + title + '",' + '"count":"' + count + '",' + '"posterId":"' + posterId + '",' + '"posterName":"' + posterName + '"}';
    //     console.log(data);
    //     localStorage.setItem("GRPPOSTDETAIL", data);
    //     // localStorage.setItem("HOMEPOSTID",pId);
    //     window.location.href = "group_comment_screen.html";
    // }
    localStorage.setItem('SHAREDDATA', '{"from":"' + from + '",' + '"id":"' + id + '",' + '"type":"' + type + '",' + '"genId":"' + genId + '",' + '"imageURL":"' + imageURL + '",' + '"userName":"' + userName + '",' + '"time":"' + time + '",' + '"desc":"' + desc + '",' + '"title":"' + title + '",' + '"count":"' + count + '",' + '"posterId":"' + posterId + '",' + '"posterName":"' + posterName + '"}');
    //localStorage.setItem("SHAREPOSTDETAIL", data);
    var gContent = "";

    if (localStorage.getItem("GRPIDLIST") === "" || localStorage.getItem("GRPIDLIST") === null) {
        document.getElementById('groupListShare').style.display = 'none';
        $('.groups-txt').hide();
    } else {
        var grpData = JSON.parse(localStorage.getItem("GRPIDLIST"));
        for (var i = 0; i < grpData.length; i++) {
            gContent += '<div class="col-30" onclick="sendShareGroup(\'' + grpData[i].id + '\')"><div class="dash-chat-img" style="background-image:url(' + server + grpData[i].photo + ')"></div><p>' + grpData[i].name + '</p></div>';
        }
        console.log(gContent);
        document.getElementById("groupListShare").innerHTML = gContent;
    }
    document.getElementById("shareList").style.display = 'block';

}

function hideShareListing(argument) {
    document.getElementById("shareList").style.display = 'none';
    // document.addEventListener('touchmove', function(e) { e.preventDefault(); eventSet=true; }, false);
}

function openContactList(argument) {
    var data = JSON.parse(localStorage.getItem("CONTACTS"));
    var content = "<form name='shareForm'>";
    var count = 0;

    for (var i = 0; i < data.length; i++) {
        if (data[i].is_user) {
            console.log("X:" + data[i].system_id);
            if (data[i].status == 2) {
                content += '<div class="row">' +
                    '                <div class="col-20">' +
                    '                    <div class="dash-chat-img contact-person-icon" style="background-image:url(' + server + data[i].imageURL + ')">' +
                    // '                        <img src="' + server + data[i].imageURL + '">' +
                    '                    </div>' +
                    '                </div>' +
                    '                <div class="col-70 col-center">' +
                    '                    <p class="contact-person-name">' + data[i].name + '</p>' +
                    '                    <p class="contact-person-num"><i class="fa fa-phone"></i> ' + data[i].phone + '</p>' +
                    '                </div>' +
                    '                <div class="col-10">' +
                    '                    <label class="radio-button">' +
                    '                        <input type="radio" name="shareRadio" value="' + data[i].system_id + '" id="rdb' + (count++) + '" data-system-id="' + data[i].system_id + '" >' +
                    '                        <div class="radio-button__checkmark"></div>' +
                    '                    </label>' +
                    '                </div>' +
                    '            </div>';
            }

        }
    }
    document.getElementById("contactListShare").innerHTML = content + "</form>";
    $("#listingContact").show();
}

function openContactListSearch(needle) {
    var content = "<form name='shareForm'>";
    var count = 0;
    document.getElementById("contactListShare").innerHTML = "";
    var data = JSON.parse(localStorage.getItem("CONTACTS"));
    for (var i = 0; i < data.length; i++) {
        if (data[i].is_user) {
            if (data[i].name.toLowerCase().indexOf(needle.value.toLowerCase()) != -1) {

                // console.log("X:" + data[i].system_id);

                content += '<div class="row">' +
                    '                <div class="col-20">' +
                    '                    <div class="dash-chat-img contact-person-icon" style="background-image:url(' + server + data[i].imageURL + ')">' +
                    // '                        <img src="' +  + '">' +
                    '                    </div>' +
                    '                </div>' +
                    '                <div class="col-70 col-center">' +
                    '                    <p class="contact-person-name">' + data[i].name + '</p>' +
                    '                    <p class="contact-person-num"><i class="fa fa-phone"></i> ' + data[i].phone + '</p>' +
                    '                </div>' +
                    '                <div class="col-10">' +
                    '                    <label class="radio-button">' +
                    '                        <input type="radio" name="shareRadio" value="' + data[i].system_id + '" id="rdb' + (count++) + '" data-system-id="' + data[i].system_id + '" >' +
                    '                        <div class="radio-button__checkmark"></div>' +
                    '                    </label>' +
                    '                </div>' +
                    '            </div>';

            }
        }
    }

    document.getElementById("contactListShare").innerHTML = content + "</form>";
}

function hideContactListing(argument) {
    $("#listingContact").hide();
    //document.addEventListener('touchmove', function(e) { e.preventDefault(); eventSet=true; }, false);
}

function sendShareContact(argument) {
    document.getElementById("sendShareContactButton").innerHTML = "Sending...";
    document.getElementById("sendShareContactButton").setAttribute("onclick", "");

    var count = 0;
    var flag = false;
    var chatterId = "";
    var content = "";


    // while (document.getElementById("rdb" + count) !== null) {
    //     console.log(document.getElementById("rdb" + count).checked + ":::" + document.getElementById("rdb" + count).getAttribute("data-system-id"));
    //     if (document.getElementById("rdb" + count).checked) {
    //         flag = true;
    //         chatterId = document.getElementById("rdb" + count).getAttribute("data-system-id");
    //     }
    //     count++;
    // }
    //////////////////////////////////////////////////// METHOD 2/////////////////////////////////
    try {
        chatterId = document.forms["shareForm"]["shareRadio"].value;
    } catch (err) {
        document.getElementById('sendShareContactButton').innerHTML = "Send";
        alert("Unable to select contact.");
    }

    console.log("Y:" + chatterId);
    if (chatterId === "" || chatterId === null) {
        flag = false;
    } else {
        flag = true;
    }
    //PUT  CHAT STUFF HERE
    if (flag) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() == true) {
                    openChat(chatterId);
                } else {
                    document.getElementById("sendShareContactButton").innerHTML = "Send";
                    document.getElementById("sendShareContactButton").setAttribute("onclick", "sendShareContact()");
                    console.log("not uploded");
                }

            }
        };
        xhttp.open("POST", server + "chatUploadPost.php", true);
        var parameters = "proId=" + localStorage.getItem("PROID") + "&chatterId=" + chatterId + "&desc=" + encodeURIComponent(localStorage.getItem("SHAREDDATA"));
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    } else {
        //no checked user
        console.log("ELSE");
        $("#displayListErr").html("Select at least one user to continue.");
    }
}

function sendShareGroup(grpId) {

    if (confirm("Post to the group?")) {
        var data = JSON.parse(localStorage.getItem("SHAREDDATA"));
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim()) {
                    getGroupId(grpId);
                }
            }
        };
        xhttp.open("POST", server + "uploadGroupPost.php", true);
        var parameters = "grpId=" + grpId + "&proId=" + localStorage.getItem("PROID") + "&desc=" + encodeURIComponent(localStorage.getItem("SHAREDDATA")) + "&type=" + data.type + "&title=" + data.title;
        console.log(parameters);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
        console.log(parameters);
    }


    // if (confirm("Post to the group?")) {
    //     var proId = localStorage.getItem("PROID");
    //     var xhttp = new XMLHttpRequest();
    //     xhttp.onreadystatechange = function() {

    //         if (xhttp.readyState == 4 && xhttp.status == 200) {
    //             console.log(xhttp.responseText.trim());
    //             if (xhttp.responseText.trim()) {
    //                 openGroupChat(grpId, 1);
    //             } else {
    //                 console.log("error");
    //             }

    //         }
    //     };
    //     xhttp.open("POST", server+"groupChatUploadPost.php", true);
    //     var parameters = "proId=" + proId + "&grpId=" + grpId + "&message=" + encodeURIComponent(localStorage.getItem("POSTSHARE"));
    //     console.log(parameters);
    //     xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    //     xhttp.send(parameters);
    // }
}


function checkPostShare() {
    var proId = localStorage.getItem("PROID");
    var chatterId = localStorage.getItem("SINGLECHATID");
    var message = localStorage.getItem("POSTSHARE");
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        mutualExclusive = true;
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                var content = '<div class="row chat section">' +
                    '            <div class="col-20"></div>' +
                    '            <div class="col-80">' +
                    '                <div class="msg-sent-cont">' +
                    '                    <div class="row">' +
                    '                        <div class="col-60">' +
                    // '                            '+chatterName+'' +
                    '                        </div>' +
                    '                        <div class="col-40 text-right">' +
                    '                             ' + formatAMPM(new Date()) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                    '                        </div>' +
                    '                    </div>' +
                    '                    <p>' + localStorage.getItem("POSTSHARE") + '</p>' +
                    '                </div>' +
                    '            </div>' +
                    '        </div>';
                document.getElementById("chat").innerHTML += content;
                $('html, body').scrollTop($(document).height());
                mutualExclusive = false;
            } else {
                console.log("error");
                mutualExclusive = false;
            }

        }
    };
    xhttp.open("POST", server + "sendSingleChat.php", true);
    var parameters = "proId=" + proId + "&chatterId=" + chatterId + "&message=" + encodeURIComponent(message);
    // console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

///////////
//DELETE //
///////////
function showDeleteOptions(event, curr) {
    $(".celeb-post-del").hide();
    $(curr).siblings('.celeb-post-del').css('display', 'block');
    event.stopPropagation();
}

function hideOptions(e) {
    $(".celeb-post-del").hide();
    e.stopPropagation();
}




function deletePost(event, postId) {
    console.log(postId);
    if (confirm("Are you sure you want to remove this post?")) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false) {
                    // var x = $("#user" + postId).wrap('<p/>').parent().html(); //to extract a div along with its container
                    document.getElementById("mediumExpression").innerHTML = localStorage.getItem("DATAFEED");
                    $("#mediumExpression").children("#user" + postId).remove();
                    localStorage.setItem("DATAFEED", document.getElementById("mediumExpression").innerHTML);
                    $("#user" + postId).remove();
                } else {
                    console.log("error");
                }

            }
        };
        xhttp.open("POST", server + "deletePost.php", true);
        var parameters = "postId=" + postId;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
    event.stopPropagation();
}

function deleteCelebPost(event, postId) {
    console.log(postId);
    if (confirm("Are you sure you want to remove this post?")) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false) {
                    document.getElementById("mediumExpression").innerHTML = localStorage.getItem("DATAFEED");
                    $("#mediumExpression").children("#celeb" + postId).remove();
                    localStorage.setItem("DATAFEED", document.getElementById("mediumExpression").innerHTML);
                    $("#celeb" + postId).remove();
                } else {
                    console.log("error");
                }

            }
        };
        xhttp.open("POST", server + "deleteCelebPost.php", true);
        var parameters = "postId=" + postId;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
    event.stopPropagation();
}

function deleteGroupPost(event, postId) {
    console.log(postId);
    if (confirm("Are you sure you want to remove this post?")) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false) {
                    document.getElementById("mediumExpression").innerHTML = localStorage.getItem("DATAFEED");
                    $("#mediumExpression").children("#group" + postId).remove();
                    localStorage.setItem("DATAFEED", document.getElementById("mediumExpression").innerHTML);
                    $("#group" + postId).remove();
                } else {
                    console.log("error");
                }

            }
        };
        xhttp.open("POST", server + "deleteGroupPost.php", true);
        var parameters = "postId=" + postId;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
    event.stopPropagation();
}

///////////////////
// NOTIFICATIONS //
///////////////////

function notificationCounter() {
    var preCount = parseInt(document.getElementById('notificationCount').innerHTML);
    var count = parseInt(document.getElementById('notificationCount').innerHTML);
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                data = JSON.parse(xhttp.responseText.trim());
                count = data.length;
                document.getElementById('notificationCount').innerHTML = count;
                localStorage.setItem("COUNT", count);
                if (preCount < count) {
                    var audio = new Audio('sound/notify.mp3');
                    audio.play();
                    navigator.vibrate(500);
                }

            } else {
                document.getElementById('notificationCount').innerHTML = 0;
                localStorage.setItem("COUNT", '0');
            }
        }
    };
    xhttp.open("POST", server + "notificationCounter.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function fetchNotification() {
    localStorage.setItem("LATESTFOLLOWCELEB", 1);
    var data = "";
    var content = "";
    var redirect = "";
    var isRead = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                data = JSON.parse(xhttp.responseText.trim());
                for (var i = 0; i < data.length; i++) {
                    if (data[i].status == 1) {
                        isRead = 'unread-notify';
                    } else {
                        isRead = '';
                    }
                    if (data[i].notiType == 'friendRequest') {
                        content += '<div class="row notify-outer ' + isRead + '"  onclick="setGeneratorId(\'' + data[i].fromId + '\')">' +
                            '        <div class="col-25"><div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].fromPhoto) + ')"></div></div>' +
                            '        <div class="col-75 col-center"><bold>' + data[i].fromName + ' </bold>' + data[i].notiDesc + '<div class="time"><i class="fa fa-clock-o"></i> ' + formatAMPM(new Date(data[i].notiAt)) + '</div></div>' +
                            '    </div>';
                    } else if (data[i].notiType == 'comment') {
                        if (data[i].detail.src == "user") {
                            redirect = "setPostId('" + data[i].detail.id + "','" + data[i].detail.type + "','" + data[i].detail.genId + "','" + data[i].detail.genPhoto + "','" + data[i].detail.genName + "','" + data[i].detail.time + "','" + data[i].detail.desc + "','" + data[i].detail.URL + "','" + data[i].detail.commentCount + "')";
                        } else if (data[i].detail.src == "group") {
                            if (data[i].detail.type == 'shared') {
                                var innerJson = data[i].detail.desc.replace(/"/g, "~");
                                redirect = "setGroupPostId('" + data[i].detail.id + "','" + data[i].detail.type + "','" + data[i].detail.groupId + "','" + data[i].detail.groupPhoto + "','" + data[i].detail.groupName + "','" + data[i].detail.time + "','" + innerJson + "','" + data[i].detail.URL + "','" + data[i].detail.commentCount + "','" + data[i].detail.postedById + "','" + data[i].detail.postedByName + "')";
                            } else {
                                redirect = "setGroupPostId('" + data[i].detail.id + "','" + data[i].detail.type + "','" + data[i].detail.groupId + "','" + data[i].detail.groupPhoto + "','" + data[i].detail.groupName + "','" + data[i].detail.time + "','" + data[i].detail.desc + "','" + data[i].detail.URL + "','" + data[i].detail.commentCount + "','" + data[i].detail.postedById + "','" + data[i].detail.postedByName + "')";
                            }

                        } else if (data[i].detail.src == "celeb") {
                            redirect = "setCelebPostId('" + data[i].detail.id + "','" + data[i].detail.type + "','" + data[i].detail.celebId + "','" + data[i].detail.celebPhoto + "','" + data[i].detail.celebName + "','" + data[i].detail.time + "','" + data[i].detail.desc + "','" + data[i].detail.URL + "','" + data[i].detail.commentCount + "')";
                        }
                        content += '<div class="row notify-outer ' + isRead + '" onclick="' + redirect + '">' +
                            '        <div class="col-25"><div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].fromPhoto) + ')"></div></div>' +
                            '        <div class="col-75 col-center"><bold>' + data[i].fromName + ' </bold>' + data[i].notiDesc + '<div class="time"><i class="fa fa-clock-o"></i> ' + formatAMPM(new Date(data[i].notiAt)) + '</div></div>' +
                            '    </div>';

                    } else if (data[i].notiType == 'create') {
                        content += '<div class="row notify-outer ' + isRead + '"  onclick="getGroupId(\'' + data[i].grpId + '\')">' +
                            '        <div class="col-25"><div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].fromPhoto) + ')"></div></div>' +
                            '        <div class="col-75 col-center"><bold>' + data[i].fromName + ' </bold>' + data[i].notiDesc + '<div class="time"><i class="fa fa-clock-o"></i> ' + formatAMPM(new Date(data[i].notiAt)) + '</div></div>' +
                            '    </div>';
                    }
                }
                document.getElementById("notifyList").innerHTML = content;
                setTimeout(function() {
                    $(".notify-outer").removeClass('unread-notify');
                }, 3000);



            } else {
                console.log("error");
            }
        }
    };
    xhttp.open("POST", server + "fetchNotification.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}
var offsetNotify = 0;

function toggleNotifyLoader() {
    newLoaderOn();
    offsetNotify += 10;
    fetchNextNotification(offsetNotify);
}

function fetchNextNotification(offset) {
    var data = "";
    var content = "";
    var redirect = "";
    var isRead = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() && xhttp.responseText.trim() !== "") {
                data = JSON.parse(xhttp.responseText.trim());
                for (var i = 0; i < data.length; i++) {
                    if (data[i].status == 1) {
                        isRead = 'unread-notify';
                    } else {
                        isRead = '';
                    }
                    if (data[i].notiType == 'friendRequest') {
                        content += '<div class="row notify-outer ' + isRead + '"  onclick="setGeneratorId(\'' + data[i].fromId + '\')">' +
                            '        <div class="col-25"><div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].fromPhoto) + ')"></div></div>' +
                            '        <div class="col-75 col-center"><bold>' + data[i].fromName + ' </bold>' + data[i].notiDesc + '<div class="time"><i class="fa fa-clock-o"></i> ' + formatAMPM(new Date(data[i].notiAt)) + '</div></div>' +
                            '    </div>';
                    } else if (data[i].notiType == 'comment') {
                        if (data[i].detail.src == "user") {
                            redirect = "setPostId('" + data[i].detail.id + "','" + data[i].detail.type + "','" + data[i].detail.genId + "','" + data[i].detail.genPhoto + "','" + data[i].detail.genName + "','" + data[i].detail.time + "','" + data[i].detail.desc + "','" + data[i].detail.URL + "','" + data[i].detail.commentCount + "')";
                        } else if (data[i].detail.src == "group") {
                            if (data[i].detail.type == 'shared') {
                                var innerJson = data[i].detail.desc.replace(/"/g, "~");
                                redirect = "setGroupPostId('" + data[i].detail.id + "','" + data[i].detail.type + "','" + data[i].detail.groupId + "','" + data[i].detail.groupPhoto + "','" + data[i].detail.groupName + "','" + data[i].detail.time + "','" + innerJson + "','" + data[i].detail.URL + "','" + data[i].detail.commentCount + "','" + data[i].detail.postedById + "','" + data[i].detail.postedByName + "')";
                            } else {
                                redirect = "setGroupPostId('" + data[i].detail.id + "','" + data[i].detail.type + "','" + data[i].detail.groupId + "','" + data[i].detail.groupPhoto + "','" + data[i].detail.groupName + "','" + data[i].detail.time + "','" + data[i].detail.desc + "','" + data[i].detail.URL + "','" + data[i].detail.commentCount + "','" + data[i].detail.postedById + "','" + data[i].detail.postedByName + "')";
                            }
                        } else if (data[i].detail.src == "celeb") {
                            redirect = "setCelebPostId('" + data[i].detail.id + "','" + data[i].detail.type + "','" + data[i].detail.celebId + "','" + data[i].detail.celebPhoto + "','" + data[i].detail.celebName + "','" + data[i].detail.time + "','" + data[i].detail.desc + "','" + data[i].detail.URL + "','" + data[i].detail.commentCount + "')";
                        }
                        content += '<div class="row notify-outer ' + isRead + '" onclick="' + redirect + '">' +
                            '        <div class="col-25"><div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].fromPhoto) + ')"></div></div>' +
                            '        <div class="col-75 col-center"><bold>' + data[i].fromName + ' </bold>' + data[i].notiDesc + '<div class="time"><i class="fa fa-clock-o"></i> ' + formatAMPM(new Date(data[i].notiAt)) + '</div></div>' +
                            '    </div>';

                    } else if (data[i].notiType == 'create') {
                        content += '<div class="row notify-outer ' + isRead + '"  onclick="getGroupId(\'' + data[i].grpId + '\')">' +
                            '        <div class="col-25"><div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].fromPhoto) + ')"></div></div>' +
                            '        <div class="col-75 col-center"><bold>' + data[i].fromName + ' </bold>' + data[i].notiDesc + '<div class="time"><i class="fa fa-clock-o"></i> ' + formatAMPM(new Date(data[i].notiAt)) + '</div></div>' +
                            '    </div>';
                    }
                }
                document.getElementById("notifyList").innerHTML += content;
                newLoaderOff();
                setTimeout(function() {
                    $(".notify-outer").removeClass('unread-notify');
                }, 3000);



            } else {
                document.getElementById("loadMore").innerHTML = "No More Notifications";
                console.log("no more post");
                newLoaderOff();
            }
        }
    };
    xhttp.open("POST", server + "fetchNextNotification.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID") + "&offset=" + offset;
    console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function newLoaderOn() {
    document.getElementById('loadMore').style.display = 'none';
    document.getElementById('postLoader').style.display = 'block';
}

function newLoaderOff() {
    document.getElementById('postLoader').style.display = 'none';
    document.getElementById('loadMore').style.display = 'block';
}
/////////////
//DOWNLOAD //
/////////////
//later for connection.
//First step check parameters mismatch and checking network connection if available call    download function
function DownloadFile(URL, Folder_Name, File_Name) {


    // function dw(URL, Folder_Name, File_Name) {
    //       console.log(URL + ":" + Folder_Name + ":" + File_Name);
    //    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function gotFS(fileSystem) {
    //            fileSystem.root.getDirectory("MSG", {create: true}, function fileSystemSuccess(fileSystem){
    //                 fileSystem.getFile("dummy.jpg",{create: true,exclusive:false},function gotFileEntry(fileEntry){
    //                     var path = fileEntry.fullPath.replace("dummy.jpg","");
    //                     fileEntry.remove();
    //                     var fileTransfer = new FileTransfer();
    //                     fileTransfer.download(URL,path+'/MSG/dummy.jpg' ,function(theFile){
    //                         console.log("File Downloaded Successfully " + theFile.toURI());
    //                     },function(error){
    //                         console.log("File Transfer failed" + error.message);
    //                     });
    //                 },fail);
    //             });
    //     }, fail);
    // }
}
var store = "";
var assetURL = "";
var fileName = "";
var folderName = "";
var ext = "";


//Second step to get Write permission and Folder Creation
function download(URL, Folder_Name) {
    if (confirm("Are you sure you want to download content?")) {
        assetURL = encodeURI(URL);
        folderName = Folder_Name;
        fileName = date.yyyymmdd() + '_' + Math.floor(Math.random() * 89999 + 10000);
        ext = assetURL.substr(assetURL.lastIndexOf('.') + 1);
        store = cordova.file.externalRootDirectory;
        window.resolveLocalFileSystemURL(store + folderName + fileName + "." + ext, alterDownload, downloadAsset);
    }
}

function downloadAsset(fs) {
    console.log("In DownloadAsset");
    $("#popupNotificationText").html("<p> File Downloading Started... </p>");
    $("#popupNotification").fadeIn('fast');
    $("#popupNotification").fadeOut(2500);

    var fileTransfer = new FileTransfer();
    console.log("About to start transfer");
    fileTransfer.download(assetURL, store + folderName + "/" + fileName + "." + ext,
        function(entry) {
            $("#popupNotificationText").html("<p> File Downloaded To /MSG... </p>");
            $("#popupNotification").fadeIn("fast");
            $("#popupNotification").fadeOut(2500);
            console.log("asset download complete: " + entry.fullPath + ":" + entry.toURL());

            function onSuccess(data) {
                console.log('extension: ' + data.extension + '\n' + 'canBeOpen: ' + data.canBeOpen);
                if (data.canBeOpen) {
                    window.cordova.plugins.FileOpener.openFile(entry.toURL(), onSucc, onError);
                } else {
                    alert("Phone Doesn't Have The Required Software.");
                }
            }

            function onSucc(data) {
                console.log('message: ' + data.message);
            }

            function onError(error) {
                console.log('message: ' + error.message);
            }

            window.cordova.plugins.FileOpener.canOpenFile(entry.toURL(), onSuccess, onError);
        },
        function(err) {
            console.log("Error");
            console.dir(err);
        });
}

function alterDownload() {
    console.log("In AlterDownload ");
    window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, fileSystemSuccess, fileSystemFail);

    function fileSystemSuccess(fileSystem) {
        console.log('file system open: ' + fileSystem.name);
        var directoryEntry = fileSystem.root; // to get root path of directory
        console.log("directoryEntry:::" + directoryEntry);

        directoryEntry.getDirectory(folderName, { create: true, exclusive: false }, onDirectorySuccess, onDirectoryFail); // creating folder in sdcard

        function onDirectorySuccess(parent) {
            // Directory created successfuly
            console.log("Directory created" + parent);
        }

        function onDirectoryFail(error) {
            //Error while creating directory
            console.log("Unable to create new directory: " + error.code);
        }

        var rootdir = fileSystem.root;
        var fp = rootdir.fullPath; // Returns Fulpath of local directory
        fp = "file:///storage/sdcard0" + "/" + folderName + "/" + fileName + "." + ext; // fullpath and name of the file which we want to give (3)  // the change that starts download
        // download function call
        filetransfer(fp);
    }

    function fileSystemFail(evt) {
        //Unable to access file system
        console.log(evt.target.error.code);
    }
}

//Third step for download a file into created folder
function filetransfer(fp) {
    $("#popupNotificationText").html("<p> File Downloading Started... </p>");
    $("#popupNotification").fadeIn('fast');
    $("#popupNotification").fadeOut(2500);

    var fileTransfer = new FileTransfer();
    fileTransfer.download(assetURL, fp,
        function(entry) {
            $("#popupNotificationText").html("<p> File Downloaded... </p>");
            $("#popupNotification").fadeIn("fast");
            $("#popupNotification").fadeOut(2500);
            console.log("alter download complete: " + entry.fullPath);
            // readFile(entry);
        },
        function(error) {
            //Download abort errors or download failed errors
            console.log("download error source " + error.source);
            console.log("download error target " + error.target);
            console.log("upload error code" + error.code);
        }
    );
}

// function readFile(fileEntry) {
//     fileEntry.file(function (file) {
//         var reader = new FileReader();

//         reader.onloadend = function () {

//             console.log("Successful file read: " + this.result);
//             // displayFileData(fileEntry.fullPath + ": " + this.result);

//         };

//         reader.readAsText(file);

//     }, onErrorReadFile);
// }


function loadOn(argument) {
    document.getElementsByClassName("cus")[0].style.display = 'block';
}

function loadOff() {
    document.getElementsByClassName("cus")[0].style.display = 'none';
}

// ///////////////
// //Image Post //
// ///////////////
// function postPhoto() {
//     console.log("in upload post:" + fileURL);
//     // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
//     var uri = encodeURI(server+"imageUpload.php?id=" + localStorage.getItem("PROID"));
//     console.log(uri);
//     var options = new FileUploadOptions();

//     options.fileKey = "fileUploadKey";
//     options.fileName = fileURL.substr(fileURL.lastIndexOf('/') + 1);
//     options.mimeType = "image/jpeg";
//     options.httpMethod = 'POST';
//     //////////////////////
//     // Important Change //
//     //////////////////////
//     options.chunkedMode = false;
//     var headers = {
//         'headerParam': 'headerValue'
//     };
//     options.headers = headers;

//     var ft = new FileTransfer();

//     ft.upload(fileURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
//     //success handler
//     function onSucc(r) {
//         console.log("Code = " + r.responseCode);
//         console.log("Response = " + r.response);
//         console.log("Sent = " + r.bytesSent);
//         console.log(r.response);
//         /*if (r.response == 'The file has been uploaded.') {*/
//         //console.log("Uploaded");

//         //window.location.href = "home.html";
//         /*}*/
//     }
//     //error handler
//     function onErr(error) {
//         console.log("An error has occurred: Code = " + error.code);
//         console.log("upload error source " + error.source);
//         console.log("upload error target " + error.target);
//         console.log("Failure");
//     }
// }
///////////////
// Text Post //
///////////////
///

function convert() {
    console.log("IN Convert");
    var input = document.getElementById('proText').value;
    var output = emojione.unicodeToImage(input);
    document.getElementById('proText').value = output;
    console.log(output);
}



function uploadText(argument) {

    var proText = document.getElementById("proText").value;
    //console.log(proText);
    if (proText !== "") {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                //console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim()) {
                    closePopup();
                    dataFeedRefreshPrevious(); // preDatafeedRefresh

                    removeJunk();
                }
            }
        };
        xhttp.open("POST", server + "uploadText.php", true);
        var parameters = "proText=" + proText + "&proId=" + localStorage.getItem("PROID");
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
        //console.log(parameters);
    } else {
        console.log("Status Not Updated.");
    }

}
////////////////
// Video Post //
////////////////
function postTakeVideo(argument) {
    // capture callback
    var captureSuccess = function(mediaFiles) {
        var i, path, len;
        for (i = 0, len = mediaFiles.length; i < len; i += 1) {
            path = mediaFiles[i].fullPath;
            // do something interesting with the file
            checkURL = path;
            document.getElementById("videoImage").src = path;
            popupVideo();
        }
    };

    // capture error callback
    var captureError = function(error) {
        navigator.notification.console.log('Error code: ' + error.code, null, 'Capture Error');
    };

    // start video capture
    navigator.device.capture.captureVideo(captureSuccess, captureError, { limit: 1, quality: 0 });
}

function postGetVideo(argument) {
    console.log("get vid");
    navigator.camera.getPicture(onSuccess, onFail, {
        quality: 50,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: navigator.camera.DestinationType.FILE_URI,
        mediaType: navigator.camera.MediaType.VIDEO,
        sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
    //success handler
    function onSuccess(imageURL) {
        checkURL = imageURL;
        document.getElementById("videoImage").src = imageURL;
        closepopupplain1();
        popupVideo();

    }
    //erroor handler
    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}


function uploadVideo() {
    console.log("in upload video:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "uploadVideo.php?proId=" + localStorage.getItem("PROID") + "&desc=" + document.getElementById("videoDesc").value);
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "video/3gpp";
    options.httpMethod = 'POST';
    var params = {};
    params.proId = localStorage.getItem("PROID");
    params.desc = document.getElementById("videoDesc").value;
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.onprogress = function(progressEvent) {
        $(".myBar").css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $(".myBar").css("width", perc + "%");
        } else {
            if (progressStatus.innerHTML === "") {
                $(".myBar").css("width", "0%");
            } else {
                $(".myBar").css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        document.getElementById("videoDesc").value = "";
        closePopup();

        dataFeedRefreshPrevious();
        removeJunk();
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }
}

////////////////
// Audio Post //
////////////////

function postTakeAudio(argument) {
    // capture callback
    pendingAudio = true;
    var captureSuccess = function(mediaFiles) {
        var i, path, len;
        for (i = 0, len = mediaFiles.length; i < len; i += 1) {
            path = mediaFiles[i].fullPath;
            // do something interesting with the file
            checkURL = path;
            document.getElementById("audioImage").src = "img/icons/audio.svg";
            popupAudio();
        }
    };

    // capture error callback
    var captureError = function(error) {
        alert("Sorry! Your phone dosen't support this functionality.");
        console.log('Error code: ' + error, null, 'Capture Error');
    };

    // start audio capture
    navigator.device.capture.captureAudio(captureSuccess, captureError, { limit: 1 });
}

function postGetAudio(argument) {
    navigator.camera.getPicture(onSuccess, onFail, {
        quality: 100,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: navigator.camera.DestinationType.FILE_URI,
        mediaType: navigator.camera.MediaType.ALLMEDIA,
        sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
    //success handler
    function onSuccess(imageURL) {
        //console.log(imageURL);
        checkURL = imageURL;
        var ext = checkURL.substr(checkURL.lastIndexOf('.') + 1);
        if (ext == "wav" || ext == "amr" || ext == "mp3") {
            document.getElementById("audioImage").src = imageURL;
            popupAudio();
        } else {
            alert("Audio File Format Not Supported.");
        }
        closepopupplain2();
    }
    //erroor handler
    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}

function uploadAudio() {
    pendingAudio = false;
    console.log("in upload audio:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "uploadAudio.php");
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "audio/wav";
    options.httpMethod = 'POST';
    var params = {};
    params.proId = localStorage.getItem("PROID");
    params.desc = document.getElementById("audioDesc").value;
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.onprogress = function(progressEvent) {
        $(".myBar").css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $(".myBar").css("width", perc + "%");
        } else {
            if (progressStatus.innerHTML === "") {
                $(".myBar").css("width", "0%");
            } else {
                $(".myBar").css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        document.getElementById("audioDesc").value = "";
        closePopup();
        dataFeedRefreshPrevious();

        removeJunk();
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }
}

////////////////
// Photo Post //
////////////////

function postTakePhoto(argument) {
    removeJunk();
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "TAKE");
    console.log("in postTakePhoto");
    navigator.camera.getPicture(postTakePhotoSuccess, postTakePhotoFail, {
        quality: 60,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI,
        sourceType: Camera.PictureSourceType.CAMERA
            // targetWidth: 200,
            // targetHeight: 200
    });
}
//success handler
function postTakePhotoSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    checkURL = imageURL;
    document.getElementById("photoImage").style.backgroundImage = "url(" + imageURL + ")";
    popupPhoto();
    localStorage.setItem("PAGELOC", "");
}
//erroor handler
function postTakePhotoFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}

function postGetPhoto(argument) {
    removeJunk();
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "GET");
    console.log("get pic");
    navigator.camera.getPicture(postGetPhotoSuccess, postGetPhotoFail, {
        quality: 60,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI,
        sourceType: Camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
}
//success handler
function postGetPhotoSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    checkURL = imageURL;
    document.getElementById("photoImage").style.backgroundImage = "url(" + imageURL + ")";
    closepopupplain();
    popupPhoto();
    localStorage.setItem("PAGELOC", "");
}
//erroor handler
function postGetPhotoFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}

function uploadPhoto() {
    console.log("in upload image:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "uploadPhoto.php");
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "image/jpeg";
    options.httpMethod = 'POST';
    var params = {};
    params.proId = localStorage.getItem("PROID");
    params.desc = document.getElementById("photoDesc").value;
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.onprogress = function(progressEvent) {
        $(".myBar").css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $(".myBar").css("width", perc + "%");
        } else {
            if (progressStatus.innerHTML === "") {
                $(".myBar").css("width", "0%");
            } else {
                $(".myBar").css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        document.getElementById("photoDesc").value = "";
        closePopup();
        dataFeedRefreshPrevious();
        removeJunk();
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }
}


function postGetFile(argument) {
    console.log("get file");
    navigator.camera.getPicture(onSuccess, onFail, {
        quality: 50,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: navigator.camera.DestinationType.FILE_URI,
        mediaType: navigator.camera.MediaType.ALLMEDIA,
        sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
    //success handler
    function onSuccess(imageURL) {
        checkURL = imageURL;
        var support = false;
        var ext = checkURL.substr(checkURL.lastIndexOf('.') + 1);
        var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
        for (var x in extName) {
            if (x == ext) {
                console.log("File: " + x);
                document.getElementById("fileImage").style.backgroundImage = "url(" + "img/attach_icons/" + extName[x] + ")";
                support = true;
                popupFile();
            }
        }
        if (!support) {
            alert("Sorry, File Not Supported.");
        }

    }
    //erroor handler
    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}


function uploadFile() {
    console.log("in upload file:" + checkURL);
    var ext = checkURL.substr(checkURL.lastIndexOf('.') + 1);
    console.log("extenstion:" + ext);
    var extName = JSON.parse('{"pdf":"application/pdf" , "txt":"text/plain" , "doc":"application/msword" , "docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document" , "ppt":"application/vnd.ms-powerpointtd>" , "pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation" , "xls":"application/vnd.ms-excel" , "xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}');
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var present = false;
    var mmt = "";
    for (var x in extName) {
        if (x == ext) {
            console.log("File: " + x);
            present = true;
            mmt = extName[x];
        }
    }

    if (!present) {
        alert("File Not Supported.");
    } else {
        console.log(mmt);
        var uri = encodeURI(server + "uploadFile.php?proId=" + localStorage.getItem("PROID") + "&desc=" + document.getElementById("fileDesc").value + "&ext=" + ext);
        var options = new FileUploadOptions();
        options.fileKey = "file"; //fileUploadKey
        options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
        options.mimeType = mmt;
        options.httpMethod = 'POST';
        var params = {};
        params.proId = localStorage.getItem("PROID");
        params.desc = document.getElementById("fileDesc").value;
        params.ext = ext;
        options.params = params;
        options.chunkedMode = false;
        var headers = {
            'headerParam': 'headerValue'
        };
        options.headers = headers;

        var ft = new FileTransfer();

        ft.onprogress = function(progressEvent) {
            $(".myBar").css("width", '0%');
            if (progressEvent.lengthComputable) {
                var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
                $(".myBar").css("width", perc + "%");
            } else {
                if (progressStatus.innerHTML === "") {
                    $(".myBar").css("width", "0%");
                } else {
                    $(".myBar").css("width", "100%");
                }
            }
        };

        ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
        //success handler
        function onSucc(r) {
            console.log("Code = " + r.responseCode);
            console.log("Response = " + r.response);
            console.log("Sent = " + r.bytesSent);
            console.log(r.response);
            document.getElementById("fileDesc").value = "";
            closePopup();
            dataFeedRefreshPrevious();

            removeJunk();
            /*if (r.response == 'The file has been uploaded.') {*/
            //console.log("Uploaded");

            //window.location.href = "home.html";
            /*}*/
        }
        //error handler
        function onErr(error) {
            console.log("An error has occurred: Code = " + error.code);
            console.log("upload error source " + error.source);
            console.log("upload error target " + error.target);
            console.log("Failure");
        }
    }
}

function popupText(argument) {
    // body... 
    $("#textPop").addClass("is-visible");
}

function popupVideo(argument) {
    $("#videoPop").addClass("is-visible");
}

function popupAudio(argument) {
    $("#audioPop").addClass("is-visible");
}

function popupPhoto(argument) {
    $("#photoPop").addClass("is-visible");
}

function popupFile(argument) {
    $("#filePop").addClass("is-visible");
}

function closePopup(argument) {
    $(".cd-popup").removeClass("is-visible");
}

function closeChatPopup() {
    $('.send-attach-outer').removeClass('send-attach-outer-visible');
}

function chatPopup(currId) {
    $("#" + currId).addClass('send-attach-outer-visible');
}

var videos = document.getElementsByTagName("video"),
    fraction = 0.8;

function checkScroll() {
    for (var i = 0; i < videos.length; i++) {

        var video = videos[i];

        var x = video.offsetLeft,
            y = video.offsetTop,
            w = video.offsetWidth,
            h = video.offsetHeight,
            r = x + w, //right
            b = y + h, //bottom
            visibleX, visibleY, visible;

        visibleX = Math.max(0, Math.min(w, window.pageXOffset + window.innerWidth - x, r - window.pageXOffset));
        visibleY = Math.max(0, Math.min(h, window.pageYOffset + window.innerHeight - y, b - window.pageYOffset));

        visible = visibleX * visibleY / (w * h);

        if (visible > fraction) {
            video.play();
        } else {
            video.pause();
        }

    }

}
// stopping scroll 
// window.addEventListener('scroll', checkScroll, false);
// window.addEventListener('resize', checkScroll, false);



///////////////////////
// Fetching DATAFEED //
///////////////////////
//<img src="'+server+localStorage.getItem("PROID")+'image/'+localStorage.getItem("PROID")+'.jpg" />
// $(document).ready(function($) {
//     dataFeedRefresh();
// });




function dataFeedRefresh(argument) {
    var proId = localStorage.getItem("PROID");
    var content = "";
    var counter = 1;
    var delOpt = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            // localStorage.setItem("FEED", xhttp.responseText.trim());
            var data = JSON.parse(xhttp.responseText.trim());
            localStorage.setItem("LASTCREATED", data[0].time);
            console.log("Latest:" + data[0].time);
            for (var i = 0; i < data.length; i++) {
                if (data[i].format == "user" || data[i].format == "friend") {
                    //console.log(data[i].type);
                    if (data[i].generator_id == proId) {
                        delOpt = '<li class="item" onclick="deletePost(event,\'' + data[i].id + '\')">Delete</li>';
                    } else {
                        delOpt = "";
                    }
                    //photo
                    if (data[i].type == "photo") {
                        content += '<div class="post-container" id="user' + data[i].id + '">' +
                            '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' + //friend_profile
                            '<div class="col-15 post-pro-pic col-center">' +
                            '<div class="dash-chat-img"  style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                            // '<img src="' + server + data[i].details.profile_photo_url + '" />' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-55">' +
                            '<p>' + data[i].details.user_name + '</p>' +
                            '</div>' +
                            '<div class="col-30 post-time">' +
                            formatAMPM(new Date(data[i].time)) +
                            '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                            '                <div class="celeb-post-del" style="display: none;">' +
                            '                    <ul class="list">' +
                            '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                            '' + delOpt + '' +
                            '                    </ul>' +
                            '                </div>' +
                            '       </div>' +
                            '       </div>' +
                            '<div class="post-desc" >' + //comment_screen
                            emojione.unicodeToImage(data[i].details.photo_description) +
                            '</div>' +
                            '<div class="post-pic" >' +
                            '<img src="' + server + getThumb(data[i].details.photo_title) + '" />' +
                            '</div>' +
                            '<div class="row post-comment">' +
                            '<div class="col-50 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.photo_title + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';
                    } else if (data[i].type == "text") {

                        content += '<div class="post-container" id="user' + data[i].id + '">' +
                            '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' + //\'friend_profile.html\'
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                            // '                       <img src="' + server + data[i].details.profile_photo_url + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-55">' +
                            '                    <p>' + data[i].details.user_name + '</p>' +
                            '                </div>' +
                            '                <div class="col-30 post-time">' +
                            formatAMPM(new Date(data[i].time)) +
                            '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                            '                <div class="celeb-post-del" style="display: none;">' +
                            '                    <ul class="list">' +
                            '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + '0' + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                            '' + delOpt + '' +
                            '                    </ul>' +
                            '                </div>' +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc">' + // \'comment_screen.html\'
                            emojione.unicodeToImage(data[i].details.text_description) +
                            '            </div>' +

                            '            <div class="post-comment row">' +
                            '                <div class="col-100 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + '0' + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments</div>' +
                            '</div>' +
                            '</div>';

                    } else if (data[i].type == "video") {

                        content += '<div class="post-container" id="user' + data[i].id + '">' +
                            '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                            // '                        <img src="' + server + data[i].details.profile_photo_url + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-55">' +
                            '                    <p>' + data[i].details.user_name + '</p>' +
                            '                </div>' +
                            '                <div class="col-30 post-time">' +
                            formatAMPM(new Date(data[i].time)) +
                            '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                            '                <div class="celeb-post-del">' +
                            '                    <ul class="list">' +
                            '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                            '' + delOpt + '' +
                            '                    </ul>' +
                            '                </div>' +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc" >' +
                            emojione.unicodeToImage(data[i].details.video_description) +
                            '            </div>' +
                            '            <div class="post-video">' +
                            '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                            '                    <source src="' + server + data[i].details.video_title + '" type="video/mp4">' +
                            '                </video>' +
                            '            </div>' +
                            '           <div class="row post-comment">' +
                            '            <div class="col-50 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\')"> <i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                            '               <div class="col-50 text-right" onclick="download(\'' + server + data[i].details.video_title + '\',\'' + 'MSG/videos' + '\')" > <i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';

                    } else if (data[i].type == "audio") {
                        content += '<div class="post-container" id="user' + data[i].id + '">' +
                            '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                            // '                        <img src="' + server + data[i].details.profile_photo_url + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-55">' +
                            '                    <p>' + data[i].details.user_name + '</p>' +
                            '                </div>' +
                            '                <div class="col-30 post-time">' +
                            formatAMPM(new Date(data[i].time)) +
                            '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                            '                <div class="celeb-post-del">' +
                            '                    <ul class="list">' +
                            '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                            '' + delOpt + '' +
                            '                    </ul>' +
                            '                </div>' +
                            '            </div>' +
                            '            </div>' +
                            '            <div class="post-desc">' +
                            emojione.unicodeToImage(data[i].details.audio_description) +
                            '            </div>' +
                            '            <div class="post-video">' +
                            '                <audio controls preload="auto">' +
                            '                    <source src="' + server + data[i].details.audio_title + '" type="audio/wav">' +
                            '                </audio>' +
                            '            </div>' +
                            '      <div class="row post-comment">' +
                            '            <div class="col-50 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\')"> <i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                            '               <div class="col-50 text-right" onclick="download(\'' + server + data[i].details.audio_title + '\',\'' + 'MSG/audios' + '\')" > <i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';

                    } else if (data[i].type == "file") {
                        var holder = "";
                        var path = data[i].details.file_title;
                        var ext = path.substr(path.lastIndexOf('.') + 1);
                        var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                        for (var x in extName) {
                            if (x == ext) {
                                console.log("File is: " + x);
                                holder = 'img/attach_icons/' + extName[x];
                            }
                        }
                        content += '<div class="post-container" id="user' + data[i].id + '">' +
                            '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                            // '                        <img src="' + server + data[i].details.profile_photo_url + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-55">' +
                            '                    <p>' + data[i].details.user_name + '</p>' +
                            '                </div>' +
                            '                <div class="col-30 post-time">' +
                            formatAMPM(new Date(data[i].time)) +
                            '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                            '                <div class="celeb-post-del">' +
                            '                    <ul class="list">' +
                            '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                            '' + delOpt + '' +
                            '                    </ul>' +
                            '                </div>' +
                            '            </div>' +
                            '            </div>' +
                            '            <div class="post-desc" >' +
                            emojione.unicodeToImage(data[i].details.file_description) +
                            '            </div>' +
                            '             <div class="post-pic" >' +
                            '              <img src="' + holder + '" />' +
                            '             </div>' +
                            '           <div class="row post-comment">' +
                            '            <div class="col-50 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\')"> <i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                            '               <div class="col-50 text-right" onclick="download(\'' + server + data[i].details.file_title + '\',\'' + 'MSG/files' + '\')" > <i class="fa fa-download"></i> </div>' +
                            '            </div>' +
                            '</div>';
                    }
                    //
                    //
                    //CELEBRITY
                    //
                    //
                } else if (data[i].format == "celebrity") {
                    if (data[i].details.applied_by == proId) {
                        delOpt = '<li class="item" onclick="deleteCelebPost(event,\'' + data[i].id + '\')">Delete</li>';
                    } else {
                        delOpt = "";
                    }

                    if (data[i].type == "photo") {

                        content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                            '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')">' + //friend_profile
                            '<div class="col-15 post-pro-pic col-center">' +
                            '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                            // '<img src="' + server + data[i].details.celeb_photo_url + '" />' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-60">' +
                            '<p>' + data[i].details.celeb_name + '</p>' +
                            '</div>' +
                            '<div class="col-25 post-time">' +
                            formatAMPM(new Date(data[i].time)) +
                            '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                            '                <div class="celeb-post-del">' +
                            '                    <ul class="list">' +
                            '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                            '' + delOpt + '' +
                            '                    </ul>' +
                            '                </div>' +
                            '</div>' +
                            '</div>' +
                            '<div class="post-desc" >' + //comment_screen
                            emojione.unicodeToImage(data[i].details.photo_description) +
                            '</div>' +
                            '<div class="post-pic" >' +
                            '<img src="' + server + getThumb(data[i].details.photo_title) + '" />' +
                            '</div>' +
                            '<div class="row post-comment">' +
                            '<div class="col-50 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.photo_title + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';

                    } else if (data[i].type == "text") {

                        content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                            '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')">' + //\'friend_profile.html\'
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                            // '                       <img src="' + server + data[i].details.celeb_photo_url + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[i].details.celeb_name + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[i].time)) +
                            '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                            '                <div class="celeb-post-del">' +
                            '                    <ul class="list">' +
                            '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + '0' + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                            '' + delOpt + '' +
                            '                    </ul>' +
                            '                </div>' +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc" >' + // \'comment_screen.html\'
                            emojione.unicodeToImage(data[i].details.text_description) +
                            '            </div>' +
                            '<div class="post-comment row" >' +
                            '                <div class="col-100 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + '0' + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments</div>' +
                            '</div>' +
                            '</div>';

                    } else if (data[i].type == "video") {

                        content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                            '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')">' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                            // '                        <img src="' + server + data[i].details.celeb_photo_url + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[i].details.celeb_name + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[i].time)) +
                            '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                            '                <div class="celeb-post-del">' +
                            '                    <ul class="list">' +
                            '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                            '' + delOpt + '' +
                            '                    </ul>' +
                            '                </div>' +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc" >' +
                            emojione.unicodeToImage(data[i].details.video_description) +
                            '            </div>' +
                            '            <div class="post-video">' +
                            '                <video  controls preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                            '                    <source src="' + server + data[i].details.video_title + '" type="video/mp4">' +
                            '                </video>' +
                            '            </div>' +
                            '           <div class="row post-comment">' +
                            '<div class="col-50 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.video_title + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';

                    } else if (data[i].type == "audio") {

                        content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                            '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')" >' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                            // '                        <img src="' + server + data[i].details.celeb_photo_url + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[i].details.celeb_name + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[i].time)) +
                            '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                            '                <div class="celeb-post-del">' +
                            '                    <ul class="list">' +
                            '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                            '' + delOpt + '' +
                            '                    </ul>' +
                            '                </div>' +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc">' +
                            emojione.unicodeToImage(data[i].details.audio_description) +
                            '            </div>' +
                            '            <div class="post-video">' +
                            '                <audio controls preload="auto">' +
                            '                    <source src="' + server + data[i].details.audio_title + '" type="audio/wav">' +
                            '                </audio>' +
                            '            </div>' +
                            '      <div class="row post-comment">' +
                            '<div class="col-50 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.audio_title + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';

                    } else if (data[i].type == "file") {
                        var holder1 = "";
                        var path1 = data[i].details.file_title;
                        var ext1 = path1.substr(path1.lastIndexOf('.') + 1);
                        var extName1 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                        for (var x1 in extName1) {
                            if (x1 == ext1) {
                                console.log("File is: " + x1);
                                holder1 = 'img/attach_icons/' + extName1[x1];
                            }
                        }
                        content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                            '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')">' + //friend_profile
                            '<div class="col-15 post-pro-pic col-center">' +
                            '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                            // '<img src="' + server + data[i].details.celeb_photo_url + '" />' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-60">' +
                            '<p>' + data[i].details.celeb_name + '</p>' +
                            '</div>' +
                            '<div class="col-25 post-time">' +
                            formatAMPM(new Date(data[i].time)) +
                            '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                            '                <div class="celeb-post-del">' +
                            '                    <ul class="list">' +
                            '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                            '' + delOpt + '' +
                            '                    </ul>' +
                            '                </div>' +
                            '</div>' +
                            '</div>' +
                            '<div class="post-desc" >' + //comment_screen
                            emojione.unicodeToImage(data[i].details.file_description) +
                            '</div>' +
                            '<div class="post-pic" >' +
                            '<img src="' + holder1 + '" />' +
                            '</div>' +
                            '<div class="row post-comment">' +
                            '<div class="col-50 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.file_title + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';

                    }
                    //////////
                    //GROUP //
                    //////////
                }
                //  else if (data[i].format == "group") {
                //     if (data[i].postedById == proId) {
                //         delOpt = '<li class="item" onclick="deleteGroupPost(event,\'' + data[i].id + '\')">Delete</li>';
                //     } else {
                //         delOpt = "";
                //     }
                //     if (data[i].type == "photo") {

                //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                //             '<div class="row post-head">' + //friend_profile
                //             '<div class="col-15 post-pro-pic col-center">' +
                //             '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                //             // '<img src="' + server + data[i].details.group_photo + '" />' +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="col-60">' +
                //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                //             '</div>' +
                //             '<div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[i].time)) +
                //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                //             '                <div class="celeb-post-del">' +
                //             '                    <ul class="list">' +
                //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')">Share</li>' +
                //             '' + delOpt + '' +
                //             '                    </ul>' +
                //             '                </div>' +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="post-desc" >' + //comment_screen
                //             emojione.unicodeToImage(data[i].details.photo_description) +
                //             '</div>' +
                //             '<div class="post-pic" >' +
                //             '<img src="' + server + data[i].details.photo_title + '" />' +
                //             '</div>' +
                //             '<div class="row post-comment">' +
                //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.photo_title + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '</div>' +
                //             '</div>';

                //     } else if (data[i].type == "text") {

                //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                //             '<div class="row post-head">' + //\'friend_profile.html\'
                //             '                <div class="col-15 post-pro-pic col-center">' +
                //             '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                //             // '                       <img src="' + server + data[i].details.group_photo + '" />' +
                //             '                    </div>' +
                //             '                </div>' +
                //             '                <div class="col-60">' +
                //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                //             '                </div>' +
                //             '                <div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[i].time)) +
                //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                //             '                <div class="celeb-post-del">' +
                //             '                    <ul class="list">' +
                //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + "0" + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')">Share</li>' +
                //             '' + delOpt + '' +
                //             '                    </ul>' +
                //             '                </div>' +
                //             '                </div>' +
                //             '            </div>' +
                //             '            <div class="post-desc" >' +
                //             emojione.unicodeToImage(data[i].details.text_description) +
                //             '            </div>' +
                //             '<div class="post-comment row" > ' +
                //             '             <div class="col-100 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + "0" + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"> <i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments</div>' +
                //             '            </div>' +
                //             '</div>';

                //     } else if (data[i].type == "video") {

                //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                //             '<div class="row post-head" >' +
                //             '                <div class="col-15 post-pro-pic col-center">' +
                //             '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                //             // '                     <img src="' + server + data[i].details.group_photo + '" />' +
                //             '                    </div>' +
                //             '                </div>' +
                //             '                <div class="col-60">' +
                //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                //             '                </div>' +
                //             '                <div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[i].time)) +
                //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                //             '                <div class="celeb-post-del">' +
                //             '                    <ul class="list">' +
                //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')">Share</li>' +
                //             '' + delOpt + '' +
                //             '                    </ul>' +
                //             '                </div>' +
                //             '                </div>' +
                //             '            </div>' +
                //             '            <div class="post-desc" >' +
                //             emojione.unicodeToImage(data[i].details.video_description) +
                //             '            </div>' +
                //             '            <div class="post-video">' +
                //             '                <video controls preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                //             '                    <source src="' + server + data[i].details.video_title + '" type="video/mp4">' +
                //             '                </video>' +
                //             '            </div>' +
                //             '           <div class="row post-comment">' +
                //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.video_title + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '</div>' +
                //             '</div>';

                //     } else if (data[i].type == "audio") {
                //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                //             '<div class="row post-head" >' +
                //             '                <div class="col-15 post-pro-pic col-center">' +
                //             '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                //             // '                  <img src="' + server + data[i].details.group_photo + '" />' +
                //             '                    </div>' +
                //             '                </div>' +
                //             '                <div class="col-60">' +
                //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                //             '                </div>' +
                //             '                <div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[i].time)) +
                //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                //             '                <div class="celeb-post-del">' +
                //             '                    <ul class="list">' +
                //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')" >Share</li>' +
                //             '' + delOpt + '' +
                //             '                    </ul>' +
                //             '                </div>' +
                //             '                </div>' +
                //             '            </div>' +
                //             '            <div class="post-desc">' +
                //             emojione.unicodeToImage(data[i].details.audio_description) +
                //             '            </div>' +
                //             '            <div class="post-video">' +
                //             '                <audio controls preload="auto">' +
                //             '                    <source src="' + server + data[i].details.audio_title + '" type="audio/wav">' +
                //             '                </audio>' +
                //             '            </div>' +
                //             '      <div class="row post-comment">' +
                //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.audio_title + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '        </div>' +
                //             '</div>';

                //     } else if (data[i].type == "file") {
                //         var holder2 = "";
                //         var path2 = data[i].details.file_title;
                //         var ext2 = path2.substr(path2.lastIndexOf('.') + 1);
                //         var extName2 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                //         for (var x2 in extName2) {
                //             if (x2 == ext2) {
                //                 console.log("File is: " + x2);
                //                 holder2 = 'img/attach_icons/' + extName2[x2];
                //             }
                //         }
                //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                //             '<div class="row post-head">' +
                //             '<div class="col-15 post-pro-pic col-center">' +
                //             '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                //             // '<img src="' + server + data[i].details.group_photo + '" />' +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="col-60">' +
                //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                //             '</div>' +
                //             '<div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[i].time)) +
                //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                //             '                <div class="celeb-post-del">' +
                //             '                    <ul class="list">' +
                //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')">Share</li>' +
                //             '' + delOpt + '' +
                //             '                    </ul>' +
                //             '                </div>' +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="post-desc" >' + //comment_screen
                //             emojione.unicodeToImage(data[i].details.file_description) +
                //             '</div>' +
                //             '<div class="post-pic" >' +
                //             '<img src="' + holder2 + '" />' +
                //             '</div>' +
                //             '<div class="row post-comment">' +
                //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.file_title + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '</div>' +
                //             '</div>';

                //     } else if (data[i].type == 'shared') {
                //         var innerContent = "";
                //         var folder = "";
                //         var innerData = JSON.parse(data[i].details.shared_description);
                //         var innerJson = data[i].details.shared_description.replace(/"/g, "~");
                //         console.log("innerJson:" + innerJson);
                //         if (data[i].details.shared_format == "photo") {
                //             folder = "images";
                //             innerContent = '<div class="shared-post">' +
                //                 '                            <div class="row post-head">' +
                //                 '                                <div class="col-15 post-pro-pic col-center">' +
                //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                //                 '                                </div>' +
                //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                //                 '                            </div>' +
                //                 '                            ' +
                //                 '                            <div class="post-desc" >' +
                //                 '                               ' + innerData.desc + '' +
                //                 '                            </div>' +
                //                 '                         ' +
                //                 '                            <div class="post-pic">' +
                //                 '                              <img src="' + server + innerData.title + '" />' +
                //                 '                            </div>' +
                //                 '                        </div>';


                //         } else if (data[i].details.shared_format == "text") {
                //             folder = "text";
                //             innerContent = '<div class="shared-post">' +
                //                 '                            <div class="row post-head">' +
                //                 '                                <div class="col-15 post-pro-pic col-center">' +
                //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                //                 '                                </div>' +
                //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                //                 '                            </div>' +
                //                 '                            ' +
                //                 '                            <div class="post-desc" >' +
                //                 '                               ' + innerData.desc + '' +
                //                 '                            </div>' +
                //                 '                         ' +
                //                 '                        </div>';


                //         } else if (data[i].details.shared_format == "video") {
                //             folder = "videos";
                //             innerContent = '<div class="shared-post">' +
                //                 '                            <div class="row post-head">' +
                //                 '                                <div class="col-15 post-pro-pic col-center">' +
                //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                //                 '                                </div>' +
                //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                //                 '                            </div>' +
                //                 '                            ' +
                //                 '                            <div class="post-desc" >' +
                //                 '                               ' + innerData.desc + '' +
                //                 '                            </div>' +
                //                 '                         ' +
                //                 '                            <div class="post-video">' +
                //                 '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                //                 '                    <source src="' + server + innerData.title + '" type="video/mp4">' +
                //                 '                </video>' +
                //                 '                            </div>' +
                //                 '                        </div>';


                //         } else if (data[i].details.shared_format == "audio") {
                //             folder = "audios";
                //             innerContent = '<div class="shared-post">' +
                //                 '                            <div class="row post-head">' +
                //                 '                                <div class="col-15 post-pro-pic col-center">' +
                //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                //                 '                                </div>' +
                //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                //                 '                            </div>' +
                //                 '                            ' +
                //                 '                            <div class="post-desc" >' +
                //                 '                               ' + innerData.desc + '' +
                //                 '                            </div>' +
                //                 '                         ' +
                //                 '                            <div class="post-video">' +
                //                 '                <audio controls preload="auto">' +
                //                 '                    <source src="' + server + innerData.title + '" type="audio/wav">' +
                //                 '                </audio>' +
                //                 '                            </div>' +
                //                 '                        </div>';



                //         } else if (data[i].details.shared_format == "file") {
                //             folder = "files";
                //             var holder3 = "";
                //             var path3 = innerData.title;
                //             var ext3 = path3.substr(path3.lastIndexOf('.') + 1);
                //             var extName3 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                //             for (var x3 in extName3) {
                //                 if (x3 == ext3) {
                //                     console.log("File is: " + x3);
                //                     holder3 = 'img/attach_icons/' + extName3[x3];
                //                 }
                //             }
                //             innerContent = '<div class="shared-post">' +
                //                 '                            <div class="row post-head">' +
                //                 '                                <div class="col-15 post-pro-pic col-center">' +
                //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                //                 '                                </div>' +
                //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                //                 '                            </div>' +
                //                 '                            ' +
                //                 '                            <div class="post-desc" >' +
                //                 '                               ' + innerData.desc + '' +
                //                 '                            </div>' +
                //                 '                         ' +
                //                 '                            <div class="post-pic">' +
                //                 '                              <img src="' + holder3 + '" />' +
                //                 '                            </div>' +
                //                 '                        </div>';

                //         }
                //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                //             '<div class="row post-head">' + //friend_profile
                //             '<div class="col-15 post-pro-pic col-center">' +
                //             '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                //             // '<img src="' + server + data[i].details.group_photo + '" />' +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="col-60">' +
                //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                //             '</div>' +
                //             '<div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[i].time)) +
                //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                //             '                <div class="celeb-post-del">' +
                //             '                    <ul class="list">' +
                //             '                        <li class="item" onclick="reShare(event,\'' + innerJson + '\')">Share</li>' +
                //             '' + delOpt + '' +
                //             '                    </ul>' +
                //             '                </div>' +
                //             '</div>' +
                //             '</div>' +
                //             '' + innerContent + '' +
                //             '<div class="row post-comment">' +
                //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + innerJson + '\',\'' + data[i].details.shared_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.shared_title + '\',\'' + 'MSG/' + folder + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '</div>' +
                //             '</div>';
                //     }
                // }
            }
            localStorage.setItem("DATAFEED", content);
            megaLoad4 = true;
            console.log("4-megaLoad:" + megaLoad4);
            if (firstCall) {
                console.log("firstCall");
                dataFeedRefreshPopulate();
            }
        }
    };
    xhttp.open("POST", server + "dataFeed.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    //console.log(parameters);
    xhttp.send(parameters);
}

function dataFeedRefreshPopulate(argument) {
    console.log("dataFeedRefreshPopulate");
    document.getElementById("dataFeed").innerHTML = localStorage.getItem("DATAFEED");
    if (localStorage.getItem("POSTCOMMENTCOUNT") !== "" && localStorage.getItem("POSTCOMMENTCOUNT") !== null) {
        var con = localStorage.getItem("POSTCOMMENTCOUNT").split(',');
        console.log(con[0] + ":::" + con[1]);
        $("#user" + con[0]).children('.post-comment').children('.comment-return').html('<i class="fa fa-comment"> ' + ' ' + con[1] + ' comments</i>');
        localStorage.setItem("POSTCOMMENTCOUNT", "");
    } else if (localStorage.getItem("GROUPCOMMENTCOUNT") !== "" && localStorage.getItem("GROUPCOMMENTCOUNT") !== null) {
        var con1 = localStorage.getItem("GROUPCOMMENTCOUNT").split(',');
        console.log(con1[0] + ":::" + con1[1]);
        $("#group" + con1[0]).children('.post-comment').children('.comment-return').html('<i class="fa fa-comment"> ' + ' ' + con1[1] + ' comments</i>');
        localStorage.setItem("GROUPCOMMENTCOUNT", "");
    } else if (localStorage.getItem("CELEBCOMMENTCOUNT") !== "" && localStorage.getItem("CELEBCOMMENTCOUNT") !== null) {
        var con2 = localStorage.getItem("CELEBCOMMENTCOUNT").split(',');
        console.log(con2[0] + ":::" + con2[1]);
        $("#celeb" + con2[0]).children('.post-comment').children('.comment-return').html('<i class="fa fa-comment"> ' + ' ' + con2[1] + ' comments</i>');
        localStorage.setItem("CELEBCOMMENTCOUNT", "");
    }
    setTimeout(function() {
        myScroll.refresh(); //for iScroll  
    }, 1000);
    setTimeout(function() {
        // $('video').on('loadstart', function(event) {
        //     // $(this).addClass('loading');
        //     console.log("loading");
        // });
        // $('video').on('canplay', function(event) {
        //    console.log("canplay"); 
        //     // $(this).removeClass('loading');
        //     // $(this).attr('poster', '');
        // });
        $("img").on('error', function() {
            $(this).attr("src", "img/pictures/notFound.png");
        });
        $("video,audio").on('click', function() {
            // console.log("IN:"+this.paused);
            if (this.paused) {
                this.play();
            } else {
                this.pause();
            }
            if (this.getAttribute('controls') !== 'true') {
                this.setAttribute('controls', 'true');
            }
            this.setAttribute('controls', 'true');
        });
    }, 2000);
    document.getElementById("cardLoader").style.display = 'none';
    document.getElementById("wrapper").style.display = 'block';
}

var offsetHome = 0;
//OBSOLOTE
function toggleHomeLoader(arg) {
    document.getElementById("loadMore").style.display = 'none';
    document.getElementById("proLoader").style.display = 'block';
    offsetHome += 10;
    dataFeedRefreshNext(offsetHome);
}
//OBSOLOTE
function toggleHomeLoaderPrevious(arg) {
    document.getElementById("loadNew").style.display = 'none';
    document.getElementById("proLoaderNew").style.display = 'block';
    dataFeedRefreshPrevious();
}

function dataFeedRefreshNext(offset) {
    //localStorage.setItem("PROID","5");
    var proId = localStorage.getItem("PROID");
    var delOpt = "";
    var content = "";
    var counter = 1;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            localStorage.setItem("FEED", xhttp.responseText.trim());
            var data = JSON.parse(xhttp.responseText.trim());
            //console.log(data.length);
            if (data.length !== 0) {
                for (var i = 0; i < data.length; i++) {
                    if (data[i].format == "user" || data[i].format == "friend") {
                        //console.log(data[i].type);
                        //photo
                        if (data[i].generator_id == proId) {
                            delOpt = '<li class="item" onclick="deletePost(event,\'' + data[i].id + '\')">Delete</li>';
                        } else {
                            delOpt = "";
                        }
                        //photo
                        if (data[i].type == "photo") {
                            content += '<div class="post-container" id="user' + data[i].id + '">' +
                                '<div class="row post-head"  onclick="setGeneratorId(event,\'' + data[i].generator_id + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img"  style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                                // '<img src="' + server + data[i].details.profile_photo_url + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-55">' +
                                '<p>' + data[i].details.user_name + '</p>' +
                                '</div>' +
                                '<div class="col-30 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '       </div>' +
                                '       </div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[i].details.photo_description) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + server + getThumb(data[i].details.photo_title) + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.photo_title + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';
                        } else if (data[i].type == "text") {

                            content += '<div class="post-container" id="user' + data[i].id + '">' +
                                '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' + //\'friend_profile.html\'
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                                // '                       <img src="' + server + data[i].details.profile_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-55">' +
                                '                    <p>' + data[i].details.user_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-30 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + '0' + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' + // \'comment_screen.html\'
                                emojione.unicodeToImage(data[i].details.text_description) +
                                '            </div>' +

                                '            <div class="post-comment row" >' +
                                '                <div class="col-100 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + '0' + '\',\'' + data[i].details.comment_count + '\')" ><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments</div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[i].type == "video") {

                            content += '<div class="post-container" id="user' + data[i].id + '">' +
                                '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                                // '                        <img src="' + server + data[i].details.profile_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-55">' +
                                '                    <p>' + data[i].details.user_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-30 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                emojione.unicodeToImage(data[i].details.video_description) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + data[i].details.video_title + '" type="video/mp4">' +
                                '                </video>' +
                                '            </div>' +
                                '           <div class="row post-comment">' +
                                '            <div class="col-50 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\')"> <i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '               <div class="col-50 text-right" onclick="download(\'' + server + data[i].details.video_title + '\',\'' + 'MSG/videos' + '\')" > <i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[i].type == "audio") {
                            content += '<div class="post-container" id="user' + data[i].id + '">' +
                                '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                                // '                        <img src="' + server + data[i].details.profile_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-55">' +
                                '                    <p>' + data[i].details.user_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-30 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '            </div>' +
                                '            </div>' +
                                '            <div class="post-desc">' +
                                emojione.unicodeToImage(data[i].details.audio_description) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <audio controls preload="auto">' +
                                '                    <source src="' + server + data[i].details.audio_title + '" type="audio/wav">' +
                                '                </audio>' +
                                '            </div>' +
                                '      <div class="row post-comment">' +
                                '            <div class="col-50 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\')"> <i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '               <div class="col-50 text-right" onclick="download(\'' + server + data[i].details.audio_title + '\',\'' + 'MSG/audios' + '\')" > <i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[i].type == "file") {
                            var holder = "";
                            var path = data[i].details.file_title;
                            var ext = path.substr(path.lastIndexOf('.') + 1);
                            var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x in extName) {
                                if (x == ext) {
                                    console.log("File is: " + x);
                                    holder = 'img/attach_icons/' + extName[x];
                                }
                            }

                            content += '<div class="post-container" id="user' + data[i].id + '">' +
                                '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                                // '                        <img src="' + server + data[i].details.profile_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-55">' +
                                '                    <p>' + data[i].details.user_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-30 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '            </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                emojione.unicodeToImage(data[i].details.file_description) +
                                '            </div>' +
                                '             <div class="post-pic" >' +
                                '              <img src="' + holder + '" />' +
                                '             </div>' +
                                '           <div class="row post-comment">' +
                                '            <div class="col-50 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\')"> <i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '               <div class="col-50 text-right" onclick="download(\'' + server + data[i].details.file_title + '\',\'' + 'MSG/files' + '\')" > <i class="fa fa-download"></i> </div>' +
                                '            </div>' +
                                '</div>';



                        }

                        //
                        //
                        //CELEBRITY
                        //
                        //
                    } else if (data[i].format == "celebrity") {


                        if (data[i].details.applied_by == proId) {
                            delOpt = '<li class="item" onclick="deletePost(event,\'' + data[i].id + '\')">Delete</li>';
                        } else {
                            delOpt = "";
                        }

                        if (data[i].type == "photo") {

                            content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                                '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                                // '<img src="' + server + data[i].details.celeb_photo_url + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[i].details.celeb_name + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[i].details.photo_description) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + server + getThumb(data[i].details.photo_title) + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.photo_title + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[i].type == "text") {

                            content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                                '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')">' + //\'friend_profile.html\'
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                                // '                       <img src="' + server + data[i].details.celeb_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[i].details.celeb_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + '0' + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' + // \'comment_screen.html\'
                                emojione.unicodeToImage(data[i].details.text_description) +
                                '            </div>' +
                                '<div class="post-comment row" >' +
                                '                <div class="col-100 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + '0' + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments</div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[i].type == "video") {

                            content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                                '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')">' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                                // '                        <img src="' + server + data[i].details.celeb_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[i].details.celeb_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                emojione.unicodeToImage(data[i].details.video_description) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + data[i].details.video_title + '" type="video/mp4">' +
                                '                </video>' +
                                '            </div>' +
                                '           <div class="row post-comment">' +
                                '<div class="col-50 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.video_title + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';


                        } else if (data[i].type == "audio") {

                            content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                                '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')" >' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                                // '                        <img src="' + server + data[i].details.celeb_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[i].details.celeb_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc">' +
                                emojione.unicodeToImage(data[i].details.audio_description) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <audio controls preload="auto">' +
                                '                    <source src="' + server + data[i].details.audio_title + '" type="audio/wav">' +
                                '                </audio>' +
                                '            </div>' +
                                '      <div class="row post-comment">' +
                                '<div class="col-50 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.audio_title + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[i].type == "file") {
                            var holder1 = "";
                            var path1 = data[i].details.file_title;
                            var ext1 = path1.substr(path1.lastIndexOf('.') + 1);
                            var extName1 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x1 in extName1) {
                                if (x1 == ext1) {
                                    console.log("File is: " + x1);
                                    holder1 = 'img/attach_icons/' + extName1[x1];
                                }
                            }
                            content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                                '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                                // '<img src="' + server + data[i].details.celeb_photo_url + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[i].details.celeb_name + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[i].details.file_description) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + holder1 + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.file_title + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        }
                        //////////
                        //GROUP //
                        //////////
                    }
                    // else if (data[i].format == "group") {

                    //     if (data[i].postedById == proId) {
                    //         delOpt = '<li class="item" onclick="deletePost(event,\'' + data[i].id + '\')">Delete</li>';
                    //     } else {
                    //         delOpt = "";
                    //     }
                    //     if (data[i].type == "photo") {

                    //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                    //             '<div class="row post-head">' + //friend_profile
                    //             '<div class="col-15 post-pro-pic col-center">' +
                    //             '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                    //             // '<img src="' + server + data[i].details.group_photo + '" />' +
                    //             '</div>' +
                    //             '</div>' +
                    //             '<div class="col-60">' +
                    //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                    //             '</div>' +
                    //             '<div class="col-25 post-time">' +
                    //             formatAMPM(new Date(data[i].time)) +
                    //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                    //             '                <div class="celeb-post-del">' +
                    //             '                    <ul class="list">' +
                    //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')">Share</li>' +
                    //             '' + delOpt + '' +
                    //             '                    </ul>' +
                    //             '                </div>' +
                    //             '</div>' +
                    //             '</div>' +
                    //             '<div class="post-desc" >' + //comment_screen
                    //             emojione.unicodeToImage(data[i].details.photo_description) +
                    //             '</div>' +
                    //             '<div class="post-pic" >' +
                    //             '<img src="' + server + data[i].details.photo_title + '" />' +
                    //             '</div>' +
                    //             '<div class="row post-comment">' +
                    //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                    //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.photo_title + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                    //             '</div>' +
                    //             '</div>';

                    //     } else if (data[i].type == "text") {

                    //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                    //             '<div class="row post-head">' + //\'friend_profile.html\'
                    //             '                <div class="col-15 post-pro-pic col-center">' +
                    //             '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                    //             // '                       <img src="' + server + data[i].details.group_photo + '" />' +
                    //             '                    </div>' +
                    //             '                </div>' +
                    //             '                <div class="col-60">' +
                    //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                    //             '                </div>' +
                    //             '                <div class="col-25 post-time">' +
                    //             formatAMPM(new Date(data[i].time)) +
                    //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                    //             '                <div class="celeb-post-del">' +
                    //             '                    <ul class="list">' +
                    //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + "0" + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')">Share</li>' +
                    //             '' + delOpt + '' +
                    //             '                    </ul>' +
                    //             '                </div>' +
                    //             '                </div>' +
                    //             '            </div>' +
                    //             '            <div class="post-desc" >' + // \'comment_screen.html\'
                    //             emojione.unicodeToImage(data[i].details.text_description) +
                    //             '            </div>' +
                    //             '<div class="post-comment row" > ' +
                    //             '             <div class="col-100 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + "0" + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"> <i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments</div>' +
                    //             '            </div>' +
                    //             '</div>';

                    //     } else if (data[i].type == "video") {

                    //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                    //             '<div class="row post-head" >' +
                    //             '                <div class="col-15 post-pro-pic col-center">' +
                    //             '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                    //             // '                     <img src="' + server + data[i].details.group_photo + '" />' +
                    //             '                    </div>' +
                    //             '                </div>' +
                    //             '                <div class="col-60">' +
                    //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                    //             '                </div>' +
                    //             '                <div class="col-25 post-time">' +
                    //             formatAMPM(new Date(data[i].time)) +
                    //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                    //             '                <div class="celeb-post-del">' +
                    //             '                    <ul class="list">' +
                    //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')">Share</li>' +
                    //             '' + delOpt + '' +
                    //             '                    </ul>' +
                    //             '                </div>' +
                    //             '                </div>' +
                    //             '            </div>' +
                    //             '            <div class="post-desc" >' +
                    //             emojione.unicodeToImage(data[i].details.video_description) +
                    //             '            </div>' +
                    //             '            <div class="post-video">' +
                    //             '                <video controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                    //             '                    <source src="' + server + data[i].details.video_title + '" type="video/mp4">' +
                    //             '                </video>' +
                    //             '            </div>' +
                    //             '           <div class="row post-comment">' +
                    //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                    //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.video_title + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                    //             '</div>' +
                    //             '</div>';



                    //     } else if (data[i].type == "audio") {
                    //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                    //             '<div class="row post-head" >' +
                    //             '                <div class="col-15 post-pro-pic col-center">' +
                    //             '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                    //             // '                  <img src="' + server + data[i].details.group_photo + '" />' +
                    //             '                    </div>' +
                    //             '                </div>' +
                    //             '                <div class="col-60">' +
                    //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                    //             '                </div>' +
                    //             '                <div class="col-25 post-time">' +
                    //             formatAMPM(new Date(data[i].time)) +
                    //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                    //             '                <div class="celeb-post-del">' +
                    //             '                    <ul class="list">' +
                    //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')" >Share</li>' +
                    //             '' + delOpt + '' +
                    //             '                    </ul>' +
                    //             '                </div>' +
                    //             '                </div>' +
                    //             '            </div>' +
                    //             '            <div class="post-desc">' +
                    //             emojione.unicodeToImage(data[i].details.audio_description) +
                    //             '            </div>' +
                    //             '            <div class="post-video">' +
                    //             '                <audio controls preload="auto">' +
                    //             '                    <source src="' + server + data[i].details.audio_title + '" type="audio/wav">' +
                    //             '                </audio>' +
                    //             '            </div>' +
                    //             '      <div class="row post-comment">' +
                    //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                    //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.audio_title + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                    //             '        </div>' +
                    //             '</div>';

                    //     } else if (data[i].type == "file") {
                    //         var holder2 = "";
                    //         var path2 = data[i].details.file_title;
                    //         var ext2 = path2.substr(path2.lastIndexOf('.') + 1);
                    //         var extName2 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                    //         for (var x2 in extName2) {
                    //             if (x2 == ext2) {
                    //                 console.log("File is: " + x2);
                    //                 holder2 = 'img/attach_icons/' + extName2[x2];
                    //             }
                    //         }
                    //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                    //             '<div class="row post-head">' +
                    //             '<div class="col-15 post-pro-pic col-center">' +
                    //             '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                    //             // '<img src="' + server + data[i].details.group_photo + '" />' +
                    //             '</div>' +
                    //             '</div>' +
                    //             '<div class="col-60">' +
                    //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                    //             '</div>' +
                    //             '<div class="col-25 post-time">' +
                    //             formatAMPM(new Date(data[i].time)) +
                    //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                    //             '                <div class="celeb-post-del">' +
                    //             '                    <ul class="list">' +
                    //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')">Share</li>' +
                    //             '' + delOpt + '' +
                    //             '                    </ul>' +
                    //             '                </div>' +
                    //             '</div>' +
                    //             '</div>' +
                    //             '<div class="post-desc" >' + //comment_screen
                    //             emojione.unicodeToImage(data[i].details.file_description) +
                    //             '</div>' +
                    //             '<div class="post-pic" >' +
                    //             '<img src="' + holder2 + '" />' +
                    //             '</div>' +
                    //             '<div class="row post-comment">' +
                    //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                    //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.file_title + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                    //             '</div>' +
                    //             '</div>';

                    //     } else if (data[i].type == 'shared') {
                    //         var innerContent = "";
                    //         var folder = "";
                    //         var innerData = JSON.parse(data[i].details.shared_description);
                    //         var innerJson = data[i].details.shared_description.replace(/"/g, "~");
                    //         console.log("innerJson:" + innerJson);
                    //         if (data[i].details.shared_format == "photo") {
                    //             folder = "images";
                    //             innerContent = '<div class="shared-post">' +
                    //                 '                            <div class="row post-head">' +
                    //                 '                                <div class="col-15 post-pro-pic col-center">' +
                    //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    //                 '                                </div>' +
                    //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    //                 '                            </div>' +
                    //                 '                            ' +
                    //                 '                            <div class="post-desc" >' +
                    //                 '                               ' + innerData.desc + '' +
                    //                 '                            </div>' +
                    //                 '                         ' +
                    //                 '                            <div class="post-pic">' +
                    //                 '                              <img src="' + server + innerData.title + '" />' +
                    //                 '                            </div>' +
                    //                 '                        </div>';


                    //         } else if (data[i].details.shared_format == "text") {
                    //             folder = "text";
                    //             innerContent = '<div class="shared-post">' +
                    //                 '                            <div class="row post-head">' +
                    //                 '                                <div class="col-15 post-pro-pic col-center">' +
                    //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    //                 '                                </div>' +
                    //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    //                 '                            </div>' +
                    //                 '                            ' +
                    //                 '                            <div class="post-desc" >' +
                    //                 '                               ' + innerData.desc + '' +
                    //                 '                            </div>' +
                    //                 '                         ' +
                    //                 '                        </div>';


                    //         } else if (data[i].details.shared_format == "video") {
                    //             folder = "videos";
                    //             innerContent = '<div class="shared-post">' +
                    //                 '                            <div class="row post-head">' +
                    //                 '                                <div class="col-15 post-pro-pic col-center">' +
                    //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    //                 '                                </div>' +
                    //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    //                 '                            </div>' +
                    //                 '                            ' +
                    //                 '                            <div class="post-desc" >' +
                    //                 '                               ' + innerData.desc + '' +
                    //                 '                            </div>' +
                    //                 '                         ' +
                    //                 '                            <div class="post-video">' +
                    //                 '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                    //                 '                    <source src="' + server + innerData.title + '" type="video/mp4">' +
                    //                 '                </video>' +
                    //                 '                            </div>' +
                    //                 '                        </div>';


                    //         } else if (data[i].details.shared_format == "audio") {
                    //             folder = "audios";
                    //             innerContent = '<div class="shared-post">' +
                    //                 '                            <div class="row post-head">' +
                    //                 '                                <div class="col-15 post-pro-pic col-center">' +
                    //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    //                 '                                </div>' +
                    //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    //                 '                            </div>' +
                    //                 '                            ' +
                    //                 '                            <div class="post-desc" >' +
                    //                 '                               ' + innerData.desc + '' +
                    //                 '                            </div>' +
                    //                 '                         ' +
                    //                 '                            <div class="post-video">' +
                    //                 '                <audio controls preload="auto">' +
                    //                 '                    <source src="' + server + innerData.title + '" type="audio/wav">' +
                    //                 '                </audio>' +
                    //                 '                            </div>' +
                    //                 '                        </div>';



                    //         } else if (data[i].details.shared_format == "file") {
                    //             folder = "files";
                    //             var holder3 = "";
                    //             var path3 = innerData.title;
                    //             var ext3 = path3.substr(path3.lastIndexOf('.') + 1);
                    //             var extName3 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                    //             for (var x3 in extName3) {
                    //                 if (x3 == ext3) {
                    //                     console.log("File is: " + x3);
                    //                     holder3 = 'img/attach_icons/' + extName3[x3];
                    //                 }
                    //             }
                    //             innerContent = '<div class="shared-post">' +
                    //                 '                            <div class="row post-head">' +
                    //                 '                                <div class="col-15 post-pro-pic col-center">' +
                    //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    //                 '                                </div>' +
                    //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    //                 '                            </div>' +
                    //                 '                            ' +
                    //                 '                            <div class="post-desc" >' +
                    //                 '                               ' + innerData.desc + '' +
                    //                 '                            </div>' +
                    //                 '                         ' +
                    //                 '                            <div class="post-pic">' +
                    //                 '                              <img src="' + holder3 + '" />' +
                    //                 '                            </div>' +
                    //                 '                        </div>';

                    //         }
                    //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                    //             '<div class="row post-head">' + //friend_profile
                    //             '<div class="col-15 post-pro-pic col-center">' +
                    //             '<div class="dash-chat-img" style="background-image:url(' + server + data[i].details.group_photo + ')">' +
                    //             // '<img src="' + server + data[i].details.group_photo + '" />' +
                    //             '</div>' +
                    //             '</div>' +
                    //             '<div class="col-60">' +
                    //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                    //             '</div>' +
                    //             '<div class="col-25 post-time">' +
                    //             formatAMPM(new Date(data[i].time)) +
                    //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                    //             '                <div class="celeb-post-del">' +
                    //             '                    <ul class="list">' +
                    //             '                        <li class="item" onclick="reShare(event,\'' + innerJson + '\')">Share</li>' +
                    //             '' + delOpt + '' +
                    //             '                    </ul>' +
                    //             '                </div>' +
                    //             '</div>' +
                    //             '</div>' +
                    //             '' + innerContent + '' +
                    //             '<div class="row post-comment">' +
                    //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + innerJson + '\',\'' + data[i].details.shared_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                    //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.shared_title + '\',\'' + 'MSG/' + folder + '\')" ><i class="fa fa-download"></i> </div>' +
                    //             '</div>' +
                    //             '</div>';
                    //     }
                    // }
                }
                document.getElementById("dataFeed").innerHTML += content;
                $("img").on('error', function() {
                    $(this).attr("src", "img/pictures/notFound.png");
                });
                setTimeout(function() {
                    $("video,audio").on('click', function() {
                        // console.log("IN:"+this.paused);
                        if (this.paused) {
                            this.play();
                        } else {
                            this.pause();
                        }
                        if (this.getAttribute('controls') !== 'true') {
                            this.setAttribute('controls', 'true');
                        }
                        this.setAttribute('controls', 'true');
                    });
                }, 2000);
                setTimeout(function() {
                    myScroll.refresh(); //for iScroll 
                }, 1000);
            } else {
                console.log("No More Post");

                myScroll.refresh(); //for iScroll 

                // document.getElementById('loadMore').innerHTML = "<p>No More Posts</p>";
            }

        }
    };
    xhttp.open("POST", server + "dataFeedNext.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID") + "&offset=" + offset;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    console.log(parameters);
    xhttp.send(parameters);
}

function dataFeedRefreshPrevious() {
    //localStorage.setItem("PROID","5");
    var proId = localStorage.getItem("PROID");
    var delOpt = "";
    var content = "";
    var counter = 1;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            localStorage.setItem("FEED", xhttp.responseText.trim());
            var data = JSON.parse(xhttp.responseText.trim());
            //console.log(data.length);
            if (data.length !== 0) {
                localStorage.setItem("LASTCREATED", data[0].time);
                for (var i = 0; i < data.length; i++) {
                    if (data[i].format == "user" || data[i].format == "friend") {
                        //console.log(data[i].type);
                        //photo
                        if (data[i].generator_id == proId) {
                            delOpt = '<li class="item" onclick="deletePost(event,\'' + data[i].id + '\')">Delete</li>';
                        } else {
                            delOpt = "";
                        }
                        //photo
                        if (data[i].type == "photo") {
                            content += '<div class="post-container" id="user' + data[i].id + '">' +
                                '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img"  style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                                // '<img src="' + server + data[i].details.profile_photo_url + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-55">' +
                                '<p>' + data[i].details.user_name + '</p>' +
                                '</div>' +
                                '<div class="col-30 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '       </div>' +
                                '       </div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[i].details.photo_description) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + server + getThumb(data[i].details.photo_title) + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.photo_title + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';
                        } else if (data[i].type == "text") {

                            content += '<div class="post-container" id="user' + data[i].id + '">' +
                                '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' + //\'friend_profile.html\'
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                                // '                       <img src="' + server + data[i].details.profile_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-55">' +
                                '                    <p>' + data[i].details.user_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-30 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + '0' + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' + // \'comment_screen.html\'
                                emojione.unicodeToImage(data[i].details.text_description) +
                                '            </div>' +

                                '            <div class="post-comment row" >' +
                                '                <div class="col-100 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + '0' + '\',\'' + data[i].details.comment_count + '\')" ><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments</div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[i].type == "video") {

                            content += '<div class="post-container" id="user' + data[i].id + '">' +
                                '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                                // '                        <img src="' + server + data[i].details.profile_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-55">' +
                                '                    <p>' + data[i].details.user_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-30 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                emojione.unicodeToImage(data[i].details.video_description) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + data[i].details.video_title + '" type="video/mp4">' +
                                '                </video>' +
                                '            </div>' +
                                '           <div class="row post-comment">' +
                                '            <div class="col-50 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\')"> <i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '               <div class="col-50 text-right" onclick="download(\'' + server + data[i].details.video_title + '\',\'' + 'MSG/videos' + '\')" > <i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[i].type == "audio") {
                            content += '<div class="post-container" id="user' + data[i].id + '">' +
                                '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                                // '                        <img src="' + server + data[i].details.profile_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-55">' +
                                '                    <p>' + data[i].details.user_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-30 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '            </div>' +
                                '            </div>' +
                                '            <div class="post-desc">' +
                                emojione.unicodeToImage(data[i].details.audio_description) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <audio controls preload="auto">' +
                                '                    <source src="' + server + data[i].details.audio_title + '" type="audio/wav">' +
                                '                </audio>' +
                                '            </div>' +
                                '      <div class="row post-comment">' +
                                '            <div class="col-50 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\')"> <i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '               <div class="col-50 text-right" onclick="download(\'' + server + data[i].details.audio_title + '\',\'' + 'MSG/audios' + '\')" > <i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[i].type == "file") {
                            var holder = "";
                            var path = data[i].details.file_title;
                            var ext = path.substr(path.lastIndexOf('.') + 1);
                            var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x in extName) {
                                if (x == ext) {
                                    console.log("File is: " + x);
                                    holder = 'img/attach_icons/' + extName[x];
                                }
                            }

                            content += '<div class="post-container" id="user' + data[i].id + '">' +
                                '<div class="row post-head"  onclick="setGeneratorId(\'' + data[i].generator_id + '\')">' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.profile_photo_url) + ')">' +
                                // '                        <img src="' + server + data[i].details.profile_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-55">' +
                                '                    <p>' + data[i].details.user_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-30 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'user' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '            </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                emojione.unicodeToImage(data[i].details.file_description) +
                                '            </div>' +
                                '             <div class="post-pic" >' +
                                '              <img src="' + holder + '" />' +
                                '             </div>' +
                                '           <div class="row post-comment">' +
                                '            <div class="col-50 comment-return" onclick="setPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].generator_id + '\',\'' + data[i].details.profile_photo_url + '\',\'' + data[i].details.user_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\')"> <i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '               <div class="col-50 text-right" onclick="download(\'' + server + data[i].details.file_title + '\',\'' + 'MSG/files' + '\')" > <i class="fa fa-download"></i> </div>' +
                                '            </div>' +
                                '</div>';



                        }

                        //
                        //
                        //CELEBRITY
                        //
                        //
                    } else if (data[i].format == "celebrity") {


                        if (data[i].details.applied_by == proId) {
                            delOpt = '<li class="item" onclick="deletePost(event,\'' + data[i].id + '\')">Delete</li>';
                        } else {
                            delOpt = "";
                        }

                        if (data[i].type == "photo") {

                            content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                                '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                                // '<img src="' + server + data[i].details.celeb_photo_url + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[i].details.celeb_name + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[i].details.photo_description) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + server + getThumb(data[i].details.photo_title) + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.photo_title + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[i].type == "text") {

                            content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                                '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')">' + //\'friend_profile.html\'
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                                // '                       <img src="' + server + data[i].details.celeb_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[i].details.celeb_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + '0' + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' + // \'comment_screen.html\'
                                emojione.unicodeToImage(data[i].details.text_description) +
                                '            </div>' +
                                '<div class="post-comment row" >' +
                                '                <div class="col-100 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + '0' + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments</div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[i].type == "video") {

                            content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                                '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')">' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                                // '                        <img src="' + server + data[i].details.celeb_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[i].details.celeb_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                emojione.unicodeToImage(data[i].details.video_description) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + data[i].details.video_title + '" type="video/mp4">' +
                                '                </video>' +
                                '            </div>' +
                                '           <div class="row post-comment">' +
                                '<div class="col-50 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.video_title + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';


                        } else if (data[i].type == "audio") {

                            content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                                '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')" >' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                                // '                        <img src="' + server + data[i].details.celeb_photo_url + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[i].details.celeb_name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc">' +
                                emojione.unicodeToImage(data[i].details.audio_description) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <audio controls preload="auto">' +
                                '                    <source src="' + server + data[i].details.audio_title + '" type="audio/wav">' +
                                '                </audio>' +
                                '            </div>' +
                                '      <div class="row post-comment">' +
                                '<div class="col-50 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.audio_title + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[i].type == "file") {
                            var holder1 = "";
                            var path1 = data[i].details.file_title;
                            var ext1 = path1.substr(path1.lastIndexOf('.') + 1);
                            var extName1 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x1 in extName1) {
                                if (x1 == ext1) {
                                    console.log("File is: " + x1);
                                    holder1 = 'img/attach_icons/' + extName1[x1];
                                }
                            }
                            content += '<div class="post-container" id="celeb' + data[i].id + '">' +
                                '<div class="row post-head" onclick="setCelebId(\'' + data[i].celebId + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.celeb_photo_url) + ')">' +
                                // '<img src="' + server + data[i].details.celeb_photo_url + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[i].details.celeb_name + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[i].time)) +
                                '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                                '                <div class="celeb-post-del">' +
                                '                    <ul class="list">' +
                                '                        <li class="item" onclick="share(event,\'' + 'celeb' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\')">Share</li>' +
                                '' + delOpt + '' +
                                '                    </ul>' +
                                '                </div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[i].details.file_description) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + holder1 + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50 comment-return" onclick="setCelebPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].celebId + '\',\'' + data[i].details.celeb_photo_url + '\',\'' + data[i].details.celeb_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.file_title + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        }
                        //////////
                        //GROUP //
                        //////////
                    }
                    // else if (data[i].format == "group") {

                    //     if (data[i].postedById == proId) {
                    //         delOpt = '<li class="item" onclick="deletePost(event,\'' + data[i].id + '\')">Delete</li>';
                    //     } else {
                    //         delOpt = "";
                    //     }
                    //     if (data[i].type == "photo") {

                    //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                    //             '<div class="row post-head">' + //friend_profile
                    //             '<div class="col-15 post-pro-pic col-center">' +
                    //             '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                    //             // '<img src="' + server + data[i].details.group_photo + '" />' +
                    //             '</div>' +
                    //             '</div>' +
                    //             '<div class="col-60">' +
                    //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                    //             '</div>' +
                    //             '<div class="col-25 post-time">' +
                    //             formatAMPM(new Date(data[i].time)) +
                    //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                    //             '                <div class="celeb-post-del">' +
                    //             '                    <ul class="list">' +
                    //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')">Share</li>' +
                    //             '' + delOpt + '' +
                    //             '                    </ul>' +
                    //             '                </div>' +
                    //             '</div>' +
                    //             '</div>' +
                    //             '<div class="post-desc" >' + //comment_screen
                    //             emojione.unicodeToImage(data[i].details.photo_description) +
                    //             '</div>' +
                    //             '<div class="post-pic" >' +
                    //             '<img src="' + server + data[i].details.photo_title + '" />' +
                    //             '</div>' +
                    //             '<div class="row post-comment">' +
                    //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.photo_description + '\',\'' + data[i].details.photo_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                    //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.photo_title + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                    //             '</div>' +
                    //             '</div>';

                    //     } else if (data[i].type == "text") {

                    //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                    //             '<div class="row post-head">' + //\'friend_profile.html\'
                    //             '                <div class="col-15 post-pro-pic col-center">' +
                    //             '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                    //             // '                       <img src="' + server + data[i].details.group_photo + '" />' +
                    //             '                    </div>' +
                    //             '                </div>' +
                    //             '                <div class="col-60">' +
                    //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                    //             '                </div>' +
                    //             '                <div class="col-25 post-time">' +
                    //             formatAMPM(new Date(data[i].time)) +
                    //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                    //             '                <div class="celeb-post-del">' +
                    //             '                    <ul class="list">' +
                    //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + "0" + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')">Share</li>' +
                    //             '' + delOpt + '' +
                    //             '                    </ul>' +
                    //             '                </div>' +
                    //             '                </div>' +
                    //             '            </div>' +
                    //             '            <div class="post-desc" >' + // \'comment_screen.html\'
                    //             emojione.unicodeToImage(data[i].details.text_description) +
                    //             '            </div>' +
                    //             '<div class="post-comment row" > ' +
                    //             '             <div class="col-100 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.text_description + '\',\'' + "0" + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"> <i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments</div>' +
                    //             '            </div>' +
                    //             '</div>';

                    //     } else if (data[i].type == "video") {

                    //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                    //             '<div class="row post-head" >' +
                    //             '                <div class="col-15 post-pro-pic col-center">' +
                    //             '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                    //             // '                     <img src="' + server + data[i].details.group_photo + '" />' +
                    //             '                    </div>' +
                    //             '                </div>' +
                    //             '                <div class="col-60">' +
                    //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                    //             '                </div>' +
                    //             '                <div class="col-25 post-time">' +
                    //             formatAMPM(new Date(data[i].time)) +
                    //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                    //             '                <div class="celeb-post-del">' +
                    //             '                    <ul class="list">' +
                    //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')">Share</li>' +
                    //             '' + delOpt + '' +
                    //             '                    </ul>' +
                    //             '                </div>' +
                    //             '                </div>' +
                    //             '            </div>' +
                    //             '            <div class="post-desc" >' +
                    //             emojione.unicodeToImage(data[i].details.video_description) +
                    //             '            </div>' +
                    //             '            <div class="post-video">' +
                    //             '                <video controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                    //             '                    <source src="' + server + data[i].details.video_title + '" type="video/mp4">' +
                    //             '                </video>' +
                    //             '            </div>' +
                    //             '           <div class="row post-comment">' +
                    //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.video_description + '\',\'' + data[i].details.video_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                    //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.video_title + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                    //             '</div>' +
                    //             '</div>';



                    //     } else if (data[i].type == "audio") {
                    //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                    //             '<div class="row post-head" >' +
                    //             '                <div class="col-15 post-pro-pic col-center">' +
                    //             '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                    //             // '                  <img src="' + server + data[i].details.group_photo + '" />' +
                    //             '                    </div>' +
                    //             '                </div>' +
                    //             '                <div class="col-60">' +
                    //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                    //             '                </div>' +
                    //             '                <div class="col-25 post-time">' +
                    //             formatAMPM(new Date(data[i].time)) +
                    //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                    //             '                <div class="celeb-post-del">' +
                    //             '                    <ul class="list">' +
                    //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')" >Share</li>' +
                    //             '' + delOpt + '' +
                    //             '                    </ul>' +
                    //             '                </div>' +
                    //             '                </div>' +
                    //             '            </div>' +
                    //             '            <div class="post-desc">' +
                    //             emojione.unicodeToImage(data[i].details.audio_description) +
                    //             '            </div>' +
                    //             '            <div class="post-video">' +
                    //             '                <audio controls preload="auto">' +
                    //             '                    <source src="' + server + data[i].details.audio_title + '" type="audio/wav">' +
                    //             '                </audio>' +
                    //             '            </div>' +
                    //             '      <div class="row post-comment">' +
                    //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.audio_description + '\',\'' + data[i].details.audio_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                    //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.audio_title + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                    //             '        </div>' +
                    //             '</div>';

                    //     } else if (data[i].type == "file") {
                    //         var holder2 = "";
                    //         var path2 = data[i].details.file_title;
                    //         var ext2 = path2.substr(path2.lastIndexOf('.') + 1);
                    //         var extName2 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                    //         for (var x2 in extName2) {
                    //             if (x2 == ext2) {
                    //                 console.log("File is: " + x2);
                    //                 holder2 = 'img/attach_icons/' + extName2[x2];
                    //             }
                    //         }
                    //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                    //             '<div class="row post-head">' +
                    //             '<div class="col-15 post-pro-pic col-center">' +
                    //             '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].details.group_photo) + ')">' +
                    //             // '<img src="' + server + data[i].details.group_photo + '" />' +
                    //             '</div>' +
                    //             '</div>' +
                    //             '<div class="col-60">' +
                    //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                    //             '</div>' +
                    //             '<div class="col-25 post-time">' +
                    //             formatAMPM(new Date(data[i].time)) +
                    //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                    //             '                <div class="celeb-post-del">' +
                    //             '                    <ul class="list">' +
                    //             '                        <li class="item" onclick="share(event,\'' + 'group' + '\',\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')">Share</li>' +
                    //             '' + delOpt + '' +
                    //             '                    </ul>' +
                    //             '                </div>' +
                    //             '</div>' +
                    //             '</div>' +
                    //             '<div class="post-desc" >' + //comment_screen
                    //             emojione.unicodeToImage(data[i].details.file_description) +
                    //             '</div>' +
                    //             '<div class="post-pic" >' +
                    //             '<img src="' + holder2 + '" />' +
                    //             '</div>' +
                    //             '<div class="row post-comment">' +
                    //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + data[i].details.file_description + '\',\'' + data[i].details.file_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                    //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.file_title + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                    //             '</div>' +
                    //             '</div>';

                    //     } else if (data[i].type == 'shared') {
                    //         var innerContent = "";
                    //         var folder = "";
                    //         var innerData = JSON.parse(data[i].details.shared_description);
                    //         var innerJson = data[i].details.shared_description.replace(/"/g, "~");
                    //         console.log("innerJson:" + innerJson);
                    //         if (data[i].details.shared_format == "photo") {
                    //             folder = "images";
                    //             innerContent = '<div class="shared-post">' +
                    //                 '                            <div class="row post-head">' +
                    //                 '                                <div class="col-15 post-pro-pic col-center">' +
                    //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    //                 '                                </div>' +
                    //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    //                 '                            </div>' +
                    //                 '                            ' +
                    //                 '                            <div class="post-desc" >' +
                    //                 '                               ' + innerData.desc + '' +
                    //                 '                            </div>' +
                    //                 '                         ' +
                    //                 '                            <div class="post-pic">' +
                    //                 '                              <img src="' + server + innerData.title + '" />' +
                    //                 '                            </div>' +
                    //                 '                        </div>';


                    //         } else if (data[i].details.shared_format == "text") {
                    //             folder = "text";
                    //             innerContent = '<div class="shared-post">' +
                    //                 '                            <div class="row post-head">' +
                    //                 '                                <div class="col-15 post-pro-pic col-center">' +
                    //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    //                 '                                </div>' +
                    //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    //                 '                            </div>' +
                    //                 '                            ' +
                    //                 '                            <div class="post-desc" >' +
                    //                 '                               ' + innerData.desc + '' +
                    //                 '                            </div>' +
                    //                 '                         ' +
                    //                 '                        </div>';


                    //         } else if (data[i].details.shared_format == "video") {
                    //             folder = "videos";
                    //             innerContent = '<div class="shared-post">' +
                    //                 '                            <div class="row post-head">' +
                    //                 '                                <div class="col-15 post-pro-pic col-center">' +
                    //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    //                 '                                </div>' +
                    //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    //                 '                            </div>' +
                    //                 '                            ' +
                    //                 '                            <div class="post-desc" >' +
                    //                 '                               ' + innerData.desc + '' +
                    //                 '                            </div>' +
                    //                 '                         ' +
                    //                 '                            <div class="post-video">' +
                    //                 '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                    //                 '                    <source src="' + server + innerData.title + '" type="video/mp4">' +
                    //                 '                </video>' +
                    //                 '                            </div>' +
                    //                 '                        </div>';


                    //         } else if (data[i].details.shared_format == "audio") {
                    //             folder = "audios";
                    //             innerContent = '<div class="shared-post">' +
                    //                 '                            <div class="row post-head">' +
                    //                 '                                <div class="col-15 post-pro-pic col-center">' +
                    //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    //                 '                                </div>' +
                    //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    //                 '                            </div>' +
                    //                 '                            ' +
                    //                 '                            <div class="post-desc" >' +
                    //                 '                               ' + innerData.desc + '' +
                    //                 '                            </div>' +
                    //                 '                         ' +
                    //                 '                            <div class="post-video">' +
                    //                 '                <audio controls preload="auto">' +
                    //                 '                    <source src="' + server + innerData.title + '" type="audio/wav">' +
                    //                 '                </audio>' +
                    //                 '                            </div>' +
                    //                 '                        </div>';



                    //         } else if (data[i].details.shared_format == "file") {
                    //             folder = "files";
                    //             var holder3 = "";
                    //             var path3 = innerData.title;
                    //             var ext3 = path3.substr(path3.lastIndexOf('.') + 1);
                    //             var extName3 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                    //             for (var x3 in extName3) {
                    //                 if (x3 == ext3) {
                    //                     console.log("File is: " + x3);
                    //                     holder3 = 'img/attach_icons/' + extName3[x3];
                    //                 }
                    //             }
                    //             innerContent = '<div class="shared-post">' +
                    //                 '                            <div class="row post-head">' +
                    //                 '                                <div class="col-15 post-pro-pic col-center">' +
                    //                 '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    //                 '                                </div>' +
                    //                 '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    //                 '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    //                 '                            </div>' +
                    //                 '                            ' +
                    //                 '                            <div class="post-desc" >' +
                    //                 '                               ' + innerData.desc + '' +
                    //                 '                            </div>' +
                    //                 '                         ' +
                    //                 '                            <div class="post-pic">' +
                    //                 '                              <img src="' + holder3 + '" />' +
                    //                 '                            </div>' +
                    //                 '                        </div>';

                    //         }
                    //         content += '<div class="post-container" id="group' + data[i].id + '">' +
                    //             '<div class="row post-head">' + //friend_profile
                    //             '<div class="col-15 post-pro-pic col-center">' +
                    //             '<div class="dash-chat-img" style="background-image:url(' + server + data[i].details.group_photo + ')">' +
                    //             // '<img src="' + server + data[i].details.group_photo + '" />' +
                    //             '</div>' +
                    //             '</div>' +
                    //             '<div class="col-60">' +
                    //             '<p><span onclick="setGroupId(\'' + data[i].groupId + '\')">' + data[i].details.group_name + '</span> ' + '<i class="fa fa-angle-left" aria-hidden="true"></i>' + ' <span  onclick="setGeneratorId(\'' + data[i].postedById + '\')">' + data[i].postedByName + '</span>' + '</p>' +
                    //             '</div>' +
                    //             '<div class="col-25 post-time">' +
                    //             formatAMPM(new Date(data[i].time)) +
                    //             '<i class="fa fa-ellipsis-v" onclick="showDeleteOptions(event,this)"></i>' +
                    //             '                <div class="celeb-post-del">' +
                    //             '                    <ul class="list">' +
                    //             '                        <li class="item" onclick="reShare(event,\'' + innerJson + '\')">Share</li>' +
                    //             '' + delOpt + '' +
                    //             '                    </ul>' +
                    //             '                </div>' +
                    //             '</div>' +
                    //             '</div>' +
                    //             '' + innerContent + '' +
                    //             '<div class="row post-comment">' +
                    //             '<div class="col-50 comment-return" onclick="setGroupPostId(\'' + data[i].id + '\',\'' + data[i].type + '\',\'' + data[i].groupId + '\',\'' + data[i].details.group_photo + '\',\'' + data[i].details.group_name + '\',\'' + data[i].time + '\',\'' + innerJson + '\',\'' + data[i].details.shared_title + '\',\'' + data[i].details.comment_count + '\',\'' + data[i].postedById + '\',\'' + data[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[i].details.comment_count + ' comments </div>' +
                    //             '<div class="col-50 text-right" onclick="download(\'' + server + data[i].details.shared_title + '\',\'' + 'MSG/' + folder + '\')" ><i class="fa fa-download"></i> </div>' +
                    //             '</div>' +
                    //             '</div>';
                    //     }
                    // }
                }
                document.getElementById("dataFeed").innerHTML = content + document.getElementById("dataFeed").innerHTML;
                console.log(content);
                $("img").on('error', function() {
                    $(this).attr("src", "img/pictures/notFound.png");
                });
                setTimeout(function() {
                    $("video,audio").on('click', function() {
                        // console.log("IN:"+this.paused);
                        if (this.paused) {
                            this.play();
                        } else {
                            this.pause();
                        }
                        if (this.getAttribute('controls') !== 'true') {
                            this.setAttribute('controls', 'true');
                        }
                        this.setAttribute('controls', 'true');
                    });
                }, 2000);
                localStorage.setItem("DATAFEED", content + localStorage.getItem("DATAFEED"));
                setTimeout(function() {
                    myScroll.refresh(); //for iScroll 
                }, 1000);

            } else {
                console.log("No More Post");
                myScroll.refresh(); //for iScroll
                // document.getElementById("loadNew").innerHTML = 'No New Post';
                // document.getElementById("loadNew").style.display = 'block';
                // document.getElementById("proLoaderNew").style.display = 'none';
            }

        }
    };
    xhttp.open("POST", server + "dataFeedPrevious.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID") + "&onset=" + encodeURIComponent(localStorage.getItem("LASTCREATED"));
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    console.log(parameters);
    xhttp.send(parameters);
}





function setGeneratorId(gId) {
    //console.log(gId+":::"+localStorage.getItem("PROID"));
    // alert(event.type);
    // event.stopPropagation();
    if (gId == localStorage.getItem("PROID")) {
        window.location.href = "profile.html";
    } else {
        localStorage.setItem("RELATIONPROFILEID", gId);
        window.location.href = "friend_profile.html";
        //pro id of friend  RELATIONPROFILEID
    }

}

function setPostId(id, type, genId, imageURL, userName, time, desc, title, count) {
    //console.log(id+":"+type+":"+genId+":"+imageURL+":"+userName+":"+time+":"+desc+":"+title+":"+count);
    var data = '{"id":"' + id + '",' + '"type":"' + type + '",' + '"genId":"' + genId + '",' + '"imageURL":"' + imageURL + '",' + '"userName":"' + userName + '",' + '"time":"' + time + '",' + '"desc":"' + desc + '",' + '"title":"' + title + '",' + '"count":"' + count + '"}';
    ///console.log(data);
    localStorage.setItem("HOMEPOSTDETAIL", data);
    // localStorage.setItem("HOMEPOSTID",pId);
    window.location.href = "comment_screen.html";
}


//////////////////////////
//GROUP FETCH HOME HTML //
//////////////////////////

function fetchGroupList(arg) {
    var proId = localStorage.getItem("PROID");
    var xhttp = new XMLHttpRequest();
    var data = "";
    var content = '<div class="group-list-inner" >';
    content += '<div class="row"  id= "grpHome" data-group-name="MSG"  onclick="openHome()">' + // openGroupChat(\'' + data[i].id + '\',\'' + data[i].status + '\')
        '                    <div class="col-15">' +
        '                        <div class="counter-person-icon celeb-post-icon" style="background-image:url(img/icon.png)"></div>' +
        '                    </div>' +
        '                    <div class="col-80 col-center">MSG</div>' +
        '                    <div class="col-5 col-center grpCol" id="grpColHome" ><i class="fa fa-dot-circle-o" aria-hidden="true"></i></div>' +
        '                </div>';
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                localStorage.setItem("GRPIDLIST", xhttp.responseText.trim());
                data = JSON.parse(xhttp.responseText);
                console.log(data.length);
                for (var i = 0; i < data.length; i++) {


                    content += '<div class="row"  id="grp' + data[i].id + '" data-group-name="' + emojione.unicodeToImage(data[i].name) + '"  onclick="openGroupHome(\'' + data[i].id + '\',\'' + data[i].status + '\')">' + // openGroupChat(\'' + data[i].id + '\',\'' + data[i].status + '\')
                        '                    <div class="col-15">' +
                        '                        <div class="counter-person-icon celeb-post-icon" style="background-image:url(' + server + getThumb(data[i].photo) + ')"></div>' +
                        '                    </div>' +
                        '                    <div class="col-80 col-center">' + data[i].name + '</div>' +
                        '                    <div class="col-5 col-center grpCol" id="grpCol' + data[i].id + '" ></div>' +
                        '                </div>';

                }

                localStorage.setItem("HOMEGROUPLIST", content + "</div>");
                if (arg == "R") {
                    fetchGroupListPopulate();
                }
                megaLoad5 = true;
                console.log("5-megaLoad:" + megaLoad5);

            } else {
                megaLoad5 = true;
                console.log("5-megaLoad:" + megaLoad5);
                console.log("else of group list home");
                document.getElementById("rotatingImg").style.display = 'none';
                document.getElementById("containerRotatingImg").setAttribute('onclick', "");
            }


        }
    };
    xhttp.open("POST", server + "fetchActiveGroupList.php", true);
    var parameters = "proId=" + proId;
    // console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function fetchGroupListPopulate(argument) {
    console.log("fetchGroupListPopulate");
    //document.getElementById("containerRotatingImg").setAttribute('onclick',"getGroupList(this)");
    document.getElementById("groupList").innerHTML = localStorage.getItem("HOMEGROUPLIST");

}

function getGroupList(curr) {
    console.log("IN");
    //     if(eventSet){
    //     document.removeEventListener('touchmove', function(e) { eventSet=false; }, false);    
    // }else{
    //     document.addEventListener('touchmove', function(e) { e.preventDefault(); eventSet=true; }, false);
    // }

    $("#groupList").toggle("fast");
    $("#rotatingImg").toggleClass("rotate180");

}

////////////////////////
//COMMENT SCREEN HTML //
////////////////////////
var mutualExclusive1 = false;

function fetchComments() {
    if (!mutualExclusive1) {
        var data = JSON.parse(localStorage.getItem("HOMEPOSTDETAIL"));
        var postId = data.id;
        var content = "";
        if (data.type == "photo") {
            content += '<div class="row post-head" onclick="setGeneratorId(\'' + data.genId + '\')">' + //friend_profile
                '<div class="col-15 post-pro-pic col-center">' +
                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '<img src="' + server + data.imageURL + '" />' +
                '</div>' +
                '</div>' +
                '<div class="col-60">' +
                '<p>' + data.userName + '</p>' +
                '</div>' +
                '<div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '</div>' +
                '</div>' +
                '<div class="post-desc" >' + //comment_screen
                emojione.unicodeToImage(data.desc) +
                '</div>' +
                '<div class="post-pic" >' +
                '<img src="' + server + getThumb(data.title) + '" />' +
                '</div>' +
                '<div class="row post-comment">' +
                '<div class="col-50"><i class="fa fa-comment"></i> ' + data.count + ' comments</div>' +
                '<div class="col-50 text-right"><i class="fa fa-download"></i></div>' +
                '</div>';
        } else if (data.type == "text") {

            content += '<div class="row post-head" onclick="setGeneratorId(\'' + data.genId + '\')">' + //\'friend_profile.html\'
                '                <div class="col-15 post-pro-pic col-center">' +
                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '                       <img src="' + server + data.imageURL + '" />' +
                '                    </div>' +
                '                </div>' +
                '                <div class="col-60">' +
                '                    <p>' + data.userName + '</p>' +
                '                </div>' +
                '                <div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '                </div>' +
                '            </div>' +
                '            <div class="post-desc" >' + // \'comment_screen.html\'
                emojione.unicodeToImage(data.desc) +
                '            </div>' +
                '            <div class="post-comment" >' +
                '                <i class="fa fa-comment"></i> ' + data.count + ' comments' +
                '            </div>';

        } else if (data.type == "video") {

            content += '<div class="row post-head" onclick="setGeneratorId(\'' + data.genId + '\')">' +
                '                <div class="col-15 post-pro-pic col-center">' +
                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '                        <img src="' + server + data.imageURL + '" />' +
                '                    </div>' +
                '                </div>' +
                '                <div class="col-60">' +
                '                    <p>' + data.userName + '</p>' +
                '                </div>' +
                '                <div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '                </div>' +
                '            </div>' +
                '            <div class="post-desc" >' +
                emojione.unicodeToImage(data.desc) +
                '            </div>' +
                '            <div class="post-video">' +
                '                <video controls preload="auto">' + //poster="img/icons/video-gallery.svg"
                '                    <source src="' + server + data.title + '" type="video/mp4">' +
                '                </video>' +
                '            </div>' +
                '            <div class="post-comment" >' +
                '                <i class="fa fa-comment"></i> ' + data.count + ' comments' +
                '            </div>' +
                '        </div>';



        } else if (data.type == "audio") {
            content += '<div class="row post-head" onclick="setGeneratorId(\'' + data.genId + '\')">' +
                '                <div class="col-15 post-pro-pic col-center">' +
                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '                        <img src="' + server + data.imageURL + '" />' +
                '                    </div>' +
                '                </div>' +
                '                <div class="col-60">' +
                '                    <p>' + data.userName + '</p>' +
                '                </div>' +
                '                <div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '                </div>' +
                '            </div>' +
                '            <div class="post-desc">' +
                emojione.unicodeToImage(data.desc) +
                '            </div>' +
                '            <div class="post-video">' +
                '                <audio controls>' +
                '                    <source src="' + server + data.title + '" type="audio/wav">' +
                '                </audio>' +
                '            </div>' +
                '            <div class="post-comment" >' +
                '                <i class="fa fa-comment"></i> ' + data.count + ' comments' +
                '            </div>' +
                '        </div>';

        } else if (data.type == "file") {

            var holder = "";
            var path = data.title;
            var ext = path.substr(path.lastIndexOf('.') + 1);
            var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
            for (var x in extName) {
                if (x == ext) {
                    console.log("File is: " + x);
                    holder = 'img/attach_icons/' + extName[x];
                }
            }

            content += '<div class="row post-head" onclick="setGeneratorId(\'' + data.genId + '\')">' + //friend_profile
                '<div class="col-15 post-pro-pic col-center">' +
                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '<img src="' + server + data.imageURL + '" />' +
                '</div>' +
                '</div>' +
                '<div class="col-60">' +
                '<p>' + data.userName + '</p>' +
                '</div>' +
                '<div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '</div>' +
                '</div>' +
                '<div class="post-desc" >' + //comment_screen
                emojione.unicodeToImage(data.desc) +
                '</div>' +
                '<div class="post-pic" >' +
                '<img src="' + holder + '" />' +
                '</div>' +
                '<div class="row post-comment">' +
                '<div class="col-50"><i class="fa fa-comment"></i> ' + data.count + ' comments</div>' +
                '<div class="col-50 text-right"><i class="fa fa-download"></i></div>' +
                '</div>';
        }
        // document.getElementById("commentFocus").innerHTML = content;

        var content1 = "";
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.indexOf('no comments - 402') == -1) {
                    var commentData = JSON.parse(xhttp.responseText);


                    for (var i = commentData.length - 1; i >= 0; i--) {

                        content1 += '<div class="row post-head" onclick="setGeneratorId(\'' + commentData[i].userId + '\')">' +
                            '            <div class="col-15 post-pro-pic col-center">' +
                            '                <div class="dash-chat-img" style="background-image:url(' + server + getThumb(commentData[i].imageURL) + ')">' +
                            // '                    <img src="' + server + commentData[i].imageURL + '" />' +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="col-60">' +
                            '                <p>' + commentData[i].name + '</p>' +
                            '                <p class="comment">' + emojione.unicodeToImage(commentData[i].comment) + '</p>' +
                            '            </div>' +
                            '            <div class="col-25 post-time">' +
                            '                ' + formatAMPM(new Date(commentData[i].time)) + '' +
                            '            </div>' +
                            '        </div>';


                    }
                    document.getElementById("commentFocus").innerHTML = content + content1;
                    var ht = "<i class='fa fa-comment'></i> " + commentData[0].count + " comments";
                    localStorage.setItem("POSTCOMMENTCOUNT", postId + "," + commentData[0].count);
                    //console.log(commentData[0].count+":::"+ht);
                    $(".post-comment").html(ht);
                    $('html, body').scrollTop($(document).height());
                } else {
                    document.getElementById("commentFocus").innerHTML = content;
                }
            }
        };
        xhttp.open("POST", server + "fetchComments.php", true);
        var parameters = "postId=" + postId;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
}

function sendCommentStatus(curr) {
    var space = /[^\s]+/; //anything except space
    if (curr.value.match(space)) {
        document.getElementById("sendDisable").style.display = 'none';
        document.getElementById("sendEnable").style.display = 'block';
    } else {
        document.getElementById("sendEnable").style.display = 'none';
        document.getElementById("sendDisable").style.display = 'block';
    }
}


function sendComment() {
    document.getElementById("sendEnable").style.display = 'none';
    document.getElementById("sendDisable").style.display = 'block';
    var proId = localStorage.getItem("PROID");
    var data = JSON.parse(localStorage.getItem("HOMEPOSTDETAIL"));
    var postId = data.id;
    var message = document.getElementById("commentMessage").value;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            mutualExclusive1 = true;
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                document.getElementById("commentMessage").value = "";
                // var commentCount=parseInt($(".post-comment").text());
                // console.log(commentCount);
                // $(".post-comment").html('<i class="fa fa-comment"></i> ' + (commentCount+1) + ' comments');
                mutualExclusive1 = false;
                fetchComments();
            } else {
                console.log("error");
                mutualExclusive1 = false;
            }

        }
    };
    xhttp.open("POST", server + "sendComment.php", true);
    var parameters = "proId=" + proId + "&postId=" + postId + "&message=" + encodeURIComponent(message);
    // console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}


function fetchPreProfile(argument) {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {

        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false) {
                localStorage.setItem("USERINFO", xhttp.responseText.trim());

            } else {

            }
            megaLoad6 = true;
            console.log("6-megaLoad:" + megaLoad6);
        }

    };
    xhttp.open("POST", server + "fetchProfile.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

/////////////////
//Profile HTML //
/////////////////
function profileFullImage(curr) {
    var bg = $(curr).css('background-image');
    bg = bg.replace('url(', '').replace(')', '').replace(/"/g, '');
    document.getElementById("fullImage").setAttribute('src', remThumb(bg));
    // console.log("In:"+bg);
    document.getElementById("imageAction").style.display = 'table';
}

function fetchProfile(argument) {
    var contentPre = "";
    var content = "";
    var data = "";
    var contentCeleb = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        preLoaderOn();
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false) {
                data = JSON.parse(xhttp.responseText.trim());
                $(".user-profile-pic").css('backgroundImage', 'url(' + server + getThumb(data[0].imageURL) + ')');
                contentPre += '<p class="name">' + data[0].name + ' <span> (' + data[0].gender + ')</span></p>' +
                    '        <p class="status">' +
                    data[0].quote +
                    '        </p>' +
                    '        <p class="mobile">' + data[0].phNo + '</p>' +
                    '        <p class="email">' + data[0].email + '</p>' +
                    '        <div class="rule-80"></div>' +
                    '        <div class="row my-profile-details-following" id="celebfollowListId" onclick="showFollowingList()">' +
                    '            <div class="col-80">Following</div>' +
                    '            <div class="col-20">' + data[0].followingCount + '</div>' +
                    '        </div>';

                document.getElementById("infoFetch").innerHTML = contentPre;
                localStorage.setItem("USERINFO", xhttp.responseText.trim());

                // for (var i = 0; i < data[0].detail.length; i++) {

                //     //photo
                //     if (data[0].detail[i].type == "photo") {
                //         content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[0].generator_id + '\')" friend_profile
                //             '<div class="col-15 post-pro-pic col-center">' +
                //             '<div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                //             // '<img src="' + server + data[0].imageURL + '" />' +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="col-60">' +
                //             '<p>' + data[0].name + '</p>' +
                //             '</div>' +
                //             '<div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[0].detail[i].at)) +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="post-desc" >' + //comment_screen
                //             emojione.unicodeToImage(data[0].detail[i].desc) +
                //             '</div>' +
                //             '<div class="post-pic" >' +
                //             '<img src="' + server + data[0].detail[i].URL + '" />' +
                //             '</div>' +
                //             '<div class="row post-comment">' +
                //             '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                //             '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                //             '</div>';
                //     } else if (data[0].detail[i].type == "text") {

                //         content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[i].generator_id + '\')"
                //             '                <div class="col-15 post-pro-pic col-center">' +
                //             '                    <div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                //             // '                       <img src="' + server + data[0].imageURL + '" />' +
                //             '                    </div>' +
                //             '                </div>' +
                //             '                <div class="col-60">' +
                //             '                    <p>' + data[0].name + '</p>' +
                //             '                </div>' +
                //             '                <div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[0].detail[i].at)) +
                //             '                </div>' +
                //             '            </div>' +
                //             '            <div class="post-desc" >' + // \'comment_screen.html\'
                //             emojione.unicodeToImage(data[0].detail[i].desc) +
                //             '            </div>' +
                //             '            <div class="post-comment" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generator_id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + "0" + '\',\'' + data[0].detail[i].commentCount + '\')">' +
                //             '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                //             '            </div>';

                //     } else if (data[0].detail[i].type == "video") {

                //         content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[i].generator_id + '\')"
                //             '                <div class="col-15 post-pro-pic col-center">' +
                //             '                    <div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                //             // '                        <img src="' + server + data[0].imageURL + '" />' +
                //             '                    </div>' +
                //             '                </div>' +
                //             '                <div class="col-60">' +
                //             '                    <p>' + data[0].name + '</p>' +
                //             '                </div>' +
                //             '                <div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[0].detail[i].at)) +
                //             '                </div>' +
                //             '            </div>' +
                //             '            <div class="post-desc" >' +
                //             emojione.unicodeToImage(data[0].detail[i].desc) +
                //             '            </div>' +
                //             '            <div class="post-video">' +
                //             '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                //             '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                //             '                </video>' +
                //             '            </div>' +
                //             '           <div class="row post-comment">' +
                //             '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                //             '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                //             '            </div>';



                //     } else if (data[0].detail[i].type == "audio") {
                //         content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[i].generator_id + '\')"
                //             '                <div class="col-15 post-pro-pic col-center">' +
                //             '                    <div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                //             // '                        <img src="' + server + data[0].imageURL + '" />' +
                //             '                    </div>' +
                //             '                </div>' +
                //             '                <div class="col-60">' +
                //             '                    <p>' + data[0].name + '</p>' +
                //             '                </div>' +
                //             '                <div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[0].detail[i].at)) +
                //             '                </div>' +
                //             '            </div>' +
                //             '            <div class="post-desc">' +
                //             emojione.unicodeToImage(data[0].detail[i].desc) +
                //             '            </div>' +
                //             '            <div class="post-video">' +
                //             '                <audio controls>' +
                //             '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                //             '                </audio>' +
                //             '            </div>' +
                //             '      <div class="row post-comment">' +
                //             '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                //             '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                //             '        </div>';

                //     } else if (data[0].detail[i].type == "file") {
                //         var holder = "";
                //         var path = data[0].detail[i].URL;
                //         var ext = path.substr(path.lastIndexOf('.') + 1);
                //         var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                //         for (var x in extName) {
                //             if (x == ext) {
                //                 console.log("File is: " + x);
                //                 holder = 'img/attach_icons/' + extName[x];
                //             }
                //         }
                //         content += '<div class="row post-head" >' +
                //             '<div class="col-15 post-pro-pic col-center">' +
                //             '<div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                //             // '<img src="' + server + data[0].imageURL + '" />' +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="col-60">' +
                //             '<p>' + data[0].name + '</p>' +
                //             '</div>' +
                //             '<div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[0].detail[i].at)) +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="post-desc" >' + //comment_screen
                //             emojione.unicodeToImage(data[0].detail[i].desc) +
                //             '</div>' +
                //             '<div class="post-pic" >' +
                //             '<img src="' + holder + '" />' +
                //             '</div>' +
                //             '<div class="row post-comment">' +
                //             '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                //             '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                //             '</div>';
                //     }
                // }
                // document.getElementById("postList").innerHTML = content;
                if (data[0].celebList == "" || data[0].celebList == null) {
                    document.getElementById('celebfollowListId').setAttribute('onclick', "");
                } else {
                    for (var i = 0; i < data[0].celebList.length; i++) {

                        contentCeleb += '<div class="row" onclick="gotoCeleb(\'' + data[0].celebList[i].celebId + '\')">' +
                            '                <div class="col-20">' +
                            '                    <div class="celeb-pro-pic-cont" style="background-image:url(' + server + data[0].celebList[i].celebPhoto + ')"></div>' +
                            '                </div>' +
                            '                <div class="col-80">' +
                            '                    <div class="celeb-pro-desc">' +
                            '                        <h3>' + data[0].celebList[i].celebName + '</h3>' +
                            '                        <p>' +
                            '                       ' + data[0].celebList[i].celebQuote + '     ' +
                            '                        </p>' +
                            '                    </div>' +
                            '                </div>' +
                            '            </div>';


                    }
                    document.getElementById("followingList").innerHTML = contentCeleb;
                }

                preLoaderOff();
            } else {
                console.log("ELSE");
                preLoaderOff();
            }
        }
    };
    xhttp.open("POST", server + "fetchProfile.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

var offsetProfile = 0;

function toggleLoaderProfile(arg) {
    document.getElementById("loadMore").style.display = 'none';
    document.getElementById("proLoader").style.display = 'block';
    offsetProfile += 10;
    fetchNextProfile(offsetProfile);
}

function fetchNextProfile(offset) {
    var content = "";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {

        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false) {
                data = JSON.parse(xhttp.responseText.trim());
                if (data.length !== 0) {
                    for (var i = 0; i < data[0].detail.length; i++) {

                        //photo
                        if (data[0].detail[i].type == "photo") {
                            content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[0].generator_id + '\')" friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                                // '<img src="' + server + data[0].imageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].name + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + server + data[0].detail[i].URL + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                                '</div>';
                        } else if (data[0].detail[i].type == "text") {

                            content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[i].generator_id + '\')"
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                                // '                       <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' + // \'comment_screen.html\'
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-comment" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generator_id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + "0" + '\',\'' + data[0].detail[i].commentCount + '\')">' +
                                '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                                '            </div>';

                        } else if (data[0].detail[i].type == "video") {

                            content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[i].generator_id + '\')"
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                                // '                        <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                                '                </video>' +
                                '            </div>' +
                                '           <div class="row post-comment">' +
                                '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                                '            </div>';



                        } else if (data[0].detail[i].type == "audio") {
                            content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[i].generator_id + '\')"
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                                // '                        <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc">' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <audio controls>' +
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                                '                </audio>' +
                                '            </div>' +
                                '      <div class="row post-comment">' +
                                '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                                '        </div>';

                        } else if (data[0].detail[i].type == "file") {
                            var holder = "";
                            var path = data[0].detail[i].URL;
                            var ext = path.substr(path.lastIndexOf('.') + 1);
                            var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x in extName) {
                                if (x == ext) {
                                    console.log("File is: " + x);
                                    holder = 'img/attach_icons/' + extName[x];
                                }
                            }
                            content += '<div class="row post-head" >' +
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                                // '<img src="' + server + data[0].imageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].name + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + holder + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                                '</div>';
                        }
                    }
                    document.getElementById("postList").innerHTML += content;
                    document.getElementById("loadMore").style.display = 'block';
                    document.getElementById("proLoader").style.display = 'none';
                } else {
                    document.getElementById('loadMore').innerHTML = "<p>No More Posts</p>";
                    document.getElementById('loadMore').setAttribute("onclick", "");
                    document.getElementById("loadMore").style.display = 'block';
                    document.getElementById("proLoader").style.display = 'none';
                }


            } else {
                console.log("ELSE");

            }
        }
    };
    xhttp.open("POST", server + "fetchNextProfile.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID") + "&offset=" + offset;
    console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}


function extractProfile(argument) {

    var data = JSON.parse(localStorage.getItem("USERINFO"));
    document.getElementById('proPic').style.backgroundImage = "url(" + server + getThumb(data[0].imageURL) + ")";
    document.getElementById("proName").value = data[0].name;
    document.getElementById("proEmail").value = data[0].email;
    document.getElementById("proGender").value = data[0].gender;
    document.getElementById("proStatus").value = data[0].quote;
    //console.log(server);
}

function updatePrevProfile(argument) {
    //console.log(localStorage.getItem("PROID"));

    var nameReg = /^[a-z ,.'-]+$/i;
    var emailReg = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    var proName = document.getElementById("proName").value;
    var proFName = proName.split(" ")[0];
    var proLName = (proName.split(" ").length > 1) ? proName.split(" ")[1] : '';
    var proEmail = document.getElementById("proEmail").value;
    var proGender = document.getElementById("proGender").value;
    var proStatus = document.getElementById("proStatus").value;
    //console.log(proStatus=="");
    if (proName.match(nameReg)) {
        if (proEmail.match(emailReg)) {
            if (proStatus != " " && proStatus !== "") {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    loadingOn();
                    if (xhttp.readyState == 4 && xhttp.status == 200) {
                        console.log(xhttp.responseText.trim());
                        if (xhttp.responseText.trim()) {
                            if (proPicUpdated) {
                                prevDisplayImageUpload();
                            } else {
                                window.location.href = "profile.html";
                            }

                        }
                    }
                };
                xhttp.open("POST", server + "prevProfileDataUpdate.php", true);
                var parameters = "proFName=" + proFName + "&proLName=" + proLName + "&proEmail=" + proEmail + "&proGender=" + proGender + "&proStatus=" + proStatus + "&proId=" + localStorage.getItem("PROID");
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                console.log(parameters);
                xhttp.send(parameters);
            } else {
                $("#proStatus").css("border-bottom", "2px solid #000");
                $("#statusErr").html("Invalid Status");
            }

        } else {
            $("#proEmail").css("border-bottom", "2px solid #000");
            $("#emailErr").html("Invalid Email");
        }
    } else {
        $("#proName").css("border-bottom", "2px solid #000");
        $("#nameErr").html("Invalid Name");
    }

}

function prevDisplayImageUpload(argument) {
    console.log("in upload file:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "prevDisplayImageUpload.php");
    //console.log(uri);
    var options = new FileUploadOptions();

    options.fileKey = "fileUploadKey";
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "image/jpeg";
    options.httpMethod = 'POST';
    var params = {};
    params.id = localStorage.getItem("PROID");
    //params.value2 = "param";
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();
    ft.onprogress = function(progressEvent) {
        $(".myBar").css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $(".myBar").css("width", perc + "%");
            $("#proPerc").html(perc);
        } else {
            if (progressStatus.innerHTML === "") {
                $(".myBar").css("width", "0%");
            } else {
                $(".myBar").css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        loadingOff();
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        window.location.href = "profile.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
        loadingOff();
    }
}

//NO NEED CAN USE FETCHPREPROFILE
function fetchInfo(argument) {
    var proId = localStorage.getItem("PROID");
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            //console.log(xhttp.responseText.trim());
            var data = JSON.parse(xhttp.responseText.trim());
            if (data.length > 0) {
                //console.log(data[0].user_quote);
                document.getElementById("proQuote").innerHTML = '"' + data[0].user_quote + '"';
                //document.getElementById("proDP").src=server+data[0].profile_photo_url;
                $(".side-nav-profile").css('backgroundImage', 'url(' + server + data[0].profile_photo_url + ')');
            }
        }
    };
    xhttp.open("POST", server + "fetchInfo.php", true);
    var parameters = "proId=" + proId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function removeJunk(argument) {
    $(".cd-popup-container").children('textarea').val("");
    $(".status-update-cont").children('textarea').val("");
    $(".myBar").css("width", '0');
    $("#photoImage").attr('src', '//:0');
    $("#audioImage").attr('src', '//:0');
    $("#videoImage").attr('src', '//:0');
    $('.send-attach-img').attr('src', '//:0');
}
///////////////////
//Contacts Fetch //
///////////////////
function checkUserStatus(argument) {
    var proId = localStorage.getItem("PROID");
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                contactFetch();
            } else {
                //nextContactFetch();
            }
        }
    };
    xhttp.open("POST", server + "checkUserStatus.php", true);
    var parameters = "proId=" + proId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function contactFetch(arg, id, from) {
    if (arg == "CON") {
        preLoaderOn();
        localStorage.setItem("CONTACTS", "");
    }

    function onSuccess(contacts) {
        //console.log('Found ' + contacts.length + ' contacts.');
        // console.log(JSON.stringify(contacts));
        if (localStorage.getItem("PHN") != "" && localStorage.getItem("PHN") != null) {
            var data = [];
            for (var i = 0; i < contacts.length; i++) {
                var count;
                var prev = "";
                var next = "";

                if (!(contacts[i].displayName === null || contacts[i].phoneNumbers === null || contacts[i].displayName === undefined || contacts[i].phoneNumbers === undefined || localStorage.getItem("PHN").indexOf(contacts[i].phoneNumbers[0].value) > -1)) {
                    for (var j = 0; j < contacts[i].phoneNumbers.length; j++) {
                        if (j == 0) {
                            count = "";
                            prev = contacts[i].phoneNumbers[j].value;
                            // data.push({ "id": contacts[i].phoneNumbers[j].id, "system_id": "", "name": contacts[i].displayName + count, "phone": contacts[i].phoneNumbers[j].value, "imageURL": "", "is_user": "", "status": "0", "action_user": "" });
                        } else {
                            count = "_" + j;
                            next = contacts[i].phoneNumbers[j].value;
                        }
                        if (prev.replace(/-|\s/g, '') == next.replace(/-|\s/g, '')) {
                            console.log("PREV:" + prev + ":::NXT:" + next);
                        } else {
                            data.push({ "id": contacts[i].phoneNumbers[j].id, "system_id": "", "name": contacts[i].displayName + count, "phone": contacts[i].phoneNumbers[j].value.replace(/-|\s/g, ''), "imageURL": "", "is_user": "", "status": "0", "action_user": "" });
                        }
                    }
                }


            }
        } else {
            console.log("PHN Not Set");
        }
        var arr = [], //to collect id values 
            collection = []; //collect unique object

        $.each(data, function(index, value) {
            if ($.inArray(value.phone, arr) == -1) { //check if id value not exits than add it
                arr.push(value.phone); //push id value in arr
                collection.push(value); //put object in collection to access it's all values
            }
        });
        //console.log(JSON.stringify(collection));
        //console.log(JSON.stringify(arr));


        var temp = JSON.stringify(collection);
        //console.log(temp);
        localStorage.setItem("LASTCONTACTID", (data[data.length - 1].id));
        contactsCheckDB(temp, arg, id, from);
    }

    function onError(contactError) {
        console.log('onError!');
    }

    var options = new ContactFindOptions();
    options.filter = "";
    options.multiple = true;
    //options.desiredFields = [navigator.contacts.fieldType.id, navigator.contacts.fieldType.displayName, navigator.contacts.fieldType.name, navigator.contacts.fieldType.phoneNumbers];
    options.hasPhoneNumber = true;
    var fields = [navigator.contacts.fieldType.id, navigator.contacts.fieldType.displayName, navigator.contacts.fieldType.phoneNumbers];
    navigator.contacts.find(fields, onSuccess, onError, options);
}

//////////////////////////////////////
//to be used later in :OPTIMIZATION //
//////////////////////////////////////

function nextContactFetch(argument) {
    function onSuccess(contacts) {
        console.log('Found ' + contacts.length + ' contacts.');
        //console.log(JSON.stringify(contacts));
        var data = [];
        for (var i = 0; i < contacts.length; i++) {
            if (!(contacts[i].displayName === null || contacts[i].phoneNumbers === null || contacts[i].displayName === undefined || contacts[i].phoneNumbers === undefined || localStorage.getItem("PHN").indexOf(contacts[i].phoneNumbers[0].value) > -1)) {
                data.push({ "id": contacts[i].id, "system_id": "", "name": contacts[i].displayName, "phone": contacts[i].phoneNumbers[0].value, "imageURL": "", "is_user": "", "status": "0", "action_user": "" });
            }
        }
        var temp = JSON.stringify(data);
        console.log(temp);
        contactsCheckDB(temp);
    }

    function onError(contactError) {
        console.log('onError!');
    }

    var options = new ContactFindOptions();
    options.filter = "";
    options.multiple = true;
    options.desiredFields = [navigator.contacts.fieldType.id, navigator.contacts.fieldType.displayName, navigator.contacts.fieldType.name, navigator.contacts.fieldType.phoneNumbers];
    options.hasPhoneNumber = true;
    var fields = [navigator.contacts.fieldType.id, navigator.contacts.fieldType.displayName, navigator.contacts.fieldType.name, navigator.contacts.fieldType.phoneNumbers];
    navigator.contacts.find(fields, onSuccess, onError, options);
}


function contactsCheckDB(data, via, id, from) {
    var proId = localStorage.getItem("PROID");
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.indexOf("error") == -1) {
                var data = JSON.parse(xhttp.responseText.trim());
                data = sortByName(data, 'name');
                localStorage.setItem("CONTACTS", JSON.stringify(data));

                if (via == 'CON') {
                    console.log('via CON');
                    fetchContacts();
                    fetchContactRelation();
                } else if (via == 'ACC') {
                    console.log('via ACC');
                    acceptReq('2', id, from);
                } else if (via == 'SEN') {
                    console.log('via SEN');
                    sendReq('1', id, from);
                }
            }
            megaLoad2 = true;
            console.log("2-megaLoad:" + megaLoad2);
        }

    };
    xhttp.open("POST", server + "contactsCheckDB.php", true);
    var parameters = "proId=" + proId + "&phNo=" + encodeURIComponent(localStorage.getItem("PHN")) + "&data=" + encodeURIComponent(data);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}
//////////////////
//CONTACTS HTML //
//////////////////
function fetchContacts(argument) {
    preLoaderOn();
    var content = '<div class="letter-cont friend-request">';
    var content1 = '<div class="letter-cont">';
    var content2 = '<div class="letter-cont friend-request">';
    var data = JSON.parse(localStorage.getItem("CONTACTS"));
    console.log(localStorage.getItem("CONTACTS"));
    document.getElementById("contactsContainer").innerHTML = "";
    // data = sortByName(data, 'name');
    for (var i = 0; i < data.length; i++) {
        if (data[i].is_user) {
            if (data[i].status == 4) {
                content2 += '<div class="row ">' +
                    '                <div class="col-20">' +
                    '                    <div class="dash-chat-img contact-person-icon" style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                    // '                        <img src="' + server + data[i].imageURL + '">' +
                    '                    </div>' +
                    '                </div>' +
                    '                <div class="col-50 col-center" >' + //onclick="checkProfile(this)" data-system-id="' + data[i].system_id + '"
                    '                    <p class="contact-person-name">' + data[i].name + '</p>' +
                    '                    <p class="contact-person-num"><i class="fa fa-phone"></i>' + data[i].phone + '</p>' +
                    '                </div>' +
                    '                <div class="col-30 text-right" id="imgReq' + data[i].system_id + '">' +
                    '                  <button class="button unblock" onclick="unBlockContacts(\'' + data[i].system_id + '\')">unBlock</button> ' +
                    '                </div>' +
                    '            </div><div id="extraReq' + data[i].system_id + '"></div>';
            } else {

                var srcRep = '<button class="button add" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '0' + '\')" >Add</button>'; // <span><img src="img/icons/correct.svg"></span> <span><img src="img/icons/wrong.svg"></span>' 
                var extra = "";
                var style = "";
                if (data[i].status == 1) { //pending
                    console.log(data[i].action_user);
                    if (data[i].action_user == localStorage.getItem("PROID")) {
                        srcRep = '<button class="button pending">Pending...</button>';
                    } else {
                        srcRep = ""; //'<button  class="button add" onclick="openResponseOptions(this)">Approve</button> <div class="add-friend-request" > <ul class="list" > <li class="item" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '2' + '\')" > Add </li> <li class="item" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '3' + '\')" > Decline </li> </ul> </div>';
                        extra = '<div class="row status"><div class="col-20"></div><div class="col-40"><button class="button accept" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '2' + '\')" >Accept</button></div> <div class="col-40"><button class="button reject"  onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '3' + '\')" >Reject</button></div> </div>';
                        style = 'friend-request-notify';
                    }
                } else if (data[i].status == 2) { //accepted
                    srcRep = ' <img src="img/icons/chat.svg" onclick="openChat(\'' + data[i].system_id + '\')"/>';
                } else if (data[i].status == 3) { //declined
                    srcRep = '<button class="button add" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '1' + '\')" >Add</button>';
                } else if (data[i].status == 5) { //Unfriended
                    srcRep = '<button class="button add" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '1' + '\')" >Add</button>';
                } else if (data[i].status == 6) { //Unblocked
                    srcRep = '<button class="button add" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '1' + '\')" >Add</button>';
                }
                content += '<div class="row ' + style + '">' +
                    '                <div class="col-20">' +
                    '                    <div class="dash-chat-img contact-person-icon"  style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                    // '                        <img src="' + server + data[i].imageURL + '">' +
                    '                    </div>' +
                    '                </div>' +
                    '                <div class="col-50 col-center" onclick="checkProfile(this)" data-system-id="' + data[i].system_id + '">' +
                    '                    <p class="contact-person-name">' + data[i].name + '</p>' +
                    '                    <p class="contact-person-num"><i class="fa fa-phone"></i>' + data[i].phone + '</p>' +
                    '                </div>' +
                    '                <div class="col-30 text-right" id="imgReq' + data[i].system_id + '">' +
                    '                   ' + srcRep +
                    '                </div>' +
                    '            </div><div id="extraReq' + data[i].system_id + '">' + extra + '</div>';
            }
        } else {
            content1 += '   <div class="row" onclick="">' +
                '                <div class="col-20">' +
                '                    <div class="dash-chat-img contact-person-icon">' +
                '                        <img src="img/list/arya_stark.jpg">' +
                '                    </div>' +
                '                </div>' +
                '                <div class="col-80 col-center">' +
                '                    <p class="contact-person-name">' + data[i].name + '</p>' +
                '                    <p class="contact-person-num"><i class="fa fa-phone"></i> ' + data[i].phone +
                ' <span onclick="sendInvite(\'' + data[i].id + '\',\'' + data[i].phone + '\')">invite</span></p>' +
                '                </div>' +
                '            </div>';
        }
    }

    document.getElementById("contactsContainer").innerHTML = content + "</div>" + content1 + "</div>" + content2 + "</div>";
}

function openResponseOptions(arg) {
    console.log($(arg).siblings('.add-friend-request').html());
    $(arg).siblings('.add-friend-request').css('display', 'block');
}

function sortByName(array, key) {
    return array.sort(function(a, b) {
        var x = a[key];
        var y = b[key];

        return ((x < y) ? -1 : ((x > y) ? 1 : 0));
    });
}

function cSearch(needle) {
    var content = '<div class="letter-cont friend-request">';
    var content1 = '<div class="letter-cont">';
    var content2 = '<div class="letter-cont friend-request">';
    var data = JSON.parse(localStorage.getItem("CONTACTS"));
    // console.log(localStorage.getItem("CONTACTS"));
    document.getElementById("contactsContainer").innerHTML = "";
    // data = sortByName(data, 'name');
    for (var i = 0; i < data.length; i++) {
        if (data[i].name.toLowerCase().indexOf(needle.value.toLowerCase()) != -1) {
            if (data[i].is_user) {
                if (data[i].status == 4) {
                    content2 += '<div class="row ">' +
                        '                <div class="col-20">' +
                        '                    <div class="dash-chat-img contact-person-icon"  style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                        // '                        <img src="' + server + data[i].imageURL + '">' +
                        '                    </div>' +
                        '                </div>' +
                        '                <div class="col-50 col-center" >' + //onclick="checkProfile(this)" data-system-id="' + data[i].system_id + '"
                        '                    <p class="contact-person-name">' + data[i].name + '</p>' +
                        '                    <p class="contact-person-num"><i class="fa fa-phone"></i>' + data[i].phone + '</p>' +
                        '                </div>' +
                        '                <div class="col-30 text-right" id="imgReq' + data[i].system_id + '">' +
                        '                  <button class="button unblock" onclick="unBlockContacts(\'' + data[i].system_id + '\')">unBlock</button> ' +
                        '                </div>' +
                        '            </div><div id="extraReq' + data[i].system_id + '"></div>';
                } else {
                    var style;
                    var extra;
                    var srcRep = '<button class="button add" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '0' + '\')" >Add</button>'; // <span><img src="img/icons/correct.svg"></span> <span><img src="img/icons/wrong.svg"></span>' 
                    if (data[i].status == 1) { //pending
                        console.log(data[i].action_user);
                        if (data[i].action_user == localStorage.getItem("PROID")) {
                            srcRep = '<button class="button pending">Pending...</button>';
                        } else {
                            srcRep = ""; //'<button  class="button add" onclick="openResponseOptions(this)">Approve</button> <div class="add-friend-request" > <ul class="list" > <li class="item" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '2' + '\')" > Add </li> <li class="item" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '3' + '\')" > Decline </li> </ul> </div>';
                            extra = '<div class="row status"><div class="col-20"></div><div class="col-40"><button class="button accept" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '2' + '\')" >Accept</button></div> <div class="col-40"><button class="button reject"  onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '3' + '\')" >Reject</button></div> </div>';
                            style = 'friend-request-notify';
                        }
                    } else if (data[i].status == 2) { //accepted
                        srcRep = ' <img src="img/icons/chat.svg" onclick="openChat(\'' + data[i].system_id + '\')"/>';
                    } else if (data[i].status == 3) { //declined
                        srcRep = '<button class="button add" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '1' + '\')" >Add</button>';
                    } else if (data[i].status == 5) { //Unfriended
                        srcRep = '<button class="button add" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '1' + '\')" >Add</button>';
                    } else if (data[i].status == 6) { //Unblocked
                        srcRep = '<button class="button add" onclick="sendRequest(\'' + data[i].system_id + '\',\'' + '1' + '\')" >Add</button>';
                    }


                    content += '<div class="row ' + style + '">' +
                        '                <div class="col-20">' +
                        '                    <div class="dash-chat-img contact-person-icon"  style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                        // '                        <img src="' + server + data[i].imageURL + '">' +
                        '                    </div>' +
                        '                </div>' +
                        '                <div class="col-50 col-center" onclick="checkProfile(this)" data-system-id="' + data[i].system_id + '">' +
                        '                    <p class="contact-person-name">' + data[i].name + '</p>' +
                        '                    <p class="contact-person-num"><i class="fa fa-phone"></i>' + data[i].phone + '</p>' +
                        '                </div>' +
                        '                <div class="col-30 text-right" id="imgReq' + data[i].system_id + '">' +
                        '                   ' + srcRep +
                        '                </div>' +
                        '            </div><div id="extraReq' + data[i].system_id + '">' + extra + '</div>';
                }
            } else {
                content1 += '   <div class="row" onclick="">' +
                    '                <div class="col-20">' +
                    '                    <div class="dash-chat-img contact-person-icon">' +
                    '                        <img src="img/list/arya_stark.jpg">' +
                    '                    </div>' +
                    '                </div>' +
                    '                <div class="col-80 col-center">' +
                    '                    <p class="contact-person-name">' + data[i].name + '</p>' +
                    '                    <p class="contact-person-num"><i class="fa fa-phone"></i> ' + data[i].phone +
                    ' <span onclick="sendInvite(\'' + data[i].id + '\',\'' + data[i].phone + '\')">invite</span></p>' +
                    '                </div>' +
                    '            </div>';
            }
        }

    }
    document.getElementById("contactsContainer").innerHTML = content + "</div>" + content1 + "</div>" + content2 + "</div>";
}

function cClear() {
    document.getElementById("search-input").value = "";
    fetchContacts();
}

function checkProfile(curr) {
    //console.log(curr.getAttribute("data-phone-num"));
    localStorage.setItem("RELATIONPROFILEID", curr.getAttribute("data-system-id"));
    window.location.href = "friend_profile.html";
}

/////////////////////////////////////////////
// FLAGS AND FUNCTIONS FOR RELATION FRIEND //
/////////////////////////////////////////////
function decideBlock(argument) {
    var status = document.getElementById("cbx").checked;
    if (status) {
        if (confirm("Are You Sure You Want To Block?")) {
            block();
        } else {
            document.getElementById("cbx").checked = false;
        }
    } else { //else wont be invoked from here , but in case
        if (confirm("Are You Sure You Want To unBlock?")) {
            unBlock();
        } else {
            document.getElementById("cbx").checked = true;
        }
    }
}

function block() {
    // alert(friId);
    fId = document.getElementById("cbx").getAttribute("data-friend-id");
    var proId = localStorage.getItem("PROID");
    var status = "4";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                data = JSON.parse(localStorage.getItem("CONTACTS"));
                for (var i = 0; i < data.length; i++) {
                    if (data[i].is_user) {
                        if (data[i].system_id == fId) {
                            data[i].status = status;
                            data[i].action_user = proId; //self change
                            localStorage.setItem("LATESTFOLLOWCELEB", 1); // to refresh homepage
                            location.href = "contacts.html";

                        }
                    }
                }
                localStorage.setItem("CONTACTS", JSON.stringify(data));
            } else {

            }

        }
    };
    xhttp.open("POST", server + "blockRelationRequest.php", true);
    var parameters = "proId=" + proId + "&friId=" + fId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function unBlock() {
    if (confirm("Are You Sure You Want To unBlock?")) {
        fId = document.getElementById("cbx").getAttribute("data-friend-id");
        var proId = localStorage.getItem("PROID");
        var status = "6";
        var data = "";
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim()) {
                    data = JSON.parse(localStorage.getItem("CONTACTS"));
                    for (var i = 0; i < data.length; i++) {
                        if (data[i].is_user) {
                            if (data[i].system_id == fId) {
                                data[i].status = status;
                                data[i].action_user = proId; //self change

                                location.href = "contacts.html";

                            }
                        }
                    }
                    localStorage.setItem("CONTACTS", JSON.stringify(data));
                } else {

                }

            }
        };
        xhttp.open("POST", server + "unBlockRelationRequest.php", true);
        var parameters = "proId=" + proId + "&friId=" + fId;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
}

function unBlockContacts(friId) {
    if (confirm("Are You Sure You Want To unBlock?")) {
        var proId = localStorage.getItem("PROID");
        var status = "6";
        var data = "";
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim()) {
                    data = JSON.parse(localStorage.getItem("CONTACTS"));
                    for (var i = 0; i < data.length; i++) {
                        if (data[i].is_user) {
                            if (data[i].system_id == friId) {
                                data[i].status = status;
                                data[i].action_user = proId; //self change

                                location.href = "contacts.html";

                            }
                        }
                    }
                    localStorage.setItem("CONTACTS", JSON.stringify(data));
                } else {

                }

            }
        };
        xhttp.open("POST", server + "unBlockRelationRequest.php", true);
        var parameters = "proId=" + proId + "&friId=" + friId;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
}

function sendRequest(friId, status, from) {
    //console.log("SREQ: " + $(curr).attr("data-req-status") + ":::" + $(curr).parent().parent().attr("data-system-id"));
    // var status = $(curr).attr("data-req-status");
    // var friId = $(curr).parent().parent().attr("data-system-id");
    //console.log(status + ":::" + friId);

    if (status == 0) {
        var response0 = confirm("Are You Sure You Want To Send Request?");
        if (response0) {
            decideSendReq(status, friId, from);
            //sendReq(status, friId, from); //nothing to friend request 0->1
        }
    } else if (status == 1) {
        var response1 = confirm("Are You Sure You Want To Send Request?");
        if (response1) {
            resendReq(status, friId, from);
        }
    } else if (status == 2) {
        var response2 = confirm("Are You Sure You Want To Accept Request?");
        if (response2) {
            decideAccept(status, friId, from); //accept
        }
    } else if (status == 3) {
        var response3 = confirm("Are You Sure You Want To Decline Request?");
        if (response3) {
            declineReq(status, friId, from); //decline
        }
    } else if (status == 4) {
        //blocking options not provided here //blocked
    } else if (status == 5) {
        var response5 = confirm("Are You Sure You Want To Unfriend?");
        if (response5) {
            unFriend(status, friId, from); //decline
        }
    }

}

function decideSendReq(st, id, from) {
    if (from == "profile") {
        console.log("1:decideSendReq");
        var data = "";
        var dataFr = "";
        var isInContact = false;
        data = JSON.parse(localStorage.getItem("CONTACTS"));
        dataFr = JSON.parse(localStorage.getItem("NEWFRIENDCONTACT"));

        for (var j = 0; j < data.length; j++) {
            if (data[j].phone.substr(data[j].phone.length - 10) == dataFr.phone.substr(dataFr.phone.length - 10)) {
                isInContact = true;
            }
        }
        console.log(isInContact);
        if (isInContact) {
            sendReq(st, id, from);
        } else {
            document.getElementById('loaderContent').innerHTML = "Adding Contact...";
            preLoaderOn();
            addAndSendReq(st, id, from);
        }

    } else {
        sendReq(st, id, from); // It means we are accessing the function from contact page i.e contact is already added
    }

}

function addAndSendReq(st, id, from) {
    console.log("3:addAndSendReq");
    var dataFr = JSON.parse(localStorage.getItem("NEWFRIENDCONTACT"));

    function onSuccess(contact) {
        console.log("Save Success");
        contactFetch('SEN', id, from);
    }

    function onError(contactError) {
        alert("Error = " + contactError.code);
    }
    var contact = navigator.contacts.create();
    contact.displayName = dataFr.name;
    contact.nickname = dataFr.name; // specify both to support all devices
    var phNumbers = [];
    phNumbers[0] = new ContactField('mobile', dataFr.phone, true); // preferred number
    contact.phoneNumbers = phNumbers;
    contact.save(onSuccess, onError);
}

function sendReq(st, id, from) {
    console.log("2:sendReq");
    var friId = id;
    var proId = localStorage.getItem("PROID");
    var status = "1";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false) {
                data = JSON.parse(localStorage.getItem("CONTACTS"));
                for (var i = 0; i < data.length; i++) {
                    if (data[i].is_user) {
                        if (data[i].system_id == friId) {
                            data[i].status = status;
                            data[i].action_user = proId; //self change
                            if (from == "profile") {
                                document.getElementById('relationStatus').innerHTML = '<button class="button pending">Pending...</button>';
                            } else {
                                document.getElementById("imgReq" + friId).innerHTML = '<button class="button pending">Pending...</button>';
                            }

                        }
                    }
                }

                localStorage.setItem("CONTACTS", JSON.stringify(data));
                preLoaderOff();
            } else {
                console.log("else of sendReq");
                preLoaderOff();
            }

        }
    };
    xhttp.open("POST", server + "sendRelationRequest.php", true);
    var parameters = "proId=" + proId + "&friId=" + friId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function resendReq(st, id, from) {
    var friId = id;
    var proId = localStorage.getItem("PROID");
    var status = "1";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false) {
                data = JSON.parse(localStorage.getItem("CONTACTS"));
                for (var i = 0; i < data.length; i++) {
                    if (data[i].is_user) {
                        if (data[i].system_id == friId) {
                            data[i].status = status;
                            data[i].action_user = proId; //self change
                            if (from == "profile") {
                                document.getElementById('relationStatus').innerHTML = '<button class="button pending">Pending...</button>';
                            } else {
                                document.getElementById("imgReq" + friId).innerHTML = '<button class="button pending">Pending...</button>';
                            }
                        }
                    }
                }
                localStorage.setItem("CONTACTS", JSON.stringify(data));
            } else {

            }

        }
    };
    xhttp.open("POST", server + "reSendRelationRequest.php", true);
    var parameters = "proId=" + proId + "&friId=" + friId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function decideAccept(st, id, from) {
    if (from == "profile") {
        console.log("1:decideAccept");
        var data = "";
        var dataFr = "";
        var isInContact = false;
        data = JSON.parse(localStorage.getItem("CONTACTS"));
        dataFr = JSON.parse(localStorage.getItem("NEWFRIENDCONTACT"));

        for (var j = 0; j < data.length; j++) {
            if (data[j].phone.substr(data[j].phone.length - 10) == dataFr.phone.substr(dataFr.phone.length - 10)) {
                isInContact = true;
            }
        }
        console.log(isInContact);
        if (isInContact) {
            acceptReq(st, id, from);
        } else {
            document.getElementById('loaderContent').innerHTML = "Adding Contact...";
            preLoaderOn();
            addAndAccept(st, id, from);
        }

    } else {
        acceptReq(st, id, from);
    }

    localStorage.setItem("LATESTFOLLOWCELEB", 1); //refresh homePage

}

function addAndAccept(st, id, from) {
    console.log("3:addAndAccept");
    var dataFr = JSON.parse(localStorage.getItem("NEWFRIENDCONTACT"));

    function onSuccess(contact) {
        console.log("Save Success");
        contactFetch('ACC', id, from);
    }

    function onError(contactError) {
        alert("Error = " + contactError.code);
    }
    var contact = navigator.contacts.create();
    contact.displayName = dataFr.name;
    contact.nickname = dataFr.name; // specify both to support all devices
    var phNumbers = [];
    phNumbers[0] = new ContactField('mobile', dataFr.phone, true); // preferred number
    contact.phoneNumbers = phNumbers;
    contact.save(onSuccess, onError);

}


function acceptReq(st, id, from) {
    console.log("2:acceptReq");
    var friId = id;
    var proId = localStorage.getItem("PROID");
    var status = "2";
    var data = "";
    data = JSON.parse(localStorage.getItem("CONTACTS"));
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {

                for (var i = 0; i < data.length; i++) {
                    if (data[i].is_user) {
                        if (data[i].system_id == friId) {
                            data[i].status = status;
                            data[i].action_user = proId; //self change
                            if (from == "profile") {
                                document.getElementById('relationStatus').innerHTML = '<button class="button message" onclick="openChat(\'' + data[i].system_id + '\')">Message</button>';
                            } else {
                                document.getElementById("imgReq" + friId).innerHTML = '<img src="img/icons/chat.svg" onclick="openChat(\'' + data[i].system_id + '\')"/>';
                                document.getElementById("extraReq" + friId).innerHTML = "";
                                $("#extraReq" + friId).prev(".row").removeClass('friend-request-notify');
                            }
                        }
                    }
                }

                localStorage.setItem("CONTACTS", JSON.stringify(data));
                preLoaderOff();
            } else {
                console.log('not accepted');
                preLoaderOff();
            }

        }
    };
    xhttp.open("POST", server + "acceptRelationRequest.php", true);
    var parameters = "proId=" + proId + "&friId=" + friId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);

}

function declineReq(st, id, from) {
    var friId = id;
    var proId = localStorage.getItem("PROID");
    var status = "3";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                data = JSON.parse(localStorage.getItem("CONTACTS"));
                for (var i = 0; i < data.length; i++) {
                    if (data[i].is_user) {
                        if (data[i].system_id == friId) {
                            data[i].status = status;
                            data[i].action_user = proId; //self change
                            if (from == "profile") {
                                document.getElementById('relationStatus').innerHTML = '<button class="button add" onclick="sendRequest(\'' + friId + '\',\'' + '1' + '\',\'' + 'profile' + '\')" >Add Friend</button>';
                            } else {
                                document.getElementById("imgReq" + friId).innerHTML = '<button class="button add" onclick="sendRequest(\'' + friId + '\',\'' + '1' + '\',\'' + '' + '\')" >Add</button>';
                                document.getElementById("extraReq" + friId).innerHTML = "";
                                $("#extraReq" + friId).prev(".row").removeClass('friend-request-notify');
                            }
                        }
                    }
                }
                localStorage.setItem("CONTACTS", JSON.stringify(data));
            } else {

            }

        }
    };
    xhttp.open("POST", server + "declineRelationRequest.php", true);
    var parameters = "proId=" + proId + "&friId=" + friId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);

}

function unFriend(status, id, from) {
    var friId = id;
    var proId = localStorage.getItem("PROID");
    var status1 = "5";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                localStorage.setItem("LATESTFOLLOWCELEB", 1);
                data = JSON.parse(localStorage.getItem("CONTACTS"));
                for (var i = 0; i < data.length; i++) {
                    if (data[i].is_user) {
                        if (data[i].system_id == friId) {
                            data[i].status = status;
                            data[i].action_user = proId; //self change
                            if (from == "profile") {
                                document.getElementById('relationStatus').innerHTML = '<button class="button add" onclick="sendRequest(\'' + friId + '\',\'' + '1' + '\',\'' + 'profile' + '\')" >Add Friend</button>';
                                //for status==0 the sent status parameter should be 1 
                            } else {
                                // document.getElementById("imgReq" + friId).innerHTML = '<button class="button add" onclick="sendRequest(\'' + friId + '\',\'' + '0' + '\',\'' + 'profile' + '\')" >Add</button>';
                                // document.getElementById("extraReq" + friId).innerHTML = "";
                                // $("#extraReq" + friId).prev(".row").removeClass('friend-request-notify');
                            }
                        }
                    }
                }
                localStorage.setItem("CONTACTS", JSON.stringify(data));
            } else {

            }

        }
    };
    xhttp.open("POST", server + "unFriendRelationRequest.php", true);
    var parameters = "proId=" + proId + "&friId=" + friId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function sendInvite(id, num) {
    //window.plugins.socialsharing.share('MSG,A Complete Social Networking Solution', 'A Complete Social Networking Solution', 'www/img/icon.png', 'https://play.google.com/store/apps/details?id=com.terasoltechnologies.aeons');
    //window.plugins.socialsharing.shareViaWhatsAppToReceiver(num, 'Message via WhatsApp', null /* img */, null /* url */, function() {console.log('share ok');});
    window.plugins.socialsharing.shareViaSMS('Download MSG, A Complete Social Networking Solution. https://play.google.com/store/apps/details?id=com.terasoltechnologies.aeons', num, function(msg) { console.log('ok: ' + msg); }, function(msg) { console.log('error: ' + msg); });
}

function openChat(chatId) {
    console.log("openChat" + chatId);
    localStorage.setItem("SINGLECHATID", chatId);
    window.location.href = "singlechat.html";
}

////////////////////////////////
//FETCH  RELATION  CONTACTS   //
///////////////////////////////

function fetchContactRelation() {
    var proId = localStorage.getItem("PROID");
    var rData = "";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim().indexOf("error") == -1) {
                data = JSON.parse(localStorage.getItem("CONTACTS"));
                rData = JSON.parse(xhttp.responseText.trim());
                for (var i = 0; i < rData.length; i++) {
                    for (var j = 0; j < data.length; j++) {
                        if (data[j].is_user) {
                            //console.log("IS USER"+data[j].name+":::"+rData[i].nmId+":::"+data[j].system_id);
                            if (data[j].system_id == rData[i].nmId) {
                                data[j].status = rData[i].status;
                                data[j].action_user = rData[i].actionId; //server change
                                var srcRep = '<button class="button add" onclick="sendRequest(\'' + data[j].system_id + '\',\'' + '0' + '\')">Add</button>'; // <span><img src="img/icons/correct.svg"></span> <span><img src="img/icons/wrong.svg"></span>' 
                                var extra = "";
                                if (data[j].status == 1) { //pending
                                    console.log(data[j].action_user);
                                    if (data[j].action_user == localStorage.getItem("PROID")) {
                                        srcRep = '<button class="button pending" >Pending...</button>';
                                    } else {
                                        srcRep = ""; //'<button  class="button add" onclick="openResponseOptions(this)">Approve</button> <div class="add-friend-request" > <ul class="list" > <li class="item" onclick="sendRequest(\'' + data[j].system_id + '\',\'' + '2' + '\')" > Add </li> <li class="item" onclick="sendRequest(\'' + data[j].system_id + '\',\'' + '3' + '\')" > Decline </li> </ul> </div>';
                                        extra = '<div class="row status"><div class="col-20"></div><div class="col-40"><button class="button accept" onclick="sendRequest(\'' + data[j].system_id + '\',\'' + '2' + '\')" >Accept</button></div> <div class="col-40"><button class="button reject"  onclick="sendRequest(\'' + data[j].system_id + '\',\'' + '3' + '\')" >Reject</button></div> </div>';
                                    }
                                } else if (data[j].status == 2) { //accepted
                                    srcRep = ' <img src="img/icons/chat.svg" onclick="openChat(\'' + data[j].system_id + '\')"/>';
                                } else if (data[j].status == 3) { //declined
                                    srcRep = '<button class="button add" onclick="sendRequest(\'' + data[j].system_id + '\',\'' + '1' + '\')">Add</button>';
                                } else if (data[j].status == 4) { //blocked
                                    if (data[j].action_user == localStorage.getItem("PROID")) {
                                        srcRep = '<button  class="button unblock" onclick="unBlockContacts(\'' + data[j].system_id + '\')">unBlock</button>';
                                    } else {
                                        srcRep = 0; //blocked by other person
                                    }
                                } else if (data[j].status == 5) { //Unfriended
                                    srcRep = '<button class="button add" onclick="sendRequest(\'' + data[j].system_id + '\',\'' + '1' + '\')" >Add</button>';
                                } else if (data[j].status == 6) { //Unblocked
                                    srcRep = '<button class="button add" onclick="sendRequest(\'' + data[j].system_id + '\',\'' + '1' + '\')" >Add</button>';
                                }
                                //alert(srcRep);
                                if (srcRep === 0) {
                                    $("#imgReq" + data[j].system_id).parent().hide();
                                } else {

                                }
                                document.getElementById("imgReq" + data[j].system_id).innerHTML = srcRep;
                                document.getElementById("extraReq" + data[j].system_id).innerHTML = extra;
                            }
                        }
                    }
                }
                localStorage.setItem("CONTACTS", JSON.stringify(data));
                preLoaderOff();
                //console.log(localStorage.getItem("CONTACTS"));
            } else {
                console.log("OUT");
                preLoaderOff();
            }

        }
    };
    xhttp.open("POST", server + "fetchRelation.php", true);
    var parameters = "proId=" + proId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

/////////////////////////////
//BACK UP FOR NOTIFICATION + IN USE//
/////////////////////////////
function fetchRelation() {
    var proId = localStorage.getItem("PROID");
    var rData = "";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            //alert(xhttp.responseText.trim());
            if (xhttp.responseText.trim().indexOf("error") == -1) {
                data = JSON.parse(localStorage.getItem("CONTACTS"));
                rData = JSON.parse(xhttp.responseText.trim());
                for (var i = 0; i < rData.length; i++) {
                    for (var j = 0; j < data.length; j++) {
                        if (data[j].is_user) {
                            //console.log("IS USER"+data[j].name+":::"+rData[i].nmId+":::"+data[j].system_id);
                            if (data[j].system_id == rData[i].nmId) {
                                data[j].status = rData[i].status;
                                data[j].action_user = rData[i].actionId; //server change

                            }
                        }
                    }
                }
                localStorage.setItem("CONTACTS", JSON.stringify(data));

                //console.log(localStorage.getItem("CONTACTS"));
            } else {
                console.log("ELSE OF FETCH RELATION");
            }
            megaLoad3 = true;
            console.log("3-megaLoad:" + megaLoad3);
        }

    };
    xhttp.open("POST", server + "fetchRelation.php", true);
    var parameters = "proId=" + proId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}


//////////////////////
//FRIEND PROFILE // //
/////////////////// //

function fetchFriendProfile() {
    var rProId = localStorage.getItem("RELATIONPROFILEID");
    var contentPre = "";
    var content = "";
    var data = "";
    var contentCeleb = "";
    isBlockStyle = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        preLoaderOn();
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false) {
                data = JSON.parse(xhttp.responseText.trim());
                document.getElementById("headTitle").innerHTML = data[0].name;
                $(".user-profile-pic").css('backgroundImage', 'url(' + server + getThumb(data[0].imageURL) + ')');
                var inter = { 'name': data[0].name, 'phone': data[0].phNo };
                localStorage.setItem("NEWFRIENDCONTACT", JSON.stringify(inter));
                // fOR rELATION sTATUS 0
                var srcRep = ' <button class="button add" onclick="sendRequest(\'' + rProId + '\',\'' + '0' + '\',\'' + 'profile' + '\')" >Add Friend</button>'; // <span><img src="img/icons/correct.svg"></span> <span><img src="img/icons/wrong.svg"></span>' 
                if (data[0].relationStatus == 1) { //pending

                    if (data[0].actionUser == localStorage.getItem("PROID")) {
                        srcRep = ' <button class="button pending">Pending...</button>';
                    } else {
                        srcRep = ' <div class="col-50" onclick="sendRequest(\'' + rProId + '\',\'' + '2' + '\',\'' + 'profile' + '\')" ><button class="button">Accept</button></div>   <div class="col-50" onclick="sendRequest(\'' + rProId + '\',\'' + '3' + '\',\'' + 'profile' + '\')"><button class="button reject">Reject</button></div>';
                    }
                } else if (data[0].relationStatus == 2) { //accepted
                    srcRep = ' <button class="button message" onclick="sendRequest(\'' + rProId + '\',\'' + '5' + '\',\'' + 'profile' + '\')">Unfriend</button>   <button class="button message" onclick="openChat(\'' + rProId + '\')">Message</button>';
                } else if (data[0].relationStatus == 3) { //declined
                    srcRep = '<button class="button add" onclick="sendRequest(\'' + rProId + '\',\'' + '1' + '\',\'' + 'profile' + '\')" >Add Friend</button> ';
                } else if (data[0].relationStatus == 4) { //blocked
                    if (data[0].actionUser == localStorage.getItem("PROID")) {
                        srcRep = '<button class="button unblock" onclick="unBlock(\'' + rProId + '\')" >Unblock</button> ';
                        isBlockStyle = "style='display:none;'"
                    } else {
                        srcRep = '<span></span>';
                    }
                } else if (data[0].relationStatus == 5) { //Unfriended
                    srcRep = '<button class="button add" onclick="sendRequest(\'' + rProId + '\',\'' + '1' + '\',\'' + 'profile' + '\')" >Add Friend</button>';
                } else if (data[0].relationStatus == 6) { //Unblocked
                    srcRep = '<button class="button add" onclick="sendRequest(\'' + rProId + '\',\'' + '1' + '\',\'' + 'profile' + '\')" >Add Friend</button>';
                }
                console.log(srcRep);
                contentPre += '<p class="name">' + data[0].name + ' <span> (' + data[0].gender + ')</span></p>' +
                    '        <p class="status">' +
                    data[0].quote +
                    '        </p>' +
                    '        <p class="mobile">' + data[0].phNo + '</p>' +
                    '        <p class="email">' + data[0].email + '</p>' +

                    '        <div class="row user-profile-friend-req" id="relationStatus">' +
                    '' + srcRep + '' +
                    '        </div>' +
                    '' +
                    '' +
                    '        <ul class="list friend-profile-block" ' + isBlockStyle + '>' +
                    '            <li class="item">' +
                    '                Block ' + data[0].name + '' +
                    '                <label class="switch">' +
                    '                    <input type="checkbox" class="switch__input" onclick="decideBlock()" id="cbx" data-friend-id="' + rProId + '" >' +
                    '                    <div class="switch__toggle"></div>' +
                    '                </label>' +
                    '            </li>' +
                    '        </ul> ' +
                    '' +
                    '     <div class="space-1"></div>' +
                    '        <div class="rule-80"></div>' +
                    '        <div class="row my-profile-details-following" id="celebfollowListId" onclick="showFollowingList()">' +
                    '            <div class="col-80">Following</div>' +
                    '            <div class="col-20">' + data[0].followingCount + '</div>' +
                    '        </div>';



                document.getElementById("infoFetch").innerHTML = contentPre;
                // for (var i = 0; i < data[0].detail.length; i++) {

                //     //photo
                //     if (data[0].detail[i].type == "photo") {
                //         content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[0].generator_id + '\')" friend_profile
                //             '<div class="col-15 post-pro-pic col-center">' +
                //             '<div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                //             // '<img src="' + server + data[0].imageURL + '" />' +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="col-60">' +
                //             '<p>' + data[0].name + '</p>' +
                //             '</div>' +
                //             '<div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[0].detail[i].at)) +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="post-desc" >' + //comment_screen
                //             emojione.unicodeToImage(data[0].detail[i].desc) +
                //             '</div>' +
                //             '<div class="post-pic" >' +
                //             '<img src="' + server + data[0].detail[i].URL + '" />' +
                //             '</div>' +
                //             '<div class="row post-comment">' +
                //             '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                //             '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                //             '</div>';
                //     } else if (data[0].detail[i].type == "text") {

                //         content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[i].generator_id + '\')"
                //             '                <div class="col-15 post-pro-pic col-center">' +
                //             '                    <div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                //             // '                       <img src="' + server + data[0].imageURL + '" />' +
                //             '                    </div>' +
                //             '                </div>' +
                //             '                <div class="col-60">' +
                //             '                    <p>' + data[0].name + '</p>' +
                //             '                </div>' +
                //             '                <div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[0].detail[i].at)) +
                //             '                </div>' +
                //             '            </div>' +
                //             '            <div class="post-desc" >' + // \'comment_screen.html\'
                //             emojione.unicodeToImage(data[0].detail[i].desc) +
                //             '            </div>' +
                //             '            <div class="post-comment" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generator_id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + "0" + '\',\'' + data[0].detail[i].commentCount + '\')">' +
                //             '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                //             '            </div>';

                //     } else if (data[0].detail[i].type == "video") {

                //         content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[i].generator_id + '\')"
                //             '                <div class="col-15 post-pro-pic col-center">' +
                //             '                    <div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                //             // '                        <img src="' + server + data[0].imageURL + '" />' +
                //             '                    </div>' +
                //             '                </div>' +
                //             '                <div class="col-60">' +
                //             '                    <p>' + data[0].name + '</p>' +
                //             '                </div>' +
                //             '                <div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[0].detail[i].at)) +
                //             '                </div>' +
                //             '            </div>' +
                //             '            <div class="post-desc" >' +
                //             emojione.unicodeToImage(data[0].detail[i].desc) +
                //             '            </div>' +
                //             '            <div class="post-video">' +
                //             '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                //             '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                //             '                </video>' +
                //             '            </div>' +
                //             '           <div class="row post-comment">' +
                //             '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                //             '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                //             '            </div>';



                //     } else if (data[0].detail[i].type == "audio") {
                //         content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[i].generator_id + '\')"
                //             '                <div class="col-15 post-pro-pic col-center">' +
                //             '                    <div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                //             // '                        <img src="' + server + data[0].imageURL + '" />' +
                //             '                    </div>' +
                //             '                </div>' +
                //             '                <div class="col-60">' +
                //             '                    <p>' + data[0].name + '</p>' +
                //             '                </div>' +
                //             '                <div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[0].detail[i].at)) +
                //             '                </div>' +
                //             '            </div>' +
                //             '            <div class="post-desc">' +
                //             emojione.unicodeToImage(data[0].detail[i].desc) +
                //             '            </div>' +
                //             '            <div class="post-video">' +
                //             '                <audio controls>' +
                //             '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                //             '                </audio>' +
                //             '            </div>' +
                //             '      <div class="row post-comment">' +
                //             '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                //             '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                //             '        </div>';

                //     } else if (data[0].detail[i].type == "file") {
                //         var holder = "";
                //         var path = data[0].detail[i].URL;
                //         var ext = path.substr(path.lastIndexOf('.') + 1);
                //         var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                //         for (var x in extName) {
                //             if (x == ext) {
                //                 console.log("File is: " + x);
                //                 holder = 'img/attach_icons/' + extName[x];
                //             }
                //         }
                //         content += '<div class="row post-head" >' +
                //             '<div class="col-15 post-pro-pic col-center">' +
                //             '<div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                //             // '<img src="' + server + data[0].imageURL + '" />' +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="col-60">' +
                //             '<p>' + data[0].name + '</p>' +
                //             '</div>' +
                //             '<div class="col-25 post-time">' +
                //             formatAMPM(new Date(data[0].detail[i].at)) +
                //             '</div>' +
                //             '</div>' +
                //             '<div class="post-desc" >' + //comment_screen
                //             emojione.unicodeToImage(data[0].detail[i].desc) +
                //             '</div>' +
                //             '<div class="post-pic" >' +
                //             '<img src="' + holder + '" />' +
                //             '</div>' +
                //             '<div class="row post-comment">' +
                //             '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                //             '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                //             '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                //             '</div>';
                //     }
                // }
                // document.getElementById("postList").innerHTML = content;
                if (data[0].celebList == "" || data[0].celebList == null) {
                    document.getElementById('celebfollowListId').setAttribute('onclick', "");
                } else {
                    for (var i = 0; i < data[0].celebList.length; i++) {

                        contentCeleb = '<div class="row" onclick="gotoCeleb(\'' + data[0].celebList[i].celebId + '\')">' +
                            '                <div class="col-20">' +
                            '                    <div class="celeb-pro-pic-cont" style="background-image:url(' + server + data[0].celebList[i].celebPhoto + ')"></div>' +
                            '                </div>' +
                            '                <div class="col-80">' +
                            '                    <div class="celeb-pro-desc">' +
                            '                        <h3>' + data[0].celebList[i].celebName + '</h3>' +
                            '                        <p>' +
                            '                       ' + data[0].celebList[i].celebQuote + '     ' +
                            '                        </p>' +
                            '                    </div>' +
                            '                </div>' +
                            '            </div>';


                    }
                    document.getElementById("followingList").innerHTML = contentCeleb;
                }
                preLoaderOff();
            } else {
                console.log("ELSE");
                preLoaderOff();
            }
        }
    };
    xhttp.open("POST", server + "fetchFriendProfile.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID") + "&rProId=" + encodeURIComponent(rProId);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}
var offsetFriendProfile = 0;

function toggleLoaderFriendProfile(arg) {
    document.getElementById("loadMore").style.display = 'none';
    document.getElementById("proLoader").style.display = 'block';
    offsetFriendProfile += 10;
    fetchNextFriendProfile(offsetFriendProfile);
}

function showFollowingList() {
    document.getElementById("flDisp").style.display = 'block';
}

function hideFollowingList() {
    document.getElementById("flDisp").style.display = 'none';
}

function fetchNextFriendProfile(offset) {
    var content = "";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {

        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false) {
                data = JSON.parse(xhttp.responseText.trim());
                if (data.length !== 0) {
                    for (var i = 0; i < data[0].detail.length; i++) {

                        //photo
                        if (data[0].detail[i].type == "photo") {
                            content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[0].generator_id + '\')" friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                                // '<img src="' + server + data[0].imageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].name + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + server + data[0].detail[i].URL + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                                '</div>';
                        } else if (data[0].detail[i].type == "text") {

                            content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[i].generator_id + '\')"
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                                // '                       <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' + // \'comment_screen.html\'
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-comment" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generator_id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + "0" + '\',\'' + data[0].detail[i].commentCount + '\')">' +
                                '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                                '            </div>';

                        } else if (data[0].detail[i].type == "video") {

                            content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[i].generator_id + '\')"
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                                // '                        <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                                '                </video>' +
                                '            </div>' +
                                '           <div class="row post-comment">' +
                                '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                                '            </div>';



                        } else if (data[0].detail[i].type == "audio") {
                            content += '<div class="row post-head" >' + //onclick="setGeneratorId(\'' + data[i].generator_id + '\')"
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                                // '                        <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc">' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <audio controls>' +
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                                '                </audio>' +
                                '            </div>' +
                                '      <div class="row post-comment">' +
                                '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                                '        </div>';

                        } else if (data[0].detail[i].type == "file") {
                            var holder = "";
                            var path = data[0].detail[i].URL;
                            var ext = path.substr(path.lastIndexOf('.') + 1);
                            var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x in extName) {
                                if (x == ext) {
                                    console.log("File is: " + x);
                                    holder = 'img/attach_icons/' + extName[x];
                                }
                            }
                            content += '<div class="row post-head" >' +
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + data[0].imageURL + ')">' +
                                // '<img src="' + server + data[0].imageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].name + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + holder + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50" onclick="setPostId(\'' + data[0].detail[i].id + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].generatorId + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-40 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '<div class="col-10 text-right" onclick="share(\'' + data[0].detail[i].id + '\')" ><i class="fa fa-share"></i> </div>' +
                                '</div>';
                        }
                    }
                    document.getElementById("postList").innerHTML += content;
                    document.getElementById("loadMore").style.display = 'block';
                    document.getElementById("proLoader").style.display = 'none';
                } else {
                    document.getElementById('loadMore').innerHTML = "<p>No More Posts</p>";
                    document.getElementById('loadMore').setAttribute("onclick", "");
                    document.getElementById("loadMore").style.display = 'block';
                    document.getElementById("proLoader").style.display = 'none';
                }


            } else {
                console.log("ELSE");

            }
        }
    };
    xhttp.open("POST", server + "fetchNextFriendProfile.php", true);
    var parameters = "rProId=" + localStorage.getItem("RELATIONPROFILEID") + "&offset=" + offset;
    console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}


function request(curr) {
    console.log(curr.checked);
}

function custom_sort(a, b) {
    return new Date(b.time).getTime() - new Date(a.time).getTime();
}

function custom_sort_div(a, b) {
    var d1 = $(a).find('.date-con').attr('data-con-date');
    var d2 = $(b).find('.date-con').attr('data-con-date');
    console.log("CSD" + d1 + ":::" + d2);
    return new Date(d2).getTime() - new Date(d1).getTime();
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////// CHAT //////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////
//CHAT COUNTER  //
//////////////////
function messageCounter() {
    var data = "";
    var message = "";
    var view = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                data = JSON.parse(xhttp.responseText.trim());
                for (var i = 0; i < data.length; i++) {
                    if (data[i].type == 'photo') {
                        message = '<i class="fa fa-picture-o"></i>';
                        view = emojione.unicodeToImage(data[i].desc);
                    } else if (data[i].type == 'video') {
                        message = '<i class="fa fa-video-camera"></i>';
                        view = emojione.unicodeToImage(data[i].desc);
                    } else if (data[i].type == 'audio') {
                        message = '<i class="fa fa-headphones"></i>';
                        view = emojione.unicodeToImage(data[i].desc);
                    } else if (data[i].type == 'file') {
                        message = '<i class="fa fa-file"></i>';
                        view = emojione.unicodeToImage(data[i].desc);
                    } else if (data[i].type == 'post') {
                        message = '<i class="fa fa-address-card-o"></i>';
                        view = "Post"; //emojione.unicodeToImage(data[i].desc);
                    } else if (data[i].type == 'contact') {
                        message = '<i class="fa fa-address-book-o"></i>';
                        view = "Contact"; //emojione.unicodeToImage(data[i].desc);
                    } else if (data[i].type == 'text') {
                        message = '';
                        view = emojione.unicodeToImage(data[i].desc);
                    } else if (data[i].type == 'map') {
                        message = '<i class="fa fa-location-arrow"></i>';
                        view = emojione.unicodeToImage(data[i].desc);
                    } else {
                        message = '';
                        view = '';
                    }

                    if (data[i].format == 'single') {
                        if (data[i].currUnread === "0") { //new unread message
                            document.getElementById("pSingle" + data[i].chatterId).innerHTML = data[i].unread;
                            document.getElementById("labelSingle" + data[i].chatterId).innerHTML = formatAMPM(new Date(data[i].time));
                            document.getElementById("labelSingle" + data[i].chatterId).setAttribute('data-con-date', data[i].time);
                            document.getElementById("descSingle" + data[i].chatterId).innerHTML = message + " " + view;
                        }
                    } else if (data[i].format == 'group') {
                        if (data[i].currUnread.indexOf(',' + localStorage.getItem("PROID") + ',') !== -1) { //new unread message
                            document.getElementById("pGroup" + data[i].id).innerHTML = data[i].unread;
                            document.getElementById("labelGroup" + data[i].id).innerHTML = formatAMPM(new Date(data[i].time));
                            document.getElementById("labelGroup" + data[i].id).setAttribute('data-con-date', data[i].time);
                            document.getElementById("descGroup" + data[i].id).innerHTML = "<b>" + data[i].senderName + "</b> " + "<i class='fa fa-angle-right' aria-hidden='true'></i> " + message + " " + view;
                        }
                    }
                    //custom_sort_div($('#single7'),$('#group4'));
                    console.log($("#chatListing .chat-cont-inner").sort(custom_sort_div).appendTo('#chatListing'));
                }
            }
        }
    };
    xhttp.open("POST", server + "messageCounter.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}
/////////////////////
//SINGLE AND GROUP CHAT HTML //
/////////////////////

var chatListData = "";

function fetchActiveChatList(argument) {
    preLoaderOn();
    var proId = localStorage.getItem("PROID");
    var xhttp = new XMLHttpRequest();
    var data = "";
    var data1 = JSON.parse(localStorage.getItem("CONTACTS"));
    var content = "";
    var message = "";
    var view = "";
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log("CHAT:::" + xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                data = JSON.parse(xhttp.responseText);
                console.log("CS:" + JSON.stringify(data.sort(custom_sort)));
                chatListData = data;
                if (data.length !== 0) {
                    for (var i = 0; i < data.length; i++) {
                        if (data[i].type == 'photo') {
                            message = '<i class="fa fa-picture-o"></i>';
                            view = emojione.unicodeToImage(data[i].desc);
                        } else if (data[i].type == 'video') {
                            message = '<i class="fa fa-video-camera"></i>';
                            view = emojione.unicodeToImage(data[i].desc);
                        } else if (data[i].type == 'audio') {
                            message = '<i class="fa fa-headphones"></i>';
                            view = emojione.unicodeToImage(data[i].desc);
                        } else if (data[i].type == 'file') {
                            message = '<i class="fa fa-file"></i>';
                            view = emojione.unicodeToImage(data[i].desc);
                        } else if (data[i].type == 'post') {
                            message = '<i class="fa fa-address-card-o"></i>';
                            view = "Post"; //emojione.unicodeToImage(data[i].desc);
                        } else if (data[i].type == 'contact') {
                            message = '<i class="fa fa-address-book-o"></i>';
                            view = "Contact"; //emojione.unicodeToImage(data[i].desc);
                        } else if (data[i].type == 'text') {
                            message = '';
                            view = emojione.unicodeToImage(data[i].desc);
                        } else if (data[i].type == 'map') {
                            message = '<i class="fa fa-location-arrow"></i>';
                            view = emojione.unicodeToImage(data[i].desc);
                        } else {
                            message = '';
                            view = '';
                        }


                        if (data[i].format == "single") {
                            console.log(data[i].format);
                            for (var j = 0; j < data1.length; j++) {
                                if (data1[j].is_user) {
                                    if (data[i].chatterId == data1[j].system_id) {

                                        content += '<div class="row chat-cont-inner" id="single' + data[i].chatterId + '" onmousedown="holdChat(this,\'' + 'single' + '\',\'' + data[i].chatterId + '\')" onmouseup="unHoldChat(\'' + data[i].chatterId + '\')">' +
                                            '                <div class="col-20">' +
                                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data1[j].imageURL) + ')">' +
                                            // '                        <img src="' + server + data1[j].imageURL + '" />' +
                                            '                    </div>' +
                                            '                </div>' +
                                            '                <div class="col-80">' +
                                            '                    <div class="dash-chat-notify">' +
                                            '                        <label class="date-con" data-con-date="' + data[i].time + '" id="labelSingle' + data[i].chatterId + '">' + formatAMPM(new Date(data[i].time)) + '</label>' +
                                            '                        <p id="pSingle' + data[i].chatterId + '">' + data[i].unread + '</p>' +
                                            '                    </div>' +
                                            '                    <div class="dash-chat-name">' + data1[j].name + '</div>' +
                                            '                    <label class="dash-chat-desc" id="descSingle' + data[i].chatterId + '"> ' + message + " " + view + '</label>' +
                                            '                </div>' +
                                            '            </div>';
                                    }
                                }
                            }
                        } else if (data[i].format == "group") {
                            console.log("GRP:::" + data[i].format);
                            if (data[i].senderId == "" || data[i].senderId == null) {
                                content += '<div class="row chat-cont-inner" id="group' + data[i].id + '" onmousedown="holdChat(this,\'' + 'group' + '\',\'' + data[i].id + '\')" onmouseup="unHoldChatGroup(\'' + data[i].id + '\',\'' + data[i].status + '\')">' +
                                    '                <div class="col-20">' +
                                    '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                                    // '                        <img src="' + server + data[i].imageURL + '" />' +
                                    '                    </div>' +
                                    '                </div>' +
                                    '                <div class="col-80">' +
                                    '                    <div class="dash-chat-notify">' +
                                    '                        <label class="date-con" data-con-date="' + data[i].created + '">' + formatAMPM(new Date(data[i].created)) + '</label>' +
                                    // '                        <p></p>' +
                                    '                    </div>' +
                                    '                    <div class="dash-chat-name">' + data[i].name + '</div>' +
                                    '                    <label class="dash-chat-desc"><b> Group Created on ' + sqlToJsDate(data[i].created) + '</b>  </label>' +
                                    '                </div>' +
                                    '            </div>';
                            } else {
                                content += '<div class="row chat-cont-inner" id="group' + data[i].id + '" onmousedown="holdChat(this,\'' + 'group' + '\',\'' + data[i].id + '\')" onmouseup="unHoldChatGroup(\'' + data[i].id + '\',\'' + data[i].status + '\')">' +
                                    '                <div class="col-20">' +
                                    '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                                    // '                        <img src="' + server + data[i].imageURL + '" />' +
                                    '                    </div>' +
                                    '                </div>' +
                                    '                <div class="col-80">' +
                                    '                    <div class="dash-chat-notify">' +
                                    '                        <label class="date-con" data-con-date="' + data[i].time + '" id="labelGroup' + data[i].id + '">' + formatAMPM(new Date(data[i].time)) + '</label>' +
                                    '                        <p id="pGroup' + data[i].id + '">' + data[i].unread + '</p>' +
                                    '                    </div>' +
                                    '                    <div class="dash-chat-name">' + data[i].name + '</div>' +
                                    '                    <label class="dash-chat-desc" id="descGroup' + data[i].id + '"><b>' + data[i].senderName + "</b> " + "<i class='fa fa-angle-right' aria-hidden='true'></i> " + message + " " + view + '</label>' +
                                    '                </div>' +
                                    '            </div>';
                            }
                        }

                    }

                    document.getElementById("chatListing").innerHTML = content;
                    preLoaderOff();
                } else {
                    document.getElementById('blankChat').style.display = 'block';
                    preLoaderOff();
                    console.log("else of chat length");
                }
            } else {
                document.getElementById('blankChat').style.display = 'block';
                preLoaderOff();
                console.log("else of chat");
                console.log("chat blank");
            }

        }
    };
    xhttp.open("POST", server + "fetchActiveChatList.php", true);
    var parameters = "proId=" + proId;
    // console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function chatSearch(needle) {
    document.getElementById("crossHide").style.display = 'table-cell';

    var proId = localStorage.getItem("PROID");
    var data = chatListData;
    var data1 = JSON.parse(localStorage.getItem("CONTACTS"));
    var content = "";
    var message = "";
    var view = "";

    chatListData = data;
    for (var i = 0; i < data.length; i++) {
        if (data[i].type == 'photo') {
            message = '<i class="fa fa-picture-o"></i>';
            view = emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'video') {
            message = '<i class="fa fa-video-camera"></i>';
            view = emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'audio') {
            message = '<i class="fa fa-headphones"></i>';
            view = emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'file') {
            message = '<i class="fa fa-file"></i>';
            view = emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'post') {
            message = '<i class="fa fa-address-card-o"></i>';
            view = "Post"; //emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'contact') {
            message = '<i class="fa fa-address-book-o"></i>';
            view = "Contact"; //emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'text') {
            message = '';
            view = emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'map') {
            message = '<i class="fa fa-location-arrow"></i>';
            view = emojione.unicodeToImage(data[i].desc);
        } else {
            message = '';
            view = '';
        }
        if (data[i].format == "single") {
            console.log(data[i].format);
            for (var j = 0; j < data1.length; j++) {
                if (data1[j].name.toLowerCase().indexOf(needle.value.toLowerCase()) != -1) {
                    if (data1[j].is_user) {
                        if (data[i].chatterId == data1[j].system_id) {

                            content += '<div class="row chat-cont-inner" id="single' + data[i].chatterId + '" onmousedown="holdChat(this,\'' + 'single' + '\',\'' + data[i].chatterId + '\')" onmouseup="unHoldChat(\'' + data[i].chatterId + '\')">' +
                                '                <div class="col-20">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data1[j].imageURL) + ')">' +
                                // '                        <img src="' + server + data1[j].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-80">' +
                                '                    <div class="dash-chat-notify">' +
                                '                        <label>' + formatAMPM(new Date(data[i].time)) + '</label>' +
                                // '                        <p></p>' +
                                '                    </div>' +
                                '                    <div class="dash-chat-name">' + data1[j].name + '</div>' +
                                '                    <label class="dash-chat-desc"> ' + message + " " + view + '</label>' +
                                '                </div>' +
                                '            </div>';
                        }
                    }
                }
            }
        } else if (data[i].format == "group") {
            console.log("GRP:::" + data[i].format);
            if (data[i].name.toLowerCase().indexOf(needle.value.toLowerCase()) != -1) {
                if (data[i].senderId == "" || data[i].senderId == null) {
                    content += '<div class="row chat-cont-inner" id="group' + data[i].id + '" onmousedown="holdChat(this,\'' + 'group' + '\',\'' + data[i].id + '\')" onmouseup="unHoldChatGroup(\'' + data[i].id + '\',\'' + data[i].status + '\')">' +
                        '                <div class="col-20">' +
                        '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                        // '                        <img src="' + server + data[i].imageURL + '" />' +
                        '                    </div>' +
                        '                </div>' +
                        '                <div class="col-80">' +
                        '                    <div class="dash-chat-notify">' +
                        '                        <label>' + formatAMPM(new Date(data[i].created)) + '</label>' +
                        // '                        <p></p>' +
                        '                    </div>' +
                        '                    <div class="dash-chat-name">' + data[i].name + '</div>' +
                        '                    <label class="dash-chat-desc"><b> Group Created on ' + sqlToJsDate(data[i].created) + '</b>  </label>' +
                        '                </div>' +
                        '            </div>';
                } else {
                    content += '<div class="row chat-cont-inner" id="group' + data[i].id + '" onmousedown="holdChat(this,\'' + 'group' + '\',\'' + data[i].id + '\')" onmouseup="unHoldChatGroup(\'' + data[i].id + '\',\'' + data[i].status + '\')">' +
                        '                <div class="col-20">' +
                        '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                        // '                        <img src="' + server + data[i].imageURL + '" />' +
                        '                    </div>' +
                        '                </div>' +
                        '                <div class="col-80">' +
                        '                    <div class="dash-chat-notify">' +
                        '                        <label>' + formatAMPM(new Date(data[i].time)) + '</label>' +
                        // '                        <p></p>' +
                        '                    </div>' +
                        '                    <div class="dash-chat-name">' + data[i].name + '</div>' +
                        '                    <label class="dash-chat-desc"><b>' + data[i].senderName + "</b> " + "<i class='fa fa-angle-right' aria-hidden='true'></i> " + message + " " + view + '</label>' +
                        '                </div>' +
                        '            </div>';
                }
            }
        }

    }

    document.getElementById("chatListing").innerHTML = content;


}

function chatClear() {
    var proId = localStorage.getItem("PROID");
    var data = chatListData;
    var data1 = JSON.parse(localStorage.getItem("CONTACTS"));
    var content = "";
    var message = "";
    var view = "";

    chatListData = data;
    for (var i = 0; i < data.length; i++) {
        if (data[i].type == 'photo') {
            message = '<i class="fa fa-picture-o"></i>';
            view = emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'video') {
            message = '<i class="fa fa-video-camera"></i>';
            view = emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'audio') {
            message = '<i class="fa fa-headphones"></i>';
            view = emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'file') {
            message = '<i class="fa fa-file"></i>';
            view = emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'post') {
            message = '<i class="fa fa-address-card-o"></i>';
            view = "Post"; //emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'contact') {
            message = '<i class="fa fa-address-book-o"></i>';
            view = "Contact"; //emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'text') {
            message = '';
            view = emojione.unicodeToImage(data[i].desc);
        } else if (data[i].type == 'map') {
            message = '<i class="fa fa-location-arrow"></i>';
            view = emojione.unicodeToImage(data[i].desc);
        } else {
            message = '';
            view = '';
        }
        if (data[i].format == "single") {
            console.log(data[i].format);
            for (var j = 0; j < data1.length; j++) {
                if (data1[j].is_user) {
                    if (data[i].chatterId == data1[j].system_id) {

                        content += '<div class="row chat-cont-inner" id="single' + data[i].chatterId + '" onmousedown="holdChat(this,\'' + 'single' + '\',\'' + data[i].chatterId + '\')" onmouseup="unHoldChat(\'' + data[i].chatterId + '\')">' +
                            '                <div class="col-20">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data1[j].imageURL) + ')">' +
                            // '                        <img src="' + server + data1[j].imageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-80">' +
                            '                    <div class="dash-chat-notify">' +
                            '                        <label>' + formatAMPM(new Date(data[i].time)) + '</label>' +
                            // '                        <p></p>' +
                            '                    </div>' +
                            '                    <div class="dash-chat-name">' + data1[j].name + '</div>' +
                            '                    <label class="dash-chat-desc"> ' + message + " " + view + '</label>' +
                            '                </div>' +
                            '            </div>';
                    }
                }
            }
        } else if (data[i].format == "group") {
            console.log("GRP:::" + data[i].format);

            if (data[i].senderId == "" || data[i].senderId == null) {
                content += '<div class="row chat-cont-inner" id="group' + data[i].id + '" onmousedown="holdChat(this,\'' + 'group' + '\',\'' + data[i].id + '\')" onmouseup="unHoldChatGroup(\'' + data[i].id + '\',\'' + data[i].status + '\')">' +
                    '                <div class="col-20">' +
                    '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                    // '                        <img src="' + server + data[i].imageURL + '" />' +
                    '                    </div>' +
                    '                </div>' +
                    '                <div class="col-80">' +
                    '                    <div class="dash-chat-notify">' +
                    '                        <label>' + formatAMPM(new Date(data[i].created)) + '</label>' +
                    // '                        <p></p>' +
                    '                    </div>' +
                    '                    <div class="dash-chat-name">' + data[i].name + '</div>' +
                    '                    <label class="dash-chat-desc"><b> Group Created on ' + sqlToJsDate(data[i].created) + '</b>  </label>' +
                    '                </div>' +
                    '            </div>';
            } else {
                content += '<div class="row chat-cont-inner" id="group' + data[i].id + '" onmousedown="holdChat(this,\'' + 'group' + '\',\'' + data[i].id + '\')" onmouseup="unHoldChatGroup(\'' + data[i].id + '\',\'' + data[i].status + '\')">' +
                    '                <div class="col-20">' +
                    '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                    // '                        <img src="' + server + data[i].imageURL + '" />' +
                    '                    </div>' +
                    '                </div>' +
                    '                <div class="col-80">' +
                    '                    <div class="dash-chat-notify">' +
                    '                        <label>' + formatAMPM(new Date(data[i].time)) + '</label>' +
                    // '                        <p></p>' +
                    '                    </div>' +
                    '                    <div class="dash-chat-name">' + data[i].name + '</div>' +
                    '                    <label class="dash-chat-desc"><b>' + data[i].senderName + "</b> " + "<i class='fa fa-angle-right' aria-hidden='true'></i> " + message + " " + view + '</label>' +
                    '                </div>' +
                    '            </div>';
            }
        }

    }

    document.getElementById("chatListing").innerHTML = content;


}


var pressTimer;

function holdChat(curr, format, id) {
    pressTimer = window.setTimeout(function() {
        console.log("FM:" + format + ":::ID:" + id);
        var content = "";
        if (format == 'single') {
            content = '<li class="item" onclick="deleteSingleChatRow(' + id + ')">Delete</li>';
        } else if (format == 'group') {
            content = '<li class="item" onclick="deleteGroupChatRow(' + id + ')">Delete</li>';
        }
        navigator.vibrate(500);
        document.getElementById('chatActionOptions').innerHTML = content;
        document.getElementById('chatAction').style.display = 'table';
    }, 1000);
    return false;
}

function unHoldChat(id) {
    clearTimeout(pressTimer);
    openChat(id);
    return false;
}

function unHoldChatGroup(id, status) {
    clearTimeout(pressTimer);
    openGroupChat(id, status);
    return false;
}

function deleteSingleChatRow(id) {
    console.log(id);
    if (confirm("Are you sure you want to remove this conversation?")) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false) {
                    $("#single" + id).remove();
                } else {
                    console.log("error");
                }

            }
        };
        xhttp.open("POST", server + "deleteSingleChatRow.php", true);
        var parameters = "friId=" + id + "&proId=" + localStorage.getItem("PROID");
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }

}

function deleteGroupChatRow(id) {
    console.log(id);
    if (confirm("Are you sure you want to remove this conversation?")) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false) {
                    $("#group" + id).remove();
                } else {
                    console.log("error");
                }
            }
        };
        xhttp.open("POST", server + "deleteGroupChatRow.php", true);
        var parameters = "grpId=" + id + "&proId=" + localStorage.getItem("PROID");
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }

}

var mutualExclusive = false;
var helperOnce = true;

function sendStatus(curr) {
    var space = /[^\s]+/; //anything except space
    if (curr.value.match(space)) {
        document.getElementById("sendDisable").style.display = 'none';
        document.getElementById("sendEnable").style.display = 'block';
    } else {
        document.getElementById("sendEnable").style.display = 'none';
        document.getElementById("sendDisable").style.display = 'block';
    }
    //  if(curr.value.match(e1) || curr.value.match(e2) || curr.value.match(e3)){
    //     console.log("MATCHED");
    //     document.getElementById("sendDisable").style.display = 'none';
    //     document.getElementById("sendEnable").style.display = 'block';
    // }
}

function sendStatusEn() {
    document.getElementById("sendDisable").style.display = 'none';
    document.getElementById("sendEnable").style.display = 'block';
}

var prevId = "";
var nextId = "";
var nextOffset = 0;

var pressThreadTimer;

function holdSingleChat(curr, status, folder) {
    var id = curr.getAttribute('data-bubble-id');
    var link = curr.getAttribute('data-bubble-link');
    pressThreadTimer = window.setTimeout(function() {
        navigator.vibrate(500);
        folder = 'MSG/' + folder;
        console.log("ID:" + id + ":::LINK:" + link);
        console.log("ST:" + status + ":::FL:" + folder);
        var content = "";

        if (status == 1) {
            content = '<li class="item" onclick="deleteBubble(\'' + id + '\')">Delete</li>' +
                '<li class="item" onclick="download(\'' + server + link + '\',\'' + folder + '\')">Download</li>';
        } else {
            content = '<li class="item" onclick="deleteBubble(' + id + ')">Delete</li>';
        }
        document.getElementById('chatActionOptions').innerHTML = content;
        document.getElementById('chatAction').style.display = 'table';
    }, 1000);
    return false;
}

function unHoldSingleChat() {
    clearTimeout(pressThreadTimer);
    return false;
}

function deleteBubble(id) {
    console.log(id);
    if (confirm("Are you sure you want to remove this chat?")) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false) {
                    $("#" + id).remove();
                } else {
                    console.log("error");
                }

            }
        };
        xhttp.open("POST", server + "deleteBubble.php", true);
        var parameters = "id=" + id;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }

}

function fetchHelpOnce(chatterId) {
    prevId = 0;
    localStorage.setItem("RELATIONPROFILEID", chatterId);
    var data = JSON.parse(localStorage.getItem("CONTACTS")); //contacts info
    for (var i = 0; i < data.length; i++) {
        if (data[i].is_user) {
            if (data[i].system_id == chatterId) {
                document.getElementById("chatterName").innerHTML = data[i].name;
                document.getElementById("chatterProImage").style.backgroundImage = "url(" + server + getThumb(data[i].imageURL) + ")";
                //console.log();
                checkOffline(chatterId);
                setInterval(function() {
                    checkOffline(chatterId);
                }, 10000);
            }
        }
    }
    helperOnce = false;
}

function fetchSingleChat() {
    if (!mutualExclusive) {
        var proId = localStorage.getItem("PROID");
        var chatterId = localStorage.getItem("SINGLECHATID");
        //console.log("PID:" + proId + ":::" + "CID:" + chatterId);
        if (helperOnce) {
            fetchHelpOnce(chatterId);
        }
        var content = "";
        var xhttp = new XMLHttpRequest();
        var chatData = "";
        var identity = "";
        var ll = [];
        var mm = [];
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log("CHAT:::" + xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                    chatData = JSON.parse(xhttp.responseText.trim());
                    prevId = chatData[0].id;
                    nextId = chatData[chatData.length - 1].id;
                    nextOffset = 10;
                    console.log(prevId + ":::" + nextId + ":::" + nextOffset);
                    for (var i = chatData.length - 1; i >= 0; i--) {
                        if (chatData[i].senderId == proId) {
                            if (chatData[i].type == 'text') {
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,0,\'' + 'text' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20"></div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    // '                            '+chatterName+'' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                             ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <div class="chat-content"> ' + emojione.unicodeToImage(chatData[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';
                            } else if (chatData[i].type == "video") {

                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'videos' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <video class="msg-bubble-img" preload="auto" controls>' +
                                    '                    <source src="' + server + chatData[i].link + '" type="video/mp4">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </video>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(chatData[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';


                            } else if (chatData[i].type == "audio") {
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'audios' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <audio class="msg-bubble-img-audio" preload="auto" controls>' +
                                    '                    <source src="' + server + chatData[i].link + '" type="audio/mpeg">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +


                                    '                        </div>' +
                                    '                    </audio>' +
                                    '                    <div class="chat-content"> ' + emojione.unicodeToImage(chatData[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';

                            } else if (chatData[i].type == "photo") {
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'images' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <p class="msg-bubble-img"  style="background-image:url(' + server + getThumb(chatData[i].link) + ')" onclick="profileFullImage(this)">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </p>' +
                                    '                    <div class="chat-content"> ' + emojione.unicodeToImage(chatData[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';

                            } else if (chatData[i].type == "file") {
                                var path = chatData[i].link;
                                var ext = path.substr(path.lastIndexOf('.') + 1);
                                var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                                for (var x in extName) {
                                    if (x == ext) {
                                        console.log("File is: " + x);
                                        holder = 'img/attach_icons/' + extName[x];
                                    }
                                }
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'files' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <a href="' + chatData[i].link + '" target="_blank"> <p class="msg-bubble-img"  style="background-image:url(' + holder + ')"></a>' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </p>' +
                                    '                    <div class="chat-content"> ' + emojione.unicodeToImage(chatData[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';
                            } else if (chatData[i].type == "contact") {

                                var contact = chatData[i].message.split(",");
                                console.log(contact[0] + ":::" + contact[1]);
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,0,\'' + 'contact' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                          ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-contact">' +
                                    '                        <div class="row">' +
                                    '                            <div class="col-30 row col-center"><div class="msg-contact-pic"></div></div>' +
                                    '                            <div class="col-70">' +
                                    '                                <p class="name">' + contact[0] + '</p>' +
                                    '                                <p class="contact">' + contact[1] + '</p>' +
                                    '                            </div>' +
                                    '                        </div>' +
                                    '                        <div class="save-contact">' +
                                    // '                            Save Contact' +
                                    '                        </div>' +
                                    // '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                    </div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';


                            } else if (chatData[i].type == "post") {
                                console.log("IN");
                                var innerContent = "";
                                var folder = "";
                                console.log(chatData[i].message);
                                var innerData = JSON.parse(chatData[i].message);
                                console.log(innerData);
                                var innerJson = chatData[i].message.replace(/"/g, "~");
                                console.log("innerJson:" + innerJson);
                                if (innerData.type == "photo") {
                                    folder = "images";
                                    innerContent = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'images' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData.title + '">' +
                                        '                            <div class="row post-head" >' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-pic">' +
                                        '                              <img src="' + server + getThumb(innerData.title) + '" />' +
                                        '                            </div>' +
                                        '                        </div>';


                                } else if (innerData.type == "text") {
                                    folder = "text";
                                    innerContent = '<div class="shared-post" onmousedown="holdSingleChat(this,0,\'' + 'text' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData.title + '">' +
                                        '                            <div class="row post-head" >' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                        </div>';


                                } else if (innerData.type == "video") {
                                    folder = "videos";
                                    innerContent = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'videos' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-video">' +
                                        '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                        '                    <source src="' + server + innerData.title + '" type="video/mp4">' +
                                        '                </video>' +
                                        '                            </div>' +
                                        '                        </div>';


                                } else if (innerData.type == "audio") {
                                    folder = "audios";
                                    innerContent = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'audios' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-video">' +
                                        '                <audio controls preload="auto">' +
                                        '                    <source src="' + server + innerData.title + '" type="audio/mpeg">' +
                                        '                </audio>' +
                                        '                            </div>' +
                                        '                        </div>';



                                } else if (innerData.type == "file") {
                                    folder = "files";
                                    var holder1 = "";
                                    var path1 = innerData.title;
                                    var ext1 = path1.substr(path1.lastIndexOf('.') + 1);
                                    var extName1 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                                    for (var x1 in extName1) {
                                        if (x1 == ext1) {
                                            console.log("File is: " + x1);
                                            holder1 = 'img/attach_icons/' + extName1[x1];
                                        }
                                    }
                                    innerContent = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'files' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-pic">' +
                                        '                              <img src="' + holder1 + '" />' +
                                        '                            </div>' +
                                        '                        </div>';

                                }

                                content += '<div class="row chat section" id="' + chatData[i].id + '"  >' +
                                    '            <div class="col-20"></div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    // '                            '+chatterName+'' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                             ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-content">' + innerContent + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';


                            } else if (chatData[i].type == "map") {
                                identity = Math.floor(Math.random() * 89999 + 10000);
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,0,\'' + 'map' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + '<span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <a href="http://www.google.com/maps/place/' + chatData[i].link + '/@' + chatData[i].link + ',15z">' +
                                    '                    <div class="msg-bubble-img" id="map' + identity + '">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   </a>' +
                                    '                   <div class="chat-content">' + emojione.unicodeToImage(chatData[i].message) + ' </div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';
                                ll.push(chatData[i].link);
                                mm.push(identity);
                            }
                            /////////////
                            //RECEIVER //
                            /////////////
                        } else if (chatData[i].senderId == chatterId) {


                            if (chatData[i].type == 'text') {
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,0,\'' + 'text' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Me' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(chatData[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (chatData[i].type == "video") {


                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'videos' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                              ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Mee' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <video controls preload="auto" class="msg-bubble-img" >' +
                                    '                       <source src="' + server + chatData[i].link + '" type="video/mp4">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </video>' +
                                    '                  <div class="chat-content">' + emojione.unicodeToImage(chatData[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';



                            } else if (chatData[i].type == "audio") {

                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'audios' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                              ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Mee' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <audio controls class="msg-bubble-img-audio" preload="auto">' +
                                    '                       <source src="' + server + chatData[i].link + '" type="audio/mpeg">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </audio>' +
                                    '                  <div class="chat-content"> ' + emojione.unicodeToImage(chatData[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (chatData[i].type == "photo") {

                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'images' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                              ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Mee' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <p  class="msg-bubble-img" style="background-image:url(' + server + getThumb(chatData[i].link) + ')" onclick="profileFullImage(this)">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </p>' +
                                    '                   <div class="chat-content"> ' + emojione.unicodeToImage(chatData[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (chatData[i].type == "file") {
                                var holder2 = "";
                                var path2 = chatData[i].link;
                                var ext2 = path2.substr(path2.lastIndexOf('.') + 1);
                                var extName2 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                                for (var x2 in extName2) {
                                    if (x2 == ext2) {
                                        console.log("File is: " + x2);
                                        holder2 = 'img/attach_icons/' + extName2[x2];
                                    }
                                }
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'files' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                              ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Mee' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <a href="' + chatData[i].link + '" target="_blank"> <p class="msg-bubble-img"  style="background-image:url(' + holder2 + ')"></a>' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </p>' +
                                    '                    <div class="chat-content"> ' + emojione.unicodeToImage(chatData[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';
                            } else if (chatData[i].type == "contact") {
                                var contact1 = chatData[i].message.split(",");
                                console.log(contact1[0] + ":::" + contact1[1]);
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,0,\'' + 'contacts' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                              ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Mee' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                       <div class="chat-contact">' +
                                    '                        <div class="row">' +
                                    '                            <div class="col-30 row col-center"><div class="msg-contact-pic"></div></div>' +
                                    '                            <div class="col-70">' +
                                    '                                <p class="name">' + contact1[0] + '</p>' +
                                    '                                <p class="contact">' + contact1[1] + '</p>' +
                                    '                            </div>' +
                                    '                        </div>' +
                                    '                        <div class="save-contact" onclick="saveContact(\'' + contact1[0] + '\',\'' + contact1[1] + '\')">' +
                                    '                            Save Contact' +
                                    '                        </div>' +
                                    // '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                      </div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (chatData[i].type == 'post') {
                                console.log("IN R");
                                var innerContent1 = "";
                                var folder1 = "";
                                var innerData1 = JSON.parse(chatData[i].message);
                                console.log(innerData1);
                                var innerJson1 = chatData[i].message.replace(/"/g, "~");
                                console.log("innerJson:" + innerJson1);
                                if (innerData1.type == "photo") {
                                    folder1 = "images";
                                    innerContent1 = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'images' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData1.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData1.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData1.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData1.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData1.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-pic">' +
                                        '                              <img src="' + server + getThumb(innerData1.title) + '" />' +
                                        '                            </div>' +
                                        '                        </div>';


                                } else if (innerData1.type == "text") {
                                    folder1 = "text";
                                    innerContent1 = '<div class="shared-post" onmousedown="holdSingleChat(this,0,\'' + 'text' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData1.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData1.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData1.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData1.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData1.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                        </div>';


                                } else if (innerData1.type == "video") {
                                    folder1 = "videos";
                                    innerContent1 = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'text' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData1.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData1.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData1.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData1.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData1.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-video">' +
                                        '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                        '                    <source src="' + server + innerData1.title + '" type="video/mp4">' +
                                        '                </video>' +
                                        '                            </div>' +
                                        '                        </div>';


                                } else if (innerData1.type == "audio") {
                                    folder1 = "audios";
                                    innerContent1 = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'audios' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData1.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData1.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData1.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData1.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData1.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-video">' +
                                        '                <audio controls preload="auto">' +
                                        '                    <source src="' + server + innerData1.title + '" type="audio/mpeg">' +
                                        '                </audio>' +
                                        '                            </div>' +
                                        '                        </div>';



                                } else if (innerData1.type == "file") {
                                    folder1 = "files";
                                    var holder3 = "";
                                    var path3 = innerData1.title;
                                    var ext3 = path3.substr(path3.lastIndexOf('.') + 1);
                                    var extName3 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                                    for (var x3 in extName3) {
                                        if (x3 == ext3) {
                                            console.log("File is: " + x3);
                                            holder3 = 'img/attach_icons/' + extName3[x3];
                                        }
                                    }
                                    innerContent1 = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'files' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData1.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData1.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData1.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData1.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData1.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-pic">' +
                                        '                              <img src="' + holder3 + '" />' +
                                        '                            </div>' +
                                        '                        </div>';

                                }
                                content += '<div class="row chat section" id="' + chatData[i].id + '" >' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Me' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <div class="chat-content">' + innerContent1 + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (chatData[i].type == "map") {

                                identity = Math.floor(Math.random() * 89999 + 10000);
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,0,\'' + 'maps' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Me' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <a href="http://www.google.com/maps/place/' + chatData[i].link + '/@' + chatData[i].link + ',15z">' +
                                    '                    <div  class="msg-bubble-img" id="map' + identity + '">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   </a>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(chatData[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';
                                ll.push(chatData[i].link);
                                mm.push(identity);
                            }

                        }
                    }
                    document.getElementById("chat").innerHTML += content;
                    $('html, body').scrollTop($(document).height());
                    $("img").on('error', function() {
                        $(this).attr("src", "img/pictures/notFound.png");
                    });
                    setTimeout(function() {
                        $("video,audio").on('click', function() {
                            if (this.paused) {
                                this.play();
                            } else {
                                this.pause();
                            }
                            if (this.getAttribute('controls') !== 'true') {
                                this.setAttribute('controls', 'true');
                            }
                            this.setAttribute('controls', 'true');
                        });
                    }, 2000);
                    for (var z = 0; z < mm.length; z++) {
                        // console.log(mm[i]+":"+ll[i]);
                        var nn = ll[z].split(",");
                        loadmap("map" + mm[z], nn[0], nn[1]);
                    }
                } else {
                    console.log("no result");
                }

            }
        };
        xhttp.open("POST", server + "fetchSingleChat.php", true);
        var parameters = "proId=" + proId + "&singleChatId=" + chatterId + "&prev=" + prevId;
        console.log(parameters);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
}


function fetchNextSingleChat() {
    if (!mutualExclusive) {
        newLoaderOn();
        var proId = localStorage.getItem("PROID");
        var chatterId = localStorage.getItem("SINGLECHATID");
        //console.log("PID:" + proId + ":::" + "CID:" + chatterId);
        var content = "";
        var xhttp = new XMLHttpRequest();
        var chatData = "";
        var identity = "";
        var ll = [];
        var mm = [];
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log("CHAT:::" + xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                    chatData = JSON.parse(xhttp.responseText.trim());
                    nextId = chatData[chatData.length - 1].id;
                    nextOffset += 10;
                    console.log("NEXTID:" + nextId + "NEXTOFF" + nextOffset);
                    for (var i = chatData.length - 1; i >= 0; i--) {
                        if (chatData[i].senderId == proId) {
                            if (chatData[i].type == 'text') {
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,0,\'' + 'text' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20"></div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    // '                            '+chatterName+'' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                             ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <p>' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';
                            } else if (chatData[i].type == "video") {

                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'videos' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <video class="msg-bubble-img" preload="auto"  controls>' +
                                    '                    <source src="' + server + chatData[i].link + '" type="video/mp4">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </video>' +
                                    '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';


                            } else if (chatData[i].type == "audio") {
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'audios' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <audio class="msg-bubble-img-audio" preload="auto" controls>' +
                                    '                    <source src="' + server + chatData[i].link + '" type="audio/mpeg">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +


                                    '                        </div>' +
                                    '                    </audio>' +
                                    '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';

                            } else if (chatData[i].type == "photo") {
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'images' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <p class="msg-bubble-img"  style="background-image:url(' + server + getThumb(chatData[i].link) + ')" onclick="profileFullImage(this)">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </p>' +
                                    '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';

                            } else if (chatData[i].type == "file") {
                                var path = chatData[i].link;
                                var ext = path.substr(path.lastIndexOf('.') + 1);
                                var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                                for (var x in extName) {
                                    if (x == ext) {
                                        console.log("File is: " + x);
                                        holder = 'img/attach_icons/' + extName[x];
                                    }
                                }
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'files' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <a href="' + chatData[i].link + '" target="_blank"> <p class="msg-bubble-img"  style="background-image:url(' + holder + ')"></a>' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </p>' +
                                    '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';
                            } else if (chatData[i].type == "contact") {

                                var contact = chatData[i].message.split(",");
                                console.log(contact[0] + ":::" + contact[1]);
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,0,\'' + 'contacts' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                          ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-contact">' +
                                    '                        <div class="row">' +
                                    '                            <div class="col-30 row col-center"><div class="msg-contact-pic"></div></div>' +
                                    '                            <div class="col-70">' +
                                    '                                <p class="name">' + contact[0] + '</p>' +
                                    '                                <p class="contact">' + contact[1] + '</p>' +
                                    '                            </div>' +
                                    '                        </div>' +
                                    '                        <div class="save-contact">' +
                                    // '                            Save Contact' +
                                    '                        </div>' +
                                    // '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                    </div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';


                            } else if (chatData[i].type == "post") {
                                console.log("IN");
                                var innerContent = "";
                                var folder = "";
                                console.log(chatData[i].message);
                                var innerData = JSON.parse(chatData[i].message);
                                console.log(innerData);
                                var innerJson = chatData[i].message.replace(/"/g, "~");
                                console.log("innerJson:" + innerJson);
                                if (innerData.type == "photo") {
                                    folder = "images";
                                    innerContent = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'images' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-pic">' +
                                        '                              <img src="' + server + getThumb(innerData.title) + '" />' +
                                        '                            </div>' +
                                        '                        </div>';


                                } else if (innerData.type == "text") {
                                    folder = "text";
                                    innerContent = '<div class="shared-post" onmousedown="holdSingleChat(this,0,\'' + 'text' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                        </div>';


                                } else if (innerData.type == "video") {
                                    folder = "videos";
                                    innerContent = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'videos' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-video">' +
                                        '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                        '                    <source src="' + server + innerData.title + '" type="video/mp4">' +
                                        '                </video>' +
                                        '                            </div>' +
                                        '                        </div>';


                                } else if (innerData.type == "audio") {
                                    folder = "audios";
                                    innerContent = '<div class="shared-post">' +
                                        '                            <div class="row post-head" onmousedown="holdSingleChat(this,1,\'' + 'audios' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData.title + '">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-video">' +
                                        '                <audio controls preload="auto">' +
                                        '                    <source src="' + server + innerData.title + '" type="audio/wav">' +
                                        '                </audio>' +
                                        '                            </div>' +
                                        '                        </div>';



                                } else if (innerData.type == "file") {
                                    folder = "files";
                                    var holder1 = "";
                                    var path1 = innerData.title;
                                    var ext1 = path1.substr(path1.lastIndexOf('.') + 1);
                                    var extName1 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                                    for (var x1 in extName1) {
                                        if (x1 == ext1) {
                                            console.log("File is: " + x1);
                                            holder1 = 'img/attach_icons/' + extName1[x1];
                                        }
                                    }
                                    innerContent = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'files' + '\')" onmouseup="unHoldSingleChat()"data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-pic">' +
                                        '                              <img src="' + holder1 + '" />' +
                                        '                            </div>' +
                                        '                        </div>';

                                }

                                content += '<div class="row chat section" id="' + chatData[i].id + '" >' +
                                    '            <div class="col-20"></div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    // '                            '+chatterName+'' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                             ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-content">' + innerContent + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';


                            } else if (chatData[i].type == "map") {
                                identity = Math.floor(Math.random() * 89999 + 10000);
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,0,\'' + 'maps' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + '<span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <a href="http://www.google.com/maps/place/' + chatData[i].link + '/@' + chatData[i].link + ',15z">' +
                                    '                    <div class="msg-bubble-img" id="map' + identity + '">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   </a>' +
                                    '                    <p>' + emojione.unicodeToImage(chatData[i].message) + ' </p>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';
                                ll.push(chatData[i].link);
                                mm.push(identity);
                            }
                            /////////////
                            //RECEIVER //
                            /////////////
                        } else if (chatData[i].senderId == chatterId) {


                            if (chatData[i].type == 'text') {
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,0,\'' + 'text' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Me' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <p>' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (chatData[i].type == "video") {


                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'videos' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                              ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Mee' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <video controls preload="auto" class="msg-bubble-img" >' +
                                    '                       <source src="' + server + chatData[i].link + '" type="video/mp4">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </video>' +
                                    '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';



                            } else if (chatData[i].type == "audio") {

                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'audios' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                              ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Mee' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <audio controls preload="auto" class="msg-bubble-img-audio" >' +
                                    '                       <source src="' + server + chatData[i].link + '" type="audio/mpeg">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </audio>' +
                                    '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (chatData[i].type == "photo") {

                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'images' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                              ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Mee' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <p  class="msg-bubble-img" style="background-image:url(' + server + getThumb(chatData[i].link) + ')" onclick="profileFullImage(this)">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </p>' +
                                    '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (chatData[i].type == "file") {
                                var path2 = chatData[i].link;
                                var ext2 = path2.substr(path2.lastIndexOf('.') + 1);
                                var extName2 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                                for (var x2 in extName2) {
                                    if (x2 == ext2) {
                                        console.log("File is: " + x2);
                                        holder2 = 'img/attach_icons/' + extName2[x2];
                                    }
                                }
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,1,\'' + 'files' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                              ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Mee' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <a href="' + chatData[i].link + '" target="_blank"> <p class="msg-bubble-img"  style="background-image:url(' + holder2 + ')"></a>' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </p>' +
                                    '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';
                            } else if (chatData[i].type == "contact") {
                                var contact1 = chatData[i].message.split(",");
                                console.log(contact1[0] + ":::" + contact1[1]);
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,0,\'' + 'contacts' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                              ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Mee' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                       <div class="chat-contact">' +
                                    '                        <div class="row">' +
                                    '                            <div class="col-30 row col-center"><div class="msg-contact-pic"></div></div>' +
                                    '                            <div class="col-70">' +
                                    '                                <p class="name">' + contact1[0] + '</p>' +
                                    '                                <p class="contact">' + contact1[1] + '</p>' +
                                    '                            </div>' +
                                    '                        </div>' +
                                    '                        <div class="save-contact" onclick="saveContact(\'' + contact1[0] + '\',\'' + contact1[1] + '\')">' +
                                    '                            Save Contact' +
                                    '                        </div>' +
                                    // '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                      </div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (chatData[i].type == 'post') {
                                console.log("IN R");
                                var innerContent1 = "";
                                var folder1 = "";
                                var innerData1 = JSON.parse(chatData[i].message);
                                console.log(innerData1);
                                var innerJson1 = chatData[i].message.replace(/"/g, "~");
                                console.log("innerJson:" + innerJson1);
                                if (innerData1.type == "photo") {
                                    folder1 = "images";
                                    innerContent1 = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'images' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData1.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData1.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData1.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData1.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData1.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-pic">' +
                                        '                              <img src="' + server + getThumb(innerData1.title) + '" />' +
                                        '                            </div>' +
                                        '                        </div>';


                                } else if (innerData1.type == "text") {
                                    folder1 = "text";
                                    innerContent1 = '<div class="shared-post" onmousedown="holdSingleChat(this,0,\'' + 'text' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData1.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData1.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData1.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData1.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData1.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                        </div>';


                                } else if (innerData1.type == "video") {
                                    folder1 = "videos";
                                    innerContent1 = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'videos' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData1.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData1.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData1.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData1.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData1.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-video">' +
                                        '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                        '                    <source src="' + server + innerData1.title + '" type="video/mp4">' +
                                        '                </video>' +
                                        '                            </div>' +
                                        '                        </div>';


                                } else if (innerData1.type == "audio") {
                                    folder1 = "audios";
                                    innerContent1 = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'audios' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData1.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData1.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData1.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData1.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData1.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-video">' +
                                        '                <audio controls preload="auto">' +
                                        '                    <source src="' + server + innerData1.title + '" type="audio/wav">' +
                                        '                </audio>' +
                                        '                            </div>' +
                                        '                        </div>';



                                } else if (innerData1.type == "file") {
                                    folder1 = "files";
                                    var holder3 = "";
                                    var path3 = innerData1.title;
                                    var ext3 = path3.substr(path3.lastIndexOf('.') + 1);
                                    var extName3 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                                    for (var x3 in extName3) {
                                        if (x3 == ext3) {
                                            console.log("File is: " + x3);
                                            holder3 = 'img/attach_icons/' + extName3[x3];
                                        }
                                    }
                                    innerContent1 = '<div class="shared-post" onmousedown="holdSingleChat(this,1,\'' + 'files' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + innerData1.title + '">' +
                                        '                            <div class="row post-head">' +
                                        '                                <div class="col-20 post-pro-pic col-center">' +
                                        '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData1.imageURL) + ')"></div>' +
                                        '                                </div>' +
                                        '                                <div class="col-80" ><p>' + innerData1.userName + '</p>' +
                                        '                                <div class="post-time">' + formatAMPM(new Date(innerData1.time)) + '</div>' +
                                        '</div>' +
                                        '                            </div>' +
                                        '                            ' +
                                        '                            <div class="post-desc" >' +
                                        '                               ' + innerData1.desc + '' +
                                        '                            </div>' +
                                        '                         ' +
                                        '                            <div class="post-pic">' +
                                        '                              <img src="' + holder3 + '" />' +
                                        '                            </div>' +
                                        '                        </div>';

                                }
                                content += '<div class="row chat section" id="' + chatData[i].id + '"  >' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Me' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <div class="chat-content">' + innerContent1 + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (chatData[i].type == "map") {

                                identity = Math.floor(Math.random() * 89999 + 10000);
                                content += '<div class="row chat section" id="' + chatData[i].id + '" onmousedown="holdSingleChat(this,0,\'' + 'maps' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + chatData[i].id + '" data-bubble-link="' + chatData[i].link + '">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                            ' + formatAMPM(new Date(chatData[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    // '                            Me' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <a href="http://www.google.com/maps/place/' + chatData[i].link + '/@' + chatData[i].link + ',15z">' +
                                    '                    <div  class="msg-bubble-img" id="map' + identity + '">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   </a>' +
                                    '                    <p>' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';
                                ll.push(chatData[i].link);
                                mm.push(identity);
                            }

                        }
                    }
                    document.getElementById("chat").innerHTML = content + document.getElementById("chat").innerHTML;
                    newLoaderOff();
                    $("img").on('error', function() {
                        $(this).attr("src", "img/pictures/notFound.png");
                    });
                    setTimeout(function() {
                        $("video,audio").on('click', function() {
                            if (this.paused) {
                                this.play();
                            } else {
                                this.pause();
                            }
                            if (this.getAttribute('controls') !== 'true') {
                                this.setAttribute('controls', 'true');
                            }
                            this.setAttribute('controls', 'true');
                        });
                    }, 2000);
                    //$('html, body').scrollTop($(document).height());
                    for (var z = 0; z < mm.length; z++) {
                        // console.log(mm[i]+":"+ll[i]);
                        var nn = ll[z].split(",");
                        loadmap("map" + mm[z], nn[0], nn[1]);
                    }
                    $('html, body').scrollTop($(document).height());
                } else {
                    console.log('no chat');
                    document.getElementById('loadMore').innerHTML = 'No More Chats';
                    newLoaderOff();
                }

            }
        };
        xhttp.open("POST", server + "fetchNextSingleChat.php", true);
        var parameters = "proId=" + proId + "&singleChatId=" + chatterId + "&next=" + nextId;
        console.log(parameters);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
}

function sendSingleChat() {
    document.getElementById("sendEnable").style.display = 'none';
    document.getElementById("sendDisable").style.display = 'block';
    var proId = localStorage.getItem("PROID");
    var chatterId = localStorage.getItem("SINGLECHATID");
    var message = document.getElementById("chatMessage").value;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        mutualExclusive = true;
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                var res = xhttp.responseText.trim().split(",");
                document.getElementById("chatMessage").value = "";
                if (prevId !== 0) {
                    var content = '<div class="row chat section" id="' + res[0] + '" onmousedown="holdSingleChat(this,0,\'' + 'text' + '\')" onmouseup="unHoldSingleChat()" data-bubble-id="' + res[0] + '" data-bubble-link="' + res[1] + '">' +
                        '            <div class="col-20"></div>' +
                        '            <div class="col-80">' +
                        '                <div class="msg-sent-cont">' +
                        '                    <div class="row">' +
                        '                        <div class="col-60">' +
                        // '                            '+chatterName+'' +
                        '                        </div>' +
                        '                        <div class="col-40 text-right">' +
                        '                             ' + formatAMPM(new Date()) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                        '                        </div>' +
                        '                    </div>' +
                        '                    <div class="chat-content">' + emojione.unicodeToImage(message) + '</div>' +
                        '                </div>' +
                        '            </div>' +
                        '        </div>';
                    document.getElementById("chat").innerHTML += content;
                    $('html, body').scrollTop($(document).height());
                }
                mutualExclusive = false;
            } else {
                console.log("error");
                mutualExclusive = false;
            }

        }
    };
    xhttp.open("POST", server + "sendSingleChat.php", true);
    var parameters = "proId=" + proId + "&chatterId=" + chatterId + "&message=" + encodeURIComponent(message);
    console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}





//////////////////////
//Chat Attachements //
//chat attachments  //
//////////////////////

function chatVideoOptions() {
    closepopupplain();
    $('.attach-sub-menu').hide();
    document.getElementById('videoAttach').style.display = 'table';
}

function chatAudioOptions() {
    closepopupplain();
    $('.attach-sub-menu').hide();
    document.getElementById('audioAttach').style.display = 'table';
}

function chatPhotoOptions() {
    closepopupplain();
    $('.attach-sub-menu').hide();
    document.getElementById('photoAttach').style.display = 'table';
}

function closeAttachOptions() {
    $('.attach-sub-menu').hide();
}

function chatTakeVideo(argument) {
    // capture callback
    var captureSuccess = function(mediaFiles) {
        var i, path, len;
        for (i = 0, len = mediaFiles.length; i < len; i += 1) {
            path = mediaFiles[i].fullPath;
            // do something interesting with the file
            checkURL = path;
            document.getElementById("preBubbleImgVideo").src = path;
            closeAttachOptions();
            chatPopup("preBubbleVideo");
        }
    };

    // capture error callback
    var captureError = function(error) {
        navigator.notification.console.log('Error code: ' + error.code, null, 'Capture Error');
    };

    // start video capture
    navigator.device.capture.captureVideo(captureSuccess, captureError, { limit: 1, quality: 0 });
}

function chatGetVideo(argument) {
    console.log("get vid");
    navigator.camera.getPicture(onSuccess, onFail, {
        quality: 50,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: navigator.camera.DestinationType.FILE_URI,
        mediaType: navigator.camera.MediaType.VIDEO,
        sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
    //success handler
    function onSuccess(imageURL) {
        checkURL = imageURL;
        document.getElementById("preBubbleImgVideo").src = imageURL;
        closeAttachOptions();
        chatPopup("preBubbleVideo");

    }
    //erroor handler
    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}

function chatUploadVideo() {
    var identity = Math.floor(Math.random() * 89999 + 10000);
    mutualExclusive = true;
    var content = '<div class="row chat section" id="vid' + identity + '">' +
        '            <div class="col-20">' +
        '            </div>' +
        '            <div class="col-80">' +
        '                <div class="msg-sent-cont">' +
        '                    <div class="row">' +
        '                        <div class="col-60">' +
        '                        </div>' +
        '                        <div class="col-40 text-right">' +
        '                            ' + formatAMPM(new Date()) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
        '                        </div>' +
        '                    </div>' +
        '                    <video class="msg-bubble-img" preload="auto" controls>' +
        '                    <source src="' + checkURL + '" type="video/mp4">' +
        '                        <div class="msg-bubble-img-loader row row-center">' +
        '                        </div>' +
        '                    </video>' +
        '                    <div class="chat-content"> ' + emojione.unicodeToImage(document.getElementById("bubbleDescVideo").value) + '</div>' +
        '                 <div class="msg-upload-progress-cont">' +
        '                   <div class="msg-upload-progress" id="' + identity + '"></div>' +
        '               </div>' +
        '              </div>' +
        '            </div>' +
        '        </div>';


    //console.log(content);
    closeChatPopup();
    document.getElementById("chat").innerHTML += content;

    $('html, body').scrollTop($(document).height());
    mutualExclusive = false;
    // console.log("in upload video:" + document.getElementById("bubbleDescVideo").value);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "chatUploadVideo.php?proId=" + localStorage.getItem("PROID") + "&chatterId=" + localStorage.getItem("SINGLECHATID") + "&desc=" + document.getElementById("bubbleDescVideo").value);
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "video/3gpp";
    options.httpMethod = 'POST';
    var params = {};
    params.proId = localStorage.getItem("PROID");
    params.chatterId = localStorage.getItem("SINGLECHATID");
    params.desc = document.getElementById("bubbleDescVideo").value;
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.onprogress = function(progressEvent) {
        $("#" + identity).css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $("#" + identity).css("width", perc + "%");
        } else {
            if (progressStatus.innerHTML === "") {
                $("#" + identity).css("width", "0%");
            } else {
                $("#" + identity).css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        // document.getElementById("vid"+identity).setAttribute;
        // onmousedown="holdSingleChat(this,0,\'' + 'maps' + '\')" 
        // onmouseup="unHoldSingleChat()" 
        // data-bubble-id="' + chatData[i].id + '" 
        // data-bubble-link="' + chatData[i].link + '"
        document.getElementById("bubbleDescVideo").value = "";
        document.getElementById("preBubbleImgVideo").src = "";
        setTimeout(function() {
            $("video").on('click', function() {
                if (this.paused) {
                    this.play();
                } else {
                    this.pause();
                }
                if (this.getAttribute('controls') !== 'true') {
                    this.setAttribute('controls', 'true');
                }
                this.setAttribute('controls', 'true');
            });
        }, 2000);
        //removeJunk();
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }
}


function chatTakeAudio(argument) {
    pendingAudio = true;
    // capture callback
    var captureSuccess = function(mediaFiles) {
        var i, path, len;
        for (i = 0, len = mediaFiles.length; i < len; i += 1) {
            path = mediaFiles[i].fullPath;
            checkURL = path;
            document.getElementById("preBubbleImgAudio").src = path;
            closeAttachOptions();
            chatPopup("preBubbleAudio");

        }
    };

    // capture error callback
    var captureError = function(error) {
        alert("Sorry! Your phone dosen't support this functionality.");
        console.log('Error code: ' + error, null, 'Capture Error');
    };

    // start audio capture
    navigator.device.capture.captureAudio(captureSuccess, captureError, { limit: 1 });
}

function chatGetAudio(argument) {
    navigator.camera.getPicture(onSuccess, onFail, {
        quality: 100,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: navigator.camera.DestinationType.FILE_URI,
        mediaType: navigator.camera.MediaType.ALLMEDIA,
        sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
    //success handler
    function onSuccess(imageURL) {
        //console.log(imageURL);
        checkURL = imageURL;
        var ext = checkURL.substr(checkURL.lastIndexOf('.') + 1);
        if (ext == "wav" || ext == "amr" || ext == "mp3") {
            checkURL = imageURL;
            document.getElementById("preBubbleImgAudio").src = imageURL;
            chatPopup("preBubbleAudio");
        } else {
            alert("Audio File Format Not Supported.");
        }
        closeAttachOptions();
    }
    //erroor handler
    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}

function chatUploadAudio() {
    pendingAudio = false;
    var identity = Math.floor(Math.random() * 89999 + 10000);
    mutualExclusive = true;
    var content = '<div class="row chat section">' +
        '            <div class="col-20">' +
        '            </div>' +
        '            <div class="col-80">' +
        '                <div class="msg-sent-cont">' +
        '                    <div class="row">' +
        '                        <div class="col-60">' +
        '                        </div>' +
        '                        <div class="col-40 text-right">' +
        '                            ' + formatAMPM(new Date()) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
        '                        </div>' +
        '                    </div>' +
        '                    <audio class="msg-bubble-img-audio" preload="auto" controls>' +
        '                    <source src="' + checkURL + '" type="audio/mpeg">' +
        '                        <div class="msg-bubble-img-loader row row-center">' +
        '                        </div>' +
        '                    </audio>' +
        '                    <div class="chat-content"> ' + emojione.unicodeToImage(document.getElementById("bubbleDescAudio").value) + '</div>' +
        '                 <div class="msg-upload-progress-cont">' +
        '                   <div class="msg-upload-progress" id="' + identity + '"></div>' +
        '               </div>' +
        '              </div>' +
        '            </div>' +
        '        </div>';


    //console.log(content);
    closeChatPopup();
    document.getElementById("chat").innerHTML += content;
    $('html, body').scrollTop($(document).height());
    mutualExclusive = false;

    console.log("in upload audio:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "chatUploadAudio.php");
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "audio/wav";
    options.httpMethod = 'POST';
    var params = {};
    params.proId = localStorage.getItem("PROID");
    params.chatterId = localStorage.getItem("SINGLECHATID");
    params.desc = document.getElementById("bubbleDescAudio").value;
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.onprogress = function(progressEvent) {
        $("#" + identity).css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $("#" + identity).css("width", perc + "%");
        } else {
            if (progressStatus.innerHTML === "") {
                $("#" + identity).css("width", "0%");
            } else {
                $("#" + identity).css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        document.getElementById("bubbleDescAudio").value = "";
        document.getElementById("preBubbleImgAudio").src = "";
        setTimeout(function() {
            $("audio").on('click', function() {
                if (this.paused) {
                    this.play();
                } else {
                    this.pause();
                }
                if (this.getAttribute('controls') !== 'true') {
                    this.setAttribute('controls', 'true');
                }
                this.setAttribute('controls', 'true');
            });
        }, 2000);
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }
}


function chatTakePhoto(argument) {
    removeJunk();
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "TAKE");
    console.log("get pic");
    navigator.camera.getPicture(chatTakePhotoSuccess, chatTakePhotoFail, {
        quality: 60,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI,
        sourceType: Camera.PictureSourceType.CAMERA
            // targetWidth: 200,
            // targetHeight: 200
    });
}
//success handler
function chatTakePhotoSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    checkURL = imageURL;
    document.getElementById("preBubbleImgPhoto").style.backgroundImage = "url(" + imageURL + ")";
    closeAttachOptions();
    chatPopup("preBubblePhoto");
    localStorage.setItem("PAGELOC", "");
}
//erroor handler
function chatTakePhotoFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}

var multiImageURL = [];

function chatGetPhoto(argument) {
    multiImageURL = [];
    removeJunk();
    var content = "";
    window.imagePicker.getPictures(
        function(results) {

            for (var i = 0; i < results.length; i++) {
                multiImageURL.push(results[i]);
                content += '<div class="col">' +
                    '                <div class="status-update-pic">' +
                    '                    <div class="send-attach-img send-attach-img-multiple" style="background-image:' + "url(" + results[i] + ")" + '"></div>' +
                    '                </div>' +
                    '            </div>';
                console.log('Image URI: ' + results[i]);
            }
            document.getElementById("multiImage").innerHTML = content;
            appState.takingPicture = false; //2
            appState.imageUri = results[0]; //3
            closeAttachOptions();
            chatPopup("preBubblePhoto");
            console.log('IN:' + multiImageURL.length);
            localStorage.setItem("PAGELOC", "");
        },
        function(error) {
            console.log('Error: ' + error);
        }, {
            maximumImagesCount: 10,
            quality: 60
        }
    );
    // localStorage.setItem("PAGELOC", pageLocation);
    // appState.takingPicture = true; //1
    // localStorage.setItem("PAGERED", "GET");
    // console.log("get pic");
    // navigator.camera.getPicture(chatGetPhotoSuccess, chatGetPhotoFail, {
    //     quality: 60,
    //     // allowEdit: true,
    //     correctOrientation: false,
    //     destinationType: Camera.DestinationType.FILE_URI,
    //     sourceType: Camera.PictureSourceType.PHOTOLIBRARY
    //         // targetWidth: 200,
    //         // targetHeight: 200
    // });
}
//success handler
function chatGetPhotoSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    checkURL = imageURL;
    document.getElementById("preBubbleImgPhoto").style.backgroundImage = "url(" + imageURL + ")";
    closeAttachOptions();
    chatPopup("preBubblePhoto");
    localStorage.setItem("PAGELOC", "");
}
//error handler
function chatGetPhotoFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}

function chatUploadMultiPhoto() {
    for (var i = 0; i < multiImageURL.length; i++) {
        checkURL = multiImageURL[i];
        chatUploadPhoto();
    }
}

function chatUploadPhoto() {
    var identity = Math.floor(Math.random() * 89999 + 10000);
    mutualExclusive = true;
    var content = '<div class="row chat section">' +
        '            <div class="col-20">' +
        '            </div>' +
        '            <div class="col-80">' +
        '                <div class="msg-sent-cont">' +
        '                    <div class="row">' +
        '                        <div class="col-60">' +
        '                        </div>' +
        '                        <div class="col-40 text-right">' +
        '                            ' + formatAMPM(new Date()) + '<span> <img src="img/icons/double-tick-indicator.svg" /></span>' +
        '                        </div>' +
        '                    </div>' +
        '                    <p class="msg-bubble-img" style="background-image:url(' + checkURL + ')">' +
        '                        <div class="msg-bubble-img-loader row row-center">' +
        '                        </div>' +
        '                    </p>' +
        '                    <div class="chat-content">' + emojione.unicodeToImage(document.getElementById("bubbleDescPhoto").value) + ' </div>' +
        '                </div>' +
        '                <div class="msg-upload-progress-cont">' +
        '                    <div class="msg-upload-progress" id="' + identity + '"></div>' +
        '                </div>' +
        '            </div>' +
        '        </div>';

    //console.log(content);
    closeChatPopup();
    document.getElementById("chat").innerHTML += content;
    $('html, body').scrollTop($(document).height());
    mutualExclusive = false;
    console.log("in upload image:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "chatUploadPhoto.php");
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "image/jpeg";
    options.httpMethod = 'POST';
    var params = {};
    params.proId = localStorage.getItem("PROID");
    params.chatterId = localStorage.getItem("SINGLECHATID");
    params.desc = document.getElementById("bubbleDescPhoto").value;
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();
    removeJunk(); // to avoid sending same caption for all images
    ft.onprogress = function(progressEvent) {
        $("#" + identity).css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $("#" + identity).css("width", perc + "%");
        } else {
            if (progressStatus.innerHTML === "") {
                $("#" + identity).css("width", "0%");
            } else {
                $("#" + identity).css("width", "100%");
            }
        }
    };
    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        document.getElementById("bubbleDescPhoto").value = "";
        document.getElementById("preBubbleImgPhoto").style.backgroundImage = "url(" + '//:0' + ")";
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }
}


function chatTakeFile(argument) {
    console.log("get file");
    navigator.camera.getPicture(onSuccess, onFail, {
        quality: 50,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: navigator.camera.DestinationType.FILE_URI,
        mediaType: navigator.camera.MediaType.ALLMEDIA,
        sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
    //success handler
    function onSuccess(imageURL) {
        checkURL = imageURL;
        var ext = checkURL.substr(checkURL.lastIndexOf('.') + 1);
        var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
        for (var x in extName) {
            if (x == ext) {
                console.log("File: " + x);

                document.getElementById("preBubbleImgFile").style.backgroundImage = "url(img/attach_icons/" + extName[x] + ")";
                chatPopup("preBubbleFile");
            }
        }


    }
    //erroor handler
    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}


function chatUploadFile() {
    var identity = Math.floor(Math.random() * 89999 + 10000);
    mutualExclusive = true;
    var present = false;
    var mmt = "";
    var holder = "";
    var path = checkURL;
    var ext = path.substr(path.lastIndexOf('.') + 1);
    var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
    for (var x in extName) {
        if (x == ext) {
            console.log("File is: " + x);
            holder = 'img/attach_icons/' + extName[x];
        }
    }
    var extNameMime = JSON.parse('{"pdf":"application/pdf" , "txt":"text/plain" , "doc":"application/msword" , "docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document" , "ppt":"application/vnd.ms-powerpointtd>" , "pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation" , "xls":"application/vnd.ms-excel" , "xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}');
    for (var x1 in extNameMime) {
        if (x1 == ext) {
            console.log("File: " + x1);
            present = true;
            mmt = extNameMime[x1];
        }
    }
    var content = '<div class="row chat section">' +
        '            <div class="col-20">' +
        '            </div>' +
        '            <div class="col-80">' +
        '                <div class="msg-sent-cont">' +
        '                    <div class="row">' +
        '                        <div class="col-60">' +
        '                        </div>' +
        '                        <div class="col-40 text-right">' +
        '                            ' + formatAMPM(new Date()) + '<span><img src="img/icons/double-tick-indicator.svg" /></span>' +
        '                        </div>' +
        '                    </div>' +
        '                    <p class="msg-bubble-img" style="background-image:url(' + holder + ')">' +
        '                        <div class="msg-bubble-img-loader row row-center">' +
        '                        </div>' +
        '                    </p>' +
        '                    <div class="chat-content">' + emojione.unicodeToImage(document.getElementById("bubbleDescPhoto").value) + ' </div>' +
        '                </div>' +
        '                <div class="msg-upload-progress-cont">' +
        '                    <div class="msg-upload-progress" id="' + identity + '"></div>' +
        '                </div>' +
        '            </div>' +
        '        </div>';

    //console.log(content);
    closeChatPopup();
    document.getElementById("chat").innerHTML += content;
    $('html, body').scrollTop($(document).height());
    mutualExclusive = false;
    console.log("in upload chat file:" + checkURL);



    if (!present) {
        alert("File Not Supported.");
    } else {
        console.log(mmt);
        var uri = encodeURI(server + "chatUploadFile.php?proId=" + localStorage.getItem("PROID") + "&desc=" + document.getElementById("bubbleDescFile").value + "&ext=" + ext);
        var options = new FileUploadOptions();
        options.fileKey = "file"; //fileUploadKey
        options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
        options.mimeType = mmt;
        options.httpMethod = 'POST';
        var params = {};
        params.proId = localStorage.getItem("PROID");
        params.chatterId = localStorage.getItem("SINGLECHATID");
        params.desc = document.getElementById("bubbleDescFile").value;
        params.ext = ext;
        options.params = params;
        options.chunkedMode = false;
        var headers = {
            'headerParam': 'headerValue'
        };
        options.headers = headers;

        var ft = new FileTransfer();

        ft.onprogress = function(progressEvent) {
            $("#" + identity).css("width", '0%');
            if (progressEvent.lengthComputable) {
                var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
                $("#" + identity).css("width", perc + "%");
            } else {
                if (progressStatus.innerHTML === "") {
                    $("#" + identity).css("width", "0%");
                } else {
                    $("#" + identity).css("width", "100%");
                }
            }
        };

        ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
        //success handler
        function onSucc(r) {
            console.log("Code = " + r.responseCode);
            console.log("Response = " + r.response);
            console.log("Sent = " + r.bytesSent);
            console.log(r.response);
            document.getElementById("bubbleDescFile").value = "";
            document.getElementById("preBubbleImgFile").style.backgroundImage = "url(" + '//:0' + ")";
            /*if (r.response == 'The file has been uploaded.') {*/
            //console.log("Uploaded");

            //window.location.href = "home.html";
            /*}*/
        }
        //error handler
        function onErr(error) {
            console.log("An error has occurred: Code = " + error.code);
            console.log("upload error source " + error.source);
            console.log("upload error target " + error.target);
            console.log("Failure");
        }
    }
}

function chatTakeContact(argument) {
    var data = JSON.parse(localStorage.getItem("CONTACTS"));
    var content = "<form name='contactForm'>";
    var count = 0;
    var members = [];
    var image = "";

    for (var i = 0; i < data.length; i++) {
        // if (data[i].is_user) {
        if (data[i].imageURL === "" || data[i].imageURL === null) {
            image = "img/list/arya_stark.jpg";
        } else {
            image = server + data[i].imageURL;
        }
        console.log("X:" + data[i].system_id);

        content += '<div class="row">' +
            '                <div class="col-20">' +
            '                    <div class="dash-chat-img contact-person-icon" style="background-image:url(' + image + ')">' +
            '                    </div>' +
            '                </div>' +
            '                <div class="col-70 col-center" onclick="setContact(this)" data-system-id="' + data[i].system_id + '">' +
            '                    <p class="contact-person-name">' + data[i].name + '</p>' +
            '                    <p class="contact-person-num"><i class="fa fa-phone"></i> ' + data[i].phone + '</p>' +
            '                </div>' +
            '                <div class="col-10">' +
            '                    <label class="radio-button">' +
            "                        <input type='radio' name='contactRadio' value='" + JSON.stringify(data[i]) + "' id='rdb" + (count++) + "'>" +
            '                        <div class="radio-button__checkmark"></div>' +
            '                    </label>' +
            '                </div>' +
            '            </div>';


        // }
    }
    document.getElementById("contactList").innerHTML = content + '</form>';
    $("#listingContact").show();
}

function chatTakeContactSearch(needle) {
    console.log(needle.value);
    var content = "<form name='contactForm'>";
    var count = 0;
    var members = [];
    var image = "";
    document.getElementById("contactList").innerHTML = "";
    var data = JSON.parse(localStorage.getItem("CONTACTS"));
    for (var i = 0; i < data.length; i++) {
        if (data[i].name.toLowerCase().indexOf(needle.value.toLowerCase()) != -1) {
            if (data[i].imageURL === "" || data[i].imageURL === null) {
                image = "img/list/arya_stark.jpg";
            } else {
                image = server + data[i].imageURL;
            }
            content += '<div class="row">' +
                '                <div class="col-20">' +
                '                    <div class="dash-chat-img contact-person-icon" style="background-image:url(' + getThumb(image) + ')">' +
                // '                        <img src="' + image + '">' +
                '                    </div>' +
                '                </div>' +
                '                <div class="col-70 col-center" onclick="setContact(this)" data-system-id="' + data[i].system_id + '">' +
                '                    <p class="contact-person-name">' + data[i].name + '</p>' +
                '                    <p class="contact-person-num"><i class="fa fa-phone"></i> ' + data[i].phone + '</p>' +
                '                </div>' +
                '                <div class="col-10">' +
                '                    <label class="radio-button">' +
                "                        <input type='radio' name='contactRadio' value='" + JSON.stringify(data[i]) + "' id='rdb" + (count++) + "'>" +
                '                        <div class="radio-button__checkmark"></div>' +
                '                    </label>' +
                '                </div>' +
                '            </div>';


            // }
        }

    }
    document.getElementById("contactList").innerHTML = content + '</form>';
}

function sendContact(argument) {
    var count = 0;
    var flag = false;
    var contact = "";
    var content = "";
    var message = "";
    ///////////////////////////////////////////////////////METHOD 1//////////////////////////////////////////////////////////////////////
    // while (document.getElementById("rdb" + count) !== null) {
    //     console.log(document.getElementById("rdb" + count).checked + ":::" + document.getElementById("rdb" + count).getAttribute("data-system-id") + ":::" + document.getElementById("rdb" + count).getAttribute("data-system-name") + ":::" + document.getElementById("rdb" + count).getAttribute("data-system-phone"));
    //     if (document.getElementById("rdb" + count).checked) {
    //         flag = true;
    //         name = document.getElementById("rdb" + count).getAttribute("data-system-name");
    //         phone = document.getElementById("rdb" + count).getAttribute("data-system-phone");
    //     }
    //     count++;
    // }
    ///////////////////////////////////////////////////////METHOD 2//////////////////////////////////////////////////////////////////////
    var d = document.forms["contactForm"]["contactRadio"].value;
    console.log(d);
    if (d === "" || d === null) {
        flag = false;
    } else {
        contact = JSON.parse(d);
        flag = true;
    }

    if (flag) {
        message = contact.phone + "," + contact.name;
        content += '<div class="row chat section">' +
            '            <div class="col-20">' +
            '            </div>' +
            '            <div class="col-80">' +
            '                <div class="msg-sent-cont">' +
            '                    <div class="row">' +
            '                        <div class="col-60">' +
            '                        </div>' +
            '                        <div class="col-40 text-right">' +
            '                          ' + formatAMPM(new Date()) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
            '                        </div>' +
            '                    </div>' +
            '                    <div class="chat-contact">' +
            '                        <div class="row">' +
            '                            <div class="col-30 row col-center"><div class="msg-contact-pic"></div></div>' +
            '                            <div class="col-70">' +
            '                                <p class="name">' + contact.name + '</p>' +
            '                                <p class="contact">' + contact.phone + '</p>' +
            '                            </div>' +
            '                        </div>' +
            '                        <div class="save-contact" >' +
            // '                            Save Contact' +
            '                        </div>' +
            // '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
            '                    </div>' +
            '                </div>' +
            '            </div>' +
            '        </div>';

        $("#listingContact").hide();
        document.getElementById("chat").innerHTML += content;
        $('html, body').scrollTop($(document).height());


        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() == true) {
                    console.log("uploaded");
                } else {
                    console.log("not uploded");
                }

            }
        };
        xhttp.open("POST", server + "chatUploadContact.php", true);
        var parameters = "proId=" + localStorage.getItem("PROID") + "&chatterId=" + localStorage.getItem("SINGLECHATID") + "&message=" + encodeURIComponent(message);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    } else {
        //no checked user
        console.log("ELSE");
        $("#displayListErr").html("Select at least one user to continue.");
    }
}

function saveContact(phone, name) {
    console.log(name + ":::" + phone);

    function onSuccess(contact) {
        alert("Save Success");
    }

    function onError(contactError) {
        alert("Error = " + contactError.code);
    }

    // create a new contact object
    var contact = navigator.contacts.create();
    contact.displayName = name;
    contact.nickname = name; // specify both to support all devices

    var phNumbers = [];
    phNumbers[0] = new ContactField('mobile', phone, true); // preferred number
    contact.phoneNumbers = phNumbers;

    // populate some fields
    // var name = new ContactName();
    // name.givenName = "Jane";
    // name.familyName = "Doe";
    // contact.name = name;

    // save to device
    contact.save(onSuccess, onError);
}

////////
//MAP //
////////
var lat = 0;
var lon = 0;
var marker = "";


function loadmap(mapId, la, lo) { /*console.log("2"); */
    console.log("in loadmap :: " + mapId + "::" + lat + "::" + lon);
    var mapOptions = {
        center: new google.maps.LatLng(la, lo),
        zoom: 17,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        disableDefaultUI: false,
        scrollwheel: false,
        draggable: false,
        /* maxZoom:11,*/
        minZoom: 9,
        /*zoomControl: true,
        zoomControlOptions: { 
            style: google.maps.ZoomControlStyle.SMALL,
            position: google.maps.ControlPosition.LEFT_BOTTOM
        },*/
        mapTypeControl: false,
        mapTypeControlOptions: {
            style: google.maps.MapTypeControlStyle.DEFAULT,
            position: google.maps.ControlPosition.LEFT_BOTTOM
        },

        fullscreenControl: false
            /*streetViewControl: false,
            streetViewControlOptions: {
                position: google.maps.ControlPosition.RIGHT_BOTTOM
            },*/
            /*rotateControl:true,
            rotateControlOptions:{
                position: google.maps.ControlPosition.RIGHT_BOTTOM
            }*/

    };
    /*setting map in its respective div*/
    var map = new google.maps.Map(document.getElementById(mapId), mapOptions);
    // directionsDisplay.setMap(map);
    /* directionsDisplay.setPanel(document.getElementById('right-panel')); */

    /*var acOptions = {
        types:['establishments'] //specifing the types we want to search leave it blank for all search to be available
    };*/
    /*binding google autocomplete to its div*/
    // var autocomplete = new google.maps.places.Autocomplete(document.getElementById('autocomplete'));
    // autocomplete.bindTo('bounds', map);
    /*setting marker at current loc using cordova geolocation plugin*/
    var markerOptions = {
        position: new google.maps.LatLng(la, lo),
        map: map,
        // icon:'img/icon.png',
        animation: google.maps.Animation.BOUNCE
    };
    marker = new google.maps.Marker(markerOptions);
    marker.setMap(map);
    /*setting infowindow*/
    var infoWindowOptions = { /*setting the InfoWindow*/
        content: 'Your Position'
    };
    var infoWindow = new google.maps.InfoWindow(infoWindowOptions);

    /*adding various event listeners to handle various events*/
    google.maps.event.addListener(marker, 'click', function(e) {
        infoWindow.open(map, marker);
    });

    google.maps.event.addListener(marker, 'mouseout', function(e) {
        infoWindow.close(map, marker);
    });
    /*recentering and rezooming the marker postion when autocoplete is used*/
    // google.maps.event.addListener(autocomplete, 'place_changed', function() {
    //     infoWindow.close();
    //     /*marker.setVisible(false);*/ //if required
    //     var place = autocomplete.getPlace();
    //     if (place.geometry.viewport) {
    //         map.fitBounds(place.geometry.viewport);
    //     } else {
    //         map.setCenter(place.geometry.location);
    //         map.setZoom(17);
    //     }
    //     marker.setPosition(place.geometry.location);
    //     infoWindow.setContent(place.name);
    //     /*infoWindow.open(map, marker);*/ //open when clicked

    //     google.maps.event.addListener(marker, 'click', function(e) {
    //         infoWindow.open(map, marker);
    //     });
    //     google.maps.event.addListener(marker, 'mouseout', function(e) {
    //         infoWindow.close(map, marker);
    //     });
    // });


} //google map close
/*setting interval of 30sec to check whether the google servers have responded or not*/

function currentloc() {
    var myLatlng = new google.maps.LatLng(lat, lon);
    marker.setPosition(myLatlng);
}

function getPosition() {
    var options = {
        enableHighAccuracy: true,
        timeout: 30000
    };
    var onSuccessMap = function(position) {
        lat = position.coords.latitude;
        lon = position.coords.longitude;
        console.log("Success:" + lat + ":::" + lon);
        $('.map-loader').hide();
        loadmap("preBubbleImgMap", lat, lon);
    };
    navigator.geolocation.getCurrentPosition(onSuccessMap, onErrorMap, options);

    function onErrorMap(error) {
        console.log("Error");
        console.log('code: ' + error.code + '\n' +
            'message: ' + error.message + '\n');
    }
}

function chatTakeLocation() {
    getPosition();
    loadmap("preBubbleImgMap", lat, lon);
    chatPopup("preBubbleMap");
}

function chatUploadLocation() {
    var identity = Math.floor(Math.random() * 89999 + 10000);
    mutualExclusive = true;
    var content = '<div class="row chat section">' +
        '            <div class="col-20">' +
        '            </div>' +
        '            <div class="col-80">' +
        '                <div class="msg-sent-cont">' +
        '                    <div class="row">' +
        '                        <div class="col-60">' +
        '                        </div>' +
        '                        <div class="col-40 text-right">' +
        '                            ' + formatAMPM(new Date()) + '<span><img src="img/icons/double-tick-indicator.svg" /></span>' +
        '                        </div>' +
        '                    </div>' +
        '                   <a href="http://www.google.com/maps/place/' + lat + ',' + lon + '/@' + lat + ',' + lon + ',15z">' +
        '                    <div class="msg-bubble-img" id="map' + identity + '">' +
        '                        <div class="msg-bubble-img-loader row row-center">' +
        '                        </div>' +
        '                    </div>' +
        '                   </a>' +
        '                    <div class="chat-content">' + emojione.unicodeToImage(document.getElementById("bubbleDescMap").value) + ' </div>' +
        '                </div>' +
        '            </div>' +
        '        </div>';

    //console.log(content);
    closeChatPopup();
    document.getElementById("chat").innerHTML += content;
    $('html, body').scrollTop($(document).height());
    loadmap("map" + identity, lat, lon);

    var proId = localStorage.getItem("PROID");
    var chatterId = localStorage.getItem("SINGLECHATID");
    var message = document.getElementById("bubbleDescMap").value;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            mutualExclusive = false;
        }
    };
    xhttp.open("POST", server + "chatUploadMap.php", true);
    var parameters = "proId=" + proId + "&chatterId=" + chatterId + "&desc=" + encodeURIComponent(message) + "&lat=" + lat + "&lon=" + lon;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////GROUPS  ///////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////
//ADD GROUP HTML //
///////////////////

function populateContacts(argument) {
    var data = JSON.parse(localStorage.getItem("CONTACTS"));
    var content = "";
    var count = 0;
    for (var i = 0; i < data.length; i++) {

        if (data[i].is_user) {
            if (data[i].status == 2) {
                content += '<div class="row">' +
                    '                <div class="col-20">' +
                    '                    <div class="dash-chat-img contact-person-icon"  style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                    // '                        <img src="' + server + data[i].imageURL + '">' +
                    '                    </div>' +
                    '                </div>' +
                    '                <div class="col-70 col-center" onclick="checkProfile(this)" data-system-id="' + data[i].system_id + '">' +
                    '                    <p class="contact-person-name">' + data[i].name + '</p>' +
                    '                    <p class="contact-person-num"><i class="fa fa-phone"></i> ' + data[i].phone + '</p>' +
                    '                </div>' +
                    '                <div class="col-10">' +
                    '                    <label class="checkbox">' +
                    '                        <input type="checkbox" id="chk' + (count++) + '" data-system-id="' + data[i].system_id + '">' +
                    '                        <div class="checkbox__checkmark"></div>' +
                    '                    </label>' +
                    '                </div>' +
                    '            </div>';
            }
        }
    }
    document.getElementById("contactList").innerHTML = content;
}

///////////////////////
// CREATE//ADD GROUP //
//////////////////////
var displayImageSet = false;

function takeGroupDisplayPhoto(argument) {
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "TAKE");
    console.log("get pic");
    removeGrpErr();
    navigator.camera.getPicture(takeGroupDisplayPhotoSuccess, takeGroupDisplayPhotoFail, {
        quality: 30,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI,
        sourceType: Camera.PictureSourceType.CAMERA
            // targetWidth: 200,
            // targetHeight: 200
    });
}
//success handler
function takeGroupDisplayPhotoSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    document.getElementById('grpIcon').style.backgroundImage = "url(" + imageURL + ")";
    displayImageSet = true;
    checkURL = imageURL;
    localStorage.setItem("PAGELOC", "");
}
//erroor handler
function takeGroupDisplayPhotoFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}

function getGroupDisplayPhoto() {
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "GET");
    console.log("get pic");
    removeGrpErr();
    navigator.camera.getPicture(getGroupDisplayPhotoSuccess, getGroupDisplayPhotoFail, {
        quality: 30,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI,
        sourceType: Camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
}
//success handler
function getGroupDisplayPhotoSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    try {
        document.getElementById('grpIcon').style.backgroundImage = "url(" + imageURL + ")";
    } catch (err) {
        console.log("getGroupDisplayPhotoSuccess:catch");
    }

    displayImageSet = true;
    checkURL = imageURL;
    localStorage.setItem("PAGELOC", "");
}
//erroor handler
function getGroupDisplayPhotoFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}

function groupUploadDisplayPhoto() {
    console.log("in upload image:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "groupUploadDisplayPhoto.php");
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "image/jpeg";
    options.httpMethod = 'POST';
    var params = {};
    params.grpId = localStorage.getItem("GRPID");
    params.proId = localStorage.getItem("PROID");
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        loadingOff();
        window.location.href = "groups.html";
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }

}

function removeGrpErr(argument) {
    $("#grpIcon").css("border", "none");
    $("#grpNameErr").css("border-bottom", "1px solid #63b5f6");
    $(".err-notify").html("");
}


function createGroup() {
    var count = 0;
    var flag = false;
    var members = [];
    var space = /[^\s]+/; //anything except space
    var grpName = document.getElementById("grpName").value;
    if (displayImageSet) {
        if (grpName.match(space) || grpName !== "") {
            while (document.getElementById("chk" + count) !== null) {
                console.log(document.getElementById("chk" + count).checked + ":::" + document.getElementById("chk" + count).getAttribute("data-system-id"));
                if (document.getElementById("chk" + count).checked) {
                    flag = true;
                    members.push(document.getElementById("chk" + count).getAttribute("data-system-id"));
                }
                count++;
            }
            if (flag) {
                var proId = localStorage.getItem("PROID");
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    loadingOn();
                    if (xhttp.readyState == 4 && xhttp.status == 200) {
                        console.log(xhttp.responseText.trim());
                        if (xhttp.responseText.trim() !== false) {
                            localStorage.setItem("GRPID", xhttp.responseText.trim());
                            groupUploadDisplayPhoto();
                        }

                    }
                };
                xhttp.open("POST", server + "createGroup.php", true);
                var parameters = "proId=" + proId + "&grpName=" + grpName + "&members=" + JSON.stringify(members);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send(parameters);
            } else {
                //no checked user
                $("#displayListErr").html("Select at least one user to continue.");
            }
        } else {
            //empty grp name
            $("#displayNameErr").html("Select a valid name.");
            $("#grpNameErr").css('border-bottom', '1px solid black');
        }
    } else {
        //no image selected
        $("#displayPhotoErr").html("Select a display picture.");
        $("#grpIcon").css('border', '2px solid black');
    }


}

function groupUploadDisplayPhotoPrev() {
    console.log("in upload image:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "groupUploadDisplayPhotoPrev.php");
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "image/jpeg";
    options.httpMethod = 'POST';
    var params = {};
    params.grpId = localStorage.getItem("GRPID");
    params.proId = localStorage.getItem("PROID");
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        loadingOff();
        window.location.href = "groups.html";
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }

}

function updateGroup() {
    var count = 0;
    var flag = false;
    var members = [];
    var space = /[^\s]+/; //anything except space
    var grpName = document.getElementById("grpName").value;

    if (grpName.match(space) || grpName !== "") {
        var proId = localStorage.getItem("PROID");
        var grpId = localStorage.getItem("GRPID");
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            loadingOn();
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false) {
                    if (displayImageSet) {
                        groupUploadDisplayPhotoPrev();
                    } else {
                        loadingOff();
                        window.location.href = "groups.html";
                    }
                }

            }
        };
        xhttp.open("POST", server + "updateGroup.php", true);
        var parameters = "proId=" + proId + "&grpId=" + grpId + "&grpName=" + grpName;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    } else {
        //empty grp name
        $("#displayNameErr").html("Select a valid name.");
        $("#grpNameErr").css('border-bottom', '1px solid black');
    }

}


////////////////
//GROUPS HTML //
////////////////


function openGroupHome(chatId, status) {

    console.log("openHomeGroup" + chatId);
    localStorage.setItem("GRPID", chatId);
    localStorage.setItem("GRPSTATUS", status);
    fetchGroupHomePost();
}

function openGroupChat(chatId, status) {

    console.log("openGroupChat" + chatId);
    localStorage.setItem("GRPID", chatId);
    localStorage.setItem("GRPSTATUS", status);
    window.location.href = "groupchat.html";
}

function getGroupId(chatId) {
    console.log("GroupId" + chatId);
    localStorage.setItem("GRPID", chatId);
    window.location.href = "group_posts.html";
}
var groupListData = "";

function fetchActiveGroupList(argument) {
    preLoaderOn();
    var proId = localStorage.getItem("PROID");
    var xhttp = new XMLHttpRequest();
    var data = "";
    var content = "";
    var isDeleted = "";
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log("GROUP:::" + xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                localStorage.setItem("GRPIDLIST", xhttp.responseText.trim());
                data = JSON.parse(xhttp.responseText);
                groupListData = data;
                for (var i = 0; i < data.length; i++) {
                    if (data[i].status == 0) {
                        isDeleted = "group-list-deleted";
                    } else {
                        isDeleted = "";
                    }

                    content += '<div class="row chat-cont-inner" >' +
                        '            <div class="col-20">' +
                        '                <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].photo) + ')">' +
                        // '                    <img  src="' + server + data[i].photo + '" />' +
                        '                </div>' +
                        '            </div>' +
                        '            <div class="col-60 col-center" onclick="getGroupId(\'' + data[i].id + '\')">' +
                        '                <div class="dash-chat-name ' + isDeleted + '">' + data[i].name + '</div>' +
                        '                <label class="dash-chat-desc">' + data[i].members.replace(/,\s*$/, "") + '</label>' +
                        '            </div>' +
                        '            <div class="col-20 col-center text-right" onclick="openGroupChat(\'' + data[i].id + '\',\'' + data[i].status + '\')">' +
                        '                <img src="img/icons/chat.svg" />' +
                        '            </div>' +
                        '        </div>';

                }

                document.getElementById("chatListing").innerHTML = content;
                preLoaderOff();
            } else {
                document.getElementById("blankGroup").style.display = 'block';
                preLoaderOff();
                console.log("blank group list");
            }

        }
    };
    xhttp.open("POST", server + "fetchActiveGroupList.php", true);
    var parameters = "proId=" + proId;
    // console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function groupSearch(needle) {
    document.getElementById("crossHide").style.display = 'table-cell';
    var proId = localStorage.getItem("PROID");
    var data = groupListData;
    var content = "";

    for (var i = 0; i < data.length; i++) {
        if (data[i].name.toLowerCase().indexOf(needle.value.toLowerCase()) != -1) {

            content += '<div class="row chat-cont-inner" >' +
                '            <div class="col-20">' +
                '                <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].photo) + ')">' +
                // '                    <img  src="' + server + data[i].photo + '" />' +
                '                </div>' +
                '            </div>' +
                '            <div class="col-60 col-center" onclick="getGroupId(\'' + data[i].id + '\')">' +
                '                <div class="dash-chat-name">' + data[i].name + '</div>' +
                '                <label class="dash-chat-desc">' + data[i].members + '</label>' +
                '            </div>' +
                '            <div class="col-20 col-center text-right" onclick="openGroupChat(\'' + data[i].id + '\',\'' + data[i].status + '\')">' +
                '                <img src="img/icons/chat.svg" />' +
                '            </div>' +
                '        </div>';

        }
    }

    document.getElementById("chatListing").innerHTML = content;
}

function groupClear() {

    var proId = localStorage.getItem("PROID");
    var data = groupListData;
    var content = "";

    for (var i = 0; i < data.length; i++) {

        content += '<div class="row chat-cont-inner" >' +
            '            <div class="col-20">' +
            '                <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[i].photo) + ')">' +
            // '                    <img  src="' + server + data[i].photo + '" />' +
            '                </div>' +
            '            </div>' +
            '            <div class="col-60 col-center" onclick="getGroupId(\'' + data[i].id + '\')">' +
            '                <div class="dash-chat-name">' + data[i].name + '</div>' +
            '                <label class="dash-chat-desc">' + data[i].members + '</label>' +
            '            </div>' +
            '            <div class="col-20 col-center text-right" onclick="openGroupChat(\'' + data[i].id + '\',\'' + data[i].status + '\')">' +
            '                <img src="img/icons/chat.svg" />' +
            '            </div>' +
            '        </div>';


    }

    document.getElementById("chatListing").innerHTML = content;
}

////////////////////
//GROUP CHAT HTML //
////////////////////

var prevGrpId = "";
var nextGrpId = "";
var helpOnceGrp = true;
var groupMutualExclusive = false;

function holdGroupChat(curr) {
    var id = curr.getAttribute('id');
    pressThreadTimer = window.setTimeout(function() {
        console.log("ID:" + id);
        var content = '<li class="item" onclick="deleteGroupBubble(' + id + ')">Delete</li>';
        navigator.vibrate(500);
        document.getElementById('chatActionOptions').innerHTML = content;
        document.getElementById('chatAction').style.display = 'table';
    }, 1000);
    return false;
}

function unHoldGroupChat() {
    clearTimeout(pressThreadTimer);
    return false;
}

function deleteGroupBubble(id) {
    console.log(id);
    if (confirm("Are you sure you want to remove this chat?")) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false) {
                    $("#" + id).remove();
                } else {
                    console.log("error");
                }

            }
        };
        xhttp.open("POST", server + "deleteGroupBubble.php", true);
        var parameters = "id=" + id;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }

}

function fetchHelpOnceGrp(grpId) {
    prevGrpId = 0;
    var data = JSON.parse(localStorage.getItem("GRPIDLIST")); //groups info
    for (var i = 0; i < data.length; i++) {
        if (data[i].id == grpId) {
            document.getElementById("groupName").innerHTML = data[i].name;
            document.getElementById("groupProImage").style.backgroundImage = "url(" + server + getThumb(data[i].photo) + ")";
        }

    }
    var grpStatus = localStorage.getItem("GRPSTATUS");
    var disabled = "";
    // console.log(grpStatus);
    if (grpStatus == 0) {
        document.getElementById("attachmentClip").style.visibility = 'hidden';
        document.getElementById("redirectionalLink").setAttribute("onclick", "");
        document.getElementById("messageSendingBox").style.display = 'none';
        disabled = '<div class="group-post-disabled"></div>';
    } else {
        disabled = "";
    }
    document.getElementById("chat").innerHTML = disabled;
    helpOnceGrp = false;
}

function fetchGroupChat() {
    if (!groupMutualExclusive) {


        var proId = localStorage.getItem("PROID");
        var grpId = localStorage.getItem("GRPID");
        //console.log("PID:" + proId + ":::" + "GID:" + grpId);
        if (helpOnceGrp) {
            fetchHelpOnceGrp(grpId);
        }
        var content = "";
        var data = "";
        var identity = "";
        var ll = [];
        var mm = [];

        var userData = JSON.parse(localStorage.getItem("USERINFO"));
        var imageURL = userData[0].imageURL;
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log("GROUP:::" + xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                    data = JSON.parse(xhttp.responseText.trim());
                    prevGrpId = data[0].id;
                    nextGrpId = data[data.length - 1].id;
                    for (var i = data.length - 1; i >= 0; i--) {
                        //SENDER
                        if (data[i].senderId == proId) {

                            if (data[i].type == 'text') {
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-20"></div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                            Me' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                             ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(data[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';
                            } else if (data[i].type == "contact") {

                                var contact = data[i].message.split(",");
                                console.log(contact[0] + ":::" + contact[1]);
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                            Me' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                          ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-contact">' +
                                    '                        <div class="row">' +
                                    '                            <div class="col-30 row col-center"><div class="msg-contact-pic"></div></div>' +
                                    '                            <div class="col-70">' +
                                    '                                <p class="name">' + contact[0] + '</p>' +
                                    '                                <p class="contact">' + contact[1] + '</p>' +
                                    '                            </div>' +
                                    '                        </div>' +
                                    '                        <div class="save-contact">' +
                                    // '                            Save Contact' +
                                    '                        </div>' +
                                    // '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                    </div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';



                            } else if (data[i].type == "post") {

                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-20"></div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                           Me ' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                             ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-content">' + data[i].message + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';


                            } else if (data[i].type == "map") {
                                identity = Math.floor(Math.random() * 89999 + 10000);
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                           Me ' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                            ' + formatAMPM(new Date(data[i].time)) + '<span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <a href="http://www.google.com/maps/place/' + data[i].link + '/@' + data[i].link + ',15z">' +
                                    '                    <div class="msg-bubble-img" id="map' + identity + '">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   </a>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(data[i].message) + ' </div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';
                                ll.push(data[i].link);
                                mm.push(identity);
                            }
                            /////////////
                            //RECEIVER //
                            /////////////
                        } else {

                            if (data[i].type == 'text') {
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                            ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    '                            ' + data[i].name + '' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(data[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (data[i].type == "contact") {
                                var contact1 = data[i].message.split(",");
                                console.log(contact1[0] + ":::" + contact1[1]);
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                              ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    '                            ' + data[i].name + '' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                       <div class="chat-contact">' +
                                    '                        <div class="row">' +
                                    '                            <div class="col-30 row col-center"><div class="msg-contact-pic"></div></div>' +
                                    '                            <div class="col-70">' +
                                    '                                <p class="name">' + contact1[0] + '</p>' +
                                    '                                <p class="contact">' + contact1[1] + '</p>' +
                                    '                            </div>' +
                                    '                        </div>' +
                                    '                        <div class="save-contact" onclick="groupSaveContact(\'' + contact1[0] + '\',\'' + contact1[1] + '\')">' +
                                    '                            Save Contact' +
                                    '                        </div>' +
                                    // '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                      </div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (data[i].type == 'post') {
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                            ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    '                            ' + data[i].name + '' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(data[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (data[i].type == "map") {

                                identity = Math.floor(Math.random() * 89999 + 10000);
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                            ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    '                            ' + data[i].name + '' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <a href="http://www.google.com/maps/place/' + data[i].link + '/@' + data[i].link + ',15z">' +
                                    '                    <div  class="msg-bubble-img" id="map' + identity + '">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   </a>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(data[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';
                                ll.push(data[i].link);
                                mm.push(identity);
                            }

                        }
                    }
                    document.getElementById("chat").innerHTML += content;
                    $('html, body').scrollTop($(document).height());

                    for (var z = 0; z < mm.length; z++) {
                        var nn = ll[z].split(",");
                        loadmap("map" + mm[z], nn[0], nn[1]);
                    }
                } else {
                    console.log("no result");
                }

            }
        };
        xhttp.open("POST", server + "fetchGroupChat.php", true);
        var parameters = "proId=" + proId + "&grpId=" + grpId + "&prev=" + prevGrpId;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    } //mutual exclusive closed
}

function fetchNextGroupChat() {
    if (!groupMutualExclusive) {
        newLoaderOn();
        var grpStatus = localStorage.getItem("GRPSTATUS");

        var proId = localStorage.getItem("PROID");
        var grpId = localStorage.getItem("GRPID");

        var content = "";
        var data = "";
        var identity = "";
        var ll = [];
        var mm = [];

        var userData = JSON.parse(localStorage.getItem("USERINFO"));
        var imageURL = userData[0].imageURL;
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log("GROUP:::" + xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                    data = JSON.parse(xhttp.responseText.trim());
                    nextGrpId = data[data.length - 1].id;
                    for (var i = data.length - 1; i >= 0; i--) {
                        //SENDER
                        if (data[i].senderId == proId) {

                            if (data[i].type == 'text') {
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-20"></div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                            Me' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                             ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(data[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';
                            } else if (data[i].type == "contact") {

                                var contact = data[i].message.split(",");
                                console.log(contact[0] + ":::" + contact[1]);
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                            Me' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                          ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-contact">' +
                                    '                        <div class="row">' +
                                    '                            <div class="col-30 row col-center"><div class="msg-contact-pic"></div></div>' +
                                    '                            <div class="col-70">' +
                                    '                                <p class="name">' + contact[0] + '</p>' +
                                    '                                <p class="contact">' + contact[1] + '</p>' +
                                    '                            </div>' +
                                    '                        </div>' +
                                    '                        <div class="save-contact">' +
                                    // '                            Save Contact' +
                                    '                        </div>' +
                                    // '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                    </div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';



                            } else if (data[i].type == "post") {

                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-20"></div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                           Me ' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                             ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-content">' + data[i].message + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';


                            } else if (data[i].type == "map") {
                                identity = Math.floor(Math.random() * 89999 + 10000);
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-20">' +
                                    '            </div>' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-60">' +
                                    '                           Me ' +
                                    '                        </div>' +
                                    '                        <div class="col-40 text-right">' +
                                    '                            ' + formatAMPM(new Date(data[i].time)) + '<span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <a href="http://www.google.com/maps/place/' + data[i].link + '/@' + data[i].link + ',15z">' +
                                    '                    <div class="msg-bubble-img" id="map' + identity + '">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   </a>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(data[i].message) + ' </div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '        </div>';
                                ll.push(data[i].link);
                                mm.push(identity);
                            }
                            /////////////
                            //RECEIVER //
                            /////////////
                        } else {

                            if (data[i].type == 'text') {
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                            ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    '                            ' + data[i].name + '' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(data[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (data[i].type == "contact") {
                                var contact1 = data[i].message.split(",");
                                console.log(contact1[0] + ":::" + contact1[1]);
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                              ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    '                            ' + data[i].name + '' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                       <div class="chat-contact">' +
                                    '                        <div class="row">' +
                                    '                            <div class="col-30 row col-center"><div class="msg-contact-pic"></div></div>' +
                                    '                            <div class="col-70">' +
                                    '                                <p class="name">' + contact1[0] + '</p>' +
                                    '                                <p class="contact">' + contact1[1] + '</p>' +
                                    '                            </div>' +
                                    '                        </div>' +
                                    '                        <div class="save-contact" onclick="groupSaveContact(\'' + contact1[0] + '\',\'' + contact1[1] + '\')">' +
                                    '                            Save Contact' +
                                    '                        </div>' +
                                    // '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
                                    '                      </div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (data[i].type == 'post') {
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                            ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    '                            ' + data[i].name + '' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(data[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';

                            } else if (data[i].type == "map") {

                                identity = Math.floor(Math.random() * 89999 + 10000);
                                content += '<div class="row chat section" id="' + data[i].id + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                                    '            <div class="col-80">' +
                                    '                <div class="msg-sent-cont msg-sent-cont-alt">' +
                                    '                    <div class="row">' +
                                    '                        <div class="col-40">' +
                                    '                            ' + formatAMPM(new Date(data[i].time)) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                                    '                        </div>' +
                                    '                        <div class="col-60 text-right">' +
                                    '                            ' + data[i].name + '' +
                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   <a href="http://www.google.com/maps/place/' + data[i].link + '/@' + data[i].link + ',15z">' +
                                    '                    <div  class="msg-bubble-img" id="map' + identity + '">' +
                                    '                        <div class="msg-bubble-img-loader row row-center">' +

                                    '                        </div>' +
                                    '                    </div>' +
                                    '                   </a>' +
                                    '                    <div class="chat-content">' + emojione.unicodeToImage(data[i].message) + '</div>' +
                                    '                </div>' +
                                    '            </div>' +
                                    '            <div class="col-20"></div>' +
                                    '        </div>';
                                ll.push(data[i].link);
                                mm.push(identity);
                            }

                        }
                    }
                    document.getElementById("chat").innerHTML = content + document.getElementById("chat").innerHTML;
                    newLoaderOff();
                    for (var z = 0; z < mm.length; z++) {
                        var nn = ll[z].split(",");
                        loadmap("map" + mm[z], nn[0], nn[1]);
                    }
                } else {
                    document.getElementById('loadMore').innerHTML = 'No More Chat';
                    console.log("no chat");
                    newLoaderOff();
                }

            }
        };
        xhttp.open("POST", server + "fetchNextGroupChat.php", true);
        var parameters = "proId=" + proId + "&grpId=" + grpId + "&next=" + nextGrpId;
        console.log(parameters);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    } //mutual exclusive closed
}



function sendGroupChat() {
    console.log(helpOnceGrp);
    groupMutualExclusive = true;
    document.getElementById("sendEnable").style.display = 'none';
    document.getElementById("sendDisable").style.display = 'block';
    var proId = localStorage.getItem("PROID");
    var grpId = localStorage.getItem("GRPID");
    var message = document.getElementById("chatMessage").value;
    var data = JSON.parse(localStorage.getItem("USERINFO"));
    var imageURL = data[0].imageURL;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        //mutualExclusive = true;
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                document.getElementById("chatMessage").value = "";
                if (prevGrpId !== 0) {
                    var content = '<div class="row chat section" id="' + xhttp.responseText.trim() + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
                        '            <div class="col-20"></div>' +
                        '            <div class="col-80">' +
                        '                <div class="msg-sent-cont">' +
                        '                    <div class="row">' +
                        '                        <div class="col-60">' +
                        '                            Me' +
                        '                        </div>' +
                        '                        <div class="col-40 text-right">' +
                        '                             ' + formatAMPM(new Date()) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
                        '                        </div>' +
                        '                    </div>' +
                        '                    <div class="chat-content">' + emojione.unicodeToImage(message) + '</div>' +
                        '                </div>' +
                        '            </div>' +
                        '        </div>';
                    document.getElementById("chat").innerHTML += content;
                    $('html, body').scrollTop($(document).height());
                }
                groupMutualExclusive = false;
            } else {
                console.log("error");
                groupMutualExclusive = false;
            }

        }
    };
    xhttp.open("POST", server + "sendGroupChat.php", true);
    var parameters = "proId=" + proId + "&grpId=" + grpId + "&message=" + encodeURIComponent(message);
    console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}


function groupChatUploadLocation() {
    groupMutualExclusive = true;
    var identity = Math.floor(Math.random() * 89999 + 10000);
    var content = '<div class="row chat section" id="loc' + identity + '" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
        '            <div class="col-20">' +
        '            </div>' +
        '            <div class="col-80">' +
        '                <div class="msg-sent-cont">' +
        '                    <div class="row">' +
        '                        <div class="col-60">' +
        '                            Me' +
        '                        </div>' +
        '                        <div class="col-40 text-right">' +
        '                            ' + formatAMPM(new Date()) + '<span><img src="img/icons/double-tick-indicator.svg" /></span>' +
        '                        </div>' +
        '                    </div>' +
        '                   <a href="http://www.google.com/maps/place/' + lat + "," + lon + '/@' + lat + "," + lon + ',15z">' +
        '                    <div class="msg-bubble-img" id="map' + identity + '">' +
        '                        <div class="msg-bubble-img-loader row row-center">' +
        '                        </div>' +
        '                    </div>' +
        '                   </a>' +
        '                    <div class="chat-content">' + emojione.unicodeToImage(document.getElementById("bubbleDescMap").value) + ' </div>' +
        '                </div>' +
        '            </div>' +
        '        </div>';

    //console.log(content);
    closeChatPopup();
    document.getElementById("chat").innerHTML += content;
    $('html, body').scrollTop($(document).height());
    loadmap("map" + identity, lat, lon);

    var proId = localStorage.getItem("PROID");
    var grpId = localStorage.getItem("GRPID");
    var message = document.getElementById("bubbleDescMap").value;


    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            document.getElementById("loc" + identity).setAttribute("id", xhttp.responseText.trim());
            groupMutualExclusive = true;
        }
    };
    xhttp.open("POST", server + "groupChatUploadMap.php", true);
    var parameters = "proId=" + proId + "&grpId=" + grpId + "&desc=" + encodeURIComponent(message) + "&lat=" + lat + "&lon=" + lon;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}


function groupChatTakeContact(argument) {
    var data = JSON.parse(localStorage.getItem("CONTACTS"));
    var content = "<form name='contactForm'>";
    var count = 0;
    var members = [];
    var image = "";
    for (var i = 0; i < data.length; i++) {
        // if (data[i].is_user) {
        if (data[i].imageURL === "" || data[i].imageURL === null) {
            image = "img/list/arya_stark.jpg";
        } else {
            image = server + getThumb(data[i].imageURL);
        }
        console.log("X:" + data[i].system_id);

        content += '<div class="row">' +
            '                <div class="col-20">' +
            '                    <div class="dash-chat-img contact-person-icon" style="background-image:url(' + image + ')">' +
            // '                        <img src="' + image + '">' +
            '                    </div>' +
            '                </div>' +
            '                <div class="col-70 col-center" onclick="setContactId(this)" data-system-id="' + data[i].system_id + '">' +
            '                    <p class="contact-person-name">' + data[i].name + '</p>' +
            '                    <p class="contact-person-num"><i class="fa fa-phone"></i> ' + data[i].phone + '</p>' +
            '                </div>' +
            '                <div class="col-10">' +
            '                    <label class="radio-button">' +
            "                        <input type='radio' name='contactRadio' value='" + JSON.stringify(data[i]) + "' id='rdb" + (count++) + "'>" +
            '                        <div class="radio-button__checkmark"></div>' +
            '                    </label>' +
            '                </div>' +
            '            </div>';


        // }
    }
    document.getElementById("contactList").innerHTML = content + "</form>";
    $("#listingContact").show();
}

function groupChatTakeContactSearch(needle) {

    var content = "<form name='contactForm'>";
    var count = 0;
    var members = [];
    var image = "";
    document.getElementById("contactList").innerHTML = "";
    var data = JSON.parse(localStorage.getItem("CONTACTS"));
    for (var i = 0; i < data.length; i++) {
        if (data[i].name.toLowerCase().indexOf(needle.value.toLowerCase()) != -1) {
            if (data[i].imageURL === "" || data[i].imageURL === null) {
                image = "img/list/arya_stark.jpg";
            } else {
                image = server + getThumb(data[i].imageURL);
            }
            // console.log("X:" + data[i].system_id);

            content += '<div class="row">' +
                '                <div class="col-20">' +
                '                    <div class="dash-chat-img contact-person-icon" style="background-image:url(' + image + ')">' +
                // '                        <img src="' + image + '">' +
                '                    </div>' +
                '                </div>' +
                '                <div class="col-70 col-center" onclick="setContactId(this)" data-system-id="' + data[i].system_id + '">' +
                '                    <p class="contact-person-name">' + data[i].name + '</p>' +
                '                    <p class="contact-person-num"><i class="fa fa-phone"></i> ' + data[i].phone + '</p>' +
                '                </div>' +
                '                <div class="col-10">' +
                '                    <label class="radio-button">' +
                "                        <input type='radio' name='contactRadio' value='" + JSON.stringify(data[i]) + "' id='rdb" + (count++) + "'>" +
                '                        <div class="radio-button__checkmark"></div>' +
                '                    </label>' +
                '                </div>' +
                '            </div>';
            // }
        }

    }
    document.getElementById("contactList").innerHTML = content + '</form>';
}

function groupSendContact(argument) {
    groupMutualExclusive = true;
    var count = 0;
    var flag = false;
    var contact = "";
    var content = "";
    var message = "";

    // while (document.getElementById("rdb" + count) !== null) {
    //     console.log(document.getElementById("rdb" + count).checked + ":::" + document.getElementById("rdb" + count).getAttribute("data-system-id") + ":::" + document.getElementById("rdb" + count).getAttribute("data-system-name") + ":::" + document.getElementById("rdb" + count).getAttribute("data-system-phone"));
    //     if (document.getElementById("rdb" + count).checked) {
    //         flag = true;
    //         name = document.getElementById("rdb" + count).getAttribute("data-system-name");
    //         phone = document.getElementById("rdb" + count).getAttribute("data-system-phone");
    //     }
    //     count++;
    // }
    ///////////////////////////////////////////////////////METHOD 2//////////////////////////////////////////////////////////////////////
    var d = document.forms["contactForm"]["contactRadio"].value;
    if (d === "" || d === null) {
        flag = false;
    } else {
        contact = JSON.parse(d);
        flag = true;
    }

    if (flag) {
        message = contact.phone + "," + contact.name;
        content += '<div class="row chat section" id="contTemp" onmousedown="holdGroupChat(this)" onmouseup="unHoldGroupChat()">' +
            '            <div class="col-20">' +
            '            </div>' +
            '            <div class="col-80">' +
            '                <div class="msg-sent-cont">' +
            '                    <div class="row">' +
            '                        <div class="col-60">' +
            '                        </div>' +
            '                        <div class="col-40 text-right">' +
            '                          ' + formatAMPM(new Date()) + ' <span><img src="img/icons/double-tick-indicator.svg" /></span>' +
            '                        </div>' +
            '                    </div>' +
            '                    <div class="chat-contact">' +
            '                        <div class="row">' +
            '                            <div class="col-30 row col-center"><div class="msg-contact-pic"></div></div>' +
            '                            <div class="col-70">' +
            '                                <p class="name">' + contact.name + '</p>' +
            '                                <p class="contact">' + contact.phone + '</p>' +
            '                            </div>' +
            '                        </div>' +
            '                        <div class="save-contact" >' +
            // '                            Save Contact' +
            '                        </div>' +
            // '                    <p> ' + emojione.unicodeToImage(chatData[i].message) + '</p>' +
            '                    </div>' +
            '                </div>' +
            '            </div>' +
            '        </div>';

        $("#listingContact").hide();
        document.getElementById("chat").innerHTML += content;
        $('html, body').scrollTop($(document).height());



        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim()) {
                    console.log("uploaded");
                    document.getElementById("contTemp").setAttribute("id", xhttp.responseText.trim());
                    groupMutualExclusive = false;
                } else {
                    console.log("not uploded");
                    groupMutualExclusive = false;
                }

            }
        };
        xhttp.open("POST", server + "groupChatUploadContact.php", true);
        var parameters = "proId=" + localStorage.getItem("PROID") + "&grpId=" + localStorage.getItem("GRPID") + "&message=" + encodeURIComponent(message);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    } else {
        //no checked user
        console.log("ELSE");
        $("#displayListErr").html("Select at least one user to continue.");
    }
}

function groupSaveContact(phone, name) {
    console.log(name + ":::" + phone);

    function onSuccess(contact) {
        console.log(contact);
        alert("Save Success");
    }

    function onError(contactError) {
        alert("Error = " + contactError.code);
    }

    // create a new contact object
    var contact = navigator.contacts.create();
    contact.displayName = name;
    contact.nickname = name; // specify both to support all devices

    var phNumbers = [];
    phNumbers[0] = new ContactField('mobile', phone, true); // preferred number
    contact.phoneNumbers = phNumbers;

    // populate some fields
    // var name = new ContactName();
    // name.givenName = "Jane";
    // name.familyName = "Doe";
    // contact.name = name;

    // save to device
    contact.save(onSuccess, onError);
}



////////////////////
//GROUP INFO HTML//
///////////////////
var grpNameTransfer = "";

function fetchGroupInfo(argument) {

    var proId = localStorage.getItem("PROID");
    var grpId = localStorage.getItem("GRPID");

    console.log("GRPID:::" + grpId + ":::PROID:::" + proId);
    var data = JSON.parse(localStorage.getItem("GRPIDLIST"));
    var by = "";
    for (var i = 0; i < data.length; i++) {
        if (data[i].id == grpId) {
            localStorage.setItem("CURRGRPBRIEF", JSON.stringify(data[i]));
            var url = "url(" + server + data[i].photo + ")";
            $(".user-profile-pic").css('background-image', url);
            document.getElementById("grpName").innerHTML = data[i].name;
            document.getElementById("grpCreated").innerHTML = "Created on " + sqlToJsDate(data[i].created);
            grpNameTransfer = data[i].name;
            by = data[i].by;
        }
    }
    var auth = "";
    var adminId = "";
    var xhttp = new XMLHttpRequest();
    var content = '<p class="group-members-head">Group Members</p>';
    var content1 = "";
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            localStorage.setItem("GRPMEM", xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false) {
                data1 = JSON.parse(xhttp.responseText.trim());
                //                 for (var j = 0;  j< data1.length; j++) {
                //                     // console.log(data1[i].system_id+":"+proId+":"+by);
                //                     if(data1[j].isAdmin==1){
                //                         adminId=data1[j].system_id;
                //                     }
                // }
                // user is an Admin
                if (by == proId) {
                    for (var i = 0; i < data1.length; i++) {
                        if (data1[i].system_id == by) {
                            content += '<div class="row" id="' + data1[i].system_id + '">' +
                                '                <div class="col-20">' +
                                '                    <div class="dash-chat-img contact-person-icon" style="background-image:url(' + server + getThumb(data1[i].imageURL) + ')">' +
                                // '                        <img src="' + server + data1[i].imageURL + '">' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-70 col-center" onclick="checkProfile(this)" data-system-id="' + data1[i].system_id + '">' +
                                '                    <p class="contact-person-name">' + data1[i].name + '</p>' +
                                '                    <p class="contact-person-num"><i class="fa fa-phone"></i>' + data1[i].phone + '</p>' +
                                '                </div>' +
                                '                <div class="col-10 contact-person-request col-bottom"  data-system-id="' + data1[i].system_id + '">' +
                                '                  <p>Admin</p>' +
                                '                </div>' +
                                '            </div>';
                        } else {
                            content1 += '<div class="row" id="' + data1[i].system_id + '">' +
                                '                <div class="col-20">' +
                                '                    <div class="dash-chat-img contact-person-icon" style="background-image:url(' + server + getThumb(data1[i].imageURL) + ')">' +
                                // '                        <img src="' + server + data1[i].imageURL + '">' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-70 col-center" onclick="checkProfile(this)" data-system-id="' + data1[i].system_id + '">' +
                                '                    <p class="contact-person-name">' + data1[i].name + '</p>' +
                                '                    <p class="contact-person-num"><i class="fa fa-phone"></i>' + data1[i].phone + '</p>' +
                                '                </div>' +
                                '                <div class="col-10 contact-person-request col-bottom">' +
                                '                    <i class="fa fa-trash-o"  onclick="removeFromGroup(this)" data-system-id="' + data1[i].system_id + '"></i>' +
                                '                </div>' +
                                '            </div>';
                        }
                    }
                    document.getElementById("PGRP").style.display = 'block';
                    document.getElementById("LGRP").style.display = 'none';
                    document.getElementById("DGRP").style.display = 'block';
                    document.getElementById("groupEditOption").style.display = 'block';

                } else {
                    for (var j = 0; j < data1.length; j++) {
                        if (data1[j].system_id == by) {
                            content += '<div class="row" id="' + data1[j].system_id + '">' +
                                '                <div class="col-20">' +
                                '                    <div class="dash-chat-img contact-person-icon" style="background-image:url(' + server + getThumb(data1[j].imageURL) + ')">' +
                                // '                        <img src="' + server + data1[i].imageURL + '">' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-70 col-center" onclick="checkProfile(this)" data-system-id="' + data1[j].system_id + '">' +
                                '                    <p class="contact-person-name">' + data1[j].name + '</p>' +
                                '                    <p class="contact-person-num"><i class="fa fa-phone"></i>' + data1[j].phone + '</p>' +
                                '                </div>' +
                                '                <div class="col-10 contact-person-request col-bottom"  data-system-id="' + data1[j].system_id + '">' +
                                '                  <p>Admin</p>' +
                                '                </div>' +
                                '            </div>';
                        } else {
                            content1 += '<div class="row" id="' + data1[j].system_id + '">' +
                                '                <div class="col-20">' +
                                '                    <div class="dash-chat-img contact-person-icon" style="background-image:url(' + server + getThumb(data1[j].imageURL) + ')">' +
                                // '                        <img src="' + server + data1[i].imageURL + '">' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-70 col-center" onclick="checkProfile(this)" data-system-id="' + data1[j].system_id + '">' +
                                '                    <p class="contact-person-name">' + data1[j].name + '</p>' +
                                '                    <p class="contact-person-num"><i class="fa fa-phone"></i>' + data1[j].phone + '</p>' +
                                '                </div>' +
                                '                <div class="col-10 contact-person-request col-bottom">' +
                                '                </div>' +
                                '            </div>';
                        }
                    }
                    document.getElementById("PGRP").style.display = 'none';
                    document.getElementById("LGRP").style.display = 'block';
                    document.getElementById("DGRP").style.display = 'none';
                    document.getElementById("groupEditOption").style.display = 'none';
                }

                document.getElementById("membersList").innerHTML = content + content1;
            } else {
                console.log("error");
            }

        }
    };
    xhttp.open("POST", server + "fetchGroupInfo.php", true);
    var parameters = "proId=" + proId + "&grpId=" + grpId;
    // console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);

}

function extractGroupInfo() {
    console.log(localStorage.getItem("CURRGRPBRIEF"));
    var data = JSON.parse(localStorage.getItem("CURRGRPBRIEF"));
    var url = "url(" + server + data.photo + ")";
    $("#grpIcon").css('background-image', url);
    document.getElementById("grpName").value = data.name;
    localStorage.setItem("GRPID", data.id);
}

/////////////////////
//Group Management //
/////////////////////


function addParticipant(argument) {
    var count = 0;
    var flag = false;
    var members = [];
    var proId = localStorage.getItem("PROID");
    var grpId = localStorage.getItem("GRPID");
    while (document.getElementById("chk" + count) != null) {
        console.log(document.getElementById("chk" + count).checked + ":::" + document.getElementById("chk" + count).getAttribute("data-system-id"));
        if (document.getElementById("chk" + count).checked) {
            flag = true;
            members.push(document.getElementById("chk" + count).getAttribute("data-system-id"));
        }
        count++;
    }
    if (flag) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            loadingOn();
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false) {
                    location.reload();
                }

            }
        };
        xhttp.open("POST", server + "addParticipant.php", true);
        var parameters = "grpId=" + grpId + "&grpName=" + encodeURIComponent(grpNameTransfer) + "&proId=" + proId + "&members=" + JSON.stringify(members);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    } else {
        //no checked user
        console.log("ELSE");
        $("#displayListErr").html("Select at least one user to continue.");
    }
}


function removeFromGroup(arg) {
    //console.log(arg.getAttribute("data-system-id"));
    var grpId = localStorage.getItem("GRPID");
    var grpMem = JSON.parse(localStorage.getItem("GRPMEM"));
    var uId = arg.getAttribute("data-system-id");
    var response = confirm("Are You Sure You Want To Remove User?");
    if (response) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false) {
                    for (var i = 0; i < grpMem.length; i++) {
                        console.log(grpMem[i].system_id);
                        if (grpMem[i].system_id == uId) {
                            grpMem.splice(i);
                            //delete json[key];
                            localStorage.setItem("GRPMEM", JSON.stringify(grpMem));
                            document.getElementById(uId).style.display = 'none';
                        }
                    }

                } else {
                    console.log("Not Removed");
                }

            }
        };
        xhttp.open("POST", server + "removeFromGroup.php", true);
        var parameters = "grpId=" + grpId + "&uId=" + uId;
        console.log(parameters);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);

    }
}

function participantList(argument) {
    var data = JSON.parse(localStorage.getItem("CONTACTS"));
    var data1 = JSON.parse(localStorage.getItem("GRPMEM"));
    var content = "";
    var count = 0;
    var members = [];
    for (var j = 0; j < data1.length; j++) {
        console.log(data1[j].system_id);
        members.push(data1[j].system_id);
    }

    for (var i = 0; i < data.length; i++) {
        if (data[i].is_user) {
            console.log("X:" + data[i].system_id);
            if (data[i].status == 2) {
                if (members.indexOf(data[i].system_id) == -1) {
                    content += '<div class="row">' +
                        '                <div class="col-20">' +
                        '                    <div class="dash-chat-img contact-person-icon" style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                        // '                        <img src="' + server + data[i].imageURL + '">' +
                        '                    </div>' +
                        '                </div>' +
                        '                <div class="col-70 col-center" onclick="checkProfile(this)" data-system-id="' + data[i].system_id + '">' +
                        '                    <p class="contact-person-name">' + data[i].name + '</p>' +
                        '                    <p class="contact-person-num"><i class="fa fa-phone"></i> ' + data[i].phone + '</p>' +
                        '                </div>' +
                        '                <div class="col-10">' +
                        '                    <label class="checkbox">' +
                        '                        <input type="checkbox" id="chk' + (count++) + '" data-system-id="' + data[i].system_id + '">' +
                        '                        <div class="checkbox__checkmark"></div>' +
                        '                    </label>' +
                        '                </div>' +
                        '            </div>';
                }
            }
        }
    }
    document.getElementById("contactList").innerHTML = content;
    $(".dash-search").show();
}


function leaveGroup(argument) {
    var grpId = localStorage.getItem("GRPID");
    var proId = localStorage.getItem("PROID");

    var response = confirm("Are You Sure You Want To Leave Group?");
    if (response) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim()) {
                    document.getElementById(proId).style.display = 'none';
                    location.href = "groups.html";
                } else {
                    console.log("Not Removed");
                }

            }
        };
        xhttp.open("POST", server + "leaveGroup.php", true);
        var parameters = "grpId=" + grpId + "&proId=" + proId;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
}

function deleteGroup(argument) {
    var grpId = localStorage.getItem("GRPID");
    var proId = localStorage.getItem("PROID");
    console.log("grpId:" + grpId + "::: proId:" + proId);
    var response = confirm("Are You Sure You Want To Delete This Group?");
    if (response) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim()) {
                    location.href = "groups.html";
                } else {
                    console.log("Not Removed");
                }

            }
        };
        xhttp.open("POST", server + "deleteGroup.php", true);
        var parameters = "grpId=" + grpId + "&proId=" + proId;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
}

////////////////
//Group POSTS //
//////////////////

function fetchGroupPost() {


    var grpId = localStorage.getItem("GRPID");
    var content = "";
    var content1 = "";
    var data = "";
    var disabled = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                data = JSON.parse(xhttp.responseText.trim());
                document.getElementById("proPic").style.backgroundImage = "url(" + server + getThumb(data[0].imageURL) + ")";
                document.getElementById("proName").innerHTML = data[0].name;
                grpStatus = data[0].status;
                if (grpStatus == 0) {
                    document.getElementById("redirectionalLink").setAttribute("onclick", "");
                    document.getElementById("postSendingBox").style.display = 'none';
                    disabled = '<div class="group-post-disabled"></div>';
                } else {
                    disabled = "";
                }

                for (var i = 0; i < data[0].detail.length; i++) {

                    if (data[0].detail[i].type == "photo") {

                        content += '<div class="post-container">' +
                            '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                            '<div class="col-15 post-pro-pic col-center">' +
                            '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                            // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-60">' +
                            '<p>' + data[0].detail[i].postedByName + '</p>' +
                            '</div>' +
                            '<div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '</div>' +
                            '</div>' +
                            '<div class="post-desc" >' + //comment_screen
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '</div>' +
                            '<div class="post-pic" >' +
                            '<img src="' + server + getThumb(data[0].detail[i].URL) + '" />' +
                            '</div>' +
                            '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                            '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';

                    } else if (data[0].detail[i].type == "text") {

                        content += '<div class="post-container">' +
                            '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //\'friend_profile.html\'
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                            // '                       <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc" >' + // \'comment_screen.html\'
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-comment" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + '0' + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')">' +
                            '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                            '</div>' +
                            '            </div>';

                    } else if (data[0].detail[i].type == "video") {

                        content += '<div class="post-container">' +
                            '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                            // '                        <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc" >' +
                            (data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-video">' +
                            '                <video controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                            '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                            '                </video>' +
                            '            </div>' +
                            '           <div class="row post-comment">' +
                            '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '            </div>';



                    } else if (data[0].detail[i].type == "audio") {
                        content += '<div class="post-container">' +
                            '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')" >' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                            // '                        <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc">' +
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-video">' +
                            '                <audio controls preload="auto">' +
                            '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                            '                </audio>' +
                            '            </div>' +
                            '      <div class="row post-comment">' +
                            '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '        </div>';

                    } else if (data[0].detail[i].type == "file") {

                        var holder = "";
                        var path = data[0].detail[i].URL;
                        var ext = path.substr(path.lastIndexOf('.') + 1);
                        var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                        for (var x in extName) {
                            if (x == ext) {
                                console.log("File is: " + x);
                                holder = 'img/attach_icons/' + extName[x];
                            }
                        }

                        content += '<div class="post-container">' +
                            '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                            '<div class="col-15 post-pro-pic col-center">' +
                            '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                            // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-60">' +
                            '<p>' + data[0].detail[i].postedByName + '</p>' +
                            '</div>' +
                            '<div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '</div>' +
                            '</div>' +
                            '<div class="post-desc" >' + //comment_screen
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '</div>' +
                            '<div class="post-pic" >' +
                            '<img src="' + holder + '" />' +
                            '</div>' +
                            '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                            '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';

                    } else if (data[0].detail[i].type == "shared") {
                        var innerContent = "";
                        var folder = "";
                        var innerData = JSON.parse(data[0].detail[i].desc);
                        var innerJson = data[0].detail[i].desc.replace(/"/g, "~");
                        console.log("innerJson:" + innerJson);
                        if (data[0].detail[i].format == "photo") {
                            folder = "images";
                            innerContent = '<div class="shared-post">' +
                                '                            <div class="row post-head">' +
                                '                                <div class="col-15 post-pro-pic col-center">' +
                                '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                '                                </div>' +
                                '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                '                            </div>' +
                                '                            ' +
                                '                            <div class="post-desc" >' +
                                '                               ' + innerData.desc + '' +
                                '                            </div>' +
                                '                         ' +
                                '                            <div class="post-pic">' +
                                '                              <img src="' + server + getThumb(innerData.title) + '" />' +
                                '                            </div>' +
                                '                        </div>';


                        } else if (data[0].detail[i].format == "text") {
                            folder = "text";
                            innerContent = '<div class="shared-post">' +
                                '                            <div class="row post-head">' +
                                '                                <div class="col-15 post-pro-pic col-center">' +
                                '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                '                                </div>' +
                                '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                '                            </div>' +
                                '                            ' +
                                '                            <div class="post-desc" >' +
                                '                               ' + innerData.desc + '' +
                                '                            </div>' +
                                '                         ' +
                                '                        </div>';


                        } else if (data[0].detail[i].format == "video") {
                            folder = "videos";
                            innerContent = '<div class="shared-post">' +
                                '                            <div class="row post-head">' +
                                '                                <div class="col-15 post-pro-pic col-center">' +
                                '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                '                                </div>' +
                                '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                '                            </div>' +
                                '                            ' +
                                '                            <div class="post-desc" >' +
                                '                               ' + innerData.desc + '' +
                                '                            </div>' +
                                '                         ' +
                                '                            <div class="post-video">' +
                                '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + innerData.title + '" type="video/mp4">' +
                                '                </video>' +
                                '                            </div>' +
                                '                        </div>';


                        } else if (data[0].detail[i].format == "audio") {
                            folder = "audios";
                            innerContent = '<div class="shared-post">' +
                                '                            <div class="row post-head">' +
                                '                                <div class="col-15 post-pro-pic col-center">' +
                                '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                '                                </div>' +
                                '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                '                            </div>' +
                                '                            ' +
                                '                            <div class="post-desc" >' +
                                '                               ' + innerData.desc + '' +
                                '                            </div>' +
                                '                         ' +
                                '                            <div class="post-video">' +
                                '                <audio controls preload="auto">' +
                                '                    <source src="' + server + innerData.title + '" type="audio/wav">' +
                                '                </audio>' +
                                '                            </div>' +
                                '                        </div>';



                        } else if (data[0].detail[i].format == "file") {
                            folder = "files";
                            var holder1 = "";
                            var path1 = innerData.title;
                            var ext1 = path1.substr(path1.lastIndexOf('.') + 1);
                            var extName1 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x1 in extName1) {
                                if (x1 == ext1) {
                                    console.log("File is: " + x1);
                                    holder1 = 'img/attach_icons/' + extName1[x1];
                                }
                            }
                            innerContent = '<div class="shared-post">' +
                                '                            <div class="row post-head">' +
                                '                                <div class="col-15 post-pro-pic col-center">' +
                                '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                '                                </div>' +
                                '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                '                            </div>' +
                                '                            ' +
                                '                            <div class="post-desc" >' +
                                '                               ' + innerData.desc + '' +
                                '                            </div>' +
                                '                         ' +
                                '                            <div class="post-pic">' +
                                '                              <img src="' + holder1 + '" />' +
                                '                            </div>' +
                                '                        </div>';

                        }

                        content += '<div class="post-container">' +
                            '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                            '<div class="col-15 post-pro-pic col-center">' +
                            '<div class="dash-chat-img" style="background-image:url(' + server + data[0].detail[i].postedByImageURL + ')">' +
                            // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-60">' +
                            '<p>' + data[0].detail[i].postedByName + '<span class="post-shared-user"> shared</span>' + '</p>' +
                            '</div>' +
                            '<div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '</div>' +
                            '</div>' +
                            '' + innerContent + '' +
                            '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                            '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + innerJson + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/' + folder + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';
                    }
                }
                document.getElementById('postList').innerHTML = disabled + content;
                $("img").on('error', function() {
                    $(this).attr("src", "img/pictures/notFound.png");
                });
                setTimeout(function() {
                    $("video,audio").on('click', function() {
                        if (this.paused) {
                            this.play();
                        } else {
                            this.pause();
                        }
                        if (this.getAttribute('controls') !== 'true') {
                            this.setAttribute('controls', 'true');
                        }
                        this.setAttribute('controls', 'true');
                    });
                }, 2000);
                document.getElementById("cardLoader").style.display = 'none';
                //console.log(content);
            } else {
                console.log("Not Removed");
            }

        }
    };
    xhttp.open("POST", server + "fetchGroupPost.php", true);
    var parameters = "grpId=" + grpId;
    console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);

}
var offsetGroupPost = 0;

function toggleLoaderGroupPost(arg) {
    newLoaderOn();
    offsetGroupPost += 10;
    fetchNextGroupPost(offsetGroupPost);
}

function fetchNextGroupPost(offset) {
    var grpId = localStorage.getItem("GRPID");
    var content = "";
    var content1 = "";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                data = JSON.parse(xhttp.responseText.trim());
                if (data[0].length !== 0) {
                    for (var i = 0; i < data[0].detail.length; i++) {

                        if (data[0].detail[i].type == "photo") {

                            content += '<div class="post-container">' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].detail[i].postedByName + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + server + getThumb(data[0].detail[i].URL) + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +

                                '</div>' +
                                '</div>';

                        } else if (data[0].detail[i].type == "text") {

                            content += '<div class="post-container">' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //\'friend_profile.html\'
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '                       <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' + // \'comment_screen.html\'
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-comment" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + '0' + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')">' +
                                '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                                '</div>' +
                                '            </div>';

                        } else if (data[0].detail[i].type == "video") {

                            content += '<div class="post-container">' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '                        <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                (data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <video controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                                '                </video>' +
                                '            </div>' +
                                '           <div class="row post-comment">' +
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +

                                '            </div>';



                        } else if (data[0].detail[i].type == "audio") {
                            content += '<div class="post-container">' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')" >' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '                        <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc">' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <audio controls preload="auto">' +
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                                '                </audio>' +
                                '            </div>' +
                                '      <div class="row post-comment">' +
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +

                                '</div>' +
                                '        </div>';

                        } else if (data[0].detail[i].type == "file") {

                            var holder = "";
                            var path = data[0].detail[i].URL;
                            var ext = path.substr(path.lastIndexOf('.') + 1);
                            var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x in extName) {
                                if (x == ext) {
                                    console.log("File is: " + x);
                                    holder = 'img/attach_icons/' + extName[x];
                                }
                            }

                            content += '<div class="post-container">' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].detail[i].postedByName + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + holder + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +

                                '</div>' +
                                '</div>';

                        } else if (data[0].detail[i].type == "shared") {
                            var innerContent = "";
                            var folder = "";
                            var innerData = JSON.parse(data[0].detail[i].desc);
                            var innerJson = data[0].detail[i].desc.replace(/"/g, "~");
                            console.log("innerJson:" + innerJson);
                            if (data[0].detail[i].format == "photo") {
                                folder = "images";
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                            <div class="post-pic">' +
                                    '                              <img src="' + server + getThumb(innerData.title) + '" />' +
                                    '                            </div>' +
                                    '                        </div>';


                            } else if (data[0].detail[i].format == "text") {
                                folder = "text";
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                        </div>';


                            } else if (data[0].detail[i].format == "video") {
                                folder = "videos";
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                            <div class="post-video">' +
                                    '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                    '                    <source src="' + server + innerData.title + '" type="video/mp4">' +
                                    '                </video>' +
                                    '                            </div>' +
                                    '                        </div>';


                            } else if (data[0].detail[i].format == "audio") {
                                folder = "audios";
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                            <div class="post-video">' +
                                    '                <audio controls preload="auto">' +
                                    '                    <source src="' + server + innerData.title + '" type="audio/wav">' +
                                    '                </audio>' +
                                    '                            </div>' +
                                    '                        </div>';



                            } else if (data[0].detail[i].format == "file") {
                                folder = "files";
                                var holder1 = "";
                                var path1 = innerData.title;
                                var ext1 = path1.substr(path1.lastIndexOf('.') + 1);
                                var extName1 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                                for (var x1 in extName1) {
                                    if (x1 == ext1) {
                                        console.log("File is: " + x1);
                                        holder1 = 'img/attach_icons/' + extName1[x1];
                                    }
                                }
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                            <div class="post-pic">' +
                                    '                              <img src="' + holder1 + '" />' +
                                    '                            </div>' +
                                    '                        </div>';

                            }

                            content += '<div class="post-container">' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].detail[i].postedByName + '<span class="post-shared-user"> shared</span>' + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '' + innerContent + '' +
                                '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + innerJson + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/' + folder + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';
                        }
                    }
                    document.getElementById('postList').innerHTML += content;
                    $("img").on('error', function() {
                        $(this).attr("src", "img/pictures/notFound.png");
                    });
                    setTimeout(function() {
                        $("video,audio").on('click', function() {
                            if (this.paused) {
                                this.play();
                            } else {
                                this.pause();
                            }
                            if (this.getAttribute('controls') !== 'true') {
                                this.setAttribute('controls', 'true');
                            }
                            this.setAttribute('controls', 'true');
                        });
                    }, 2000);
                    newLoaderOff();
                } else {
                    document.getElementById('loadMore').innerHTML = "<p>No More Posts</p>";
                    newLoaderOff();
                }
            } else {
                console.log("Not Removed");
            }

        }
    };
    xhttp.open("POST", server + "fetchNextGroupPost.php", true);
    var parameters = "grpId=" + grpId + "&offset=" + offset;
    console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}



function setGroupId(gId) {
    window.localStorage.setItem("GRPID", gId);
    window.location.href = "group_posts.html";

}

function setGroupPostId(id, type, genId, imageURL, userName, time, desc, title, count, posterId, posterName) {
    //console.log(id+":"+type+":"+genId+":"+imageURL+":"+userName+":"+time+":"+desc+":"+title+":"+count);
    var data = '{"id":"' + id + '",' + '"type":"' + type + '",' + '"genId":"' + genId + '",' + '"imageURL":"' + imageURL + '",' + '"userName":"' + userName + '",' + '"time":"' + time + '",' + '"desc":"' + desc + '",' + '"title":"' + title + '",' + '"count":"' + count + '",' + '"posterId":"' + posterId + '",' + '"posterName":"' + posterName + '"}';
    console.log(data);
    localStorage.setItem("GRPPOSTDETAIL", data);
    // localStorage.setItem("HOMEPOSTID",pId);
    window.location.href = "group_comment_screen.html";
}


////////////////////
// GROUP COMMENTS //
////////////////////
var mutualExclusive3 = false;

function fetchGroupComments() {
    if (!mutualExclusive3) {
        console.log(localStorage.getItem("GRPPOSTDETAIL"));
        var data = JSON.parse(localStorage.getItem("GRPPOSTDETAIL"));
        var postId = data.id; // group post id
        var content = "";
        if (data.type == "photo") {

            content += '<div class="row post-head">' + //friend_profile
                '<div class="col-15 post-pro-pic col-center">' +
                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '<img src="' + server + data.imageURL + '" />' +
                '</div>' +
                '</div>' +
                '<div class="col-60">' +
                '<p><span onclick="setGroupId(\'' + data.genId + '\')">' + data.userName + '</span> ' + '<' + ' <span  onclick="setGeneratorId(\'' + data.posterId + '\')">' + data.posterName + '</span>' + '</p>' +
                '</div>' +
                '<div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '</div>' +
                '</div>' +
                '<div class="post-desc" >' + //comment_screen
                emojione.unicodeToImage(data.desc) +
                '</div>' +
                '<div class="post-pic" >' +
                '<img src="' + server + getThumb(data.title) + '" />' +
                '</div>' +
                '<div class="row post-comment">' +
                '<div class="col-50"><i class="fa fa-comment"></i> ' + data.count + ' comments</div>' +
                '<div class="col-50 text-right"><i ></i></div>' +
                '</div>';
        } else if (data.type == "text") {

            content += '<div class="row post-head" >' + //\'friend_profile.html\'
                '                <div class="col-15 post-pro-pic col-center">' +
                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '                       <img src="' + server + data.imageURL + '" />' +
                '                    </div>' +
                '                </div>' +
                '                <div class="col-60">' +
                '<p><span onclick="setGroupId(\'' + data.genId + '\')">' + data.userName + '</span> ' + '<' + ' <span  onclick="setGeneratorId(\'' + data.posterId + '\')">' + data.posterName + '</span>' + '</p>' +
                '                </div>' +
                '                <div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '                </div>' +
                '            </div>' +
                '            <div class="post-desc" >' + // \'comment_screen.html\'
                emojione.unicodeToImage(data.desc) +
                '            </div>' +
                '            <div class="post-comment" >' +
                '                <i class="fa fa-comment"></i> ' + data.count + ' comments' +
                '            </div>';

        } else if (data.type == "video") {

            content += '<div class="row post-head" >' +
                '                <div class="col-15 post-pro-pic col-center">' +
                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '                        <img src="' + server + data.imageURL + '" />' +
                '                    </div>' +
                '                </div>' +
                '                <div class="col-60">' +
                '<p><span onclick="setGroupId(\'' + data.genId + '\')">' + data.userName + '</span> ' + '<' + ' <span  onclick="setGeneratorId(\'' + data.posterId + '\')">' + data.posterName + '</span>' + '</p>' +
                '                </div>' +
                '                <div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '                </div>' +
                '            </div>' +
                '            <div class="post-desc" >' +
                emojione.unicodeToImage(data.desc) +
                '            </div>' +
                '            <div class="post-video">' +
                '                <video controls  preload="auto"  loop >' + //poster="img/icons/video-gallery.svg"
                '                    <source src="' + server + data.title + '" type="video/mp4">' +
                '                </video>' +
                '            </div>' +
                '            <div class="post-comment" >' +
                '                <i class="fa fa-comment"></i> ' + data.count + ' comments' +
                '            </div>' +
                '        </div>';



        } else if (data.type == "audio") {
            content += '<div class="row post-head">' +
                '                <div class="col-15 post-pro-pic col-center">' +
                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '                        <img src="' + server + data.imageURL + '" />' +
                '                    </div>' +
                '                </div>' +
                '                <div class="col-60">' +
                '<p><span onclick="setGroupId(\'' + data.genId + '\')">' + data.userName + '</span> ' + '<' + ' <span  onclick="setGeneratorId(\'' + data.posterId + '\')">' + data.posterName + '</span>' + '</p>' +
                '                </div>' +
                '                <div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '                </div>' +
                '            </div>' +
                '            <div class="post-desc">' +
                emojione.unicodeToImage(data.desc) +
                '            </div>' +
                '            <div class="post-video">' +
                '                <audio controls preload="auto">' +
                '                    <source src="' + server + data.title + '" type="audio/wav">' +
                '                </audio>' +
                '            </div>' +
                '            <div class="post-comment" >' +
                '                <i class="fa fa-comment"></i> ' + data.count + ' comments' +
                '            </div>' +
                '        </div>';

        } else if (data.type == "file") {
            var holder = "";
            var path = data.title;
            var ext = path.substr(path.lastIndexOf('.') + 1);
            var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
            for (var x in extName) {
                if (x == ext) {
                    console.log("File is: " + x);
                    holder = 'img/attach_icons/' + extName[x];
                }
            }

            content += '<div class="row post-head">' + //friend_profile
                '<div class="col-15 post-pro-pic col-center">' +
                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '<img src="' + server + data.imageURL + '" />' +
                '</div>' +
                '</div>' +
                '<div class="col-60">' +
                '<p><span onclick="setGroupId(\'' + data.genId + '\')">' + data.userName + '</span> ' + '<' + ' <span  onclick="setGeneratorId(\'' + data.posterId + '\')">' + data.posterName + '</span>' + '</p>' +
                '</div>' +
                '<div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '</div>' +
                '</div>' +
                '<div class="post-desc" >' + //comment_screen
                emojione.unicodeToImage(data.desc) +
                '</div>' +
                '<div class="post-pic" >' +
                '<img src="' + holder + '" />' +
                '</div>' +
                '<div class="row post-comment">' +
                '<div class="col-50"><i class="fa fa-comment"></i> ' + data.count + ' comments</div>' +
                '<div class="col-50 text-right"><i ></i></div>' +
                '</div>';
        } else if (data.type == "shared") {

            var innerContent = "";
            var folder = "";
            var innerJson = data.desc.replace(/~/g, '"');
            var innerData = JSON.parse(innerJson);
            if (innerData.type == "photo") {
                innerContent = '<div class="shared-post">' +
                    '                            <div class="row post-head">' +
                    '                                <div class="col-15 post-pro-pic col-center">' +
                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    '                                </div>' +
                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    '                            </div>' +
                    '                            ' +
                    '                            <div class="post-desc" >' +
                    '                               ' + innerData.desc + '' +
                    '                            </div>' +
                    '                         ' +
                    '                            <div class="post-pic">' +
                    '                              <img src="' + server + getThumb(innerData.title) + '" />' +
                    '                            </div>' +
                    '                        </div>';


            } else if (innerData.type == "text") {
                innerContent = '<div class="shared-post">' +
                    '                            <div class="row post-head">' +
                    '                                <div class="col-15 post-pro-pic col-center">' +
                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    '                                </div>' +
                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    '                            </div>' +
                    '                            ' +
                    '                            <div class="post-desc" >' +
                    '                               ' + innerData.desc + '' +
                    '                            </div>' +
                    '                         ' +
                    '                        </div>';


            } else if (innerData.type == "video") {
                innerContent = '<div class="shared-post">' +
                    '                            <div class="row post-head">' +
                    '                                <div class="col-15 post-pro-pic col-center">' +
                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    '                                </div>' +
                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    '                            </div>' +
                    '                            ' +
                    '                            <div class="post-desc" >' +
                    '                               ' + innerData.desc + '' +
                    '                            </div>' +
                    '                         ' +
                    '                            <div class="post-video">' +
                    '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                    '                    <source src="' + server + innerData.title + '" type="video/mp4">' +
                    '                </video>' +
                    '                            </div>' +
                    '                        </div>';


            } else if (innerData.type == "audio") {
                innerContent = '<div class="shared-post">' +
                    '                            <div class="row post-head">' +
                    '                                <div class="col-15 post-pro-pic col-center">' +
                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    '                                </div>' +
                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    '                            </div>' +
                    '                            ' +
                    '                            <div class="post-desc" >' +
                    '                               ' + innerData.desc + '' +
                    '                            </div>' +
                    '                         ' +
                    '                            <div class="post-video">' +
                    '                <audio controls preload="auto">' +
                    '                    <source src="' + server + innerData.title + '" type="audio/wav">' +
                    '                </audio>' +
                    '                            </div>' +
                    '                        </div>';



            } else if (innerData.type == "file") {
                var holder1 = "";
                var path1 = innerData.title;
                var ext1 = path1.substr(path1.lastIndexOf('.') + 1);
                var extName1 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                for (var x1 in extName1) {
                    if (x1 == ext1) {
                        console.log("File is: " + x1);
                        holder1 = 'img/attach_icons/' + extName1[x1];
                    }
                }
                innerContent = '<div class="shared-post">' +
                    '                            <div class="row post-head">' +
                    '                                <div class="col-15 post-pro-pic col-center">' +
                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                    '                                </div>' +
                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                    '                            </div>' +
                    '                            ' +
                    '                            <div class="post-desc" >' +
                    '                               ' + innerData.desc + '' +
                    '                            </div>' +
                    '                         ' +
                    '                            <div class="post-pic">' +
                    '                              <img src="' + holder1 + '" />' +
                    '                            </div>' +
                    '                        </div>';

            }
            content += '<div class="row post-head">' + //friend_profile
                '<div class="col-15 post-pro-pic col-center">' +
                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '<img src="' + server + data.imageURL + '" />' +
                '</div>' +
                '</div>' +
                '<div class="col-60">' +
                '<p><span onclick="setGroupId(\'' + data.genId + '\')">' + data.userName + '</span> ' + '<' + ' <span  onclick="setGeneratorId(\'' + data.posterId + '\')">' + data.posterName + '</span>' + '</p>' +
                '</div>' +
                '<div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '</div>' +
                '</div>' +
                '' + innerContent + '' +
                '<div class="row post-comment">' +
                '<div class="col-50"><i class="fa fa-comment"></i> ' + data.count + ' comments</div>' +
                '<div class="col-50 text-right"><i ></i></div>' +
                '</div>';

        }

        // document.getElementById("commentFocus").innerHTML = content;

        var content1 = "";
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                    var commentData = JSON.parse(xhttp.responseText);
                    for (var i = commentData.length - 1; i >= 0; i--) {

                        content1 += '<div class="row post-head" onclick="setGeneratorId(\'' + commentData[i].userId + '\')">' +
                            '            <div class="col-15 post-pro-pic col-center">' +
                            '                <div class="dash-chat-img" style="background-image:url(' + server + getThumb(commentData[i].imageURL) + ')">' +
                            // '                    <img src="' + server + commentData[i].imageURL + '" />' +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="col-60">' +
                            '                <p>' + commentData[i].name + '</p>' +
                            '                <p class="comment">' + commentData[i].comment + '</p>' +
                            '            </div>' +
                            '            <div class="col-25 post-time">' +
                            '                ' + formatAMPM(new Date(commentData[i].time)) + '' +
                            '            </div>' +
                            '        </div>';


                    }
                    document.getElementById("commentFocus").innerHTML = content + content1;
                    var ht = "<i class='fa fa-comment'></i> " + commentData[0].count + " comments";
                    localStorage.setItem("GROUPCOMMENTCOUNT", postId + "," + commentData[0].count);
                    //console.log(commentData[0].count+":::"+ht);
                    $(".post-comment").html(ht);
                    $('html, body').scrollTop($(document).height());
                } else {
                    document.getElementById("commentFocus").innerHTML = content;
                }
            }
        };
        xhttp.open("POST", server + "fetchGroupComments.php", true);
        var parameters = "postId=" + postId;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
}

// function sendCommentStatus(curr) {
//     var space = /[^\s]+/; //anything except space
//     if (curr.value.match(space)) {
//         document.getElementById("sendDisable").style.display = 'none';
//         document.getElementById("sendEnable").style.display = 'block';
//     } else {
//         document.getElementById("sendEnable").style.display = 'none';
//         document.getElementById("sendDisable").style.display = 'block';
//     }
// }


function sendGroupComment() {

    document.getElementById("sendEnable").style.display = 'none';
    document.getElementById("sendDisable").style.display = 'block';
    var proId = localStorage.getItem("PROID"); //to be checked later to be commented at as celebrity or user who created the profile
    var data = JSON.parse(localStorage.getItem("GRPPOSTDETAIL"));
    var postId = data.id;
    var message = document.getElementById("commentMessage").value;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            mutualExclusive3 = true;
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                document.getElementById("commentMessage").value = "";
                mutualExclusive3 = false;
                fetchGroupComments();
            } else {
                console.log("error");
                mutualExclusive3 = false;
            }

        }
    };
    xhttp.open("POST", server + "sendGroupComment.php", true);
    var parameters = "proId=" + proId + "&postId=" + postId + "&message=" + encodeURIComponent(message);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}


//////////////////////////////////////
//GROUP POST UPLOAD  ////////////////
//////////////////////////////////////

///////////////
// Text Post //
///////////////
function uploadGroupText(arg) {

    var proText = document.getElementById("proText").value;
    console.log("UGT:::" + proText);
    if (proText !== "") {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim()) {
                    closePopup();
                    if (arg == "home") {
                        fetchGroupHomePostPrevious();
                    } else {
                        fetchGroupPost(); //to be changed later    
                    }

                    removeJunk();
                }
            }
        };
        xhttp.open("POST", server + "uploadGroupText.php", true);
        var parameters = "proText=" + proText + "&grpId=" + localStorage.getItem("GRPID") + "&proId=" + localStorage.getItem("PROID");
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
        console.log(parameters);
    } else {
        console.log("Status Not Updated.");
    }

}
////////////////
// Video Post //
////////////////
function postGroupTakeVideo(argument) {
    // capture callback
    var captureSuccess = function(mediaFiles) {
        var i, path, len;
        for (i = 0, len = mediaFiles.length; i < len; i += 1) {
            path = mediaFiles[i].fullPath;
            // do something interesting with the file
            checkURL = path;
            document.getElementById("videoImage").src = path;
            popupVideo();
        }
    };

    // capture error callback
    var captureError = function(error) {
        navigator.notification.console.log('Error code: ' + error.code, null, 'Capture Error');
    };

    // start video capture
    navigator.device.capture.captureVideo(captureSuccess, captureError, { limit: 1, quality: 0 });
}

function postGroupGetVideo(argument) {
    console.log("get vid");
    navigator.camera.getPicture(onSuccess, onFail, {
        quality: 50,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: navigator.camera.DestinationType.FILE_URI,
        mediaType: navigator.camera.MediaType.VIDEO,
        sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
    //success handler
    function onSuccess(imageURL) {
        checkURL = imageURL;
        document.getElementById("videoImage").src = imageURL;
        closepopupplain1();
        popupVideo();

    }
    //erroor handler
    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}


function uploadGroupVideo(arg) {
    console.log("in upload video:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "uploadGroupVideo.php?grpId=" + localStorage.getItem("GRPID") + "&proId=" + localStorage.getItem("PROID") + "&desc=" + document.getElementById("videoDesc").value);
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "video/3gpp";
    options.httpMethod = 'POST';
    var params = {};
    params.grpId = localStorage.getItem("GRPID");
    params.proId = localStorage.getItem("PROID");
    params.desc = document.getElementById("videoDesc").value;
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.onprogress = function(progressEvent) {
        $(".myBar").css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $(".myBar").css("width", perc + "%");
        } else {
            if (progressStatus.innerHTML === "") {
                $(".myBar").css("width", "0%");
            } else {
                $(".myBar").css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        document.getElementById("videoDesc").value = "";
        closePopup();
        if (arg == "home") {
            fetchGroupHomePostPrevious();
        } else {
            fetchGroupPost(); //to be changed later    
        }
        setTimeout(function() {
            $("video").on('click', function() {
                if (this.paused) {
                    this.play();
                } else {
                    this.pause();
                }
                if (this.getAttribute('controls') !== 'true') {
                    this.setAttribute('controls', 'true');
                }
                this.setAttribute('controls', 'true');
            });
        }, 2000);
        removeJunk();
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }
}


////////////////
// Audio Post //
////////////////

function postGroupTakeAudio(argument) {
    // capture callback
    pendingAudio = true;
    var captureSuccess = function(mediaFiles) {
        var i, path, len;
        for (i = 0, len = mediaFiles.length; i < len; i += 1) {
            path = mediaFiles[i].fullPath;
            // do something interesting with the file
            checkURL = path;
            document.getElementById("audioImage").src = checkURL;
            popupAudio();
        }
    };

    // capture error callback
    var captureError = function(error) {
        alert("Sorry! Your phone dosen't support this functionality.");
        console.log('Error code: ' + error, null, 'Capture Error');
    };

    // start audio capture
    navigator.device.capture.captureAudio(captureSuccess, captureError, { limit: 1 });
}

function postGroupGetAudio(argument) {
    navigator.camera.getPicture(onSuccess, onFail, {
        quality: 100,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: navigator.camera.DestinationType.FILE_URI,
        mediaType: navigator.camera.MediaType.ALLMEDIA,
        sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
    //success handler
    function onSuccess(imageURL) {
        //console.log(imageURL);
        checkURL = imageURL;
        var format = imageURL.split(".")[1];
        if (format == "wav" || format == "amr" || format == "mp3") {
            document.getElementById("audioImage").src = imageURL;
            popupAudio();
        } else {
            alert("Audio File Format Not Supported.");
        }
        closepopupplain2();
    }
    //erroor handler
    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}

function uploadGroupAudio(arg) {
    pendingAudio = false;
    console.log("in upload audio:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "uploadGroupAudio.php");
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "audio/wav";
    options.httpMethod = 'POST';
    var params = {};
    params.grpId = localStorage.getItem("GRPID");
    params.proId = localStorage.getItem("PROID");
    params.desc = document.getElementById("audioDesc").value;
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.onprogress = function(progressEvent) {
        $(".myBar").css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $(".myBar").css("width", perc + "%");
        } else {
            if (progressStatus.innerHTML === "") {
                $(".myBar").css("width", "0%");
            } else {
                $(".myBar").css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        document.getElementById("audioDesc").value = "";
        closePopup();
        if (arg == "home") {
            fetchGroupHomePostPrevious();
        } else {
            fetchGroupPost(); //to be changed later    
        }
        setTimeout(function() {
            $("audio").on('click', function() {
                if (this.paused) {
                    this.play();
                } else {
                    this.pause();
                }
                if (this.getAttribute('controls') !== 'true') {
                    this.setAttribute('controls', 'true');
                }
                this.setAttribute('controls', 'true');
            });
        }, 2000);
        removeJunk();
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }
}



////////////////
// Photo Post //
////////////////

function postGroupTakePhoto(argument) {
    console.log("get pic");
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "TAKE");
    navigator.camera.getPicture(postGroupTakePhotoSuccess, postGroupTakePhotoFail, {
        quality: 60,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI,
        sourceType: Camera.PictureSourceType.CAMERA
            // targetWidth: 200,
            // targetHeight: 200
    });
}
//success handler
function postGroupTakePhotoSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    checkURL = imageURL;
    document.getElementById("photoImage").style.backgroundImage = "url(" + imageURL + ")";
    closepopupplain();
    popupPhoto();
    localStorage.setItem("PAGELOC", "");
}
//erroor handler
function postGroupTakePhotoFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}

function postGroupGetPhoto(argument) {
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "GET");
    console.log("get pic");
    navigator.camera.getPicture(postGroupGetPhotoSuccess, postGroupGetPhotoFail, {
        quality: 60,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI,
        sourceType: Camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
}
//success handler
function postGroupGetPhotoSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    checkURL = imageURL;
    document.getElementById("photoImage").style.backgroundImage = "url(" + imageURL + ")";
    closepopupplain();
    popupPhoto();
    localStorage.setItem("PAGELOC", "");
}
//erroor handler
function postGroupGetPhotoFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}

function uploadGroupPhoto(arg) {
    //console.log("in upload image:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "uploadGroupPhoto.php");
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "image/jpeg";
    options.httpMethod = 'POST';
    var params = {};
    params.grpId = localStorage.getItem("GRPID");
    params.proId = localStorage.getItem("PROID");
    params.desc = document.getElementById("photoDesc").value;
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.onprogress = function(progressEvent) {
        $(".myBar").css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $(".myBar").css("width", perc + "%");
        } else {
            if (progressStatus.innerHTML === "") {
                $(".myBar").css("width", "0%");
            } else {
                $(".myBar").css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        document.getElementById("photoDesc").value = "";
        closePopup();
        if (arg == "home") {
            fetchGroupHomePostPrevious();
        } else {
            fetchGroupPost(); //to be changed later    
        }
        removeJunk();
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }
}


function postGroupGetFile(argument) {
    console.log("get file");
    navigator.camera.getPicture(onSuccess, onFail, {
        quality: 50,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: navigator.camera.DestinationType.FILE_URI,
        mediaType: navigator.camera.MediaType.ALLMEDIA,
        sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
    //success handler
    function onSuccess(imageURL) {
        checkURL = imageURL;
        var support = false;
        var ext = checkURL.substr(checkURL.lastIndexOf('.') + 1);
        var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
        for (var x in extName) {
            if (x == ext) {
                console.log("File: " + x);
                support = true;
                document.getElementById("fileImage").style.backgroundImage = 'url(img/attach_icons/' + extName[x] + ')';
                popupFile();
            }
        }
        if (!support) {
            alert("Sorry, File Not Supported.");
        }

    }
    //erroor handler
    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}


function uploadGroupFile(arg) {
    console.log("in upload group file:" + checkURL);
    var ext = checkURL.substr(checkURL.lastIndexOf('.') + 1);
    console.log("extenstion:" + ext);
    var extName = JSON.parse('{"pdf":"application/pdf" , "txt":"text/plain" , "doc":"application/msword" , "docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document" , "ppt":"application/vnd.ms-powerpointtd>" , "pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation" , "xls":"application/vnd.ms-excel" , "xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}');
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var present = false;
    var mmt = "";
    for (var x in extName) {
        if (x == ext) {
            console.log("File: " + x);
            present = true;
            mmt = extName[x];
        }
    }

    if (!present) {
        alert("File Not Supported.");
    } else {
        console.log(mmt);
        var uri = encodeURI(server + "uploadGroupFile.php?proId=" + localStorage.getItem("PROID") + "&desc=" + document.getElementById("fileDesc").value + "&ext=" + ext);
        var options = new FileUploadOptions();
        options.fileKey = "file"; //fileUploadKey
        options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
        options.mimeType = mmt;
        options.httpMethod = 'POST';
        var params = {};
        params.grpId = localStorage.getItem("GRPID");
        params.proId = localStorage.getItem("PROID");
        params.desc = document.getElementById("fileDesc").value;
        params.ext = ext;
        options.params = params;
        options.chunkedMode = false;
        var headers = {
            'headerParam': 'headerValue'
        };
        options.headers = headers;

        var ft = new FileTransfer();

        ft.onprogress = function(progressEvent) {
            $(".myBar").css("width", '0%');
            if (progressEvent.lengthComputable) {
                var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
                $(".myBar").css("width", perc + "%");
            } else {
                if (progressStatus.innerHTML === "") {
                    $(".myBar").css("width", "0%");
                } else {
                    $(".myBar").css("width", "100%");
                }
            }
        };

        ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
        //success handler
        function onSucc(r) {
            console.log("Code = " + r.responseCode);
            console.log("Response = " + r.response);
            console.log("Sent = " + r.bytesSent);
            console.log(r.response);
            document.getElementById("fileDesc").value = "";

            closePopup();
            if (arg == "home") {
                fetchGroupHomePostPrevious();
            } else {
                fetchGroupPost(); //to be changed later    
            }
            removeJunk();
            /*if (r.response == 'The file has been uploaded.') {*/
            //console.log("Uploaded");

            //window.location.href = "home.html";
            /*}*/
        }
        //error handler
        function onErr(error) {
            console.log("An error has occurred: Code = " + error.code);
            console.log("upload error source " + error.source);
            console.log("upload error target " + error.target);
            console.log("Failure");
        }
    }
}


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////CELEBRITY PROFILE HTML ///////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function createCelebProfile() {
    // console.log(document.getElementById("proCategory").value=="0");
    //console.log(localStorage.getItem("PROID"));
    if (checkBox) {
        $("#privacyErr").html("Please Agree To Proceed.");
    } else {
        var nameReg = /^[a-z ,.'-]+$/i;
        var emailReg = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        var proCategory = document.getElementById("proCategory").value;
        var proName = document.getElementById("proName").value;
        var proFName = proName.split(" ")[0];
        var proLName = (proName.split(" ").length > 1) ? proName.split(" ")[1] : '';
        var proEmail = document.getElementById("proEmail").value;
        var proGender = "";
        if (proCategory == 'Celebrity') {
            proGender = document.getElementById("proGender").value;
            if(proGender=="0"){
                $("#proGender").css("border-bottom", "2px solid #000");
                $("#genderErr").html("Please Select Your Gender");
            }
        } else {
            proGender = "";
        }
        console.log(proGender);
        var proStatus = document.getElementById("proStatus").value;
        //console.log(proStatus=="");
        if (coverPicUpdated) {
            if (proPicUpdated) {
                if (proCategory != "0") {
                    if (proName.match(nameReg)) {
                        if (proEmail.match(emailReg)) {
                            if (proStatus != " " && proStatus !== "") {
                                var xhttp = new XMLHttpRequest();
                                xhttp.onreadystatechange = function() {
                                    loadingOnC();
                                    if (xhttp.readyState == 4 && xhttp.status == 200) {
                                        console.log(xhttp.responseText.trim());
                                        if (xhttp.responseText.trim() !== false) {
                                            celebDisplayImageUpload(xhttp.responseText.trim());

                                        }
                                    }
                                };
                                xhttp.open("POST", server + "createCelebProfile.php", true);
                                var parameters = "proCategory=" + proCategory + "&proFName=" + proFName + "&proLName=" + proLName + "&proEmail=" + proEmail + "&proGender=" + proGender + "&proStatus=" + proStatus + "&proId=" + localStorage.getItem("PROID");
                                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                                console.log(parameters);
                                xhttp.send(parameters);
                            } else {
                                $("#proStatus").css("border-bottom", "2px solid #000");
                                $("#statusErr").html("Invalid Status");
                            }

                        } else {
                            $("#proEmail").css("border-bottom", "2px solid #000");
                            $("#emailErr").html("Invalid Email");
                        }
                    } else {
                        $("#proName").css("border-bottom", "2px solid #000");
                        $("#nameErr").html("Invalid Name");
                    }
                } else {
                    $("#proCategory").css("border-bottom", "2px solid #000");
                    $("#catErr").html("Invalid Category");
                }
            } else {
                $("#proPic").css("border", "2px solid #000");
                $("#picErr").html("Select a display picture.");
            }
        } else {
            $("#picErr").html("Select a cover picture.");
        }
    }
}

function takePicture() {
    console.log("Take Pic");
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "TAKE");
    localStorage.setItem("CELEBPICTYPE", "DP");
    navigator.camera.getPicture(takePictureSuccess, takePictureFail, {
        quality: 30,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI, //FILE_URI is better than FILE_DATA
        sourceType: Camera.PictureSourceType.CAMERA
            // targetWidth: 200, //need to specify if getting thumbnails else leave blank
            // targetHeight: 200
    });

}
//success handler
function takePictureSuccess(imageURL) {
    console.log("CAMERA SUCC");
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    document.getElementById('proPic').style.backgroundImage = "url(" + imageURL + ")";
    //for DATA_URI we use ----- image.src = "data:image/jpeg;base64," + imageData;
    //for FILE_URI we directly assign the path
    checkURL = imageURL;
    fileURL = imageURL;
    proPicUpdated = true;
    cleanup();
    localStorage.setItem("PAGELOC", "");
}
// failure handler
function takePictureFail(message) {
    console.log("CAMERA FAIL");
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}


//plugin function to retrive photo from PHOTOLIBRARY
function getPicture() {
    console.log("get pic");
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "GET");
    localStorage.setItem("CELEBPICTYPE", "DP");
    navigator.camera.getPicture(getPictureSuccess, getPictureFail, {
        quality: 30,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI,
        sourceType: Camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });

}
//success handler
function getPictureSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    //console.log("UP:"+checkURLC+":::"+imageURL);
    document.getElementById('proPic').style.backgroundImage = "url(" + imageURL + ")";
    checkURL = imageURL;
    fileURL = imageURL;
    proPicUpdated = true;
    localStorage.setItem("PAGELOC", "");
}
//erroor handler
function getPictureFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}


//plugin function to upload the file on the server
function celebDisplayImageUpload(celId) {
    console.log("in upload file:" + checkURL + ":::" + celId);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "celebDisplayImageUpload.php");
    //console.log(uri);
    var options = new FileUploadOptions();

    options.fileKey = "fileUploadKey";
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "image/jpeg";
    options.httpMethod = 'POST';
    var params = {};
    params.celId = celId;
    //params.value2 = "param";
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        celebDisplayImageUploadCover(celId);
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
        loadingOffC();
    }
}

function takePictureC() {
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "TAKE");
    localStorage.setItem("CELEBPICTYPE", "COVER");
    navigator.camera.getPicture(takePictureCSuccess, takePictureCFail, {
        quality: 30,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.DATA_URL, //FILE_URI is better than FILE_DATA
        sourceType: Camera.PictureSourceType.CAMERA
            // targetWidth: 200, //need to specify if getting thumbnails else leave blank
            // targetHeight: 200
    });

}
//success handler
function takePictureCSuccess(imageURLCover) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURLCover; //3
    document.getElementById('coverProPic').style.backgroundImage = "url(" + 'data:image/jpeg;base64,' + imageURLCover + ")";
    //for DATA_URI we use ----- image.src = "data:image/jpeg;base64," + imageData;
    //for FILE_URI we directly assign the path
    checkURLC = imageURLCover;
    coverPicUpdated = true;
    cleanup();
    localStorage.setItem("PAGELOC", "");
}
// failure handler
function takePictureCFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}


//plugin function to retrive photo from PHOTOLIBRARY
function getPictureC() {
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "GET");
    localStorage.setItem("CELEBPICTYPE", "COVER");
    navigator.camera.getPicture(getPictureCSuccess, getPictureCFail, {
        quality: 30,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.DATA_URL,
        sourceType: Camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
}
//success handler
function getPictureCSuccess(imageURLCover) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURLCover; //3
    document.getElementById('coverProPic').style.backgroundImage = "url(" + 'data:image/jpeg;base64,' + imageURLCover + ")";
    checkURLC = imageURLCover;
    coverPicUpdated = true;
    localStorage.setItem("PAGELOC", "");
}
//erroor handler
function getPictureCFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}


function celebDisplayImageUploadCover(celId) {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            //copyTextToClipboard(server+);
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() != false) {
                // localStorage.setItem("CID",celId); //done in check status
                // 
                localStorage.setItem("CELEBAPPLIED", 1);
                window.location.href = "celeb_pending.html";
            }
        }
    };
    xhttp.open("POST", server + "celebDisplayImageUploadCover.php", true);
    var parameters = "celId=" + celId + "&screen=" + checkURLC;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
    // console.log("in upload file:" + checkURLC + ":::" + celId);
    // // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    // var uri = encodeURI(server+"celebDisplayImageUploadCover.php");
    // //console.log(uri);
    // var options = new FileUploadOptions();

    // options.fileKey = "fileUploadKey";
    // options.fileName = checkURLC.substr(checkURLC.lastIndexOf('/') + 1);
    // options.mimeType = "image/jpeg";
    // options.httpMethod = 'POST';
    // var params = {};
    // params.celId = celId;
    // //params.value2 = "param";
    // options.params = params;
    // options.chunkedMode = false;
    // var headers = {
    //     'headerParam': 'headerValue'
    // };
    // options.headers = headers;

    // var ft = new FileTransfer();

    // ft.upload(checkURLC, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    // //success handler
    // function onSucc(r) {
    //     console.log("Code = " + r.responseCode);
    //     console.log("Response = " + r.response);
    //     console.log("Sent = " + r.bytesSent);
    //     console.log(r.response);
    //     loadingOffC();
    //     /*if (r.response == 'The file has been uploaded.') {*/
    //     //console.log("Uploaded");

    //     window.location.href = "celeb_posts.html";
    //     /*}*/
    // }
    // //error handler
    // function onErr(error) {
    //     console.log("An error has occurred: Code = " + error.code);
    //     console.log("upload error source " + error.source);
    //     console.log("upload error target " + error.target);
    //     console.log("Failure");
    //     loadingOffC();
    // }
}

////////////////
//SOCIAL HTML //
////////////////
var socialSearchData = "";

function fetchCelebrityList(argument) {
    console.log("FETCH LIST");
    preLoaderOn();
    var content = "";
    var data = "";
    var followList = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim().length);
            if (xhttp.responseText.trim().length != false && xhttp.responseText.trim() != "") {
                data = JSON.parse(xhttp.responseText.trim());
                socialSearchData = data;
                for (var i = 0; i < data.length; i++) {
                    if (data[i].applied == localStorage.getItem("PROID")) {
                        document.getElementById("statusButton").style.display = 'none';
                        localStorage.setItem("CELEBSTATUS", "1");
                    }
                    if (localStorage.getItem("CELEBAPPLIED") == 1) {
                        document.getElementById("celebStatus").style.display = 'block';
                        if (localStorage.getItem("CELEBSTATUS") == 1) {
                            document.getElementById("celebStatus").setAttribute("onclick", "location.href = 'celeb_posts.html'");
                        } else {
                            document.getElementById("celebStatus").setAttribute("onclick", "location.href = 'celeb_pending.html'");
                        }
                    } else {
                        document.getElementById("celebStatus").style.display = 'none';
                    }
                    if (data[i].is_follower) {
                        followList = ' <div class="col-30 col-center"> ' +
                            '   <div class="celeb-follow-btn follow-active">' +
                            '       Following ' +
                            '   </div>' +
                            '       </div>';
                    } else {

                        followList = '<div class="col-30 col-center"  onclick="follow(\'' + data[i].id + '\')">' +
                            '            <div class="celeb-follow-btn" id="cel' + data[i].id + '" >' +
                            '              <span>+ </span> Follow' +
                            '        </div>';
                    }
                    content += '<div class="celeb-pro-list">' +
                        '            <div class="row">' +
                        '                <div class="col-70" onclick="gotoCeleb(\'' + data[i].id + '\')">' +
                        '                    <div class="row">' +
                        '                        <div class="col-20 celeb-pro-pic-base">' +
                        '                            <div class="celeb-pro-pic">' +
                        '                                <div class="celeb-pro-pic-cont" style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                        // '                                    <img src="' +  + '" />' +
                        '                                </div>' +
                        '                            </div>' +
                        '                        </div>' +
                        '                        <div class="col-80">' +
                        '                            <div class="celeb-pro-desc">' +
                        '                                <h3>' + data[i].name + '</h3>' +
                        '                                <p>' + data[i].quote + '</p>' +
                        '                            </div>' +
                        '                        </div>' +
                        '                    </div>' +
                        '' +
                        '                </div>' +
                        '  ' + followList + ' ' +
                        '                </div>' +
                        '            </div>' +
                        '        </div>';


                }
                document.getElementById("celebList").innerHTML = content;
                preLoaderOff();
            } else {
                console.log("No Celebrity");
                document.getElementById("blankCelebList").style.display = "block";
                preLoaderOff();
            }
        }

    };
    xhttp.open("POST", server + "fetchCelebrityList.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);

}

function socialSearch(needle) {
    document.getElementById("crossHide").style.display = 'table-cell';
    var content = "";
    var followList = "";
    var data = socialSearchData;
    for (var i = 0; i < data.length; i++) {
        if (data[i].name.toLowerCase().indexOf(needle.value.toLowerCase()) != -1) {

            if (data[i].is_follower) {
                followList = ' <div class="col-30 col-center"> ' +
                    '   <div class="celeb-follow-btn follow-active">' +
                    '       Following ' +
                    '   </div>' +
                    '       </div>';
            } else {

                followList = '<div class="col-30 col-center"  onclick="follow(\'' + data[i].id + '\')">' +
                    '            <div class="celeb-follow-btn" id="cel' + data[i].id + '" >' +
                    '              <span>+ </span> Follow' +
                    '        </div>';
            }
            content += '<div class="celeb-pro-list">' +
                '            <div class="row">' +
                '                <div class="col-70" onclick="gotoCeleb(\'' + data[i].id + '\')">' +
                '                    <div class="row">' +
                '                        <div class="col-20 celeb-pro-pic-base">' +
                '                            <div class="celeb-pro-pic">' +
                '                                <div class="celeb-pro-pic-cont" style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
                // '                                    <img src="' +  + '" />' +
                '                                </div>' +
                '                            </div>' +
                '                        </div>' +
                '                        <div class="col-80">' +
                '                            <div class="celeb-pro-desc">' +
                '                                <h3>' + data[i].name + '</h3>' +
                '                                <p>' + data[i].quote + '</p>' +
                '                            </div>' +
                '                        </div>' +
                '                    </div>' +
                '' +
                '                </div>' +
                '  ' + followList + ' ' +
                '                </div>' +
                '            </div>' +
                '        </div>';

        }
    }
    document.getElementById("celebList").innerHTML = content;
}

function socialClear() {
    document.getElementById("search-input").value = "";
    var content = "";
    var followList = "";
    var data = socialSearchData;
    for (var i = 0; i < data.length; i++) {

        if (data[i].is_follower) {
            followList = ' <div class="col-30 col-center"> ' +
                '   <div class="celeb-follow-btn follow-active">' +
                '       Following ' +
                '   </div>' +
                '       </div>';
        } else {

            followList = '<div class="col-30 col-center"  onclick="follow(\'' + data[i].id + '\')">' +
                '            <div class="celeb-follow-btn" id="cel' + data[i].id + '" >' +
                '              <span>+ </span> Follow' +
                '        </div>';
        }
        content += '<div class="celeb-pro-list">' +
            '            <div class="row">' +
            '                <div class="col-70" onclick="gotoCeleb(\'' + data[i].id + '\')">' +
            '                    <div class="row">' +
            '                        <div class="col-20 celeb-pro-pic-base">' +
            '                            <div class="celeb-pro-pic">' +
            '                                <div class="celeb-pro-pic-cont" style="background-image:url(' + server + getThumb(data[i].imageURL) + ')">' +
            // '                                    <img src="' +  + '" />' +
            '                                </div>' +
            '                            </div>' +
            '                        </div>' +
            '                        <div class="col-80">' +
            '                            <div class="celeb-pro-desc">' +
            '                                <h3>' + data[i].name + '</h3>' +
            '                                <p>' + data[i].quote + '</p>' +
            '                            </div>' +
            '                        </div>' +
            '                    </div>' +
            '' +
            '                </div>' +
            '  ' + followList + ' ' +
            '                </div>' +
            '            </div>' +
            '        </div>';

    }
    document.getElementById("celebList").innerHTML = content;
}
///////////
//FOLLOW //
///////////
function follow(id) {
    if (confirm("Do You Want To Follow?")) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim()) {
                    $('#cel' + id).addClass('follow-active');
                    $('#cel' + id).html("Following");
                    localStorage.setItem("LATESTFOLLOWCELEB", 1);
                } else {

                }
            }
        };
        xhttp.open("POST", server + "followCelebrity.php", true);
        var parameters = "cId=" + id + "&proId=" + localStorage.getItem("PROID");
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
}

function followIn(id) {
    // console.log(id);
    if (confirm("Do You Want To Follow?")) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim()) {
                    document.getElementById("isFollower").innerHTML = "Unfollow";
                    document.getElementById("followCount").innerHTML = parseInt(document.getElementById("followCount").innerHTML) + 1;
                    document.getElementById("isFollower").setAttribute("onclick", "followOut('" + id + "')");
                    localStorage.setItem("LATESTFOLLOWCELEB", 1);
                } else {

                }
            }
        };
        xhttp.open("POST", server + "followCelebrity.php", true);
        var parameters = "cId=" + id + "&proId=" + localStorage.getItem("PROID");
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
}

function followOut(id) {
    // console.log(id);
    if (confirm("Do You Want To Unfollow?")) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim()) {
                    document.getElementById("isFollower").innerHTML = "Follow";
                    document.getElementById("followCount").innerHTML = parseInt(document.getElementById("followCount").innerHTML) - 1;
                    document.getElementById("isFollower").setAttribute("onclick", "followIn('" + id + "')");
                    localStorage.setItem("LATESTFOLLOWCELEB", 1);
                } else {

                }
            }
        };
        xhttp.open("POST", server + "unfollowCelebrity.php", true);
        var parameters = "cId=" + id + "&proId=" + localStorage.getItem("PROID");
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
}


function gotoCeleb(id) {
    //console.log(id);
    window.localStorage.setItem("CELID", id);
    window.location.href = "celeb_profile.html";
}

function preLoaderOn(argument) {
    document.getElementById('preLoader').style.display = 'table';
}

function preLoaderOff(argument) {
    document.getElementById('preLoader').style.display = 'none';
}

///////////////////////
//CELEB PROFILE HTML //
///////////////////////
function fetchCelebrityDetail() {
    preLoaderOn();
    var celId = localStorage.getItem("CELID");
    var content = "";
    var content1 = "";
    var data = "";
    var isFollower = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false) {

                data = JSON.parse(xhttp.responseText.trim());
                document.getElementById("coverPic").style.backgroundImage = "url(" + server + data[0].imageURLCover + ")";
                document.getElementById("proPic").style.backgroundImage = "url(" + server + getThumb(data[0].imageURL) + ")";
                document.getElementById("proName").innerHTML = data[0].name;
                // document.getElementById("proGenderEmail").innerHTML = data[0].gender + ", " + data[0].email;
                document.getElementById("followCount").innerHTML = data[0].followerCount;
                document.getElementById("proQuote").innerHTML = data[0].quote;
                if (data[0].is_follower) {
                    document.getElementById("isFollower").innerHTML = "Unfollow";
                    document.getElementById("isFollower").setAttribute("onclick", "followOut(\"" + data[0].id + "\")");
                } else {
                    document.getElementById("isFollower").innerHTML = "Follow";
                    document.getElementById("isFollower").setAttribute("onclick", "followIn(\"" + data[0].id + "\")");
                }
                for (var i = 0; i < data[0].detail.length; i++) {

                    if (data[0].detail[i].type == "photo") {

                        content += '<div class="post-container">' +
                            '<div class="row post-head" >' + //friend_profile
                            '<div class="col-15 post-pro-pic col-center">' +
                            '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                            // '<img src="' + server + data[0].imageURL + '" />' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-60">' +
                            '<p>' + data[0].name + '</p>' +
                            '</div>' +
                            '<div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '</div>' +
                            '</div>' +
                            '<div class="post-desc" >' + //comment_screen
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '</div>' +
                            '<div class="post-pic" >' +
                            '<img src="' + server + getThumb(data[0].detail[i].URL) + '" />' +
                            '</div>' +
                            '<div class="row post-comment">' +
                            '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';

                    } else if (data[0].detail[i].type == "text") {

                        content += '<div class="post-container">' +
                            '<div class="row post-head" >' + //\'friend_profile.html\'
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                            // '                       <img src="' + server + data[0].imageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].name + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc" >' + // \'comment_screen.html\'
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-comment" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + "0" + '\',\'' + data[0].detail[i].commentCount + '\')">' +
                            '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                            '</div>' +
                            '            </div>';

                    } else if (data[0].detail[i].type == "video") {

                        content += '<div class="post-container">' +
                            '<div class="row post-head" >' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                            // '                        <img src="' + server + data[0].imageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].name + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc" >' +
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-video">' +
                            '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                            '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                            '                </video>' +
                            '            </div>' +
                            '           <div class="row post-comment">' +
                            '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '            </div>';



                    } else if (data[0].detail[i].type == "audio") {
                        content += '<div class="post-container">' +
                            '<div class="row post-head" >' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                            // '                        <img src="' + server + data[0].imageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].name + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc">' +
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-video">' +
                            '                <audio controls preload="auto">' +
                            '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                            '                </audio>' +
                            '            </div>' +
                            '      <div class="row post-comment">' +
                            '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '        </div>';

                    } else if (data[0].detail[i].type == "file") {
                        var holder = "";
                        var path = data[0].detail[i].URL;
                        var ext = path.substr(path.lastIndexOf('.') + 1);
                        var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                        for (var x in extName) {
                            if (x == ext) {
                                console.log("File is: " + x);
                                holder = 'img/attach_icons/' + extName[x];
                            }
                        }
                        content += '<div class="post-container">' +
                            '<div class="row post-head" >' + //friend_profile
                            '<div class="col-15 post-pro-pic col-center">' +
                            '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                            // '<img src="' + server + data[0].imageURL + '" />' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-60">' +
                            '<p>' + data[0].name + '</p>' +
                            '</div>' +
                            '<div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '</div>' +
                            '</div>' +
                            '<div class="post-desc" >' + //comment_screen
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '</div>' +
                            '<div class="post-pic" >' +
                            '<img src="' + holder + '" />' +
                            '</div>' +
                            '<div class="row post-comment">' +
                            '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';

                    }
                }
                document.getElementById('postList').innerHTML = content;

                $("img").on('error', function() {
                    $(this).attr("src", "img/pictures/notFound.png");
                });
                setTimeout(function() {
                    $("video,audio").on('click', function() {
                        if (this.paused) {
                            this.play();
                        } else {
                            this.pause();
                        }
                        if (this.getAttribute('controls') !== 'true') {
                            this.setAttribute('controls', 'true');
                        }
                        this.setAttribute('controls', 'true');
                    });
                }, 2000);
                preLoaderOff();
            } else {
                console.log("Not Removed");
                preLoaderOff();
            }

        }
    };
    xhttp.open("POST", server + "fetchCelebrityDetail.php", true);
    var parameters = "celId=" + celId + "&proId=" + localStorage.getItem("PROID");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);

    //onclick="playFullScreen(\''+data[0].detail[i].pId+'\')"
}


var offset = 0;

function toggleLoader(arg) {
    document.getElementById("loadMore").style.display = 'none';
    document.getElementById("proLoader").style.display = 'block';
    offset += 10;
    fetchNextCelebrityDetail(offset);
}


function fetchNextCelebrityDetail(offset) {
    //console.log(offset);
    var celId = localStorage.getItem("CELID");
    var content = "";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            if (xhttp.responseText.trim() !== false) {
                data = JSON.parse(xhttp.responseText.trim());
                if (data[0].length !== 0) {
                    for (var i = 0; i < data[0].detail.length; i++) {

                        if (data[0].detail[i].type == "photo") {

                            content += '<div class="post-container">' +
                                '<div class="row post-head" >' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                                // '<img src="' + server + data[0].imageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].name + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + server + getThumb(data[0].detail[i].URL) + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[0].detail[i].type == "text") {

                            content += '<div class="post-container">' +
                                '<div class="row post-head" >' + //\'friend_profile.html\'
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                                // '                       <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' + // \'comment_screen.html\'
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-comment" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + "0" + '\',\'' + data[0].detail[i].commentCount + '\')">' +
                                '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                                '</div>' +
                                '            </div>';

                        } else if (data[0].detail[i].type == "video") {

                            content += '<div class="post-container">' +
                                '<div class="row post-head" >' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                                // '                        <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <video controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                                '                </video>' +
                                '            </div>' +
                                '           <div class="row post-comment">' +
                                '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '            </div>';



                        } else if (data[0].detail[i].type == "audio") {
                            content += '<div class="post-container">' +
                                '<div class="row post-head" >' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                                // '                        <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc">' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <audio controls preload="auto">' +
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                                '                </audio>' +
                                '            </div>' +
                                '      <div class="row post-comment">' +
                                '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '        </div>';

                        } else if (data[0].detail[i].type == "file") {
                            var holder = "";
                            var path = data[0].detail[i].URL;
                            var ext = path.substr(path.lastIndexOf('.') + 1);
                            var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x in extName) {
                                if (x == ext) {
                                    console.log("File is: " + x);
                                    holder = 'img/attach_icons/' + extName[x];
                                }
                            }
                            content += '<div class="post-container">' +
                                '<div class="row post-head" >' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                                // '<img src="' + server + data[0].imageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].name + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + holder + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        }
                    }
                    document.getElementById('postList').innerHTML += content;
                    document.getElementById("loadMore").style.display = 'block';
                    document.getElementById("proLoader").style.display = 'none';
                    $("img").on('error', function() {
                        $(this).attr("src", "img/pictures/notFound.png");
                    });
                    setTimeout(function() {
                        $("video,audio").on('click', function() {
                            if (this.paused) {
                                this.play();
                            } else {
                                this.pause();
                            }
                            if (this.getAttribute('controls') !== 'true') {
                                this.setAttribute('controls', 'true');
                            }
                            this.setAttribute('controls', 'true');
                        });
                    }, 2000);

                } else {
                    document.getElementById('loadMore').innerHTML = "<p>No More Posts</p>";
                    document.getElementById('loadMore').setAttribute("onclick", "");
                    document.getElementById("loadMore").style.display = 'block';
                    document.getElementById("proLoader").style.display = 'none';
                }
            } else {
                console.log("No result");
            }

        }
    };
    xhttp.open("POST", server + "fetchNextCelebrityDetail.php", true);
    var parameters = "celId=" + celId + "&offset=" + offset + "&proId=" + localStorage.getItem("PROID");
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);

}

function setCelebId(cId) {
    window.localStorage.setItem("CELID", cId);
    window.location.href = "celeb_profile.html";

}

function setCelebPostId(id, type, genId, imageURL, userName, time, desc, title, count) {
    //console.log(id+":"+type+":"+genId+":"+imageURL+":"+userName+":"+time+":"+desc+":"+title+":"+count);
    var data = '{"id":"' + id + '",' + '"type":"' + type + '",' + '"genId":"' + genId + '",' + '"imageURL":"' + imageURL + '",' + '"userName":"' + userName + '",' + '"time":"' + time + '",' + '"desc":"' + desc + '",' + '"title":"' + title + '",' + '"count":"' + count + '"}';
    ///console.log(data);
    localStorage.setItem("CELEBPOSTDETAIL", data);
    // localStorage.setItem("HOMEPOSTID",pId);
    window.location.href = "celebrity_comment_screen.html";
}

////////////////////////
//CELEBRITY COMMENT SCREEN HTML //
////////////////////////

var mutualExclusive2 = false;

function fetchCelebrityComments() {
    if (!mutualExclusive2) {
        //console.log(localStorage.getItem("CELEBPOSTDETAIL"));
        var data = JSON.parse(localStorage.getItem("CELEBPOSTDETAIL"));
        var postId = data.id; // celeb post id
        var content = "";
        if (data.type == "photo") {
            content += '<div class="row post-head" onclick="setCelebId(\'' + data.genId + '\')">' + //friend_profile
                '<div class="col-15 post-pro-pic col-center">' +
                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '<img src="' + server + data.imageURL + '" />' +
                '</div>' +
                '</div>' +
                '<div class="col-60">' +
                '<p>' + data.userName + '</p>' +
                '</div>' +
                '<div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '</div>' +
                '</div>' +
                '<div class="post-desc" >' + //comment_screen
                emojione.unicodeToImage(data.desc) +
                '</div>' +
                '<div class="post-pic" >' +
                '<img src="' + server + getThumb(data.title) + '" />' +
                '</div>' +
                '<div class="row post-comment">' +
                '<div class="col-50"><i class="fa fa-comment"></i> ' + data.count + ' comments</div>' +
                '<div class="col-50 text-right"><i class="fa fa-download"></i></div>' +
                '</div>';
        } else if (data.type == "text") {

            content += '<div class="row post-head" onclick="setCelebId(\'' + data.genId + '\')">' + //\'friend_profile.html\'
                '                <div class="col-15 post-pro-pic col-center">' +
                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '                       <img src="' + server + data.imageURL + '" />' +
                '                    </div>' +
                '                </div>' +
                '                <div class="col-60">' +
                '                    <p>' + data.userName + '</p>' +
                '                </div>' +
                '                <div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '                </div>' +
                '            </div>' +
                '            <div class="post-desc" >' + // \'comment_screen.html\'
                emojione.unicodeToImage(data.desc) +
                '            </div>' +
                '            <div class="post-comment" >' +
                '                <i class="fa fa-comment"></i> ' + data.count + ' comments' +
                '            </div>';

        } else if (data.type == "video") {

            content += '<div class="row post-head" onclick="setCelebId(\'' + data.genId + '\')">' +
                '                <div class="col-15 post-pro-pic col-center">' +
                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '                        <img src="' + server + data.imageURL + '" />' +
                '                    </div>' +
                '                </div>' +
                '                <div class="col-60">' +
                '                    <p>' + data.userName + '</p>' +
                '                </div>' +
                '                <div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '                </div>' +
                '            </div>' +
                '            <div class="post-desc" >' +
                emojione.unicodeToImage(data.desc) +
                '            </div>' +
                '            <div class="post-video">' +
                '                <video controls  preload="auto"  loop >' + //poster="img/icons/video-gallery.svg"
                '                    <source src="' + server + data.title + '" type="video/mp4">' +
                '                </video>' +
                '            </div>' +
                '            <div class="post-comment" >' +
                '                <i class="fa fa-comment"></i> ' + data.count + ' comments' +
                '            </div>' +
                '        </div>';



        } else if (data.type == "audio") {
            content += '<div class="row post-head" onclick="setCelebId(\'' + data.genId + '\')">' +
                '                <div class="col-15 post-pro-pic col-center">' +
                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '                        <img src="' + server + data.imageURL + '" />' +
                '                    </div>' +
                '                </div>' +
                '                <div class="col-60">' +
                '                    <p>' + data.userName + '</p>' +
                '                </div>' +
                '                <div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '                </div>' +
                '            </div>' +
                '            <div class="post-desc">' +
                emojione.unicodeToImage(data.desc) +
                '            </div>' +
                '            <div class="post-video">' +
                '                <audio controls preload="auto">' +
                '                    <source src="' + server + data.title + '" type="audio/wav">' +
                '                </audio>' +
                '            </div>' +
                '            <div class="post-comment" >' +
                '                <i class="fa fa-comment"></i> ' + data.count + ' comments' +
                '            </div>' +
                '        </div>';

        } else if (data.type == "file") {

            var holder = "";
            var path = data.title;
            var ext = path.substr(path.lastIndexOf('.') + 1);
            var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
            for (var x in extName) {
                if (x == ext) {
                    console.log("File is: " + x);
                    holder = 'img/attach_icons/' + extName[x];
                }
            }

            content += '<div class="row post-head" onclick="setCelebId(\'' + data.genId + '\')">' + //friend_profile
                '<div class="col-15 post-pro-pic col-center">' +
                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data.imageURL) + ')">' +
                // '<img src="' + server + data.imageURL + '" />' +
                '</div>' +
                '</div>' +
                '<div class="col-60">' +
                '<p>' + data.userName + '</p>' +
                '</div>' +
                '<div class="col-25 post-time">' +
                formatAMPM(new Date(data.time)) +
                '</div>' +
                '</div>' +
                '<div class="post-desc" >' + //comment_screen
                emojione.unicodeToImage(data.desc) +
                '</div>' +
                '<div class="post-pic" >' +
                '<img src="' + holder + '" />' +
                '</div>' +
                '<div class="row post-comment">' +
                '<div class="col-50"><i class="fa fa-comment"></i> ' + data.count + ' comments</div>' +
                '<div class="col-50 text-right"><i class="fa fa-download"></i></div>' +
                '</div>';
        }
        // document.getElementById("commentFocus").innerHTML = content;

        var content1 = "";
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                //console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() != "") {
                    var commentData = JSON.parse(xhttp.responseText);
                    for (var i = commentData.length - 1; i >= 0; i--) {

                        content1 += '<div class="row post-head" >' + //unlinking onclick="setGeneratorId(\'' + commentData[i].userId + '\')"
                            '            <div class="col-15 post-pro-pic col-center">' +
                            '                <div class="dash-chat-img" style="background-image:url(' + server + getThumb(commentData[i].imageURL) + ')">' +
                            // '                    <img src="' + server + commentData[i].imageURL + '" />' +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="col-60">' +
                            '                <p>' + commentData[i].name + '</p>' +
                            '                <p class="comment">' + commentData[i].comment + '</p>' +
                            '            </div>' +
                            '            <div class="col-25 post-time">' +
                            '                ' + formatAMPM(new Date(commentData[i].time)) + '' +
                            '            </div>' +
                            '        </div>';


                    }
                    document.getElementById("commentFocus").innerHTML = content + content1;
                    var ht = "<i class='fa fa-comment'></i> " + commentData[0].count + " comments";
                    localStorage.setItem("CELEBCOMMENTCOUNT", postId + "," + commentData[0].count);
                    //console.log(commentData[0].count+":::"+ht);
                    $(".post-comment").html(ht);
                    $('html, body').scrollTop($(document).height());
                } else {
                    document.getElementById("commentFocus").innerHTML = content;
                }
            }
        };
        xhttp.open("POST", server + "fetchCelebrityComments.php", true);
        var parameters = "postId=" + postId;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    }
}

// function sendCommentStatus(curr) {
//     var space = /[^\s]+/; //anything except space
//     if (curr.value.match(space)) {
//         document.getElementById("sendDisable").style.display = 'none';
//         document.getElementById("sendEnable").style.display = 'block';
//     } else {
//         document.getElementById("sendEnable").style.display = 'none';
//         document.getElementById("sendDisable").style.display = 'block';
//     }
// }


function sendCelebrityComment() {

    document.getElementById("sendEnable").style.display = 'none';
    document.getElementById("sendDisable").style.display = 'block';
    var proId = localStorage.getItem("PROID"); //to be checked later to be commented at as celebrity or user who created the profile
    var data = JSON.parse(localStorage.getItem("CELEBPOSTDETAIL"));
    var postId = data.id;
    var message = document.getElementById("commentMessage").value;
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            mutualExclusive2 = true;
            //console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim()) {
                document.getElementById("commentMessage").value = "";
                mutualExclusive2 = false;
                fetchCelebrityComments();
            } else {
                console.log("error");
                mutualExclusive2 = false;
            }

        }
    };
    xhttp.open("POST", server + "sendCelebrityComment.php", true);
    var parameters = "proId=" + proId + "&postId=" + postId + "&message=" + encodeURIComponent(message);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function checkCelebrityStatus() {
    console.log("CHECK STATUS");

    //to be checked later to be commented at as celebrity or user who created the profile
    var proId = localStorage.getItem("PROID");
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() == "Y") {
                fetchCelebrityList();
            } else if (xhttp.responseText.trim() == "X") {
                document.getElementById("statusButton").style.display = 'none';
                fetchCelebrityList();
            } else {
                localStorage.setItem("CID", xhttp.responseText.trim());
                localStorage.setItem("CELEBAPPLIED", 1);
                fetchCelebrityList();
            }

        }
    };
    xhttp.open("POST", server + "checkCelebrityStatus.php", true);
    var parameters = "proId=" + proId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);

}



//////////////////////////
//MY CELEB PROFILE HTML //
////////////////////////////
function fetchMyCelebrityProfile() {
    preLoaderOn();
    var cId = localStorage.getItem("CID");
    var content = "";
    var content1 = "";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            //console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false) {
                localStorage.setItem("MYCELEBPROFILEINFO", xhttp.responseText.trim());
                data = JSON.parse(xhttp.responseText.trim());
                document.getElementById("coverPic").style.backgroundImage = "url(" + server + data.imageURLCover + ")";
                document.getElementById("proPic").style.backgroundImage = "url(" + server + getThumb(data.imageURL) + ")";
                document.getElementById("proName").innerHTML = data.name;
                if (data.category == 'Celebrity') {
                    document.getElementById("proGenderEmail").innerHTML = data.gender + ", " + data.email;
                } else {
                    document.getElementById("proGenderEmail").innerHTML = data.email;
                }
                document.getElementById("followCount").innerHTML = data.followerCount;
                document.getElementById("proQuote").innerHTML = data.quote;
                preLoaderOff();

            } else {
                console.log("Not Result");
                preLoaderOff();
            }

        }
    };
    xhttp.open("POST", server + "fetchMyCelebrityProfile.php", true);
    var parameters = "cId=" + cId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);

}

function extractMyCelebrityProfile() {
    preLoaderOn();
    var data = JSON.parse(localStorage.getItem("MYCELEBPROFILEINFO"));
    document.getElementById("coverProPic").style.backgroundImage = "url(" + server + data.imageURLCover + ")";
    document.getElementById("proPic").style.backgroundImage = "url(" + server + getThumb(data.imageURL) + ")";
    document.getElementById("proCategory").value = data.category;
    document.getElementById("proName").value = data.name;
    document.getElementById("proEmail").value = data.email;
    if (data.category == 'Celebrity') {
        document.getElementById("proGender").value = data.gender;
    } else {
        document.getElementById("genderSelection").style.display = 'none';
    }
    document.getElementById("proStatus").innerHTML = data.quote;
    preLoaderOff();
}

function updateCelebProfile() {
    // console.log(document.getElementById("proCategory").value=="0");
    //console.log(localStorage.getItem("PROID"));
    if (checkBox) {
        $("#privacyErr").html("Please Agree To Proceed.");
    } else {
        var nameReg = /^[a-z ,.'-]+$/i;
        var emailReg = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        var proCategory = document.getElementById("proCategory").value;
        var proName = document.getElementById("proName").value;
        var proFName = proName.split(" ")[0];
        var proLName = (proName.split(" ").length > 1) ? proName.split(" ")[1] : '';
        var proEmail = document.getElementById("proEmail").value;
        var proGender = "";
        if (proCategory == 'Celebrity') {
            proGender = document.getElementById("proGender").value;
        } else {
            proGender = "";
        }
        console.log(proGender);
        var proStatus = document.getElementById("proStatus").value;
        //console.log(proStatus=="");
        if (proCategory != "0") {
            if (proName.match(nameReg)) {
                if (proEmail.match(emailReg)) {
                    if (proStatus != " " && proStatus !== "") {
                        var xhttp = new XMLHttpRequest();
                        xhttp.onreadystatechange = function() {
                            loadingOnC();
                            if (xhttp.readyState == 4 && xhttp.status == 200) {
                                console.log(xhttp.responseText.trim());
                                if (xhttp.responseText.trim() !== false) {
                                    celebDisplayImageUploadPrev(xhttp.responseText.trim());
                                    //console.log("Done");
                                }
                            }
                        };
                        xhttp.open("POST", server + "updateCelebProfile.php", true);
                        var parameters = "proCategory=" + proCategory + "&proFName=" + proFName + "&proLName=" + proLName + "&proEmail=" + proEmail + "&proGender=" + proGender + "&proStatus=" + proStatus + "&cId=" + localStorage.getItem("CID");
                        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                        //console.log(parameters);
                        xhttp.send(parameters);
                    } else {
                        $("#proStatus").css("border-bottom", "2px solid #000");
                        $("#statusErr").html("Invalid Status");
                    }

                } else {
                    $("#proEmail").css("border-bottom", "2px solid #000");
                    $("#emailErr").html("Invalid Email");
                }
            } else {
                $("#proName").css("border-bottom", "2px solid #000");
                $("#nameErr").html("Invalid Name");
            }
        } else {
            $("#proCategory").css("border-bottom", "2px solid #000");
            $("#catErr").html("Invalid Category");
        }

    }
}



//plugin function to upload the file on the server
function celebDisplayImageUploadPrev(celId) {
    if (proPicUpdated) {
        console.log("in upload file:" + checkURL + ":::" + celId);
        // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
        var uri = encodeURI(server + "celebDisplayImageUploadPrev.php");
        //console.log(uri);
        var options = new FileUploadOptions();

        options.fileKey = "fileUploadKey";
        options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
        options.mimeType = "image/jpeg";
        options.httpMethod = 'POST';
        var params = {};
        params.celId = celId;
        //params.value2 = "param";
        options.params = params;
        options.chunkedMode = false;
        var headers = {
            'headerParam': 'headerValue'
        };
        options.headers = headers;

        var ft = new FileTransfer();

        ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
        //success handler
        function onSucc(r) {
            console.log("Code = " + r.responseCode);
            console.log("Response = " + r.response);
            console.log("Sent = " + r.bytesSent);
            console.log(r.response);
            celebDisplayImageUploadCoverPrev(celId);
            /*if (r.response == 'The file has been uploaded.') {*/
            //console.log("Uploaded");

            /*}*/
        }
        //error handler
        function onErr(error) {
            console.log("An error has occurred: Code = " + error.code);
            console.log("upload error source " + error.source);
            console.log("upload error target " + error.target);
            console.log("Failure");
            loadingOffC();
        }
    } else {
        //console.log("ELSE1");
        celebDisplayImageUploadCoverPrev(celId);
    }
}

function celebDisplayImageUploadCoverPrev(celId) {
    if (coverPicUpdated) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim() != false) {
                    loadingOffC();
                    window.location.href = "my_celeb_profile.html";
                }
            }
        };
        xhttp.open("POST", server + "celebDisplayImageUploadCoverPrev.php", true);
        var parameters = "celId=" + celId + "&screen=" + checkURLC;
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
    } else {
        //console.log("ELSE2");
        loadingOffC();
        window.location.href = "my_celeb_profile.html";
    }
}

////////////////
//CELEB POSTS //
////////////////
function fetchMyCelebrityPost() {

    var cId = localStorage.getItem("CID");
    var content = "";
    var content1 = "";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false) {
                data = JSON.parse(xhttp.responseText.trim());

                document.getElementById("proPic").style.backgroundImage = "url(" + server + getThumb(data[0].imageURL) + ")";
                document.getElementById("proName").innerHTML = data[0].name;



                for (var i = 0; i < data[0].detail.length; i++) {

                    if (data[0].detail[i].type == "photo") {

                        content += '<div class="post-container">' +
                            '<div class="row post-head" >' + //friend_profile
                            '<div class="col-15 post-pro-pic col-center">' +
                            '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                            // '<img src="' + server + data[0].imageURL + '" />' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-60">' +
                            '<p>' + data[0].name + '</p>' +
                            '</div>' +
                            '<div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '</div>' +
                            '</div>' +
                            '<div class="post-desc" >' + //comment_screen
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '</div>' +
                            '<div class="post-pic" >' +
                            '<img src="' + server + getThumb(data[0].detail[i].URL) + '" />' +
                            '</div>' +
                            '<div class="row post-comment">' +
                            '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';

                    } else if (data[0].detail[i].type == "text") {

                        content += '<div class="post-container">' +
                            '<div class="row post-head" >' + //\'friend_profile.html\'
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                            // '                       <img src="' + server + data[0].imageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].name + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc" >' + // \'comment_screen.html\'
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-comment" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + "0" + '\',\'' + data[0].detail[i].commentCount + '\')">' +
                            '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                            '</div>' +
                            '            </div>';

                    } else if (data[0].detail[i].type == "video") {

                        content += '<div class="post-container">' +
                            '<div class="row post-head" >' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                            // '                        <img src="' + server + data[0].imageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].name + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc" >' +
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-video">' +
                            '                <video controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                            '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                            '                </video>' +
                            '            </div>' +
                            '           <div class="row post-comment">' +
                            '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                            ' </div>' +
                            '            </div>';



                    } else if (data[0].detail[i].type == "audio") {
                        content += '<div class="post-container">' +
                            '<div class="row post-head" >' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                            // '                        <img src="' + server + data[0].imageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].name + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc">' +
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-video">' +
                            '                <audio controls preload="auto">' +
                            '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                            '                </audio>' +
                            '            </div>' +
                            '      <div class="row post-comment">' +
                            '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                            ' </div>' +
                            '        </div>';

                    } else if (data[0].detail[i].type == "file") {
                        var holder = "";
                        var path = data[0].detail[i].URL;
                        var ext = path.substr(path.lastIndexOf('.') + 1);
                        var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                        for (var x in extName) {
                            if (x == ext) {
                                console.log("File is: " + x);
                                holder = 'img/attach_icons/' + extName[x];
                            }
                        }
                        content += '<div class="post-container">' +
                            '<div class="row post-head" >' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                            // '                        <img src="' + server + data[0].imageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].name + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc">' +
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-pic">' +
                            '              <img src="' + holder + '" />' +
                            '            </div>' +
                            '      <div class="row post-comment">' +
                            '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                            ' </div>' +
                            '        </div>';

                    }
                }
                document.getElementById('postList').innerHTML = content;
                $("img").on('error', function() {
                    $(this).attr("src", "img/pictures/notFound.png");
                });
                setTimeout(function() {
                    $("video,audio").on('click', function() {
                        if (this.paused) {
                            this.play();
                        } else {
                            this.pause();
                        }
                        if (this.getAttribute('controls') !== 'true') {
                            this.setAttribute('controls', 'true');
                        }
                        this.setAttribute('controls', 'true');
                    });
                }, 2000);
                document.getElementById("cardLoader").style.display = 'none';
            } else {
                console.log("Not Removed");
            }

        }
    };
    xhttp.open("POST", server + "fetchMyCelebrityPost.php", true);
    var parameters = "cId=" + cId;
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);

}
var offsetMyCelebPost = 0;

function toggleLoaderMyCelebrityPost(arg) {
    newLoaderOn();
    offsetMyCelebPost += 10;
    fetchNextMyCelebrityPost(offsetMyCelebPost);
}

function fetchNextMyCelebrityPost(offset) {

    var cId = localStorage.getItem("CID");
    var content = "";
    var content1 = "";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false) {
                data = JSON.parse(xhttp.responseText.trim());
                if (data[0].length !== 0) {
                    for (var i = 0; i < data[0].detail.length; i++) {

                        if (data[0].detail[i].type == "photo") {

                            content += '<div class="post-container">' +
                                '<div class="row post-head" >' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                                // '<img src="' + server + data[0].imageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].name + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + server + getThumb(data[0].detail[i].URL) + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' +
                                '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';

                        } else if (data[0].detail[i].type == "text") {

                            content += '<div class="post-container">' +
                                '<div class="row post-head" >' + //\'friend_profile.html\'
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                                // '                       <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' + // \'comment_screen.html\'
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-comment" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + "0" + '\',\'' + data[0].detail[i].commentCount + '\')">' +
                                '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                                '</div>' +
                                '            </div>';

                        } else if (data[0].detail[i].type == "video") {

                            content += '<div class="post-container">' +
                                '<div class="row post-head" >' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                                // '                        <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <video controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                                '                </video>' +
                                '            </div>' +
                                '           <div class="row post-comment">' +
                                '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +
                                ' </div>' +
                                '            </div>';



                        } else if (data[0].detail[i].type == "audio") {
                            content += '<div class="post-container">' +
                                '<div class="row post-head" >' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                                // '                        <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc">' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <audio controls preload="auto">' +
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                                '                </audio>' +
                                '            </div>' +
                                '      <div class="row post-comment">' +
                                '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +
                                ' </div>' +
                                '        </div>';

                        } else if (data[0].detail[i].type == "file") {
                            var holder = "";
                            var path = data[0].detail[i].URL;
                            var ext = path.substr(path.lastIndexOf('.') + 1);
                            var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x in extName) {
                                if (x == ext) {
                                    console.log("File is: " + x);
                                    holder = 'img/attach_icons/' + extName[x];
                                }
                            }
                            content += '<div class="post-container">' +
                                '<div class="row post-head" >' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].imageURL) + ')">' +
                                // '                        <img src="' + server + data[0].imageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].name + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc">' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-pic">' +
                                '              <img src="' + holder + '" />' +
                                '            </div>' +
                                '      <div class="row post-comment">' +
                                '<div class="col-50" onclick="setCelebPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +
                                ' </div>' +
                                '        </div>';

                        }
                    }
                    document.getElementById('postList').innerHTML += content;
                    newLoaderOff();
                    $("img").on('error', function() {
                        $(this).attr("src", "img/pictures/notFound.png");
                    });
                    setTimeout(function() {
                        $("video,audio").on('click', function() {
                            if (this.paused) {
                                this.play();
                            } else {
                                this.pause();
                            }
                            if (this.getAttribute('controls') !== 'true') {
                                this.setAttribute('controls', 'true');
                            }
                            this.setAttribute('controls', 'true');
                        });
                    }, 2000);
                } else {
                    document.getElementById('loadMore').innerHTML = "<p>No More Posts</p>";
                    newLoaderOff();
                }
            } else {
                console.log("Not Removed");
            }

        }
    };
    xhttp.open("POST", server + "fetchNextMyCelebrityPost.php", true);
    var parameters = "cId=" + cId + "&offset=" + offset;
    console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);

}
///////////////////////////////////////////
////////////////////                    //
// CELEBRITY POST UPLOAD /////////////////
/////////////////////////////////////////

///////////////
// Text Post //
///////////////
function uploadCelebText(argument) {

    var proText = document.getElementById("proText").value;
    //console.log(proText);
    if (proText !== "") {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                console.log(xhttp.responseText.trim());
                if (xhttp.responseText.trim()) {
                    closePopup();
                    fetchMyCelebrityPost(); //to be changed later
                    removeJunk();
                }
            }
        };
        xhttp.open("POST", server + "uploadCelebText.php", true);
        var parameters = "proText=" + proText + "&cId=" + localStorage.getItem("CID");
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send(parameters);
        //console.log(parameters);
    } else {
        console.log("Status Not Updated.");
    }

}
////////////////
// Video Post //
////////////////
function postCelebTakeVideo(argument) {
    // capture callback
    var captureSuccess = function(mediaFiles) {
        var i, path, len;
        for (i = 0, len = mediaFiles.length; i < len; i += 1) {
            path = mediaFiles[i].fullPath;
            // do something interesting with the file
            checkURL = path;
            document.getElementById("videoImage").src = path;
            popupVideo();
        }
    };

    // capture error callback
    var captureError = function(error) {
        navigator.notification.console.log('Error code: ' + error.code, null, 'Capture Error');
    };

    // start video capture
    navigator.device.capture.captureVideo(captureSuccess, captureError, { limit: 1, quality: 0 });
}

function postCelebGetVideo(argument) {
    console.log("get vid");
    navigator.camera.getPicture(onSuccess, onFail, {
        quality: 50,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: navigator.camera.DestinationType.FILE_URI,
        mediaType: navigator.camera.MediaType.VIDEO,
        sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
    //success handler
    function onSuccess(imageURL) {
        checkURL = imageURL;
        document.getElementById("videoImage").src = imageURL;
        closepopupplain1();
        popupVideo();

    }
    //erroor handler
    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}

function uploadCelebVideo() {
    //console.log("in upload video:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "uploadCelebVideo.php?cId=" + localStorage.getItem("CID") + "&desc=" + document.getElementById("videoDesc").value);
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "video/3gpp";
    options.httpMethod = 'POST';
    var params = {};
    params.cId = localStorage.getItem("CID");
    params.desc = document.getElementById("videoDesc").value;
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.onprogress = function(progressEvent) {
        $(".myBar").css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $(".myBar").css("width", perc + "%");
        } else {
            if (progressStatus.innerHTML === "") {
                $(".myBar").css("width", "0%");
            } else {
                $(".myBar").css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        document.getElementById("videoDesc").value = "";
        closePopup();
        fetchMyCelebrityPost();
        removeJunk();
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }
}

////////////////
// Audio Post //
////////////////
function postCelebTakeAudio(argument) {
    // capture callback
    pendingAudio = true;
    var captureSuccess = function(mediaFiles) {
        var i, path, len;
        for (i = 0, len = mediaFiles.length; i < len; i += 1) {
            path = mediaFiles[i].fullPath;
            // do something interesting with the file
            checkURL = path;
            document.getElementById("audioImage").src = checkURL;
            popupAudio();
        }
    };

    // capture error callback
    var captureError = function(error) {
        alert("Sorry! Your phone dosen't support this functionality.");
        console.log('Error code: ' + error, null, 'Capture Error');
    };

    // start audio capture
    navigator.device.capture.captureAudio(captureSuccess, captureError, { limit: 1 });
}

function postCelebGetAudio(argument) {
    navigator.camera.getPicture(onSuccess, onFail, {
        quality: 100,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: navigator.camera.DestinationType.FILE_URI,
        mediaType: navigator.camera.MediaType.ALLMEDIA,
        sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
    //success handler
    function onSuccess(imageURL) {
        //console.log(imageURL);
        checkURL = imageURL;
        var format = imageURL.split(".")[1];
        if (format == "wav" || format == "amr" || format == "mp3") {
            document.getElementById("audioImage").src = imageURL;
            popupAudio();
        } else {
            alert("Audio File Format Not Supported.");
        }
        closepopupplain2();
    }
    //erroor handler
    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}

function uploadCelebAudio() {
    pendingAudio = false;
    console.log("in upload audio:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "uploadCelebAudio.php");
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "audio/wav";
    options.httpMethod = 'POST';
    var params = {};
    params.cId = localStorage.getItem("CID");
    params.desc = document.getElementById("audioDesc").value;
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.onprogress = function(progressEvent) {
        $(".myBar").css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $(".myBar").css("width", perc + "%");
        } else {
            if (progressStatus.innerHTML === "") {
                $(".myBar").css("width", "0%");
            } else {
                $(".myBar").css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        document.getElementById("audioDesc").value = "";
        closePopup();
        fetchMyCelebrityPost();
        removeJunk();
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }
}



////////////////
// Photo Post //
////////////////

function postCelebTakePhoto(argument) {
    console.log("get pic");
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "TAKE");
    navigator.camera.getPicture(postCelebTakePhotoSuccess, postCelebTakePhotoFail, {
        quality: 60,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI,
        sourceType: Camera.PictureSourceType.CAMERA
            // targetWidth: 200,
            // targetHeight: 200
    });
}
//success handler
function postCelebTakePhotoSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    checkURL = imageURL;
    document.getElementById("photoImage").style.backgroundImage = "url(" + imageURL + ")";
    closepopupplain();
    popupPhoto();
    localStorage.setItem("PAGELOC", "");
}
//erroor handler
function postCelebTakePhotoFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}

function postCelebGetPhoto(argument) {
    console.log("get pic");
    localStorage.setItem("PAGELOC", pageLocation);
    appState.takingPicture = true; //1
    localStorage.setItem("PAGERED", "GET");
    navigator.camera.getPicture(postCelebGetPhotoSuccess, postCelebGetPhotoFail, {
        quality: 60,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: Camera.DestinationType.FILE_URI,
        sourceType: Camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
}
//success handler
function postCelebGetPhotoSuccess(imageURL) {
    appState.takingPicture = false; //2
    appState.imageUri = imageURL; //3
    checkURL = imageURL;
    document.getElementById("photoImage").style.backgroundImage = "url(" + imageURL + ")";
    closepopupplain();
    popupPhoto();
    localStorage.setItem("PAGELOC", "");
}
//erroor handler
function postCelebGetPhotoFail(message) {
    appState.takingPicture = false; //4
    console.log('Failed because: ' + message);
}

function uploadCelebPhoto() {
    //console.log("in upload image:" + checkURL);
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var uri = encodeURI(server + "uploadCelebPhoto.php");
    var options = new FileUploadOptions();
    options.fileKey = "file"; //fileUploadKey
    options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
    options.mimeType = "image/jpeg";
    options.httpMethod = 'POST';
    var params = {};
    params.cId = localStorage.getItem("CID");
    params.desc = document.getElementById("photoDesc").value;
    options.params = params;
    options.chunkedMode = false;
    var headers = {
        'headerParam': 'headerValue'
    };
    options.headers = headers;

    var ft = new FileTransfer();

    ft.onprogress = function(progressEvent) {
        $(".myBar").css("width", '0%');
        if (progressEvent.lengthComputable) {
            var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
            $(".myBar").css("width", perc + "%");
        } else {
            if (progressStatus.innerHTML === "") {
                $(".myBar").css("width", "0%");
            } else {
                $(".myBar").css("width", "100%");
            }
        }
    };

    ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
    //success handler
    function onSucc(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        console.log(r.response);
        document.getElementById("photoDesc").value = "";
        closePopup();
        fetchMyCelebrityPost();
        removeJunk();
        /*if (r.response == 'The file has been uploaded.') {*/
        //console.log("Uploaded");

        //window.location.href = "home.html";
        /*}*/
    }
    //error handler
    function onErr(error) {
        console.log("An error has occurred: Code = " + error.code);
        console.log("upload error source " + error.source);
        console.log("upload error target " + error.target);
        console.log("Failure");
    }
}
///////////////
// FILE POST //
///////////////


function postCelebGetFile(argument) {
    console.log("get file");
    navigator.camera.getPicture(onSuccess, onFail, {
        quality: 50,
        // allowEdit: true,
        correctOrientation: false,
        destinationType: navigator.camera.DestinationType.FILE_URI,
        mediaType: navigator.camera.MediaType.ALLMEDIA,
        sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY
            // targetWidth: 200,
            // targetHeight: 200
    });
    //success handler
    function onSuccess(imageURL) {
        checkURL = imageURL;
        var support = false;
        var ext = checkURL.substr(checkURL.lastIndexOf('.') + 1);
        var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
        for (var x in extName) {
            if (x == ext) {
                console.log("File: " + x);
                support = true;
                document.getElementById("fileImage").style.backgroundImage = 'url(img/attach_icons/' + extName[x] + ')';
                popupFile();
            }
        }
        if (!support) {
            alert("Sorry, File Not Supported.");
        }

    }
    //erroor handler
    function onFail(message) {
        console.log('Failed because: ' + message);
    }
}


function uploadCelebFile() {
    console.log("in upload celeb file:" + checkURL);
    var ext = checkURL.substr(checkURL.lastIndexOf('.') + 1);
    console.log("extenstion:" + ext);
    var extName = JSON.parse('{"pdf":"application/pdf" , "txt":"text/plain" , "doc":"application/msword" , "docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document" , "ppt":"application/vnd.ms-powerpointtd>" , "pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation" , "xls":"application/vnd.ms-excel" , "xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}');
    // already filled in global variables-----var fileURL = "///storage/emulated/0/DCIM/myFile"
    var present = false;
    var mmt = "";
    for (var x in extName) {
        if (x == ext) {
            console.log("File: " + x);
            present = true;
            mmt = extName[x];
        }
    }

    if (!present) {
        alert("File Not Supported.");
    } else {
        console.log(mmt);
        var uri = encodeURI(server + "uploadCelebFile.php?proId=" + localStorage.getItem("CID") + "&desc=" + document.getElementById("fileDesc").value + "&ext=" + ext);
        var options = new FileUploadOptions();
        options.fileKey = "file"; //fileUploadKey
        options.fileName = checkURL.substr(checkURL.lastIndexOf('/') + 1);
        options.mimeType = mmt;
        options.httpMethod = 'POST';
        var params = {};
        params.cId = localStorage.getItem("CID");
        params.desc = document.getElementById("fileDesc").value;
        params.ext = ext;
        options.params = params;
        options.chunkedMode = false;
        var headers = {
            'headerParam': 'headerValue'
        };
        options.headers = headers;

        var ft = new FileTransfer();

        ft.onprogress = function(progressEvent) {
            $(".myBar").css("width", '0%');
            if (progressEvent.lengthComputable) {
                var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
                $(".myBar").css("width", perc + "%");
            } else {
                if (progressStatus.innerHTML === "") {
                    $(".myBar").css("width", "0%");
                } else {
                    $(".myBar").css("width", "100%");
                }
            }
        };

        ft.upload(checkURL, uri, onSucc, onErr, options); //main function of the plugin for upload (file URL,Server add,win,fail,opt)
        //success handler
        function onSucc(r) {
            console.log("Code = " + r.responseCode);
            console.log("Response = " + r.response);
            console.log("Sent = " + r.bytesSent);
            console.log(r.response);
            document.getElementById("fileDesc").value = "";
            closePopup();
            fetchMyCelebrityPost();
            /*if (r.response == 'The file has been uploaded.') {*/
            //console.log("Uploaded");

            //window.location.href = "home.html";
            /*}*/
        }
        //error handler
        function onErr(error) {
            console.log("An error has occurred: Code = " + error.code);
            console.log("upload error source " + error.source);
            console.log("upload error target " + error.target);
            console.log("Failure");
        }
    }
}



/////////////////////
//DISPLAYING ERROR //
/////////////////////
window.onerror = function(msg, url, linenumber) {
    console.log('Error message: ' + msg + '\nURL: ' + url + '\nLine Number: ' + linenumber);
    return true;
};



//////////////////////
// EMOJI MANAGEMENT //
//////////////////////

var ESET = [];
ESET[0] = "";

function populateEmoji(arg) {
    console.log(arg);
    if (ESET[arg] == null || ESET[arg] == "") {
        document.getElementById("tabpage_" + arg).innerHTML = localStorage.getItem("EMOJI" + arg);
        ESET[arg] = "1";
        console.log(localStorage.getItem("EMOJI" + arg));
    } else {
        console.log("ELSE POPULATE EMOJI");
    }
    //console.log(localStorage.getItem("EMOJI" + arg));
    //tabsLoading();
}

function setInput(curr) {
    var name = curr.getAttribute("data-emoji-name");
    console.log(emojione.shortnameToUnicode(name));
    document.getElementById('chatMessage').value += emojione.shortnameToUnicode(name);


    var e1 = /\ud83c[\udf00-\udfff]/; // U+1F300 to U+1F3FF
    var e2 = /\ud83d[\udc00-\ude4f]/; // U+1F400 to U+1F64F
    var e3 = /\ud83d[\ude80-\udeff]/;


    document.getElementById("sendDisable").style.display = 'none';
    document.getElementById("sendEnable").style.display = 'block';

}

function removeText() {
    console.log("IN");

    var val = document.getElementById("chatMessage").value;
    var arr = val.split(" ");
    for (var i = 0; i < arr.length; i++) {
        console.log(arr[i] + ":::" + arr.length);
    }
    var ret = removeInvalidChars(arr[arr.length - 1]);
    console.log(":::" + ret + ":::");
    var count = (ret.match(/`/g) || []).length;
    console.log(count);
    if (count !== 0) {
        fin = val.replace(arr[arr.length - 1], '');
        console.log(fin);
        document.getElementById("chatMessage").value = fin;

    } else {
        document.getElementById("chatMessage").value = val.substring(0, val.length - 1);
    }

}

var ranges = [
    '\ud83c[\udf00-\udfff]', // U+1F300 to U+1F3FF
    '\ud83d[\udc00-\ude4f]', // U+1F400 to U+1F64F
    '\ud83d[\ude80-\udeff]' // U+1F680 to U+1F6FF
];



function removeInvalidChars(rem) {
    return rem.replace(new RegExp(ranges.join('|'), 'g'), '`');
}

//////////////////////////////////////////
// GROUP POSTS ON HOME PAGE CONTROLS /////
//////////////////////////////////////////

function fetchGroupHomePost() {
    var grpId = localStorage.getItem("GRPID");
    document.getElementById("currentPage").innerHTML = document.getElementById("grp" + grpId).getAttribute("data-group-name");
    $(".grpCol").html("");
    document.getElementById("grpCol" + grpId).innerHTML = '<i class="fa fa-dot-circle-o" aria-hidden="true"></i>';

    document.getElementById("buttonSwapText").setAttribute("onclick", "uploadGroupText('home')");
    document.getElementById("buttonSwapVideo").setAttribute("onclick", "uploadGroupVideo('home')");
    document.getElementById("buttonSwapAudio").setAttribute("onclick", "uploadGroupAudio('home')");
    document.getElementById("buttonSwapPhoto").setAttribute("onclick", "uploadGroupPhoto('home')");
    document.getElementById("buttonSwapFile").setAttribute("onclick", "uploadGroupFile('home')");

    document.getElementById("buttonSwapTakePhoto").setAttribute("onclick", "postGroupTakePhoto()");
    document.getElementById("buttonSwapGetPhoto").setAttribute("onclick", "postGroupGetPhoto()");
    document.getElementById("buttonSwapTakeVideo").setAttribute("onclick", "postGroupTakevideo()");
    document.getElementById("buttonSwapGetVideo").setAttribute("onclick", "postGroupGetVideo()");
    document.getElementById("buttonSwapTakeAudio").setAttribute("onclick", "postGroupTakeAudio()");
    document.getElementById("buttonSwapGetAudio").setAttribute("onclick", "postGroupGetAudio()");
    document.getElementById("buttonSwapGetFile").setAttribute("onclick", "postGroupGetFile()");

    currentPage = 1;

    // var grpStatus = localStorage.getItem("GRPSTATUS");
    // console.log(grpStatus);
    // if (grpStatus == 0) {
    //     //document.getElementById("redirectionalLink").setAttribute("onclick", "");
    //     document.getElementById("postSendingBox").style.display = 'none';
    // }


    var content = "";
    var content1 = "";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                data = JSON.parse(xhttp.responseText.trim());
                localStorage.setItem("LASTCREATEDGROUP", data[0].detail[0].at);
                for (var i = 0; i < data[0].detail.length; i++) {

                    if (data[0].detail[i].type == "photo") {

                        content += '<div class="post-container" >' +
                            '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                            '<div class="col-15 post-pro-pic col-center">' +
                            '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                            // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-60">' +
                            '<p>' + data[0].detail[i].postedByName + '</p>' +
                            '</div>' +
                            '<div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '</div>' +
                            '</div>' +
                            '<div class="post-desc" >' + //comment_screen
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '</div>' +
                            '<div class="post-pic" >' +
                            '<img src="' + server + getThumb(data[0].detail[i].URL) + '" />' +
                            '</div>' +
                            '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                            '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';

                    } else if (data[0].detail[i].type == "text") {

                        content += '<div class="post-container" >' +
                            '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //\'friend_profile.html\'
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                            // '                       <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc" >' + // \'comment_screen.html\'
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-comment" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + '0' + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')">' +
                            '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                            '</div>' +
                            '            </div>';

                    } else if (data[0].detail[i].type == "video") {

                        content += '<div class="post-container" >' +
                            '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                            // '                        <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc" >' +
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-video">' +
                            '                <video controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                            '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                            '                </video>' +
                            '            </div>' +
                            '           <div class="row post-comment">' +
                            '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +

                            '</div>' +
                            '            </div>';



                    } else if (data[0].detail[i].type == "audio") {
                        content += '<div class="post-container" >' +
                            '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')" >' +
                            '                <div class="col-15 post-pro-pic col-center">' +
                            '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                            // '                        <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                            '                    </div>' +
                            '                </div>' +
                            '                <div class="col-60">' +
                            '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                            '                </div>' +
                            '                <div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '                </div>' +
                            '            </div>' +
                            '            <div class="post-desc">' +
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '            </div>' +
                            '            <div class="post-video">' +
                            '                <audio controls preload="auto">' +
                            '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                            '                </audio>' +
                            '            </div>' +
                            '      <div class="row post-comment">' +
                            '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +

                            '</div>' +
                            '        </div>';

                    } else if (data[0].detail[i].type == "file") {
                        var holder = "";
                        var path = data[0].detail[i].URL;
                        var ext = path.substr(path.lastIndexOf('.') + 1);
                        var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                        for (var x in extName) {
                            if (x == ext) {
                                console.log("File is: " + x);
                                holder = 'img/attach_icons/' + extName[x];
                            }
                        }

                        content += '<div class="post-container" >' +
                            '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                            '<div class="col-15 post-pro-pic col-center">' +
                            '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                            // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-60">' +
                            '<p>' + data[0].detail[i].postedByName + '</p>' +
                            '</div>' +
                            '<div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '</div>' +
                            '</div>' +
                            '<div class="post-desc" >' + //comment_screen
                            emojione.unicodeToImage(data[0].detail[i].desc) +
                            '</div>' +
                            '<div class="post-pic" >' +
                            '<img src="' + holder + '" />' +
                            '</div>' +
                            '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                            '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +

                            '</div>' +
                            '</div>';

                    } else if (data[0].detail[i].type == "shared") {
                        var innerContent = "";
                        var folder = "";
                        var innerData = JSON.parse(data[0].detail[i].desc);
                        var innerJson = data[0].detail[i].desc.replace(/"/g, "~");
                        console.log("innerJson:" + innerJson);
                        if (data[0].detail[i].format == "photo") {
                            folder = "images";
                            innerContent = '<div class="shared-post">' +
                                '                            <div class="row post-head">' +
                                '                                <div class="col-15 post-pro-pic col-center">' +
                                '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                '                                </div>' +
                                '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                '                            </div>' +
                                '                            ' +
                                '                            <div class="post-desc" >' +
                                '                               ' + innerData.desc + '' +
                                '                            </div>' +
                                '                         ' +
                                '                            <div class="post-pic">' +
                                '                              <img src="' + server + getThumb(innerData.title) + '" />' +
                                '                            </div>' +
                                '                        </div>';


                        } else if (data[0].detail[i].format == "text") {
                            folder = "text";
                            innerContent = '<div class="shared-post">' +
                                '                            <div class="row post-head">' +
                                '                                <div class="col-15 post-pro-pic col-center">' +
                                '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                '                                </div>' +
                                '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                '                            </div>' +
                                '                            ' +
                                '                            <div class="post-desc" >' +
                                '                               ' + innerData.desc + '' +
                                '                            </div>' +
                                '                         ' +
                                '                        </div>';


                        } else if (data[0].detail[i].format == "video") {
                            folder = "videos";
                            innerContent = '<div class="shared-post">' +
                                '                            <div class="row post-head">' +
                                '                                <div class="col-15 post-pro-pic col-center">' +
                                '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                '                                </div>' +
                                '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                '                            </div>' +
                                '                            ' +
                                '                            <div class="post-desc" >' +
                                '                               ' + innerData.desc + '' +
                                '                            </div>' +
                                '                         ' +
                                '                            <div class="post-video">' +
                                '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + innerData.title + '" type="video/mp4">' +
                                '                </video>' +
                                '                            </div>' +
                                '                        </div>';


                        } else if (data[0].detail[i].format == "audio") {
                            folder = "audios";
                            innerContent = '<div class="shared-post">' +
                                '                            <div class="row post-head">' +
                                '                                <div class="col-15 post-pro-pic col-center">' +
                                '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                '                                </div>' +
                                '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                '                            </div>' +
                                '                            ' +
                                '                            <div class="post-desc" >' +
                                '                               ' + innerData.desc + '' +
                                '                            </div>' +
                                '                         ' +
                                '                            <div class="post-video">' +
                                '                <audio controls preload="auto">' +
                                '                    <source src="' + server + innerData.title + '" type="audio/wav">' +
                                '                </audio>' +
                                '                            </div>' +
                                '                        </div>';



                        } else if (data[0].detail[i].format == "file") {
                            folder = "files";
                            var holder1 = "";
                            var path1 = innerData.title;
                            var ext1 = path1.substr(path1.lastIndexOf('.') + 1);
                            var extName1 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x1 in extName1) {
                                if (x1 == ext1) {
                                    console.log("File is: " + x1);
                                    holder1 = 'img/attach_icons/' + extName1[x1];
                                }
                            }
                            innerContent = '<div class="shared-post">' +
                                '                            <div class="row post-head">' +
                                '                                <div class="col-15 post-pro-pic col-center">' +
                                '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                '                                </div>' +
                                '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                '                            </div>' +
                                '                            ' +
                                '                            <div class="post-desc" >' +
                                '                               ' + innerData.desc + '' +
                                '                            </div>' +
                                '                         ' +
                                '                            <div class="post-pic">' +
                                '                              <img src="' + holder1 + '" />' +
                                '                            </div>' +
                                '                        </div>';

                        }

                        content += '<div class="post-container">' +
                            '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                            '<div class="col-15 post-pro-pic col-center">' +
                            '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                            // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                            '</div>' +
                            '</div>' +
                            '<div class="col-60">' +
                            '<p>' + data[0].detail[i].postedByName + '<span class="post-shared-user"> shared</span>' + '</p>' +
                            '</div>' +
                            '<div class="col-25 post-time">' +
                            formatAMPM(new Date(data[0].detail[i].at)) +
                            '</div>' +
                            '</div>' +
                            '' + innerContent + '' +
                            '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                            '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + innerJson + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                            '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/' + folder + '\')" ><i class="fa fa-download"></i> </div>' +
                            '</div>' +
                            '</div>';
                    }
                }
                document.getElementById('dataFeed').innerHTML = content;
                setTimeout(function() {
                    myScroll.refresh(); //for iScroll  
                }, 1000);
                $("img").on('error', function() {
                    $(this).attr("src", "img/pictures/notFound.png");
                });
                setTimeout(function() {
                    $("video,audio").on('click', function() {
                        if (this.paused) {
                            this.play();
                        } else {
                            this.pause();
                        }
                        if (this.getAttribute('controls') !== 'true') {
                            this.setAttribute('controls', 'true');
                        }
                        this.setAttribute('controls', 'true');
                    });
                }, 2000);
                //console.log(content);
            } else {
                console.log("Not Removed");
            }

        }
    };
    xhttp.open("POST", server + "fetchGroupPost.php", true);
    var parameters = "grpId=" + grpId;
    console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);

}
var offsetGroupHome = 0;

function toggleGroupHomeLoader(arg) {
    document.getElementById("loadMore").style.display = 'none';
    document.getElementById("proLoader").style.display = 'block';
    offsetGroupHome += 10;
    fetchGroupHomePostNext(offsetGroupHome);
}

function fetchGroupHomePostNext(offset) {
    var grpId = localStorage.getItem("GRPID");
    var content = "";
    var content1 = "";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                data = JSON.parse(xhttp.responseText.trim());
                if (data[0].length !== 0) {
                    for (var i = 0; i < data[0].detail.length; i++) {

                        if (data[0].detail[i].type == "photo") {

                            content += '<div class="post-container" >' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].detail[i].postedByName + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + server + getThumb(data[0].detail[i].URL) + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +

                                '</div>' +
                                '</div>';

                        } else if (data[0].detail[i].type == "text") {

                            content += '<div class="post-container" >' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //\'friend_profile.html\'
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '                       <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' + // \'comment_screen.html\'
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-comment" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + '0' + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')">' +
                                '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                                '</div>' +
                                '            </div>';

                        } else if (data[0].detail[i].type == "video") {

                            content += '<div class="post-container" >' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '                        <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <video controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                                '                </video>' +
                                '            </div>' +
                                '           <div class="row post-comment">' +
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +

                                '</div>' +
                                '            </div>';



                        } else if (data[0].detail[i].type == "audio") {
                            content += '<div class="post-container" >' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')" >' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '                        <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc">' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <audio controls preload="auto">' +
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                                '                </audio>' +
                                '            </div>' +
                                '      <div class="row post-comment">' +
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +

                                '</div>' +
                                '        </div>';

                        } else if (data[0].detail[i].type == "file") {
                            var holder = "";
                            var path = data[0].detail[i].URL;
                            var ext = path.substr(path.lastIndexOf('.') + 1);
                            var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x in extName) {
                                if (x == ext) {
                                    console.log("File is: " + x);
                                    holder = 'img/attach_icons/' + extName[x];
                                }
                            }

                            content += '<div class="post-container" >' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].detail[i].postedByName + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + holder + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +

                                '</div>' +
                                '</div>';

                        } else if (data[0].detail[i].type == "shared") {
                            var innerContent = "";
                            var folder = "";
                            var innerData = JSON.parse(data[0].detail[i].desc);
                            var innerJson = data[0].detail[i].desc.replace(/"/g, "~");
                            console.log("innerJson:" + innerJson);
                            if (data[0].detail[i].format == "photo") {
                                folder = "images";
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                            <div class="post-pic">' +
                                    '                              <img src="' + server + getThumb(innerData.title) + '" />' +
                                    '                            </div>' +
                                    '                        </div>';


                            } else if (data[0].detail[i].format == "text") {
                                folder = "text";
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                        </div>';


                            } else if (data[0].detail[i].format == "video") {
                                folder = "videos";
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                            <div class="post-video">' +
                                    '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                    '                    <source src="' + server + innerData.title + '" type="video/mp4">' +
                                    '                </video>' +
                                    '                            </div>' +
                                    '                        </div>';


                            } else if (data[0].detail[i].format == "audio") {
                                folder = "audios";
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                            <div class="post-video">' +
                                    '                <audio controls preload="auto">' +
                                    '                    <source src="' + server + innerData.title + '" type="audio/wav">' +
                                    '                </audio>' +
                                    '                            </div>' +
                                    '                        </div>';



                            } else if (data[0].detail[i].format == "file") {
                                folder = "files";
                                var holder1 = "";
                                var path1 = innerData.title;
                                var ext1 = path1.substr(path1.lastIndexOf('.') + 1);
                                var extName1 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                                for (var x1 in extName1) {
                                    if (x1 == ext1) {
                                        console.log("File is: " + x1);
                                        holder1 = 'img/attach_icons/' + extName1[x1];
                                    }
                                }
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                            <div class="post-pic">' +
                                    '                              <img src="' + holder1 + '" />' +
                                    '                            </div>' +
                                    '                        </div>';

                            }

                            content += '<div class="post-container">' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].detail[i].postedByName + '<span class="post-shared-user"> shared</span>' + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '' + innerContent + '' +
                                '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + innerJson + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/' + folder + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';
                        }
                    }
                    document.getElementById('dataFeed').innerHTML += content;
                    setTimeout(function() {
                        myScroll.refresh(); //for iScroll  
                    }, 1000);
                    $("img").on('error', function() {
                        $(this).attr("src", "img/pictures/notFound.png");
                    });
                    setTimeout(function() {
                        $("video,audio").on('click', function() {
                            if (this.paused) {
                                this.play();
                            } else {
                                this.pause();
                            }
                            if (this.getAttribute('controls') !== 'true') {
                                this.setAttribute('controls', 'true');
                            }
                            this.setAttribute('controls', 'true');
                        });
                    }, 2000);
                } else {
                    console.log("no more group post");
                    myScroll.refresh();
                }

                //console.log(content);
            } else {
                console.log("ELSE");
            }

        }
    };
    xhttp.open("POST", server + "fetchNextGroupPost.php", true);
    var parameters = "grpId=" + grpId + "&offset=" + offset;
    console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function fetchGroupHomePostPrevious() {
    var grpId = localStorage.getItem("GRPID");
    var content = "";
    var content1 = "";
    var data = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log(xhttp.responseText.trim());
            if (xhttp.responseText.trim() !== false && xhttp.responseText.trim() !== "") {
                data = JSON.parse(xhttp.responseText.trim());
                if (data[0].length !== 0) {
                    localStorage.setItem("LASTCREATEDGROUP", data[0].detail[0].at);
                    for (var i = 0; i < data[0].detail.length; i++) {

                        if (data[0].detail[i].type == "photo") {

                            content += '<div class="post-container" >' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].detail[i].postedByName + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + server + getThumb(data[0].detail[i].URL) + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/images' + '\')" ><i class="fa fa-download"></i> </div>' +

                                '</div>' +
                                '</div>';

                        } else if (data[0].detail[i].type == "text") {

                            content += '<div class="post-container" >' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //\'friend_profile.html\'
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '                       <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' + // \'comment_screen.html\'
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-comment" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + '0' + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')">' +
                                '                <i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments' +
                                '</div>' +
                                '            </div>';

                        } else if (data[0].detail[i].type == "video") {

                            content += '<div class="post-container" >' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '                        <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc" >' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <video controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="video/mp4">' +
                                '                </video>' +
                                '            </div>' +
                                '           <div class="row post-comment">' +
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/videos' + '\')" ><i class="fa fa-download"></i> </div>' +

                                '</div>' +
                                '            </div>';



                        } else if (data[0].detail[i].type == "audio") {
                            content += '<div class="post-container" >' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')" >' +
                                '                <div class="col-15 post-pro-pic col-center">' +
                                '                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '                        <img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '                    </div>' +
                                '                </div>' +
                                '                <div class="col-60">' +
                                '                    <p>' + data[0].detail[i].postedByName + '</p>' +
                                '                </div>' +
                                '                <div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '                </div>' +
                                '            </div>' +
                                '            <div class="post-desc">' +
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '            </div>' +
                                '            <div class="post-video">' +
                                '                <audio controls preload="auto">' +
                                '                    <source src="' + server + data[0].detail[i].URL + '" type="audio/wav">' +
                                '                </audio>' +
                                '            </div>' +
                                '      <div class="row post-comment">' +
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/audios' + '\')" ><i class="fa fa-download"></i> </div>' +

                                '</div>' +
                                '        </div>';

                        } else if (data[0].detail[i].type == "file") {
                            var holder = "";
                            var path = data[0].detail[i].URL;
                            var ext = path.substr(path.lastIndexOf('.') + 1);
                            var extName = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                            for (var x in extName) {
                                if (x == ext) {
                                    console.log("File is: " + x);
                                    holder = 'img/attach_icons/' + extName[x];
                                }
                            }

                            content += '<div class="post-container" >' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].detail[i].postedByName + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '<div class="post-desc" >' + //comment_screen
                                emojione.unicodeToImage(data[0].detail[i].desc) +
                                '</div>' +
                                '<div class="post-pic" >' +
                                '<img src="' + holder + '" />' +
                                '</div>' +
                                '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + data[0].detail[i].desc + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/files' + '\')" ><i class="fa fa-download"></i> </div>' +

                                '</div>' +
                                '</div>';

                        } else if (data[0].detail[i].type == "shared") {
                            var innerContent = "";
                            var folder = "";
                            var innerData = JSON.parse(data[0].detail[i].desc);
                            var innerJson = data[0].detail[i].desc.replace(/"/g, "~");
                            console.log("innerJson:" + innerJson);
                            if (data[0].detail[i].format == "photo") {
                                folder = "images";
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                            <div class="post-pic">' +
                                    '                              <img src="' + server + getThumb(innerData.title) + '" />' +
                                    '                            </div>' +
                                    '                        </div>';


                            } else if (data[0].detail[i].format == "text") {
                                folder = "text";
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                        </div>';


                            } else if (data[0].detail[i].format == "video") {
                                folder = "videos";
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                            <div class="post-video">' +
                                    '                <video  controls  preload="auto"  loop>' + //poster="img/icons/video-gallery.svg"
                                    '                    <source src="' + server + innerData.title + '" type="video/mp4">' +
                                    '                </video>' +
                                    '                            </div>' +
                                    '                        </div>';


                            } else if (data[0].detail[i].format == "audio") {
                                folder = "audios";
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                            <div class="post-video">' +
                                    '                <audio controls preload="auto">' +
                                    '                    <source src="' + server + innerData.title + '" type="audio/wav">' +
                                    '                </audio>' +
                                    '                            </div>' +
                                    '                        </div>';



                            } else if (data[0].detail[i].format == "file") {
                                folder = "files";
                                var holder1 = "";
                                var path1 = innerData.title;
                                var ext1 = path1.substr(path1.lastIndexOf('.') + 1);
                                var extName1 = JSON.parse('{"pdf":"pdf.svg" , "txt":"txt.svg" , "doc":"doc.svg" , "docx":"doc.svg" , "ppt":"ppt.svg" , "pptx":"ppt.svg" , "xls":"xls.svg" , "xlsx":"xls.svg"}');
                                for (var x1 in extName1) {
                                    if (x1 == ext1) {
                                        console.log("File is: " + x1);
                                        holder1 = 'img/attach_icons/' + extName1[x1];
                                    }
                                }
                                innerContent = '<div class="shared-post">' +
                                    '                            <div class="row post-head">' +
                                    '                                <div class="col-15 post-pro-pic col-center">' +
                                    '                                    <div class="dash-chat-img" style="background-image:url(' + server + getThumb(innerData.imageURL) + ')"></div>' +
                                    '                                </div>' +
                                    '                                <div class="col-55" ><p>' + innerData.userName + '</p></div>' +
                                    '                                <div class="col-30 post-time">' + formatAMPM(new Date(innerData.time)) + '</div>' +
                                    '                            </div>' +
                                    '                            ' +
                                    '                            <div class="post-desc" >' +
                                    '                               ' + innerData.desc + '' +
                                    '                            </div>' +
                                    '                         ' +
                                    '                            <div class="post-pic">' +
                                    '                              <img src="' + holder1 + '" />' +
                                    '                            </div>' +
                                    '                        </div>';

                            }

                            content += '<div class="post-container">' +
                                '<div class="row post-head" onclick="setGeneratorId(\'' + data[0].detail[i].postedBy + '\')">' + //friend_profile
                                '<div class="col-15 post-pro-pic col-center">' +
                                '<div class="dash-chat-img" style="background-image:url(' + server + getThumb(data[0].detail[i].postedByImageURL) + ')">' +
                                // '<img src="' + server + data[0].detail[i].postedByImageURL + '" />' +
                                '</div>' +
                                '</div>' +
                                '<div class="col-60">' +
                                '<p>' + data[0].detail[i].postedByName + '<span class="post-shared-user"> shared</span>' + '</p>' +
                                '</div>' +
                                '<div class="col-25 post-time">' +
                                formatAMPM(new Date(data[0].detail[i].at)) +
                                '</div>' +
                                '</div>' +
                                '' + innerContent + '' +
                                '<div class="row post-comment">' + //data[0].detail[i].postedBy //data[0].detail[i].postedByImageURL //
                                '<div class="col-50" onclick="setGroupPostId(\'' + data[0].detail[i].pId + '\',\'' + data[0].detail[i].type + '\',\'' + data[0].id + '\',\'' + data[0].imageURL + '\',\'' + data[0].name + '\',\'' + data[0].detail[i].at + '\',\'' + innerJson + '\',\'' + data[0].detail[i].URL + '\',\'' + data[0].detail[i].commentCount + '\',\'' + data[0].detail[i].postedBy + '\',\'' + data[0].detail[i].postedByName + '\')"><i class="fa fa-comment"></i> ' + data[0].detail[i].commentCount + ' comments </div>' +
                                '<div class="col-50 text-right" onclick="download(\'' + server + data[0].detail[i].URL + '\',\'' + 'MSG/' + folder + '\')" ><i class="fa fa-download"></i> </div>' +
                                '</div>' +
                                '</div>';
                        }
                    }
                    document.getElementById('dataFeed').innerHTML = content + document.getElementById('dataFeed').innerHTML;
                    setTimeout(function() {
                        myScroll.refresh(); //for iScroll  
                    }, 1000);
                    $("img").on('error', function() {
                        $(this).attr("src", "img/pictures/notFound.png");
                    });
                    setTimeout(function() {
                        $("video,audio").on('click', function() {
                            if (this.paused) {
                                this.play();
                            } else {
                                this.pause();
                            }
                            if (this.getAttribute('controls') !== 'true') {
                                this.setAttribute('controls', 'true');
                            }
                            this.setAttribute('controls', 'true');
                        });
                    }, 2000);

                } else {
                    console.log('no more group posts');
                    myScroll.refresh();
                }

                //console.log(content);
            } else {
                console.log("ELSE");
            }

        }
    };
    xhttp.open("POST", server + "fetchPrevGroupPost.php", true);
    var parameters = "grpId=" + grpId + "&onset=" + encodeURIComponent(localStorage.getItem("LASTCREATEDGROUP"));
    console.log(parameters);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function openHome() {
    document.getElementById("currentPage").innerHTML = document.getElementById("grpHome").getAttribute("data-group-name");
    $(".grpCol").html("");
    document.getElementById("grpColHome").innerHTML = '<i class="fa fa-dot-circle-o" aria-hidden="true"></i>';

    document.getElementById("buttonSwapText").setAttribute("onclick", "uploadText('')");
    document.getElementById("buttonSwapVideo").setAttribute("onclick", "uploadVideo('')");
    document.getElementById("buttonSwapAudio").setAttribute("onclick", "uploadAudio('')");
    document.getElementById("buttonSwapPhoto").setAttribute("onclick", "uploadPhoto('')");
    document.getElementById("buttonSwapFile").setAttribute("onclick", "uploadFile('')");

    document.getElementById("buttonSwapTakePhoto").setAttribute("onclick", "postTakePhoto()");
    document.getElementById("buttonSwapGetPhoto").setAttribute("onclick", "postGetPhoto()");
    document.getElementById("buttonSwapTakeVideo").setAttribute("onclick", "postTakevideo()");
    document.getElementById("buttonSwapGetVideo").setAttribute("onclick", "postGetVideo()");
    document.getElementById("buttonSwapTakeAudio").setAttribute("onclick", "postTakeAudio()");
    document.getElementById("buttonSwapGetAudio").setAttribute("onclick", "postGetAudio()");
    document.getElementById("buttonSwapGetFile").setAttribute("onclick", "postGetFile()");

    currentPage = 0;

    dataFeedRefreshPopulate();
}
////////////////////
// APP SHARING    //
//general sharing //
////////////////////
function appSharing() {
    window.plugins.socialsharing.share('MSG,A Complete Social Networking Solution', 'A Complete Social Networking Solution', 'www/img/icon.png', 'https://play.google.com/store/apps/details?id=com.terasoltechnologies.msg');
}

///////////////
// FILE OPEN //
/////////////////
function openFileInApp(URL, loc) {
    function onSuccess(data) {
        console.log('extension: ' + data.extension + '\n' + 'canBeOpen: ' + data.canBeOpen);
        if (data.canBeOpen) {
            window.cordova.plugins.FileOpener.openFile(URL, onSucc, onError);
        } else {
            alert("Phone Doesn't Have The Required Software.");
        }
    }

    function onSucc(data) {
        console.log('message: ' + data.message);
    }

    function onError(error) {
        console.log('message: ' + error.message);
    }

    window.cordova.plugins.FileOpener.canOpenFile(URL, onSuccess, onError);
    //window.cordova.plugins.FileOpener.canOpenFile("file:///storage/emulated/0/Download/local_file.pdf", onSuccess, onError);
}

//Thumbnail Replacement
function getThumb(str) {
    try {
        // var str = 'a/b/c';
        var replacement = '/th_';
        str = str.replace(/\/([^\/]*)$/, replacement + '$1');
    } catch (err) {
        console.log('No Image');
        str = "uploads/notFound.png";
    }
    return str;
}

function remThumb(str) {
    str = str.replace(/th_/g, "");
    return str;
}


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////// WALLET HTML /////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function fetchWallet() {
    preLoaderOn();
    if (localStorage.getItem("PROVIDERS") !== "" && localStorage.getItem("PROVIDERS") !== null) {
        getPoints();
    } else {
        getProviders();
    }


}

function getProviders() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log("GetPro:" + xhttp.responseText.trim());
            if (xhttp.responseText != "" && xhttp.responseText !== null) {
                localStorage.setItem("PROVIDERS", xhttp.responseText);
                getPoints();
            }
            preLoaderOff();
        }
    };
    xhttp.open("POST", server + "fetchWallet.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID") + "&code=" + "1";
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}

function getPoints() {
    var list = "<option selected disabled>Operator</option>";
    var data = JSON.parse(localStorage.getItem("PROVIDERS")).providers;
    var data1 = "";
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (xhttp.readyState == 4 && xhttp.status == 200) {
            console.log("GetPoi:" + xhttp.responseText.trim());
            if (xhttp.responseText != "" && xhttp.responseText !== null) {
                data1 = JSON.parse(xhttp.responseText);
                for (var i = 0; i < data.length; i++) {
                    if (data[i].provider_id == data1.detail.provider_id) {
                        list += '<option value="' + data[i].provider_id + '" selected>' + data[i].provider_name + '</option>';
                    } else {
                        list += '<option value="' + data[i].provider_id + '">' + data[i].provider_name + '</option>';
                    }
                    document.getElementById('operatorList').innerHTML = list;
                }
            }
            preLoaderOff();
        }
    };
    xhttp.open("POST", server + "fetchWallet.php", true);
    var parameters = "proId=" + localStorage.getItem("PROID") + "&code=" + "2";
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send(parameters);
}
